generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["youspeak_exercisein"]
}

model Assignment {
  id             String       @id
  sessionId      String?
  title          String
  description    String?
  attachmentUrls String?
  dueDate        DateTime?    @db.Timestamp(6)
  createdAt      DateTime     @default(now()) @db.Timestamp(6)
  updatedAt      DateTime     @default(now()) @db.Timestamp(6)
  Session        Session?     @relation(fields: [sessionId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Submission     Submission[]

  @@schema("youspeak_exercisein")
}

model AuditLog {
  id        String   @id
  action    String
  userId    String?
  details   String?
  createdAt DateTime @default(now()) @db.Timestamp(6)

  @@schema("youspeak_exercisein")
}

model Chat {
  id                         String   @id
  fromUserId                 String
  toUserId                   String
  content                    String
  attachments                String?
  isSaved                    Boolean  @default(false)
  createdAt                  DateTime @default(now()) @db.Timestamp(6)
  User_Chat_fromUserIdToUser User     @relation("Chat_fromUserIdToUser", fields: [fromUserId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  User_Chat_toUserIdToUser   User     @relation("Chat_toUserIdToUser", fields: [toUserId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("youspeak_exercisein")
}

model Package {
  id            String         @id
  title         String
  titleAr       String
  description   String?
  descriptionAr String?
  price         Float
  lessonsCount  Int
  durationDays  Int
  isActive      Boolean        @default(true)
  createdAt     DateTime       @default(now()) @db.Timestamp(6)
  updatedAt     DateTime       @default(now()) @db.Timestamp(6)
  Subscription  Subscription[]

  @@schema("youspeak_exercisein")
}

model Session {
  id             String           @id
  teacherId      String
  title          String
  startTime      DateTime         @db.Timestamp(6)
  endTime        DateTime         @db.Timestamp(6)
  status         String           @default("SCHEDULED")
  roomId         String?          @unique
  recordingUrl   String?
  createdAt      DateTime         @default(now()) @db.Timestamp(6)
  updatedAt      DateTime         @default(now()) @db.Timestamp(6)
  Assignment     Assignment[]
  TeacherProfile TeacherProfile   @relation(fields: [teacherId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  SessionStudent SessionStudent[]

  @@schema("youspeak_exercisein")
}

model SessionStudent {
  id        String   @id
  sessionId String
  studentId String
  attended  Boolean  @default(false)
  createdAt DateTime @default(now()) @db.Timestamp(6)
  Session   Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  User      User     @relation(fields: [studentId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([sessionId, studentId])
  @@schema("youspeak_exercisein")
}

model StudentProfile {
  id            String   @id
  userId        String   @unique
  age           Int?
  levelInitial  String?
  levelCurrent  String?
  targetLevel   String?
  goal          String?
  preferredTime String?
  isVerified    Boolean  @default(false)
  createdAt     DateTime @default(now()) @db.Timestamp(6)
  updatedAt     DateTime @default(now()) @db.Timestamp(6)
  User          User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("youspeak_exercisein")
}

model Submission {
  id            String     @id
  assignmentId  String
  studentId     String
  textAnswer    String?
  attachedFiles String?
  grade         Float?
  feedback      String?
  grammarErrors String?
  submittedAt   DateTime   @default(now()) @db.Timestamp(6)
  updatedAt     DateTime   @default(now()) @db.Timestamp(6)
  Assignment    Assignment @relation(fields: [assignmentId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  User          User       @relation(fields: [studentId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("youspeak_exercisein")
}

model Subscription {
  id         String    @id
  studentId  String
  packageId  String
  paid       Boolean   @default(false)
  receiptUrl String?
  startDate  DateTime? @db.Timestamp(6)
  endDate    DateTime? @db.Timestamp(6)
  createdAt  DateTime  @default(now()) @db.Timestamp(6)
  updatedAt  DateTime  @default(now()) @db.Timestamp(6)
  Package    Package   @relation(fields: [packageId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  User       User      @relation(fields: [studentId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("youspeak_exercisein")
}

model TeacherProfile {
  id        String    @id
  userId    String    @unique
  bio       String?
  subjects  String?
  createdAt DateTime  @default(now()) @db.Timestamp(6)
  updatedAt DateTime  @default(now()) @db.Timestamp(6)
  Session   Session[]
  User      User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("youspeak_exercisein")
}

model User {
  id                         String           @id
  email                      String           @unique
  name                       String
  phone                      String?
  passwordHash               String
  role                       String           @default("STUDENT")
  profilePhoto               String?
  isActive                   Boolean          @default(false)
  createdAt                  DateTime         @default(now()) @db.Timestamp(6)
  updatedAt                  DateTime         @default(now()) @db.Timestamp(6)
  Chat_Chat_fromUserIdToUser Chat[]           @relation("Chat_fromUserIdToUser")
  Chat_Chat_toUserIdToUser   Chat[]           @relation("Chat_toUserIdToUser")
  SessionStudent             SessionStudent[]
  StudentProfile             StudentProfile?
  Submission                 Submission[]
  Subscription               Subscription[]
  TeacherProfile             TeacherProfile?
  Word                       Word[]

  @@schema("youspeak_exercisein")
}

model Word {
  id               String   @id
  studentId        String
  englishWord      String
  arabicMeaning    String
  exampleSentence  String?
  pronunciationUrl String?
  known            Boolean  @default(false)
  reviewCount      Int      @default(0)
  createdAt        DateTime @default(now()) @db.Timestamp(6)
  updatedAt        DateTime @default(now()) @db.Timestamp(6)
  User             User     @relation(fields: [studentId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("youspeak_exercisein")
}
