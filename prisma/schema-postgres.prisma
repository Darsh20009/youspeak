generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

enum UserRole {
  STUDENT
  TEACHER
  ADMIN
  ASSISTANT
  GUEST
}

enum SessionStatus {
  SCHEDULED
  ONGOING
  COMPLETED
  CANCELLED
}

enum LanguageLevel {
  A1
  A2
  B1
  B2
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  name          String
  phone         String?
  passwordHash  String
  role          UserRole  @default(STUDENT)
  profilePhoto  String?
  isActive      Boolean   @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  studentProfile StudentProfile?
  teacherProfile TeacherProfile?
  subscriptions  Subscription[]
  words          Word[]
  submissions    Submission[]
  sentMessages   Chat[]        @relation("SentMessages")
  receivedMessages Chat[]      @relation("ReceivedMessages")
  sessions       SessionStudent[]
  
  
}

model StudentProfile {
  id            String        @id @default(uuid())
  userId        String        @unique
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  age           Int?
  levelInitial  LanguageLevel?
  levelCurrent  LanguageLevel?
  targetLevel   LanguageLevel?
  goal          String?
  preferredTime String?
  isVerified    Boolean       @default(false)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  
}

model TeacherProfile {
  id              String    @id @default(uuid())
  userId          String    @unique
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  bio             String?
  subjects        String[]
  sessionsCreated Session[] @relation("TeacherSessions")
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  
}

model Package {
  id            String         @id @default(uuid())
  title         String
  titleAr       String
  description   String?
  descriptionAr String?
  price         Float
  lessonsCount  Int
  durationDays  Int
  isActive      Boolean        @default(true)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  subscriptions Subscription[]

  
}

model Subscription {
  id         String   @id @default(uuid())
  studentId  String
  student    User     @relation(fields: [studentId], references: [id], onDelete: Cascade)
  packageId  String
  package    Package  @relation(fields: [packageId], references: [id])
  paid       Boolean  @default(false)
  receiptUrl String?
  startDate  DateTime?
  endDate    DateTime?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  
}

model Session {
  id          String          @id @default(uuid())
  teacherId   String
  teacher     TeacherProfile  @relation("TeacherSessions", fields: [teacherId], references: [id])
  title       String
  startTime   DateTime
  endTime     DateTime
  status      SessionStatus   @default(SCHEDULED)
  roomId      String?         @unique
  recordingUrl String?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  students    SessionStudent[]
  assignments Assignment[]

  
}

model SessionStudent {
  id        String   @id @default(uuid())
  sessionId String
  session   Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  studentId String
  student   User     @relation(fields: [studentId], references: [id], onDelete: Cascade)
  attended  Boolean  @default(false)
  createdAt DateTime @default(now())

  @@unique([sessionId, studentId])
  
}

model Word {
  id                String   @id @default(uuid())
  studentId         String
  student           User     @relation(fields: [studentId], references: [id], onDelete: Cascade)
  englishWord       String
  arabicMeaning     String
  exampleSentence   String?
  pronunciationUrl  String?
  known             Boolean  @default(false)
  reviewCount       Int      @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  
}

model Assignment {
  id            String       @id @default(uuid())
  sessionId     String?
  session       Session?     @relation(fields: [sessionId], references: [id])
  title         String
  description   String?
  attachmentUrls String[]
  dueDate       DateTime?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  submissions   Submission[]

  
}

model Submission {
  id             String   @id @default(uuid())
  assignmentId   String
  assignment     Assignment @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  studentId      String
  student        User     @relation(fields: [studentId], references: [id], onDelete: Cascade)
  textAnswer     String?
  attachedFiles  String[]
  grade          Float?
  feedback       String?
  grammarErrors  Json?
  submittedAt    DateTime @default(now())
  updatedAt      DateTime @updatedAt

  
}

model Chat {
  id          String   @id @default(uuid())
  fromUserId  String
  fromUser    User     @relation("SentMessages", fields: [fromUserId], references: [id], onDelete: Cascade)
  toUserId    String
  toUser      User     @relation("ReceivedMessages", fields: [toUserId], references: [id], onDelete: Cascade)
  content     String
  attachments String[]
  isSaved     Boolean  @default(false)
  createdAt   DateTime @default(now())

  
}

model AuditLog {
  id        String   @id @default(uuid())
  action    String
  userId    String?
  details   Json?
  createdAt DateTime @default(now())

  
}
