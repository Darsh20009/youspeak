{"file_contents":{"app/dashboard/student/components/SessionsTab.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { Calendar, Clock, User, CheckCircle, XCircle, Video } from 'lucide-react'\nimport Card from '@/components/ui/Card'\nimport Badge from '@/components/ui/Badge'\nimport Alert from '@/components/ui/Alert'\nimport LoadingSpinner from '@/components/ui/LoadingSpinner'\nimport Button from '@/components/ui/Button'\n\ninterface Session {\n  id: string\n  sessionId: string\n  attended: boolean\n  session: {\n    id: string\n    title: string\n    startTime: string\n    endTime: string\n    status: string\n    roomId: string | null\n    teacher: {\n      user: {\n        name: string\n      }\n    }\n  }\n}\n\nexport default function SessionsTab({ isActive }: { isActive: boolean }) {\n  const router = useRouter()\n  const [sessions, setSessions] = useState<Session[]>([])\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    if (isActive) {\n      fetchSessions()\n    }\n  }, [isActive])\n\n  async function fetchSessions() {\n    try {\n      const response = await fetch('/api/sessions/student')\n      if (response.ok) {\n        const data = await response.json()\n        setSessions(data)\n      }\n    } catch (error) {\n      console.error('Error fetching sessions:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const upcomingSessions = sessions.filter(s => \n    new Date(s.session.startTime) > new Date() && s.session.status === 'SCHEDULED'\n  )\n  const pastSessions = sessions.filter(s => \n    new Date(s.session.startTime) <= new Date() || s.session.status !== 'SCHEDULED'\n  )\n\n  if (!isActive) {\n    return (\n      <div>\n        <h2 className=\"text-3xl font-bold text-primary-600 dark:text-primary-300 mb-6\">\n          My Sessions / حصصي\n        </h2>\n        <Alert variant=\"warning\">\n          <p>Activate your account to book sessions / قم بتفعيل حسابك لحجز الحصص</p>\n        </Alert>\n      </div>\n    )\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <LoadingSpinner size=\"lg\" />\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <h2 className=\"text-3xl font-bold text-primary-600 dark:text-primary-300\">\n        My Sessions / حصصي\n      </h2>\n\n      <div>\n        <h3 className=\"text-xl font-semibold text-neutral-900 dark:text-neutral-100 mb-4\">\n          Upcoming Sessions / الحصص القادمة\n        </h3>\n        {upcomingSessions.length === 0 ? (\n          <Alert variant=\"info\">\n            <p>No upcoming sessions scheduled.</p>\n            <p>لا توجد حصص مجدولة حالياً.</p>\n          </Alert>\n        ) : (\n          <div className=\"space-y-4\">\n            {upcomingSessions.map((session) => (\n              <Card key={session.id} variant=\"elevated\">\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <h3 className=\"text-lg font-bold text-primary-600 dark:text-primary-300\">{session.session.title}</h3>\n                      <Badge variant=\"primary\">Upcoming / قادمة</Badge>\n                    </div>\n                    <div className=\"space-y-1 text-sm text-neutral-600 dark:text-neutral-400\">\n                      <div className=\"flex items-center gap-2\">\n                        <Calendar className=\"h-4 w-4\" />\n                        <span>{new Date(session.session.startTime).toLocaleDateString('ar-EG', {\n                          weekday: 'long',\n                          year: 'numeric',\n                          month: 'long',\n                          day: 'numeric'\n                        })}</span>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Clock className=\"h-4 w-4\" />\n                        <span>\n                          {new Date(session.session.startTime).toLocaleTimeString('ar-EG', {\n                            hour: '2-digit',\n                            minute: '2-digit'\n                          })}\n                          {' - '}\n                          {new Date(session.session.endTime).toLocaleTimeString('ar-EG', {\n                            hour: '2-digit',\n                            minute: '2-digit'\n                          })}\n                        </span>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <User className=\"h-4 w-4\" />\n                        <span>Teacher / المعلم: {session.session.teacher.user.name}</span>\n                      </div>\n                    </div>\n                  </div>\n                  <Button \n                    variant=\"primary\" \n                    size=\"sm\"\n                    onClick={() => router.push(`/session/${session.session.id}`)}\n                  >\n                    <Video className=\"h-4 w-4 mr-2\" />\n                    Join Session / انضم للحصة\n                  </Button>\n                </div>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n\n      <div>\n        <h3 className=\"text-xl font-semibold text-neutral-900 dark:text-neutral-100 mb-4\">\n          Past Sessions / الحصص السابقة\n        </h3>\n        {pastSessions.length === 0 ? (\n          <Alert variant=\"info\">\n            <p>No past sessions yet.</p>\n            <p>لا توجد حصص سابقة بعد.</p>\n          </Alert>\n        ) : (\n          <div className=\"space-y-4\">\n            {pastSessions.slice(0, 5).map((session) => (\n              <Card key={session.id} variant=\"elevated\">\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <h3 className=\"text-lg font-bold text-neutral-700 dark:text-neutral-300\">{session.session.title}</h3>\n                      {session.attended ? (\n                        <Badge variant=\"success\">\n                          <CheckCircle className=\"h-3 w-3 mr-1\" />\n                          Attended / حضور\n                        </Badge>\n                      ) : (\n                        <Badge variant=\"warning\">\n                          <XCircle className=\"h-3 w-3 mr-1\" />\n                          Absent / غياب\n                        </Badge>\n                      )}\n                    </div>\n                    <div className=\"space-y-1 text-sm text-neutral-600 dark:text-neutral-400\">\n                      <div className=\"flex items-center gap-2\">\n                        <Calendar className=\"h-4 w-4\" />\n                        <span>{new Date(session.session.startTime).toLocaleDateString('ar-EG')}</span>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <User className=\"h-4 w-4\" />\n                        <span>{session.session.teacher.user.name}</span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n","size_bytes":7246},"app/dashboard/student/components/MyLearnTab.tsx":{"content":"'use client'\n\nimport { useState, useEffect, useRef } from 'react'\nimport { Plus, Trash2, Check, X, FileDown, Upload, Languages, CheckSquare } from 'lucide-react'\nimport Card from '@/components/ui/Card'\nimport Button from '@/components/ui/Button'\nimport Input from '@/components/ui/Input'\nimport Alert from '@/components/ui/Alert'\nimport LoadingSpinner from '@/components/ui/LoadingSpinner'\nimport Badge from '@/components/ui/Badge'\nimport { exportWordsToExcel } from '@/lib/utils/exportToExcel'\n\ninterface Word {\n  id: string\n  englishWord: string\n  arabicMeaning: string\n  exampleSentence: string | null\n  known: boolean\n  reviewCount: number\n  createdAt: string\n}\n\nexport default function MyLearnTab({ isActive }: { isActive: boolean }) {\n  const [words, setWords] = useState<Word[]>([])\n  const [loading, setLoading] = useState(true)\n  const [showAddForm, setShowAddForm] = useState(false)\n  const [showImportForm, setShowImportForm] = useState(false)\n  const [selectedWords, setSelectedWords] = useState<Set<string>>(new Set())\n  const [newWord, setNewWord] = useState({\n    englishWord: '',\n    arabicMeaning: '',\n    exampleSentence: ''\n  })\n  const [submitting, setSubmitting] = useState(false)\n  const [translating, setTranslating] = useState(false)\n  const [importing, setImporting] = useState(false)\n  const fileInputRef = useRef<HTMLInputElement>(null)\n\n  useEffect(() => {\n    if (isActive) {\n      fetchWords()\n    }\n  }, [isActive])\n\n  async function fetchWords() {\n    try {\n      const response = await fetch('/api/words')\n      if (response.ok) {\n        const data = await response.json()\n        setWords(data)\n      }\n    } catch (error) {\n      console.error('Error fetching words:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  async function handleAddWord() {\n    if (!newWord.englishWord || !newWord.arabicMeaning) {\n      return\n    }\n\n    setSubmitting(true)\n    try {\n      const response = await fetch('/api/words', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(newWord)\n      })\n\n      if (response.ok) {\n        const word = await response.json()\n        setWords([word, ...words])\n        setNewWord({ englishWord: '', arabicMeaning: '', exampleSentence: '' })\n        setShowAddForm(false)\n      }\n    } catch (error) {\n      console.error('Error adding word:', error)\n    } finally {\n      setSubmitting(false)\n    }\n  }\n\n  async function handleToggleKnown(wordId: string, currentKnown: boolean) {\n    try {\n      const response = await fetch(`/api/words/${wordId}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ known: !currentKnown })\n      })\n\n      if (response.ok) {\n        setWords(words.map(w => \n          w.id === wordId ? { ...w, known: !currentKnown } : w\n        ))\n      }\n    } catch (error) {\n      console.error('Error updating word:', error)\n    }\n  }\n\n  async function handleDeleteWord(wordId: string) {\n    if (!confirm('Are you sure you want to delete this word?')) {\n      return\n    }\n\n    try {\n      const response = await fetch(`/api/words/${wordId}`, {\n        method: 'DELETE'\n      })\n\n      if (response.ok) {\n        setWords(words.filter(w => w.id !== wordId))\n      }\n    } catch (error) {\n      console.error('Error deleting word:', error)\n    }\n  }\n\n  async function handleDeleteSelected() {\n    if (selectedWords.size === 0) return\n    \n    if (!confirm(`Are you sure you want to delete ${selectedWords.size} word(s)?`)) {\n      return\n    }\n\n    try {\n      const deletePromises = Array.from(selectedWords).map(wordId =>\n        fetch(`/api/words/${wordId}`, { method: 'DELETE' })\n      )\n      \n      await Promise.all(deletePromises)\n      setWords(words.filter(w => !selectedWords.has(w.id)))\n      setSelectedWords(new Set())\n    } catch (error) {\n      console.error('Error deleting words:', error)\n      alert('Error deleting some words. Please try again.')\n    }\n  }\n\n  function toggleSelect(wordId: string) {\n    const newSelected = new Set(selectedWords)\n    if (newSelected.has(wordId)) {\n      newSelected.delete(wordId)\n    } else {\n      newSelected.add(wordId)\n    }\n    setSelectedWords(newSelected)\n  }\n\n  function selectAll() {\n    if (selectedWords.size === words.length) {\n      setSelectedWords(new Set())\n    } else {\n      setSelectedWords(new Set(words.map(w => w.id)))\n    }\n  }\n\n  async function handleTranslate() {\n    if (!newWord.englishWord) return\n    \n    setTranslating(true)\n    try {\n      const response = await fetch('/api/translate', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ text: newWord.englishWord, sourceLang: 'en', targetLang: 'ar' })\n      })\n      \n      if (response.ok) {\n        const data = await response.json()\n        setNewWord({ ...newWord, arabicMeaning: data.translation })\n      }\n    } catch (error) {\n      console.error('Translation error:', error)\n      alert('Translation failed')\n    } finally {\n      setTranslating(false)\n    }\n  }\n\n  async function handleFileImport(event: React.ChangeEvent<HTMLInputElement>) {\n    const file = event.target.files?.[0]\n    if (!file) return\n\n    setImporting(true)\n    try {\n      const text = await file.text()\n      const lines = text.split('\\n').map(line => line.trim()).filter(line => line.length > 0)\n      \n      const wordsToImport = lines.slice(0, 100).map(line => ({\n        englishWord: line,\n        arabicMeaning: '',\n        exampleSentence: ''\n      }))\n\n      const response = await fetch('/api/words/import', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ words: wordsToImport })\n      })\n\n      if (response.ok) {\n        const data = await response.json()\n        alert(`Successfully imported ${data.count} words!`)\n        fetchWords()\n        setShowImportForm(false)\n      }\n    } catch (error) {\n      console.error('Import error:', error)\n      alert('Failed to import words')\n    } finally {\n      setImporting(false)\n      if (fileInputRef.current) {\n        fileInputRef.current.value = ''\n      }\n    }\n  }\n\n  if (!isActive) {\n    return (\n      <div>\n        <h2 className=\"text-3xl font-bold text-[#004E89] mb-6\">\n          MyLearn - My Words / كلماتي\n        </h2>\n        <Alert variant=\"warning\">\n          <p>Activate your account to access this feature / قم بتفعيل حسابك للوصول لهذه الميزة</p>\n        </Alert>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between flex-wrap gap-4\">\n        <h2 className=\"text-2xl sm:text-3xl font-bold text-gray-900\">\n          MyLearn - My Words / كلماتي\n        </h2>\n        <div className=\"flex gap-2 flex-wrap\">\n          {words.length > 0 && (\n            <>\n              <Button\n                variant=\"outline\"\n                onClick={selectAll}\n                size=\"sm\"\n              >\n                <CheckSquare className=\"h-4 w-4 mr-2\" />\n                {selectedWords.size === words.length ? 'Deselect All / إلغاء الكل' : 'Select All / تحديد الكل'}\n              </Button>\n              {selectedWords.size > 0 && (\n                <Button\n                  variant=\"outline\"\n                  onClick={handleDeleteSelected}\n                  size=\"sm\"\n                  className=\"border-red-500 text-red-600 hover:bg-red-50\"\n                >\n                  <Trash2 className=\"h-4 w-4 mr-2\" />\n                  Delete Selected ({selectedWords.size}) / حذف المحدد\n                </Button>\n              )}\n            </>\n          )}\n          <Button\n            variant=\"outline\"\n            onClick={() => setShowImportForm(!showImportForm)}\n          >\n            <Upload className=\"h-4 w-4 mr-2\" />\n            Import / استيراد\n          </Button>\n          <Button\n            variant=\"outline\"\n            onClick={() => exportWordsToExcel(words.filter(w => !w.known), 'unknown-words.xlsx', true)}\n            disabled={words.filter(w => !w.known).length === 0}\n          >\n            <FileDown className=\"h-4 w-4 mr-2\" />\n            Export Unknown / تصدير غير المحفوظة\n          </Button>\n          <Button\n            variant=\"outline\"\n            onClick={() => exportWordsToExcel(words, 'all-words.xlsx')}\n            disabled={words.length === 0}\n          >\n            <FileDown className=\"h-4 w-4 mr-2\" />\n            Export All / تصدير الكل\n          </Button>\n          <Button\n            variant=\"primary\"\n            onClick={() => setShowAddForm(!showAddForm)}\n          >\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Add Word / أضف كلمة\n          </Button>\n        </div>\n      </div>\n\n      {showImportForm && (\n        <Card variant=\"elevated\">\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4\">\n            Import Words / استيراد الكلمات\n          </h3>\n          <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">\n            Upload a text file with one English word per line (max 100 words). Words will be automatically translated to Arabic.\n          </p>\n          <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\" dir=\"rtl\">\n            قم برفع ملف نصي يحتوي على كلمة إنجليزية واحدة في كل سطر (حد أقصى 100 كلمة). سيتم ترجمة الكلمات تلقائيًا إلى العربية.\n          </p>\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            accept=\".txt\"\n            onChange={handleFileImport}\n            disabled={importing}\n            className=\"block w-full text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer bg-gray-50 dark:bg-gray-800 focus:outline-none p-2\"\n          />\n          {importing && (\n            <div className=\"mt-4 text-center\">\n              <LoadingSpinner size=\"md\" />\n              <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-2\">\n                Importing and translating words...\n              </p>\n            </div>\n          )}\n        </Card>\n      )}\n\n      {showAddForm && (\n        <Card variant=\"elevated\">\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4\">Add New Word / أضف كلمة جديدة</h3>\n          <div className=\"space-y-4\">\n            <Input\n              label=\"English Word / الكلمة بالإنجليزية\"\n              value={newWord.englishWord}\n              onChange={(e) => setNewWord({ ...newWord, englishWord: e.target.value })}\n              placeholder=\"e.g., Hello\"\n            />\n            <div>\n              <Input\n                label=\"Arabic Meaning / المعنى بالعربية\"\n                value={newWord.arabicMeaning}\n                onChange={(e) => setNewWord({ ...newWord, arabicMeaning: e.target.value })}\n                placeholder=\"مثال: مرحباً\"\n              />\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={handleTranslate}\n                disabled={!newWord.englishWord || translating}\n                className=\"mt-2\"\n              >\n                <Languages className=\"h-4 w-4 mr-2\" />\n                {translating ? 'Translating...' : 'Auto Translate / ترجمة تلقائية'}\n              </Button>\n            </div>\n            <Input\n              label=\"Example Sentence (Optional) / جملة توضيحية (اختياري)\"\n              value={newWord.exampleSentence}\n              onChange={(e) => setNewWord({ ...newWord, exampleSentence: e.target.value })}\n              placeholder=\"e.g., Hello, how are you?\"\n            />\n            <div className=\"flex gap-2\">\n              <Button\n                variant=\"primary\"\n                onClick={handleAddWord}\n                disabled={submitting || !newWord.englishWord || !newWord.arabicMeaning}\n              >\n                {submitting ? 'Adding...' : 'Add / إضافة'}\n              </Button>\n              <Button\n                variant=\"outline\"\n                onClick={() => setShowAddForm(false)}\n              >\n                Cancel / إلغاء\n              </Button>\n            </div>\n          </div>\n        </Card>\n      )}\n\n      {loading ? (\n        <div className=\"flex items-center justify-center h-64\">\n          <LoadingSpinner size=\"lg\" />\n        </div>\n      ) : words.length === 0 ? (\n        <Alert variant=\"info\">\n          <p>No words saved yet. Start adding words to build your vocabulary!</p>\n          <p>لم تقم بحفظ أي كلمات بعد. ابدأ بإضافة كلمات لبناء مفرداتك!</p>\n        </Alert>\n      ) : (\n        <div className=\"grid md:grid-cols-2 gap-4\">\n          {words.map((word) => (\n            <Card \n              key={word.id} \n              variant=\"elevated\"\n              className={`transition-all ${selectedWords.has(word.id) ? 'ring-2 ring-gray-900 bg-gray-50' : ''}`}\n            >\n              <div className=\"flex items-start gap-3\">\n                <input\n                  type=\"checkbox\"\n                  checked={selectedWords.has(word.id)}\n                  onChange={() => toggleSelect(word.id)}\n                  className=\"mt-1 h-5 w-5 rounded border-gray-300 text-gray-900 focus:ring-gray-900 cursor-pointer\"\n                />\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2 mb-1\">\n                    <h3 className=\"text-lg font-bold text-gray-900\">{word.englishWord}</h3>\n                    {word.known && (\n                      <Badge variant=\"success\" size=\"sm\">\n                        <Check className=\"h-3 w-3 mr-1\" />\n                        Known\n                      </Badge>\n                    )}\n                  </div>\n                  <p className=\"text-gray-700 mb-2\">{word.arabicMeaning}</p>\n                  {word.exampleSentence && (\n                    <p className=\"text-sm text-gray-600 italic\">{word.exampleSentence}</p>\n                  )}\n                  <div className=\"flex gap-2 mt-4\">\n                    <Button\n                      variant={word.known ? 'outline' : 'primary'}\n                      size=\"sm\"\n                      fullWidth\n                      onClick={() => handleToggleKnown(word.id, word.known)}\n                    >\n                      {word.known ? (\n                        <>\n                          <X className=\"h-4 w-4 mr-1\" />\n                          Mark Unknown / غير محفوظة\n                        </>\n                      ) : (\n                        <>\n                          <Check className=\"h-4 w-4 mr-1\" />\n                          Mark Known / محفوظة\n                        </>\n                      )}\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => handleDeleteWord(word.id)}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </div>\n            </Card>\n          ))}\n        </div>\n      )}\n\n      <div className=\"text-center text-gray-600\">\n        <p className=\"text-lg font-semibold\">\n          Total Words: {words.length} | Known: {words.filter(w => w.known).length}\n        </p>\n        <p className=\"text-sm\">\n          إجمالي الكلمات: {words.length} | محفوظة: {words.filter(w => w.known).length}\n        </p>\n      </div>\n    </div>\n  )\n}\n","size_bytes":15782},"start-server.js":{"content":"#!/usr/bin/env node\n\n// Setup DATABASE_URL from AWS credentials before starting the server\nconst { spawn } = require('child_process');\n\n// Check if DATABASE_URL is already set\nif (!process.env.DATABASE_URL && !process.env.EXTERNAL_DATABASE_URL) {\n  // Try to construct from AWS credentials\n  const awsDbHost = process.env.AWS_DB_HOST;\n  const awsDbPort = process.env.AWS_DB_PORT;\n  const awsDbName = process.env.AWS_DB_NAME;\n  const awsDbUser = process.env.AWS_DB_USER;\n  const awsDbPassword = process.env.AWS_DB_PASSWORD;\n\n  // Verify all AWS credentials are present\n  if (awsDbHost && awsDbPort && awsDbName && awsDbUser && awsDbPassword) {\n    const dbUrl = `postgresql://${awsDbUser}:${awsDbPassword}@${awsDbHost}:${awsDbPort}/${awsDbName}?schema=youspeak_exercisein`;\n    process.env.DATABASE_URL = dbUrl;\n    process.env.EXTERNAL_DATABASE_URL = dbUrl;\n\n    console.log('✅ Database configured from AWS credentials:');\n    console.log('   Host:', awsDbHost);\n    console.log('   Port:', awsDbPort);\n    console.log('   Database:', awsDbName);\n    console.log('   User:', awsDbUser);\n    console.log('');\n  } else {\n    console.error('❌ ERROR: No database configuration found!');\n    console.error('Please set either:');\n    console.error('  1. DATABASE_URL environment variable, or');\n    console.error('  2. All AWS database credentials: AWS_DB_HOST, AWS_DB_PORT, AWS_DB_NAME, AWS_DB_USER, AWS_DB_PASSWORD');\n    console.error('');\n    process.exit(1);\n  }\n} else {\n  console.log('✅ Database configured from DATABASE_URL');\n  console.log('');\n}\n\n// Start the Next.js server\nconst server = spawn('node', ['server.js'], {\n  stdio: 'inherit',\n  env: process.env\n});\n\nserver.on('close', (code) => {\n  console.log(`Server process exited with code ${code}`);\n  process.exit(code);\n});\n\n// Handle termination signals\nprocess.on('SIGTERM', () => {\n  server.kill('SIGTERM');\n});\n\nprocess.on('SIGINT', () => {\n  server.kill('SIGINT');\n});\n","size_bytes":1940},"lib/auth-helpers.ts":{"content":"import { getServerSession } from 'next-auth'\nimport { authOptions } from './auth'\nimport { prisma } from './prisma'\nimport { NextResponse } from 'next/server'\n\nexport interface AuthSession {\n  userId: string\n  role: string\n  name: string\n  email: string\n}\n\nexport interface TeacherSession extends AuthSession {\n  teacherProfileId: string\n}\n\nexport async function requireSession(): Promise<AuthSession | null> {\n  const session = await getServerSession(authOptions)\n  if (!session || !session.user) {\n    return null\n  }\n\n  return {\n    userId: session.user.id,\n    role: session.user.role,\n    name: session.user.name,\n    email: session.user.email\n  }\n}\n\nexport async function requireRole(allowedRoles: string[]): Promise<AuthSession | NextResponse> {\n  const session = await requireSession()\n  \n  if (!session) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n  }\n\n  if (!allowedRoles.includes(session.role)) {\n    return NextResponse.json({ error: 'Forbidden' }, { status: 403 })\n  }\n\n  return session\n}\n\nexport async function requireTeacher(): Promise<TeacherSession | NextResponse> {\n  const sessionResult = await requireRole(['TEACHER'])\n  \n  if (sessionResult instanceof NextResponse) {\n    return sessionResult\n  }\n\n  const teacherProfile = await prisma.teacherProfile.findUnique({\n    where: { userId: sessionResult.userId }\n  })\n\n  if (!teacherProfile) {\n    return NextResponse.json({ error: 'Teacher profile not found' }, { status: 404 })\n  }\n\n  return {\n    ...sessionResult,\n    teacherProfileId: teacherProfile.id\n  }\n}\n\nexport async function requireAdmin(): Promise<AuthSession | NextResponse> {\n  return await requireRole(['ADMIN', 'ASSISTANT'])\n}\n\nexport async function requireStudent(): Promise<AuthSession | NextResponse> {\n  return await requireRole(['STUDENT'])\n}\n\nexport async function parseJsonBody<T>(request: Request): Promise<T | NextResponse> {\n  try {\n    const body = await request.json()\n    return body as T\n  } catch (error) {\n    return NextResponse.json({ error: 'Invalid JSON body' }, { status: 400 })\n  }\n}\n\nexport function isAuthSession(value: any): value is AuthSession {\n  return value && typeof value === 'object' && 'userId' in value\n}\n\nexport function isTeacherSession(value: any): value is TeacherSession {\n  return isAuthSession(value) && 'teacherProfileId' in value\n}\n\nexport function isNextResponse(value: any): value is NextResponse {\n  return value instanceof NextResponse\n}\n\nexport async function verifyOwnership(\n  resourceId: string,\n  resourceType: 'session' | 'assignment',\n  teacherId: string\n): Promise<boolean> {\n  if (resourceType === 'session') {\n    const session = await prisma.session.findUnique({\n      where: { id: resourceId }\n    })\n    return session?.teacherId === teacherId\n  }\n\n  if (resourceType === 'assignment') {\n    const assignment = await prisma.assignment.findUnique({\n      where: { id: resourceId },\n      include: { Session: true }\n    })\n    return assignment?.Session?.teacherId === teacherId\n  }\n\n  return false\n}\n","size_bytes":3024},"app/api/grammar-check/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport OpenAI from 'openai'\n\nconst openai = process.env.OPENAI_API_KEY ? new OpenAI({ apiKey: process.env.OPENAI_API_KEY }) : null\n\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'TEACHER') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    if (!openai) {\n      return NextResponse.json({ error: 'Grammar check service is not configured' }, { status: 503 })\n    }\n\n    const { text } = await request.json()\n\n    if (!text) {\n      return NextResponse.json({ error: 'Text is required' }, { status: 400 })\n    }\n\n    // the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\n    const response = await openai.chat.completions.create({\n      model: \"gpt-5\",\n      messages: [\n        {\n          role: \"system\",\n          content: \"You are an expert English grammar checker for English learning students. Analyze the text and provide detailed grammar corrections. Return JSON with this format: { 'errors': [{ 'error': string, 'correction': string, 'explanation': string, 'type': string }], 'overallScore': number, 'summary': string }\"\n        },\n        {\n          role: \"user\",\n          content: `Check this student's English text for grammar errors:\\n\\n${text}`\n        }\n      ],\n      response_format: { type: \"json_object\" }\n    })\n\n    const result = JSON.parse(response.choices[0].message.content || '{}')\n    return NextResponse.json(result)\n  } catch (error) {\n    console.error('Error checking grammar:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":1873},"components/ui/LoadingSpinner.tsx":{"content":"import React from 'react';\nimport { cva, type VariantProps } from 'class-variance-authority';\nimport { cn } from '@/lib/utils';\nimport { Loader2 } from 'lucide-react';\n\nconst spinnerVariants = cva('animate-spin', {\n  variants: {\n    size: {\n      xs: 'h-3 w-3',\n      sm: 'h-4 w-4',\n      md: 'h-6 w-6',\n      lg: 'h-8 w-8',\n      xl: 'h-12 w-12',\n    },\n    variant: {\n      primary: 'text-primary',\n      accent: 'text-accent',\n      neutral: 'text-neutral-500',\n      white: 'text-white',\n    },\n  },\n  defaultVariants: {\n    size: 'md',\n    variant: 'primary',\n  },\n});\n\nexport interface LoadingSpinnerProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof spinnerVariants> {\n  label?: string;\n  fullScreen?: boolean;\n}\n\nconst LoadingSpinner = React.forwardRef<HTMLDivElement, LoadingSpinnerProps>(\n  ({ className, size, variant, label, fullScreen = false, ...props }, ref) => {\n    const spinner = (\n      <div\n        className={cn(\n          'flex flex-col items-center justify-center gap-3',\n          fullScreen && 'fixed inset-0 bg-white/80 backdrop-blur-sm dark:bg-neutral-900/80 z-50',\n          className\n        )}\n        ref={ref}\n        role=\"status\"\n        aria-live=\"polite\"\n        aria-label={label || 'Loading'}\n        {...props}\n      >\n        <Loader2 className={cn(spinnerVariants({ size, variant }))} aria-hidden=\"true\" />\n        {label && (\n          <p className=\"text-sm text-neutral-600 dark:text-neutral-400 rtl:text-right\">\n            {label}\n          </p>\n        )}\n        <span className=\"sr-only\">{label || 'Loading...'}</span>\n      </div>\n    );\n\n    return spinner;\n  }\n);\n\nLoadingSpinner.displayName = 'LoadingSpinner';\n\nexport default LoadingSpinner;\n","size_bytes":1723},"attached_assets/useWhiteboard_1763165145845.ts":{"content":"import { useEffect, useRef, useState, useCallback } from 'react';\nimport type { DrawCommand } from '@shared/schema';\n\ninterface UseWhiteboardProps {\n  roomToken: string;\n  userId: string;\n  isEnabled: boolean;\n  onSendCommand?: (command: DrawCommand) => void;\n}\n\nexport function useWhiteboard({ roomToken, userId, isEnabled, onSendCommand }: UseWhiteboardProps) {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const contextRef = useRef<CanvasRenderingContext2D | null>(null);\n  const [isDrawing, setIsDrawing] = useState(false);\n  const [tool, setTool] = useState<'pen' | 'eraser' | 'rectangle' | 'circle' | 'line' | 'arrow' | 'text'>('pen');\n  const [color, setColor] = useState('#000000');\n  const [lineWidth, setLineWidth] = useState(3);\n  const [filled, setFilled] = useState(false);\n  const [startPoint, setStartPoint] = useState<{ x: number; y: number } | null>(null);\n  const [commandHistory, setCommandHistory] = useState<DrawCommand[]>([]);\n  const [historyIndex, setHistoryIndex] = useState(-1);\n  const commandIdMapRef = useRef<Set<string>>(new Set());\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const context = canvas.getContext('2d');\n    if (!context) return;\n\n    context.lineCap = 'round';\n    context.lineJoin = 'round';\n    contextRef.current = context;\n\n    const resizeCanvas = () => {\n      const container = canvas.parentElement;\n      if (!container) return;\n\n      const tempCanvas = document.createElement('canvas');\n      const tempContext = tempCanvas.getContext('2d');\n      if (!tempContext) return;\n\n      tempCanvas.width = canvas.width;\n      tempCanvas.height = canvas.height;\n      tempContext.drawImage(canvas, 0, 0);\n\n      canvas.width = container.clientWidth;\n      canvas.height = container.clientHeight;\n\n      if (contextRef.current) {\n        contextRef.current.drawImage(tempCanvas, 0, 0);\n      }\n    };\n\n    resizeCanvas();\n    window.addEventListener('resize', resizeCanvas);\n\n    return () => {\n      window.removeEventListener('resize', resizeCanvas);\n    };\n  }, []);\n\n  const addToHistory = useCallback((command: DrawCommand, skipDedup = false) => {\n    const commandKey = command.commandId || `${command.clientId || userId}-${Date.now()}-${Math.random()}`;\n    \n    if (!skipDedup && commandIdMapRef.current.has(commandKey)) {\n      return;\n    }\n\n    const commandWithId = { ...command, commandId: commandKey };\n    commandIdMapRef.current.add(commandKey);\n    \n    setHistoryIndex(prevIndex => {\n      setCommandHistory(prevHistory => {\n        const newHistory = [...prevHistory.slice(0, prevIndex + 1), commandWithId];\n        return newHistory;\n      });\n      return prevIndex + 1;\n    });\n  }, [userId]);\n\n  const startDrawing = useCallback((x: number, y: number) => {\n    if (!isEnabled || !contextRef.current) return;\n\n    setIsDrawing(true);\n    const context = contextRef.current;\n\n    if (tool === 'text') {\n      const text = prompt('أدخل النص:');\n      if (text) {\n        context.font = `${lineWidth * 5}px Arial`;\n        context.fillStyle = color;\n        context.fillText(text, x, y);\n\n        const commandId = `${userId}-${Date.now()}-${Math.random()}`;\n        const command: DrawCommand = {\n          type: 'text',\n          x,\n          y,\n          color,\n          lineWidth,\n          text,\n          commandId,\n          clientId: userId,\n          userId\n        };\n        addToHistory(command);\n        onSendCommand?.(command);\n      }\n      setIsDrawing(false);\n      return;\n    }\n\n    if (['rectangle', 'circle', 'line', 'arrow'].includes(tool)) {\n      setStartPoint({ x, y });\n      return;\n    }\n\n    context.strokeStyle = tool === 'pen' ? color : '#FFFFFF';\n    context.lineWidth = tool === 'pen' ? lineWidth : lineWidth * 3;\n    context.globalCompositeOperation = tool === 'pen' ? 'source-over' : 'destination-out';\n\n    context.beginPath();\n    context.moveTo(x, y);\n\n    const commandId = `${userId}-${Date.now()}-${Math.random()}`;\n    const command: DrawCommand = {\n      type: 'start',\n      x,\n      y,\n      color: tool === 'pen' ? color : '#FFFFFF',\n      lineWidth: tool === 'pen' ? lineWidth : lineWidth * 3,\n      commandId,\n      clientId: userId,\n      userId\n    };\n\n    addToHistory(command);\n    onSendCommand?.(command);\n  }, [isEnabled, tool, color, lineWidth, userId, onSendCommand, addToHistory]);\n\n  const draw = useCallback((x: number, y: number) => {\n    if (!isDrawing || !isEnabled || !contextRef.current) return;\n    \n    if (['rectangle', 'circle', 'line', 'arrow', 'text'].includes(tool)) {\n      return;\n    }\n\n    const context = contextRef.current;\n    context.lineTo(x, y);\n    context.stroke();\n\n    const commandId = `${userId}-${Date.now()}-${Math.random()}`;\n    const command: DrawCommand = {\n      type: 'draw',\n      x,\n      y,\n      commandId,\n      clientId: userId,\n      userId\n    };\n\n    addToHistory(command);\n    onSendCommand?.(command);\n  }, [isDrawing, isEnabled, tool, userId, onSendCommand, addToHistory]);\n\n  const stopDrawing = useCallback((x?: number, y?: number) => {\n    if (!isEnabled || !contextRef.current) return;\n\n    if (['rectangle', 'circle', 'line', 'arrow'].includes(tool) && startPoint && x !== undefined && y !== undefined) {\n      const context = contextRef.current;\n      const commandId = `${userId}-${Date.now()}-${Math.random()}`;\n      const command: DrawCommand = {\n        type: 'shape',\n        x: startPoint.x,\n        y: startPoint.y,\n        x2: x,\n        y2: y,\n        color,\n        lineWidth,\n        filled,\n        shape: tool as 'rectangle' | 'circle' | 'line' | 'arrow',\n        commandId,\n        clientId: userId,\n        userId\n      };\n\n      drawShape(context, command);\n      addToHistory(command);\n      onSendCommand?.(command);\n      setStartPoint(null);\n    }\n\n    setIsDrawing(false);\n    if (tool === 'pen' || tool === 'eraser') {\n      contextRef.current.closePath();\n    }\n  }, [isEnabled, tool, startPoint, color, lineWidth, filled, userId, onSendCommand, addToHistory]);\n\n  const clearCanvas = useCallback(() => {\n    if (!contextRef.current || !canvasRef.current) return;\n\n    const context = contextRef.current;\n    context.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n\n    const commandId = `${userId}-${Date.now()}-${Math.random()}`;\n    const command: DrawCommand = {\n      type: 'clear',\n      x: 0,\n      y: 0,\n      userId,\n      commandId,\n      clientId: userId,\n    };\n\n    addToHistory(command);\n    onSendCommand?.(command);\n  }, [userId, onSendCommand, addToHistory]);\n\n  const drawShape = (context: CanvasRenderingContext2D, command: DrawCommand) => {\n    if (command.x2 === undefined || command.y2 === undefined) return;\n\n    context.globalCompositeOperation = 'source-over';\n    context.strokeStyle = command.color || '#000000';\n    context.fillStyle = command.color || '#000000';\n    context.lineWidth = command.lineWidth || 3;\n\n    switch (command.shape) {\n      case 'rectangle':\n        if (command.filled) {\n          context.fillRect(command.x, command.y, command.x2 - command.x, command.y2 - command.y);\n        } else {\n          context.strokeRect(command.x, command.y, command.x2 - command.x, command.y2 - command.y);\n        }\n        break;\n\n      case 'circle':\n        const radius = Math.sqrt(Math.pow(command.x2 - command.x, 2) + Math.pow(command.y2 - command.y, 2));\n        context.beginPath();\n        context.arc(command.x, command.y, radius, 0, 2 * Math.PI);\n        if (command.filled) {\n          context.fill();\n        } else {\n          context.stroke();\n        }\n        break;\n\n      case 'line':\n        context.beginPath();\n        context.moveTo(command.x, command.y);\n        context.lineTo(command.x2, command.y2);\n        context.stroke();\n        break;\n\n      case 'arrow':\n        const headlen = 15;\n        const dx = command.x2 - command.x;\n        const dy = command.y2 - command.y;\n        const angle = Math.atan2(dy, dx);\n\n        context.beginPath();\n        context.moveTo(command.x, command.y);\n        context.lineTo(command.x2, command.y2);\n        context.lineTo(command.x2 - headlen * Math.cos(angle - Math.PI / 6), command.y2 - headlen * Math.sin(angle - Math.PI / 6));\n        context.moveTo(command.x2, command.y2);\n        context.lineTo(command.x2 - headlen * Math.cos(angle + Math.PI / 6), command.y2 - headlen * Math.sin(angle + Math.PI / 6));\n        context.stroke();\n        break;\n    }\n  };\n\n  const executeRemoteCommand = useCallback((command: DrawCommand) => {\n    if (!contextRef.current || !canvasRef.current) return;\n\n    const context = contextRef.current;\n\n    // Handle undo/redo commands (adjust history index and replay)\n    if (command.type === 'undo') {\n      setHistoryIndex(prev => {\n        const newIndex = Math.max(-1, prev - 1);\n        replayHistory(newIndex);\n        return newIndex;\n      });\n      return;\n    }\n\n    if (command.type === 'redo') {\n      setCommandHistory(prevHistory => {\n        setHistoryIndex(prevIndex => {\n          const newIndex = Math.min(prevHistory.length - 1, prevIndex + 1);\n          replayHistory(newIndex);\n          return newIndex;\n        });\n        return prevHistory;\n      });\n      return;\n    }\n\n    // Add remote command to history (with deduplication)\n    addToHistory(command);\n\n    // Execute canvas operation immediately\n    switch (command.type) {\n      case 'start':\n        context.strokeStyle = command.color || '#000000';\n        context.lineWidth = command.lineWidth || 3;\n        context.globalCompositeOperation = command.color === '#FFFFFF' ? 'destination-out' : 'source-over';\n        context.beginPath();\n        context.moveTo(command.x, command.y);\n        break;\n\n      case 'draw':\n        context.lineTo(command.x, command.y);\n        context.stroke();\n        break;\n\n\n      case 'clear':\n        context.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n        break;\n\n      case 'erase':\n        context.globalCompositeOperation = 'destination-out';\n        context.beginPath();\n        context.arc(command.x, command.y, command.lineWidth || 10, 0, Math.PI * 2);\n        context.fill();\n        context.globalCompositeOperation = 'source-over';\n        break;\n\n      case 'shape':\n        drawShape(context, command);\n        break;\n\n      case 'text':\n        if (command.text) {\n          context.globalCompositeOperation = 'source-over';\n          context.font = `${(command.lineWidth || 3) * 5}px Arial`;\n          context.fillStyle = command.color || '#000000';\n          context.fillText(command.text, command.x, command.y);\n        }\n        break;\n    }\n  }, [addToHistory, replayHistory]);\n\n  const undo = useCallback(() => {\n    if (historyIndex < 0) return;\n    \n    const newIndex = historyIndex - 1;\n    setHistoryIndex(newIndex);\n    \n    const command: DrawCommand = {\n      type: 'undo',\n      x: 0,\n      y: 0,\n      userId\n    };\n    \n    onSendCommand?.(command);\n    replayHistory(newIndex);\n  }, [historyIndex, userId, onSendCommand]);\n\n  const redo = useCallback(() => {\n    if (historyIndex >= commandHistory.length - 1) return;\n    \n    const newIndex = historyIndex + 1;\n    setHistoryIndex(newIndex);\n    \n    const command: DrawCommand = {\n      type: 'redo',\n      x: 0,\n      y: 0,\n      userId\n    };\n    \n    onSendCommand?.(command);\n    replayHistory(newIndex);\n  }, [historyIndex, commandHistory.length, userId, onSendCommand]);\n\n  const replayHistory = useCallback((upToIndex: number) => {\n    if (!contextRef.current || !canvasRef.current) return;\n    \n    const context = contextRef.current;\n    context.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n    \n    for (let i = 0; i <= upToIndex; i++) {\n      executeRemoteCommand(commandHistory[i]);\n    }\n  }, [commandHistory, executeRemoteCommand]);\n\n  const saveAsImage = useCallback(() => {\n    if (!canvasRef.current) return;\n    \n    const link = document.createElement('a');\n    link.download = `whiteboard-${Date.now()}.png`;\n    link.href = canvasRef.current.toDataURL();\n    link.click();\n  }, []);\n\n  const saveAsJSON = useCallback(() => {\n    const data = {\n      commands: commandHistory,\n      timestamp: Date.now()\n    };\n    \n    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n    const link = document.createElement('a');\n    link.download = `whiteboard-${Date.now()}.json`;\n    link.href = URL.createObjectURL(blob);\n    link.click();\n  }, [commandHistory]);\n\n  const loadFromJSON = useCallback((jsonData: string) => {\n    try {\n      const data = JSON.parse(jsonData);\n      if (data.commands && Array.isArray(data.commands)) {\n        setCommandHistory(data.commands);\n        setHistoryIndex(data.commands.length - 1);\n        replayHistory(data.commands.length - 1);\n      }\n    } catch (error) {\n      console.error('Failed to load whiteboard data:', error);\n    }\n  }, [replayHistory]);\n\n  return {\n    canvasRef,\n    isDrawing,\n    tool,\n    setTool,\n    color,\n    setColor,\n    lineWidth,\n    setLineWidth,\n    filled,\n    setFilled,\n    startDrawing,\n    draw,\n    stopDrawing,\n    clearCanvas,\n    executeRemoteCommand,\n    undo,\n    redo,\n    canUndo: historyIndex >= 0,\n    canRedo: historyIndex < commandHistory.length - 1,\n    saveAsImage,\n    saveAsJSON,\n    loadFromJSON\n  };\n}\n","size_bytes":13327},"app/api/chat/messages/[id]/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { prisma } from '@/lib/prisma'\nimport { requireSession, isNextResponse } from '@/lib/auth-helpers'\n\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await requireSession()\n    \n    if (!session) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const { id } = await params\n\n    const message = await prisma.chat.findUnique({\n      where: { id }\n    })\n\n    if (!message) {\n      return NextResponse.json({ error: 'Message not found' }, { status: 404 })\n    }\n\n    const isAdmin = session.role === 'ADMIN' || session.role === 'ASSISTANT'\n    const isSender = message.fromUserId === session.userId\n    const isReceiver = message.toUserId === session.userId\n\n    if (!isAdmin && !isSender && !isReceiver) {\n      return NextResponse.json({ error: 'Forbidden' }, { status: 403 })\n    }\n\n    await prisma.chat.delete({\n      where: { id }\n    })\n\n    return NextResponse.json({ success: true }, { status: 200 })\n  } catch (error) {\n    console.error('Error deleting message:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":1255},"app/session/[id]/page.tsx":{"content":"import { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { redirect } from 'next/navigation'\nimport SessionClient from './SessionClient'\n\nexport default async function SessionPage({ params }: { params: { id: string } }) {\n  const session = await getServerSession(authOptions)\n\n  if (!session) {\n    redirect('/auth/signin')\n  }\n\n  return <SessionClient sessionId={params.id} user={session.user} />\n}\n","size_bytes":436},"lib/contexts/ThemeContext.tsx":{"content":"'use client'\n\nimport { createContext, useContext, useEffect, useState, ReactNode } from 'react'\n\ntype Theme = 'light' | 'dark'\ntype Language = 'ar' | 'en'\n\ninterface ThemeContextType {\n  theme: Theme\n  language: Language\n  toggleTheme: () => void\n  toggleLanguage: () => void\n  setLanguage: (lang: Language) => void\n}\n\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined)\n\nexport function ThemeProvider({ children }: { children: ReactNode }) {\n  const [mounted, setMounted] = useState(false)\n  const [theme, setTheme] = useState<Theme>('light')\n  const [language, setLanguageState] = useState<Language>('en')\n\n  useEffect(() => {\n    setMounted(true)\n    const savedTheme = (localStorage.getItem('theme') as Theme) || 'light'\n    const savedLanguage = (localStorage.getItem('language') as Language) || 'en'\n    \n    setTheme(savedTheme)\n    setLanguageState(savedLanguage)\n    \n    if (typeof document !== 'undefined') {\n      document.documentElement.classList.toggle('dark', savedTheme === 'dark')\n      document.documentElement.setAttribute('dir', savedLanguage === 'ar' ? 'rtl' : 'ltr')\n      document.documentElement.setAttribute('lang', savedLanguage)\n    }\n  }, [])\n\n  const toggleTheme = () => {\n    const newTheme = theme === 'light' ? 'dark' : 'light'\n    setTheme(newTheme)\n    if (mounted) {\n      localStorage.setItem('theme', newTheme)\n      if (typeof document !== 'undefined') {\n        document.documentElement.classList.toggle('dark', newTheme === 'dark')\n      }\n    }\n  }\n\n  const toggleLanguage = () => {\n    const newLanguage = language === 'ar' ? 'en' : 'ar'\n    setLanguageState(newLanguage)\n    setLanguage(newLanguage)\n  }\n\n  const setLanguage = (lang: Language) => {\n    setLanguageState(lang)\n    if (mounted) {\n      localStorage.setItem('language', lang)\n      if (typeof document !== 'undefined') {\n        document.documentElement.setAttribute('dir', lang === 'ar' ? 'rtl' : 'ltr')\n        document.documentElement.setAttribute('lang', lang)\n      }\n    }\n  }\n\n  return (\n    <ThemeContext.Provider value={{ theme, language, toggleTheme, toggleLanguage, setLanguage }}>\n      {children}\n    </ThemeContext.Provider>\n  )\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext)\n  if (context === undefined) {\n    throw new Error('useTheme must be used within a ThemeProvider')\n  }\n  return context\n}\n","size_bytes":2372},"app/auth/register/page.tsx":{"content":"'use client'\n\nimport { useState } from 'react'\nimport Link from 'next/link'\nimport { useRouter } from 'next/navigation'\nimport Image from 'next/image'\nimport { User, Mail, Phone, Lock, Calendar, Target, Clock, ArrowLeft } from 'lucide-react'\nimport Button from '@/components/ui/Button'\nimport Input from '@/components/ui/Input'\nimport Card from '@/components/ui/Card'\nimport Alert from '@/components/ui/Alert'\nimport LanguageToggle from '@/components/LanguageToggle'\nimport { useTranslation } from '@/lib/hooks/useTranslation'\n\nexport default function RegisterPage() {\n  const router = useRouter()\n  const { t } = useTranslation()\n  const [formData, setFormData] = useState({\n    name: '',\n    email: '',\n    password: '',\n    confirmPassword: '',\n    phone: '',\n    age: '',\n    levelInitial: '',\n    goal: '',\n    preferredTime: '',\n  })\n  const [error, setError] = useState('')\n  const [loading, setLoading] = useState(false)\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setError('')\n\n    // Validation\n    if (formData.password !== formData.confirmPassword) {\n      setError(t('passwordsDoNotMatch'))\n      return\n    }\n\n    if (formData.password.length < 6) {\n      setError(t('passwordTooShort'))\n      return\n    }\n\n    const phoneRegex = /^\\+?[0-9]{10,15}$/\n    if (!phoneRegex.test(formData.phone.replace(/\\s/g, ''))) {\n      setError(t('invalidPhoneNumber'))\n      return\n    }\n\n    const age = parseInt(formData.age)\n    if (isNaN(age) || age < 5 || age > 100) {\n      setError(t('invalidAge'))\n      return\n    }\n\n    setLoading(true)\n\n    try {\n      const payload = {\n        name: formData.name.trim(),\n        email: formData.email.trim().toLowerCase(),\n        password: formData.password,\n        phone: formData.phone.replace(/\\s/g, ''),\n        age: parseInt(formData.age),\n        levelInitial: formData.levelInitial,\n        goal: formData.goal.trim(),\n        preferredTime: formData.preferredTime,\n      }\n\n      const response = await fetch('/api/auth/register', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload),\n      })\n\n      const data = await response.json()\n\n      if (!response.ok) {\n        throw new Error(data.error || t('registrationFailed'))\n      }\n\n      router.push('/auth/login?registered=true')\n    } catch (err: any) {\n      setError(err.message)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-[#F5F1E8] via-[#E8DCC8] to-[#F5F1E8] flex flex-col items-center justify-center px-4 py-8 sm:py-12\">\n      <Card className=\"w-full max-w-md p-6 sm:p-8 bg-white/90 backdrop-blur-sm shadow-2xl border-2 border-[#d4c9b8]\">\n        <div className=\"flex justify-between items-center mb-4\">\n          <Link href=\"/\">\n            <Button variant=\"ghost\" size=\"sm\" className=\"gap-2\">\n              <ArrowLeft className=\"w-4 h-4\" />\n            </Button>\n          </Link>\n          <LanguageToggle />\n        </div>\n\n        <div className=\"text-center mb-6 sm:mb-8\">\n          <Link href=\"/\" className=\"inline-flex items-center gap-2 mb-3 sm:mb-4 hover:opacity-80 transition-opacity\">\n            <Image src=\"/logo.png\" alt=\"Youspeak\" width={40} height={40} className=\"sm:w-[50px] sm:h-[50px]\" />\n            <span className=\"text-xl sm:text-2xl font-bold text-black\">Youspeak</span>\n          </Link>\n          <h1 className=\"text-2xl sm:text-3xl font-bold text-center mb-2 text-black\">\n            Create Your Account\n          </h1>\n          <p className=\"text-sm sm:text-base text-center text-black mb-4 sm:mb-8\">\n            Join us today to start learning\n          </p>\n        </div>\n\n        {error && (\n          <Alert\n            variant=\"error\"\n            dismissible\n            onDismiss={() => setError('')}\n            className=\"mb-6\"\n          >\n            {error}\n          </Alert>\n        )}\n\n        <form onSubmit={handleSubmit} className=\"space-y-3 sm:space-y-4\">\n          <Input\n            type=\"text\"\n            label={t('fullName')}\n            placeholder=\"John Doe\"\n            required\n            value={formData.name}\n            onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n            leftIcon={<User className=\"h-4 w-4 sm:h-5 sm:w-5\" />}\n            inputSize=\"md\"\n          />\n\n          <Input\n            type=\"email\"\n            label={t('email')}\n            placeholder=\"your.email@example.com\"\n            required\n            value={formData.email}\n            onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n            leftIcon={<Mail className=\"h-4 w-4 sm:h-5 sm:w-5\" />}\n            inputSize=\"md\"\n          />\n\n          <Input\n            type=\"tel\"\n            label={t('whatsappNumber')}\n            placeholder=\"+966... or +20...\"\n            required\n            value={formData.phone}\n            onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n            leftIcon={<Phone className=\"h-4 w-4 sm:h-5 sm:w-5\" />}\n            inputSize=\"md\"\n            hint={t('phoneHint')}\n          />\n\n          <Input\n            type=\"number\"\n            label={t('age')}\n            placeholder=\"18\"\n            required\n            value={formData.age}\n            onChange={(e) => setFormData({ ...formData, age: e.target.value })}\n            leftIcon={<Calendar className=\"h-4 w-4 sm:h-5 sm:w-5\" />}\n            inputSize=\"md\"\n            min=\"5\"\n            max=\"100\"\n          />\n\n          <div>\n            <label className=\"block text-xs sm:text-sm font-medium text-black mb-2\">\n              {t('currentLevel')} *\n            </label>\n            <select\n              required\n              value={formData.levelInitial}\n              onChange={(e) => setFormData({ ...formData, levelInitial: e.target.value })}\n              className=\"w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#004E89] focus:border-transparent text-sm sm:text-base\"\n            >\n              <option value=\"\">{t('selectLevel')}</option>\n              <option value=\"A1\">A1 - Beginner</option>\n              <option value=\"A2\">A2 - Elementary</option>\n              <option value=\"B1\">B1 - Intermediate</option>\n              <option value=\"B2\">B2 - Upper Intermediate</option>\n            </select>\n            <p className=\"mt-1 text-xs text-gray-500\">\n              {t('dontKnowLevelHint')}\n            </p>\n          </div>\n\n          <div>\n            <label className=\"block text-xs sm:text-sm font-medium text-black mb-2\" htmlFor=\"goal\">\n              {t('learningGoal')} *\n            </label>\n            <textarea\n              id=\"goal\"\n              required\n              value={formData.goal}\n              onChange={(e) => setFormData({ ...formData, goal: e.target.value })}\n              placeholder={t('goalPlaceholder')}\n              className=\"w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#004E89] focus:border-transparent text-sm sm:text-base resize-none\"\n              rows={3}\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-xs sm:text-sm font-medium text-black mb-2\">\n              {t('preferredTime')} *\n            </label>\n            <select\n              required\n              value={formData.preferredTime}\n              onChange={(e) => setFormData({ ...formData, preferredTime: e.target.value })}\n              className=\"w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#004E89] focus:border-transparent text-sm sm:text-base\"\n            >\n              <option value=\"\">{t('selectTime')}</option>\n              <option value=\"morning\">{t('morning')}</option>\n              <option value=\"afternoon\">{t('afternoon')}</option>\n              <option value=\"evening\">{t('evening')}</option>\n              <option value=\"flexible\">{t('flexible')}</option>\n            </select>\n          </div>\n\n          <Input\n            type=\"password\"\n            label={t('password')}\n            placeholder=\"••••••••\"\n            required\n            value={formData.password}\n            onChange={(e) => setFormData({ ...formData, password: e.target.value })}\n            leftIcon={<Lock className=\"h-4 w-4 sm:h-5 sm:w-5\" />}\n            inputSize=\"md\"\n            hint={t('passwordHint')}\n          />\n\n          <Input\n            type=\"password\"\n            label={t('confirmPassword')}\n            placeholder=\"••••••••\"\n            required\n            value={formData.confirmPassword}\n            onChange={(e) => setFormData({ ...formData, confirmPassword: e.target.value })}\n            leftIcon={<Lock className=\"h-4 w-4 sm:h-5 sm:w-5\" />}\n            inputSize=\"md\"\n          />\n\n          <Button\n            type=\"submit\"\n            fullWidth\n            size=\"lg\"\n            loading={loading}\n            className=\"font-semibold bg-[#004E89] hover:bg-[#003A6B] text-white text-base sm:text-lg py-3 sm:py-4\"\n          >\n            {loading ? t('creatingAccount') : t('register')}\n          </Button>\n        </form>\n\n        <p className=\"mt-4 sm:mt-6 text-center text-black text-xs sm:text-sm\">\n          {t('alreadyHaveAccount')} {' '}\n          <Link href=\"/auth/login\" className=\"text-[#004E89] hover:text-[#003A6B] font-semibold\">\n            {t('login')}\n          </Link>\n        </p>\n\n        <Alert variant=\"info\" className=\"mt-4 sm:mt-6\">\n          <p className=\"text-xs sm:text-sm text-black\">\n            <strong>{t('note')}:</strong> {t('accountReview')}\n            <strong className=\"text-[#004E89]\">{t('contactNumber')}</strong> {t('forPaymentActivation')}\n          </p>\n        </Alert>\n      </Card>\n\n      <footer className=\"w-full py-4 sm:py-6 text-center text-sm sm:text-base text-black bg-[#F5F1E8] border-t-2 border-[#d4c9b8] mt-4 sm:mt-8\">\n        <p className=\"px-4\">Made with ❤️ by MA3K Company</p>\n      </footer>\n    </div>\n  )\n}","size_bytes":10085},"scripts/seed-data.ts":{"content":"import { prisma } from '../lib/prisma'\nimport bcrypt from 'bcryptjs'\n\nasync function seedData() {\n  console.log('Starting data seeding...')\n  \n  const password = await bcrypt.hash('admin123', 10)\n  \n  // Create sample words for existing students\n  const students = await prisma.user.findMany({\n    where: { role: 'STUDENT' }\n  })\n  \n  const sampleWords = [\n    { english: 'hello', arabic: 'مرحبا', example: 'Hello, how are you?' },\n    { english: 'book', arabic: 'كتاب', example: 'I am reading a book.' },\n    { english: 'school', arabic: 'مدرسة', example: 'I go to school every day.' },\n    { english: 'teacher', arabic: 'معلم', example: 'The teacher is very kind.' },\n    { english: 'student', arabic: 'طالب', example: 'She is a good student.' },\n    { english: 'water', arabic: 'ماء', example: 'I drink water.' },\n    { english: 'food', arabic: 'طعام', example: 'The food is delicious.' },\n    { english: 'house', arabic: 'بيت', example: 'This is my house.' },\n    { english: 'car', arabic: 'سيارة', example: 'He drives a car.' },\n    { english: 'friend', arabic: 'صديق', example: 'She is my best friend.' },\n    { english: 'family', arabic: 'عائلة', example: 'I love my family.' },\n    { english: 'time', arabic: 'وقت', example: 'What time is it?' },\n    { english: 'day', arabic: 'يوم', example: 'Have a nice day!' },\n    { english: 'night', arabic: 'ليل', example: 'Good night, sleep well.' },\n    { english: 'morning', arabic: 'صباح', example: 'Good morning everyone!' },\n  ]\n  \n  for (const student of students) {\n    console.log(`Adding words for student: ${student.name}`)\n    \n    for (let i = 0; i < sampleWords.length; i++) {\n      const word = sampleWords[i]\n      const known = i < 5 // First 5 words are marked as known\n      \n      await prisma.word.create({\n        data: {\n          id: `word_${student.id}_${i}_${Date.now()}`,\n          studentId: student.id,\n          englishWord: word.english,\n          arabicMeaning: word.arabic,\n          exampleSentence: word.example,\n          known,\n          reviewCount: known ? Math.floor(Math.random() * 5) + 1 : 0\n        }\n      })\n    }\n  }\n  \n  // Create sample packages\n  const packages = [\n    {\n      id: `pkg_${Date.now()}_1`,\n      title: 'Basic English',\n      titleAr: 'الإنجليزية الأساسية',\n      description: 'Learn the basics of English language',\n      descriptionAr: 'تعلم أساسيات اللغة الإنجليزية',\n      price: 500,\n      lessonsCount: 12,\n      durationDays: 30\n    },\n    {\n      id: `pkg_${Date.now()}_2`,\n      title: 'Intermediate English',\n      titleAr: 'الإنجليزية المتوسطة',\n      description: 'Improve your English skills',\n      descriptionAr: 'حسن مهاراتك في اللغة الإنجليزية',\n      price: 800,\n      lessonsCount: 20,\n      durationDays: 60\n    },\n    {\n      id: `pkg_${Date.now()}_3`,\n      title: 'Advanced English',\n      titleAr: 'الإنجليزية المتقدمة',\n      description: 'Master advanced English',\n      descriptionAr: 'أتقن اللغة الإنجليزية المتقدمة',\n      price: 1200,\n      lessonsCount: 30,\n      durationDays: 90\n    }\n  ]\n  \n  for (const pkg of packages) {\n    await prisma.package.create({ data: pkg })\n  }\n  \n  console.log('✅ Data seeding completed!')\n  console.log(`- Added ${sampleWords.length} words per student`)\n  console.log(`- Created ${packages.length} packages`)\n}\n\nseedData()\n  .catch(console.error)\n  .finally(() => prisma.$disconnect())\n","size_bytes":3558},"lib/theme.ts":{"content":"export const theme = {\n  colors: {\n    primary: {\n      50: '#e6f1f7',\n      100: '#cce3ef',\n      200: '#99c7df',\n      300: '#66abcf',\n      400: '#338fbf',\n      500: '#004E89',\n      600: '#003e6e',\n      700: '#002f52',\n      800: '#001f37',\n      900: '#00101b',\n    },\n    accent: {\n      50: '#fffdf5',\n      100: '#fffbeb',\n      200: '#fff6d6',\n      300: '#fff1c2',\n      400: '#ffedad',\n      500: '#FFD700',\n      600: '#ccac00',\n      700: '#998100',\n      800: '#665600',\n      900: '#332b00',\n    },\n    success: {\n      50: '#f0fdf4',\n      100: '#dcfce7',\n      200: '#bbf7d0',\n      300: '#86efac',\n      400: '#4ade80',\n      500: '#22c55e',\n      600: '#16a34a',\n      700: '#15803d',\n      800: '#166534',\n      900: '#14532d',\n    },\n    error: {\n      50: '#fef2f2',\n      100: '#fee2e2',\n      200: '#fecaca',\n      300: '#fca5a5',\n      400: '#f87171',\n      500: '#ef4444',\n      600: '#dc2626',\n      700: '#b91c1c',\n      800: '#991b1b',\n      900: '#7f1d1d',\n    },\n    warning: {\n      50: '#fffbeb',\n      100: '#fef3c7',\n      200: '#fde68a',\n      300: '#fcd34d',\n      400: '#fbbf24',\n      500: '#f59e0b',\n      600: '#d97706',\n      700: '#b45309',\n      800: '#92400e',\n      900: '#78350f',\n    },\n    info: {\n      50: '#eff6ff',\n      100: '#dbeafe',\n      200: '#bfdbfe',\n      300: '#93c5fd',\n      400: '#60a5fa',\n      500: '#3b82f6',\n      600: '#2563eb',\n      700: '#1d4ed8',\n      800: '#1e40af',\n      900: '#1e3a8a',\n    },\n    neutral: {\n      50: '#fafafa',\n      100: '#f5f5f5',\n      200: '#e5e5e5',\n      300: '#d4d4d4',\n      400: '#a3a3a3',\n      500: '#737373',\n      600: '#525252',\n      700: '#404040',\n      800: '#262626',\n      900: '#171717',\n    },\n  },\n  spacing: {\n    xs: '0.25rem',\n    sm: '0.5rem',\n    md: '1rem',\n    lg: '1.5rem',\n    xl: '2rem',\n    '2xl': '3rem',\n    '3xl': '4rem',\n    '4xl': '6rem',\n    '5xl': '8rem',\n  },\n  borderRadius: {\n    none: '0',\n    sm: '0.125rem',\n    DEFAULT: '0.375rem',\n    md: '0.5rem',\n    lg: '0.75rem',\n    xl: '1rem',\n    '2xl': '1.5rem',\n    '3xl': '2rem',\n    full: '9999px',\n  },\n  shadows: {\n    sm: '0 1px 2px 0 rgb(0 0 0 / 0.05)',\n    DEFAULT: '0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1)',\n    md: '0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)',\n    lg: '0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)',\n    xl: '0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1)',\n    '2xl': '0 25px 50px -12px rgb(0 0 0 / 0.25)',\n    inner: 'inset 0 2px 4px 0 rgb(0 0 0 / 0.05)',\n    none: '0 0 #0000',\n  },\n  fontSize: {\n    xs: ['0.75rem', { lineHeight: '1rem' }],\n    sm: ['0.875rem', { lineHeight: '1.25rem' }],\n    base: ['1rem', { lineHeight: '1.5rem' }],\n    lg: ['1.125rem', { lineHeight: '1.75rem' }],\n    xl: ['1.25rem', { lineHeight: '1.75rem' }],\n    '2xl': ['1.5rem', { lineHeight: '2rem' }],\n    '3xl': ['1.875rem', { lineHeight: '2.25rem' }],\n    '4xl': ['2.25rem', { lineHeight: '2.5rem' }],\n    '5xl': ['3rem', { lineHeight: '1' }],\n    '6xl': ['3.75rem', { lineHeight: '1' }],\n    '7xl': ['4.5rem', { lineHeight: '1' }],\n    '8xl': ['6rem', { lineHeight: '1' }],\n    '9xl': ['8rem', { lineHeight: '1' }],\n  },\n  breakpoints: {\n    xs: '320px',\n    sm: '640px',\n    md: '768px',\n    lg: '1024px',\n    xl: '1280px',\n    '2xl': '1536px',\n  },\n  transitions: {\n    fast: '150ms cubic-bezier(0.4, 0, 0.2, 1)',\n    base: '300ms cubic-bezier(0.4, 0, 0.2, 1)',\n    slow: '500ms cubic-bezier(0.4, 0, 0.2, 1)',\n  },\n} as const;\n\nexport type Theme = typeof theme;\n","size_bytes":3554},"app/api/packages/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { prisma } from '@/lib/prisma'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const packages = await prisma.package.findMany({\n      where: { isActive: true },\n      orderBy: { price: 'asc' }\n    })\n\n    return NextResponse.json(packages)\n  } catch (error) {\n    console.error('Error fetching packages:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":479},"app/dashboard/teacher/page.tsx":{"content":"import { redirect } from 'next/navigation'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\nimport TeacherDashboardClient from './TeacherDashboardClient'\n\nexport const dynamic = 'force-dynamic'\n\nexport default async function TeacherDashboardPage() {\n  const session = await getServerSession(authOptions)\n\n  if (!session) {\n    redirect('/auth/login')\n  }\n\n  if (session.user.role !== 'TEACHER') {\n    redirect('/dashboard')\n  }\n\n  const teacherProfile = await prisma.teacherProfile.findUnique({\n    where: { userId: session.user.id }\n  })\n\n  if (!teacherProfile) {\n    return <div>Error: Teacher profile not found</div>\n  }\n\n  return (\n    <TeacherDashboardClient\n      user={{\n        name: session.user.name,\n        email: session.user.email,\n        teacherProfileId: teacherProfile.id\n      }}\n    />\n  )\n}\n","size_bytes":887},"app/dashboard/admin/components/SystemTab.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { Activity, Clock } from 'lucide-react'\nimport Card from '@/components/ui/Card'\nimport LoadingSpinner from '@/components/ui/LoadingSpinner'\nimport Alert from '@/components/ui/Alert'\n\ninterface AuditLog {\n  id: string\n  action: string\n  userId: string | null\n  details: string | null\n  createdAt: string\n}\n\nexport default function SystemTab() {\n  const [logs, setLogs] = useState<AuditLog[]>([])\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    fetchLogs()\n  }, [])\n\n  async function fetchLogs() {\n    try {\n      const response = await fetch('/api/admin/logs')\n      if (response.ok) {\n        const data = await response.json()\n        setLogs(data)\n      }\n    } catch (error) {\n      console.error('Error fetching logs:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <LoadingSpinner size=\"lg\" />\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <h2 className=\"text-3xl font-bold text-[#004E89]\">\n        System Activity / نشاط النظام\n      </h2>\n\n      <Card variant=\"elevated\">\n        <div className=\"flex items-center gap-3 mb-4\">\n          <Activity className=\"h-6 w-6 text-[#004E89]\" />\n          <h3 className=\"text-xl font-bold text-[#004E89]\">\n            Recent Activity Logs / سجلات النشاط الأخيرة\n          </h3>\n        </div>\n        \n        {logs.length === 0 ? (\n          <Alert variant=\"info\">\n            <p>No activity logs yet.</p>\n            <p>لا توجد سجلات نشاط بعد.</p>\n          </Alert>\n        ) : (\n          <div className=\"space-y-2\">\n            {logs.map((log) => (\n              <div key={log.id} className=\"p-3 bg-gray-50 rounded-lg border border-gray-200\">\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <p className=\"font-medium text-gray-900\">{log.action}</p>\n                    {log.details && (\n                      <p className=\"text-sm text-gray-600 mt-1\">{log.details}</p>\n                    )}\n                  </div>\n                  <div className=\"flex items-center gap-2 text-xs text-gray-500\">\n                    <Clock className=\"h-3 w-3\" />\n                    <span>{new Date(log.createdAt).toLocaleString('ar-EG')}</span>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </Card>\n\n      <Card variant=\"elevated\">\n        <h3 className=\"text-xl font-bold text-[#004E89] mb-4\">\n          System Information / معلومات النظام\n        </h3>\n        <div className=\"space-y-2 text-gray-700\">\n          <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n            <span>Platform Version</span>\n            <span className=\"font-medium\">1.0.0</span>\n          </div>\n          <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n            <span>Database Status</span>\n            <span className=\"font-medium text-green-600\">Connected</span>\n          </div>\n          <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n            <span>Last Backup</span>\n            <span className=\"font-medium\">Automatic</span>\n          </div>\n        </div>\n      </Card>\n    </div>\n  )\n}\n","size_bytes":3454},"app/dashboard/teacher/components/AssignmentsTab.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { FileText, Plus, CheckCircle, Clock, Send } from 'lucide-react'\nimport Card from '@/components/ui/Card'\nimport Badge from '@/components/ui/Badge'\nimport Alert from '@/components/ui/Alert'\nimport Button from '@/components/ui/Button'\nimport LoadingSpinner from '@/components/ui/LoadingSpinner'\nimport Modal from '@/components/ui/Modal'\nimport Input from '@/components/ui/Input'\nimport GrammarErrorHighlighter from '@/components/GrammarErrorHighlighter'\n\ninterface Assignment {\n  id: string\n  title: string\n  description: string | null\n  dueDate: string | null\n  session: {\n    title: string\n  } | null\n  submissions: Array<{\n    id: string\n    student: {\n      name: string\n    }\n    textAnswer: string\n    grade: number | null\n    feedback: string | null\n    grammarErrors: string | null\n    submittedAt: string\n  }>\n}\n\ninterface Session {\n  id: string\n  title: string\n}\n\nexport default function AssignmentsTab({ teacherProfileId }: { teacherProfileId: string }) {\n  const [assignments, setAssignments] = useState<Assignment[]>([])\n  const [sessions, setSessions] = useState<Session[]>([])\n  const [loading, setLoading] = useState(true)\n  const [showCreateForm, setShowCreateForm] = useState(false)\n  const [selectedSubmission, setSelectedSubmission] = useState<Assignment['submissions'][0] | null>(null)\n  const [gradeData, setGradeData] = useState({ grade: '', feedback: '', grammarErrors: [] as Array<{text: string, correction: string, explanation: string}> })\n  const [newAssignment, setNewAssignment] = useState({\n    title: '',\n    description: '',\n    sessionId: '',\n    dueDate: ''\n  })\n  const [submitting, setSubmitting] = useState(false)\n\n  useEffect(() => {\n    fetchData()\n  }, [])\n\n  async function fetchData() {\n    try {\n      const [assignmentsRes, sessionsRes] = await Promise.all([\n        fetch('/api/teacher/assignments'),\n        fetch('/api/teacher/sessions')\n      ])\n\n      if (assignmentsRes.ok) {\n        const data = await assignmentsRes.json()\n        setAssignments(data)\n      }\n\n      if (sessionsRes.ok) {\n        const data = await sessionsRes.json()\n        setSessions(data)\n      }\n    } catch (error) {\n      console.error('Error fetching data:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  async function handleCreateAssignment() {\n    if (!newAssignment.title) {\n      alert('Please enter a title')\n      return\n    }\n\n    setSubmitting(true)\n    try {\n      const response = await fetch('/api/teacher/assignments', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(newAssignment)\n      })\n\n      if (response.ok) {\n        await fetchData()\n        setNewAssignment({ title: '', description: '', sessionId: '', dueDate: '' })\n        setShowCreateForm(false)\n        alert('Assignment created successfully!')\n      } else {\n        alert('Failed to create assignment')\n      }\n    } catch (error) {\n      console.error('Error creating assignment:', error)\n      alert('Error creating assignment')\n    } finally {\n      setSubmitting(false)\n    }\n  }\n\n  async function handleGradeSubmission() {\n    if (!selectedSubmission || !gradeData.grade) {\n      alert('Please enter a grade')\n      return\n    }\n\n    setSubmitting(true)\n    try {\n      const response = await fetch(`/api/teacher/assignments/${selectedSubmission.id}/grade`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          grade: parseFloat(gradeData.grade),\n          feedback: gradeData.feedback,\n          grammarErrors: JSON.stringify(gradeData.grammarErrors)\n        })\n      })\n\n      if (response.ok) {\n        await fetchData()\n        setSelectedSubmission(null)\n        setGradeData({ grade: '', feedback: '', grammarErrors: [] })\n        alert('Submission graded successfully!')\n      } else {\n        alert('Failed to grade submission')\n      }\n    } catch (error) {\n      console.error('Error grading submission:', error)\n      alert('Error grading submission')\n    } finally {\n      setSubmitting(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <LoadingSpinner size=\"lg\" />\n      </div>\n    )\n  }\n\n  const pendingGrading = assignments.flatMap(a => \n    a.submissions.filter(s => s.grade === null)\n  )\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <h2 className=\"text-3xl font-bold text-[#004E89]\">\n          Assignments / الواجبات\n        </h2>\n        <Button\n          variant=\"primary\"\n          onClick={() => setShowCreateForm(true)}\n        >\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Create Assignment / إنشاء واجب\n        </Button>\n      </div>\n\n      {pendingGrading.length > 0 && (\n        <Card variant=\"elevated\" className=\"bg-orange-50 border-orange-200\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center\">\n              <Clock className=\"h-6 w-6 text-orange-600\" />\n            </div>\n            <div>\n              <h3 className=\"font-semibold text-gray-900\">Pending Grading</h3>\n              <p className=\"text-sm text-gray-700\">\n                {pendingGrading.length} submission(s) waiting for your review\n              </p>\n            </div>\n          </div>\n        </Card>\n      )}\n\n      <div className=\"space-y-4\">\n        {assignments.length === 0 ? (\n          <Alert variant=\"info\">\n            <p>No assignments created yet. Create your first assignment!</p>\n            <p>لم يتم إنشاء واجبات بعد. قم بإنشاء أول واجب!</p>\n          </Alert>\n        ) : (\n          assignments.map((assignment) => (\n            <Card key={assignment.id} variant=\"elevated\">\n              <div className=\"mb-4\">\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <FileText className=\"h-5 w-5 text-[#004E89]\" />\n                  <h3 className=\"text-lg font-bold text-[#004E89]\">{assignment.title}</h3>\n                  {assignment.submissions.length > 0 && (\n                    <Badge variant=\"info\">\n                      {assignment.submissions.length} submission(s)\n                    </Badge>\n                  )}\n                </div>\n                {assignment.description && (\n                  <p className=\"text-gray-700 mb-2\">{assignment.description}</p>\n                )}\n                {assignment.session && (\n                  <p className=\"text-sm text-gray-600\">Session: {assignment.session.title}</p>\n                )}\n                {assignment.dueDate && (\n                  <p className=\"text-sm text-gray-600\">\n                    Due: {new Date(assignment.dueDate).toLocaleDateString('ar-EG')}\n                  </p>\n                )}\n              </div>\n\n              {assignment.submissions.length > 0 && (\n                <div className=\"space-y-3 mt-4 pt-4 border-t border-gray-200\">\n                  <h4 className=\"font-semibold text-gray-900\">Submissions:</h4>\n                  {assignment.submissions.map((submission) => (\n                    <div key={submission.id} className=\"bg-gray-50 p-3 rounded-lg\">\n                      <div className=\"flex items-start justify-between mb-2\">\n                        <div className=\"flex-1\">\n                          <p className=\"font-medium text-gray-900\">{submission.student.name}</p>\n                          <p className=\"text-sm text-gray-600\">\n                            Submitted: {new Date(submission.submittedAt).toLocaleString('ar-EG')}\n                          </p>\n                        </div>\n                        {submission.grade !== null ? (\n                          <Badge variant=\"success\">\n                            <CheckCircle className=\"h-3 w-3 mr-1\" />\n                            Graded: {submission.grade}/100\n                          </Badge>\n                        ) : (\n                          <Button\n                            variant=\"primary\"\n                            size=\"sm\"\n                            onClick={() => {\n                              setSelectedSubmission(submission)\n                              const existingErrors = submission.grammarErrors \n                                ? JSON.parse(submission.grammarErrors) \n                                : []\n                              setGradeData({ \n                                grade: submission.grade?.toString() || '', \n                                feedback: submission.feedback || '', \n                                grammarErrors: existingErrors \n                              })\n                            }}\n                          >\n                            <Send className=\"h-3 w-3 mr-1\" />\n                            Grade\n                          </Button>\n                        )}\n                      </div>\n                      <p className=\"text-sm text-gray-700 mb-2\">\n                        <strong>Answer:</strong> {submission.textAnswer}\n                      </p>\n                      {submission.feedback && (\n                        <p className=\"text-sm text-blue-700\">\n                          <strong>Your Feedback:</strong> {submission.feedback}\n                        </p>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              )}\n            </Card>\n          ))\n        )}\n      </div>\n\n      {showCreateForm && (\n        <Modal\n          isOpen={true}\n          onClose={() => setShowCreateForm(false)}\n          title=\"Create New Assignment / إنشاء واجب جديد\"\n        >\n          <div className=\"space-y-4\">\n            <Input\n              label=\"Assignment Title / عنوان الواجب\"\n              value={newAssignment.title}\n              onChange={(e) => setNewAssignment({ ...newAssignment, title: e.target.value })}\n              placeholder=\"e.g., Essay on Environmental Protection\"\n            />\n            <div>\n              <label className=\"block text-sm font-medium text-gray-900 mb-2\">\n                Description / الوصف\n              </label>\n              <textarea\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#004E89]\"\n                value={newAssignment.description}\n                onChange={(e) => setNewAssignment({ ...newAssignment, description: e.target.value })}\n                placeholder=\"Assignment instructions...\"\n                rows={4}\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-900 mb-2\">\n                Linked Session (Optional) / الحصة المرتبطة (اختياري)\n              </label>\n              <select\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#004E89]\"\n                value={newAssignment.sessionId}\n                onChange={(e) => setNewAssignment({ ...newAssignment, sessionId: e.target.value })}\n              >\n                <option value=\"\">No session</option>\n                {sessions.map((session) => (\n                  <option key={session.id} value={session.id}>\n                    {session.title}\n                  </option>\n                ))}\n              </select>\n            </div>\n            <Input\n              label=\"Due Date (Optional) / تاريخ التسليم (اختياري)\"\n              type=\"datetime-local\"\n              value={newAssignment.dueDate}\n              onChange={(e) => setNewAssignment({ ...newAssignment, dueDate: e.target.value })}\n            />\n            <div className=\"flex gap-2\">\n              <Button\n                variant=\"primary\"\n                fullWidth\n                onClick={handleCreateAssignment}\n                disabled={submitting}\n              >\n                {submitting ? 'Creating...' : 'Create / إنشاء'}\n              </Button>\n              <Button\n                variant=\"outline\"\n                fullWidth\n                onClick={() => setShowCreateForm(false)}\n              >\n                Cancel / إلغاء\n              </Button>\n            </div>\n          </div>\n        </Modal>\n      )}\n\n      {selectedSubmission && (\n        <Modal\n          isOpen={true}\n          onClose={() => setSelectedSubmission(null)}\n          title={`Grade: ${selectedSubmission.student.name}`}\n        >\n          <div className=\"space-y-4 max-h-[80vh] overflow-y-auto\">\n            <GrammarErrorHighlighter\n              studentAnswer={selectedSubmission.textAnswer}\n              errors={gradeData.grammarErrors}\n              onErrorsChange={(errors) => setGradeData({ ...gradeData, grammarErrors: errors })}\n            />\n            \n            <Input\n              label=\"Grade (0-100) / الدرجة\"\n              type=\"number\"\n              min=\"0\"\n              max=\"100\"\n              value={gradeData.grade}\n              onChange={(e) => setGradeData({ ...gradeData, grade: e.target.value })}\n              placeholder=\"e.g., 85\"\n            />\n            <div>\n              <label className=\"block text-sm font-medium text-gray-900 dark:text-gray-100 mb-2\">\n                General Feedback (Optional) / التعليق العام (اختياري)\n              </label>\n              <textarea\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#004E89] bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100\"\n                value={gradeData.feedback}\n                onChange={(e) => setGradeData({ ...gradeData, feedback: e.target.value })}\n                placeholder=\"Provide general feedback to the student...\"\n                rows={4}\n              />\n            </div>\n            <div className=\"flex gap-2\">\n              <Button\n                variant=\"primary\"\n                fullWidth\n                onClick={handleGradeSubmission}\n                disabled={submitting}\n              >\n                {submitting ? 'Submitting...' : 'Submit Grade / تسليم'}\n              </Button>\n              <Button\n                variant=\"outline\"\n                fullWidth\n                onClick={() => setSelectedSubmission(null)}\n              >\n                Cancel / إلغاء\n              </Button>\n            </div>\n          </div>\n        </Modal>\n      )}\n    </div>\n  )\n}\n","size_bytes":14616},"app/api/teacher/stats/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'TEACHER') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const teacherProfile = await prisma.teacherProfile.findUnique({\n      where: { userId: session.user.id }\n    })\n\n    if (!teacherProfile) {\n      return NextResponse.json({ error: 'Teacher profile not found' }, { status: 404 })\n    }\n\n    const [totalSessions, upcomingSessions, activeStudents, pendingSubmissions] = await Promise.all([\n      prisma.session.count({\n        where: { teacherId: teacherProfile.id }\n      }),\n      prisma.session.count({\n        where: {\n          teacherId: teacherProfile.id,\n          startTime: { gte: new Date() },\n          status: 'SCHEDULED'\n        }\n      }),\n      prisma.sessionStudent.groupBy({\n        by: ['studentId'],\n        where: {\n          Session: {\n            teacherId: teacherProfile.id\n          }\n        }\n      }),\n      prisma.submission.count({\n        where: {\n          Assignment: {\n            Session: {\n              teacherId: teacherProfile.id\n            }\n          },\n          grade: null\n        }\n      })\n    ])\n\n    const nextSession = await prisma.session.findFirst({\n      where: {\n        teacherId: teacherProfile.id,\n        startTime: { gte: new Date() },\n        status: 'SCHEDULED'\n      },\n      include: {\n        SessionStudent: true\n      },\n      orderBy: {\n        startTime: 'asc'\n      }\n    })\n\n    return NextResponse.json({\n      totalStudents: activeStudents.length,\n      totalSessions,\n      upcomingSessions,\n      pendingGrading: pendingSubmissions,\n      nextSession: nextSession ? {\n        id: nextSession.id,\n        title: nextSession.title,\n        startTime: nextSession.startTime,\n        endTime: nextSession.endTime,\n        studentsCount: nextSession.SessionStudent.length\n      } : null\n    })\n  } catch (error) {\n    console.error('Error fetching teacher stats:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":2314},"app/dashboard/student/components/HomeworkTab.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { FileText, Clock, CheckCircle, Send } from 'lucide-react'\nimport Card from '@/components/ui/Card'\nimport Badge from '@/components/ui/Badge'\nimport Alert from '@/components/ui/Alert'\nimport Button from '@/components/ui/Button'\nimport LoadingSpinner from '@/components/ui/LoadingSpinner'\nimport Modal from '@/components/ui/Modal'\nimport GrammarErrorHighlighter from '@/components/GrammarErrorHighlighter'\n\ninterface Assignment {\n  id: string\n  title: string\n  description: string | null\n  dueDate: string | null\n  session: {\n    title: string\n  } | null\n  submissions: Array<{\n    id: string\n    textAnswer: string\n    grade: number | null\n    feedback: string | null\n    grammarErrors: string | null\n    submittedAt: string\n  }>\n}\n\nexport default function HomeworkTab({ isActive }: { isActive: boolean }) {\n  const [assignments, setAssignments] = useState<Assignment[]>([])\n  const [loading, setLoading] = useState(true)\n  const [selectedAssignment, setSelectedAssignment] = useState<Assignment | null>(null)\n  const [answer, setAnswer] = useState('')\n  const [submitting, setSubmitting] = useState(false)\n\n  useEffect(() => {\n    if (isActive) {\n      fetchAssignments()\n    }\n  }, [isActive])\n\n  async function fetchAssignments() {\n    try {\n      const response = await fetch('/api/assignments/student')\n      if (response.ok) {\n        const data = await response.json()\n        setAssignments(data)\n      }\n    } catch (error) {\n      console.error('Error fetching assignments:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  async function handleSubmit() {\n    if (!selectedAssignment || !answer.trim()) return\n\n    setSubmitting(true)\n    try {\n      const response = await fetch('/api/assignments/student', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          assignmentId: selectedAssignment.id,\n          textAnswer: answer\n        })\n      })\n\n      if (response.ok) {\n        await fetchAssignments()\n        setAnswer('')\n        setSelectedAssignment(null)\n      }\n    } catch (error) {\n      console.error('Error submitting assignment:', error)\n    } finally {\n      setSubmitting(false)\n    }\n  }\n\n  const pendingAssignments = assignments.filter(a => a.submissions.length === 0)\n  const submittedAssignments = assignments.filter(a => a.submissions.length > 0)\n\n  if (!isActive) {\n    return (\n      <div>\n        <h2 className=\"text-3xl font-bold text-[#004E89] mb-6\">\n          My Homework / واجباتي\n        </h2>\n        <Alert variant=\"warning\">\n          <p>Activate your account to access homework / قم بتفعيل حسابك للوصول للواجبات</p>\n        </Alert>\n      </div>\n    )\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <LoadingSpinner size=\"lg\" />\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <h2 className=\"text-3xl font-bold text-[#004E89]\">\n        My Homework / واجباتي\n      </h2>\n\n      <div>\n        <h3 className=\"text-xl font-semibold text-gray-900 mb-4\">\n          Pending Assignments / واجبات معلقة ({pendingAssignments.length})\n        </h3>\n        {pendingAssignments.length === 0 ? (\n          <Alert variant=\"success\">\n            <CheckCircle className=\"h-5 w-5\" />\n            <p>Great! No pending assignments.</p>\n            <p>رائع! لا توجد واجبات معلقة.</p>\n          </Alert>\n        ) : (\n          <div className=\"space-y-4\">\n            {pendingAssignments.map((assignment) => (\n              <Card key={assignment.id} variant=\"elevated\">\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <FileText className=\"h-5 w-5 text-[#004E89]\" />\n                      <h3 className=\"text-lg font-bold text-[#004E89]\">{assignment.title}</h3>\n                      <Badge variant=\"warning\">Pending / معلق</Badge>\n                    </div>\n                    {assignment.description && (\n                      <p className=\"text-gray-700 mb-2\">{assignment.description}</p>\n                    )}\n                    {assignment.session && (\n                      <p className=\"text-sm text-gray-600 mb-2\">\n                        From session: {assignment.session.title}\n                      </p>\n                    )}\n                    {assignment.dueDate && (\n                      <div className=\"flex items-center gap-2 text-sm text-gray-600\">\n                        <Clock className=\"h-4 w-4\" />\n                        <span>\n                          Due: {new Date(assignment.dueDate).toLocaleDateString('ar-EG', {\n                            weekday: 'short',\n                            year: 'numeric',\n                            month: 'short',\n                            day: 'numeric'\n                          })}\n                        </span>\n                      </div>\n                    )}\n                  </div>\n                  <Button\n                    variant=\"primary\"\n                    size=\"sm\"\n                    onClick={() => {\n                      setSelectedAssignment(assignment)\n                      setAnswer('')\n                    }}\n                  >\n                    <Send className=\"h-4 w-4 mr-2\" />\n                    Submit / سلّم\n                  </Button>\n                </div>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n\n      <div>\n        <h3 className=\"text-xl font-semibold text-gray-900 mb-4\">\n          Submitted Assignments / واجبات مسلّمة ({submittedAssignments.length})\n        </h3>\n        {submittedAssignments.length === 0 ? (\n          <Alert variant=\"info\">\n            <p>No submitted assignments yet.</p>\n            <p>لم تسلّم أي واجبات بعد.</p>\n          </Alert>\n        ) : (\n          <div className=\"space-y-4\">\n            {submittedAssignments.map((assignment) => {\n              const submission = assignment.submissions[0]\n              return (\n                <Card key={assignment.id} variant=\"elevated\">\n                  <div className=\"flex items-start justify-between mb-3\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        <FileText className=\"h-5 w-5 text-green-600\" />\n                        <h3 className=\"text-lg font-bold text-gray-900\">{assignment.title}</h3>\n                        {submission.grade !== null ? (\n                          <Badge variant=\"success\">\n                            Graded: {submission.grade}/100\n                          </Badge>\n                        ) : (\n                          <Badge variant=\"info\">\n                            Under Review / قيد المراجعة\n                          </Badge>\n                        )}\n                      </div>\n                      <p className=\"text-sm text-gray-600 mb-2\">\n                        Submitted: {new Date(submission.submittedAt).toLocaleString('ar-EG')}\n                      </p>\n                    </div>\n                  </div>\n                  {submission.grammarErrors && JSON.parse(submission.grammarErrors).length > 0 ? (\n                    <div className=\"mb-3\">\n                      <GrammarErrorHighlighter\n                        studentAnswer={submission.textAnswer}\n                        errors={JSON.parse(submission.grammarErrors)}\n                        onErrorsChange={() => {}}\n                        readonly={true}\n                      />\n                    </div>\n                  ) : (\n                    <div className=\"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg mb-3\">\n                      <p className=\"text-sm text-gray-700 dark:text-gray-300 font-medium mb-1\">Your Answer / إجابتك:</p>\n                      <p className=\"text-sm text-gray-800 dark:text-gray-200\">{submission.textAnswer}</p>\n                    </div>\n                  )}\n                  {submission.feedback && (\n                    <div className=\"bg-blue-50 dark:bg-blue-900 p-4 rounded-lg\">\n                      <p className=\"text-sm text-blue-900 dark:text-blue-100 font-medium mb-1\">\n                        General Feedback / التعليق العام:\n                      </p>\n                      <p className=\"text-sm text-blue-800 dark:text-blue-200\">{submission.feedback}</p>\n                    </div>\n                  )}\n                </Card>\n              )\n            })}\n          </div>\n        )}\n      </div>\n\n      {selectedAssignment && (\n        <Modal\n          isOpen={true}\n          onClose={() => setSelectedAssignment(null)}\n          title={`Submit: ${selectedAssignment.title}`}\n        >\n          <div className=\"space-y-4\">\n            {selectedAssignment.description && (\n              <div>\n                <p className=\"font-medium text-gray-900 mb-1\">Assignment Description:</p>\n                <p className=\"text-gray-700\">{selectedAssignment.description}</p>\n              </div>\n            )}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-900 mb-2\">\n                Your Answer / إجابتك:\n              </label>\n              <textarea\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#004E89] min-h-[200px]\"\n                value={answer}\n                onChange={(e) => setAnswer(e.target.value)}\n                placeholder=\"Type your answer here... / اكتب إجابتك هنا...\"\n              />\n            </div>\n            <div className=\"flex gap-2\">\n              <Button\n                variant=\"primary\"\n                fullWidth\n                onClick={handleSubmit}\n                disabled={submitting || !answer.trim()}\n              >\n                {submitting ? 'Submitting...' : 'Submit / تسليم'}\n              </Button>\n              <Button\n                variant=\"outline\"\n                fullWidth\n                onClick={() => setSelectedAssignment(null)}\n              >\n                Cancel / إلغاء\n              </Button>\n            </div>\n          </div>\n        </Modal>\n      )}\n    </div>\n  )\n}\n","size_bytes":10413},"app/dashboard/teacher/components/StudentsTab.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { User, CheckCircle, XCircle, Calendar } from 'lucide-react'\nimport Card from '@/components/ui/Card'\nimport Badge from '@/components/ui/Badge'\nimport Alert from '@/components/ui/Alert'\nimport LoadingSpinner from '@/components/ui/LoadingSpinner'\n\ninterface Student {\n  id: string\n  name: string\n  email: string\n  isActive: boolean\n  phone: string | null\n  studentProfile: {\n    levelCurrent: string | null\n    sessionsAttended: number\n  }\n  sessionsCount: number\n  wordsCount: number\n}\n\nexport default function StudentsTab({ teacherProfileId }: { teacherProfileId: string }) {\n  const [students, setStudents] = useState<Student[]>([])\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    fetchStudents()\n  }, [])\n\n  async function fetchStudents() {\n    try {\n      const response = await fetch('/api/teacher/students')\n      if (response.ok) {\n        const data = await response.json()\n        setStudents(data)\n      }\n    } catch (error) {\n      console.error('Error fetching students:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <LoadingSpinner size=\"lg\" />\n      </div>\n    )\n  }\n\n  const activeStudents = students.filter(s => s.isActive)\n  const inactiveStudents = students.filter(s => !s.isActive)\n\n  return (\n    <div className=\"space-y-6\">\n      <h2 className=\"text-3xl font-bold text-[#004E89]\">\n        My Students / طلابي\n      </h2>\n\n      <div>\n        <h3 className=\"text-xl font-semibold text-gray-900 mb-4\">\n          Active Students / طلاب نشطون ({activeStudents.length})\n        </h3>\n        {activeStudents.length === 0 ? (\n          <Alert variant=\"info\">\n            <p>No active students yet.</p>\n            <p>لا يوجد طلاب نشطون بعد.</p>\n          </Alert>\n        ) : (\n          <div className=\"space-y-4\">\n            {activeStudents.map((student) => (\n              <Card key={student.id} variant=\"elevated\">\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex items-start gap-3 flex-1\">\n                    <div className=\"w-12 h-12 bg-[#004E89] rounded-full flex items-center justify-center text-white text-lg font-bold\">\n                      {student.name?.charAt(0).toUpperCase()}\n                    </div>\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2 mb-1\">\n                        <h3 className=\"text-lg font-bold text-gray-900\">{student.name}</h3>\n                        <Badge variant=\"success\">\n                          <CheckCircle className=\"h-3 w-3 mr-1\" />\n                          Active\n                        </Badge>\n                      </div>\n                      <p className=\"text-sm text-gray-600 mb-2\">{student.email}</p>\n                      {student.phone && (\n                        <p className=\"text-sm text-gray-600 mb-2\">Phone: {student.phone}</p>\n                      )}\n                      <div className=\"flex gap-4 text-sm text-gray-700\">\n                        <span>\n                          <strong>Level:</strong> {student.studentProfile?.levelCurrent || 'Not set'}\n                        </span>\n                        <span>\n                          <strong>Sessions:</strong> {student.sessionsCount || 0}\n                        </span>\n                        <span>\n                          <strong>Words:</strong> {student.wordsCount || 0}\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {inactiveStudents.length > 0 && (\n        <div>\n          <h3 className=\"text-xl font-semibold text-gray-900 mb-4\">\n            Inactive Students / طلاب غير نشطين ({inactiveStudents.length})\n          </h3>\n          <div className=\"space-y-4\">\n            {inactiveStudents.map((student) => (\n              <Card key={student.id} variant=\"elevated\" className=\"opacity-60\">\n                <div className=\"flex items-start gap-3\">\n                  <div className=\"w-12 h-12 bg-gray-300 rounded-full flex items-center justify-center text-gray-600 text-lg font-bold\">\n                    {student.name?.charAt(0).toUpperCase()}\n                  </div>\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-1\">\n                      <h3 className=\"text-lg font-bold text-gray-700\">{student.name}</h3>\n                      <Badge variant=\"warning\">\n                        <XCircle className=\"h-3 w-3 mr-1\" />\n                        Pending Activation\n                      </Badge>\n                    </div>\n                    <p className=\"text-sm text-gray-600\">{student.email}</p>\n                  </div>\n                </div>\n              </Card>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","size_bytes":5097},"app/api/admin/subscriptions/[id]/approve/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || (session.user.role !== 'ADMIN' && session.user.role !== 'ASSISTANT')) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const { id: subscriptionId } = await params\n\n    const subscription = await prisma.subscription.findUnique({\n      where: { id: subscriptionId },\n      include: {\n        package: true,\n        user: true\n      }\n    })\n\n    if (!subscription) {\n      return NextResponse.json({ error: 'Subscription not found' }, { status: 404 })\n    }\n\n    if (subscription.paid) {\n      return NextResponse.json({ error: 'Subscription already approved' }, { status: 400 })\n    }\n\n    const now = new Date()\n    const endDate = new Date(now)\n    endDate.setDate(endDate.getDate() + subscription.package.durationDays)\n\n    const updatedSubscription = await prisma.subscription.update({\n      where: { id: subscriptionId },\n      data: {\n        paid: true,\n        startDate: now,\n        endDate: endDate\n      }\n    })\n\n    await prisma.user.update({\n      where: { id: subscription.studentId },\n      data: { isActive: true }\n    })\n\n    await prisma.auditLog.create({\n      data: {\n        id: `audit_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        action: 'Subscription approved',\n        userId: session.user.id,\n        details: `Approved subscription for ${subscription.user.name} - ${subscription.package.title} (${subscription.package.price} SAR)`\n      }\n    })\n\n    const approvalMessage = `🎉 *مبروك! تم تفعيل اشتراكك!*\\n\\nعزيزي ${subscription.user.name},\\n\\nتم تفعيل اشتراكك بنجاح في:\\n📦 ${subscription.package.titleAr}\\n💰 ${subscription.package.price} SAR\\n📚 ${subscription.package.lessonsCount} حصة\\n📅 صالح حتى: ${endDate.toLocaleDateString('ar-EG')}\\n\\nيمكنك الآن:\\n✅ الدخول إلى لوحة التحكم\\n✅ حجز الحصص\\n✅ التواصل مع المعلمين\\n\\nنتمنى لك تجربة تعليمية ممتعة! 🎓\\n\\nفريق Youspeak 🌟`\n    \n    const phoneNumber = '201091515594'\n    const studentPhone = subscription.user.phone\n    \n    if (studentPhone) {\n      console.log('Send WhatsApp message to:', studentPhone)\n      console.log('Message:', approvalMessage)\n    }\n\n    return NextResponse.json(updatedSubscription)\n  } catch (error) {\n    console.error('Error approving subscription:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":2848},"scripts/seed-database.js":{"content":"const { PrismaClient } = require('@prisma/client');\nconst bcrypt = require('bcryptjs');\nconst { v4: uuidv4 } = require('uuid');\nconst prisma = new PrismaClient();\n\nasync function main() {\n  console.log('🌱 بدء إضافة البيانات الوهمية...\\n');\n\n  const adminPassword = await bcrypt.hash('admin123', 10);\n  await prisma.user.update({\n    where: { email: 'admin@youspeak.com' },\n    data: { passwordHash: adminPassword }\n  });\n  console.log('✅ تم تحديث كلمة مرور المدير إلى: admin123\\n');\n\n  const teacherPassword = await bcrypt.hash('teacher123', 10);\n  \n  let teacher = await prisma.user.findUnique({\n    where: { email: 'teacher@youspeak.com' }\n  });\n  \n  if (teacher) {\n    teacher = await prisma.user.update({\n      where: { email: 'teacher@youspeak.com' },\n      data: { passwordHash: teacherPassword, isActive: true }\n    });\n  } else {\n    teacher = await prisma.user.create({\n      data: {\n        id: uuidv4(),\n        email: 'teacher@youspeak.com',\n        name: 'Mr. Ahmed',\n        passwordHash: teacherPassword,\n        role: 'TEACHER',\n        isActive: true,\n        phone: '+966501234567'\n      }\n    });\n  }\n\n  const existingTeacherProfile = await prisma.teacherProfile.findUnique({\n    where: { userId: teacher.id }\n  });\n\n  if (existingTeacherProfile) {\n    await prisma.teacherProfile.update({\n      where: { userId: teacher.id },\n      data: { bio: 'خبرة 10 سنوات في تدريس اللغة الإنجليزية' }\n    });\n  } else {\n    await prisma.teacherProfile.create({\n      data: {\n        id: uuidv4(),\n        userId: teacher.id,\n        bio: 'خبرة 10 سنوات في تدريس اللغة الإنجليزية',\n        subjects: 'English Grammar, Speaking, Writing'\n      }\n    });\n  }\n  console.log('✅ تم إنشاء حساب معلم: teacher@youspeak.com (كلمة المرور: teacher123)\\n');\n\n  const studentPassword = await bcrypt.hash('student123', 10);\n  const students = [];\n  \n  const studentNames = [\n    { name: 'محمد أحمد', email: 'student1@test.com', age: 18, level: 'A1' },\n    { name: 'فاطمة علي', email: 'student2@test.com', age: 22, level: 'A2' },\n    { name: 'عبدالله خالد', email: 'student3@test.com', age: 20, level: 'B1' }\n  ];\n\n  for (const studentData of studentNames) {\n    let student = await prisma.user.findUnique({\n      where: { email: studentData.email }\n    });\n    \n    if (student) {\n      student = await prisma.user.update({\n        where: { email: studentData.email },\n        data: { passwordHash: studentPassword, isActive: true }\n      });\n    } else {\n      student = await prisma.user.create({\n        data: {\n          id: uuidv4(),\n          email: studentData.email,\n          name: studentData.name,\n          passwordHash: studentPassword,\n          role: 'STUDENT',\n          isActive: true,\n          phone: `+96650${Math.floor(Math.random() * 9000000) + 1000000}`\n        }\n      });\n    }\n    \n    const existingStudentProfile = await prisma.studentProfile.findUnique({\n      where: { userId: student.id }\n    });\n\n    if (existingStudentProfile) {\n      await prisma.studentProfile.update({\n        where: { userId: student.id },\n        data: { age: studentData.age, levelCurrent: studentData.level }\n      });\n    } else {\n      await prisma.studentProfile.create({\n        data: {\n          id: uuidv4(),\n          userId: student.id,\n          age: studentData.age,\n          levelInitial: studentData.level,\n          levelCurrent: studentData.level,\n          targetLevel: 'C1',\n          goal: 'تحسين مهارات المحادثة والكتابة',\n          preferredTime: 'مساءً',\n          isVerified: true\n        }\n      });\n    }\n    \n    students.push(student);\n  }\n  console.log('✅ تم إنشاء 3 حسابات طلاب (كلمة المرور للجميع: student123)\\n');\n\n  const words = [\n    { en: 'book', ar: 'كتاب', example: 'I read a book every day.' },\n    { en: 'teacher', ar: 'معلم', example: 'My teacher is very kind.' },\n    { en: 'student', ar: 'طالب', example: 'She is a good student.' },\n    { en: 'learn', ar: 'يتعلم', example: 'I want to learn English.' },\n    { en: 'speak', ar: 'يتحدث', example: 'Can you speak Arabic?' },\n    { en: 'beautiful', ar: 'جميل', example: 'What a beautiful day!' },\n    { en: 'important', ar: 'مهم', example: 'This is very important.' },\n    { en: 'difficult', ar: 'صعب', example: 'English is not difficult.' }\n  ];\n\n  await prisma.word.deleteMany({\n    where: {\n      studentId: { in: students.map(s => s.id) }\n    }\n  });\n\n  for (const student of students) {\n    for (const word of words) {\n      await prisma.word.create({\n        data: {\n          id: uuidv4(),\n          studentId: student.id,\n          englishWord: word.en,\n          arabicMeaning: word.ar,\n          exampleSentence: word.example,\n          known: Math.random() > 0.5\n        }\n      });\n    }\n  }\n  console.log('✅ تم إضافة كلمات تجريبية للطلاب\\n');\n\n  console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');\n  console.log('📋 ملخص الحسابات:');\n  console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');\n  console.log('👨‍💼 المدير: admin@youspeak.com / admin123');\n  console.log('👨‍🏫 المعلم: teacher@youspeak.com / teacher123');\n  console.log('👨‍🎓 الطلاب:');\n  console.log('  - student1@test.com / student123');\n  console.log('  - student2@test.com / student123');\n  console.log('  - student3@test.com / student123');\n  console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\\n');\n}\n\nmain()\n  .catch((e) => {\n    console.error('❌ خطأ:', e);\n    process.exit(1);\n  })\n  .finally(async () => {\n    await prisma.$disconnect();\n  });\n","size_bytes":6017},"app/dashboard/student/page.tsx":{"content":"import { redirect } from 'next/navigation'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport StudentDashboardClient from './StudentDashboardClient'\n\nexport default async function StudentDashboardPage() {\n  const session = await getServerSession(authOptions)\n\n  if (!session) {\n    redirect('/auth/login')\n  }\n\n  if (session.user.role !== 'STUDENT') {\n    redirect('/dashboard')\n  }\n\n  return (\n    <StudentDashboardClient\n      user={{\n        name: session.user.name,\n        email: session.user.email,\n        isActive: session.user.isActive,\n      }}\n    />\n  )\n}\n","size_bytes":610},"check_admin.js":{"content":"const { PrismaClient } = require('@prisma/client');\nconst prisma = new PrismaClient();\n\nasync function checkAdmin() {\n  try {\n    const admins = await prisma.user.findMany({\n      where: {\n        role: 'ADMIN'\n      },\n      select: {\n        id: true,\n        email: true,\n        name: true,\n        phone: true,\n        role: true,\n        isActive: true,\n        createdAt: true\n      }\n    });\n    \n    console.log('بيانات المدير:');\n    console.log(JSON.stringify(admins, null, 2));\n    \n    if (admins.length === 0) {\n      console.log('\\nلا يوجد مدير في قاعدة البيانات. جارٍ البحث عن جميع الأدوار...');\n      const allUsers = await prisma.user.findMany({\n        select: {\n          email: true,\n          role: true\n        },\n        take: 10\n      });\n      console.log('المستخدمون الموجودون:');\n      console.log(JSON.stringify(allUsers, null, 2));\n    }\n  } catch (error) {\n    console.error('خطأ في الاتصال بقاعدة البيانات:', error.message);\n  } finally {\n    await prisma.$disconnect();\n  }\n}\n\ncheckAdmin();\n","size_bytes":1128},"app/dashboard/admin/components/HomeTab.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { Users, UserCheck, Calendar, TrendingUp, Clock, AlertCircle, CreditCard, Activity } from 'lucide-react'\nimport Card from '@/components/ui/Card'\nimport LoadingSpinner from '@/components/ui/LoadingSpinner'\nimport Badge from '@/components/ui/Badge'\n\ninterface Stats {\n  totalUsers: number\n  totalStudents: number\n  activeStudents: number\n  totalTeachers: number\n  totalSessions: number\n  sessionsThisWeek: number\n  pendingSubscriptions: number\n  totalRevenue: number\n}\n\nexport default function HomeTab() {\n  const [stats, setStats] = useState<Stats | null>(null)\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    fetchStats()\n  }, [])\n\n  async function fetchStats() {\n    try {\n      const response = await fetch('/api/admin/stats')\n      if (response.ok) {\n        const data = await response.json()\n        setStats(data)\n      }\n    } catch (error) {\n      console.error('Error fetching stats:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <LoadingSpinner size=\"lg\" />\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <h2 className=\"text-3xl font-bold text-[#004E89]\">\n        Dashboard / لوحة التحكم\n      </h2>\n\n      <div className=\"grid md:grid-cols-4 gap-4\">\n        <Card variant=\"elevated\">\n          <div className=\"text-center\">\n            <div className=\"w-12 h-12 bg-blue-100 rounded-full mx-auto mb-3 flex items-center justify-center\">\n              <Users className=\"h-6 w-6 text-[#004E89]\" />\n            </div>\n            <h3 className=\"font-semibold text-gray-900 mb-1\">Total Users</h3>\n            <p className=\"text-2xl font-bold text-[#004E89]\">{stats?.totalUsers || 0}</p>\n            <p className=\"text-sm text-gray-600\">إجمالي المستخدمين</p>\n          </div>\n        </Card>\n\n        <Card variant=\"elevated\">\n          <div className=\"text-center\">\n            <div className=\"w-12 h-12 bg-green-100 rounded-full mx-auto mb-3 flex items-center justify-center\">\n              <UserCheck className=\"h-6 w-6 text-green-600\" />\n            </div>\n            <h3 className=\"font-semibold text-gray-900 mb-1\">Active Students</h3>\n            <p className=\"text-2xl font-bold text-[#004E89]\">{stats?.activeStudents || 0}</p>\n            <p className=\"text-sm text-gray-600\">\n              of {stats?.totalStudents || 0} / من {stats?.totalStudents || 0}\n            </p>\n          </div>\n        </Card>\n\n        <Card variant=\"elevated\">\n          <div className=\"text-center\">\n            <div className=\"w-12 h-12 bg-purple-100 rounded-full mx-auto mb-3 flex items-center justify-center\">\n              <Calendar className=\"h-6 w-6 text-purple-600\" />\n            </div>\n            <h3 className=\"font-semibold text-gray-900 mb-1\">Sessions This Week</h3>\n            <p className=\"text-2xl font-bold text-[#004E89]\">{stats?.sessionsThisWeek || 0}</p>\n            <p className=\"text-sm text-gray-600\">حصص هذا الأسبوع</p>\n          </div>\n        </Card>\n\n        <Card variant=\"elevated\">\n          <div className=\"text-center\">\n            <div className=\"w-12 h-12 bg-orange-100 rounded-full mx-auto mb-3 flex items-center justify-center\">\n              <TrendingUp className=\"h-6 w-6 text-orange-600\" />\n            </div>\n            <h3 className=\"font-semibold text-gray-900 mb-1\">Total Revenue</h3>\n            <p className=\"text-2xl font-bold text-[#004E89]\">{stats?.totalRevenue || 0} SAR</p>\n            <p className=\"text-sm text-gray-600\">الإيرادات</p>\n          </div>\n        </Card>\n      </div>\n\n      {stats && stats.pendingSubscriptions > 0 && (\n        <Card variant=\"elevated\" className=\"bg-orange-50 border-orange-200\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center\">\n              <Clock className=\"h-6 w-6 text-orange-600\" />\n            </div>\n            <div>\n              <h3 className=\"font-semibold text-gray-900\">Pending Subscription Approvals</h3>\n              <p className=\"text-sm text-gray-700\">\n                {stats.pendingSubscriptions} subscription(s) waiting for payment verification\n              </p>\n            </div>\n          </div>\n        </Card>\n      )}\n\n      <div className=\"grid md:grid-cols-2 gap-6\">\n        <Card variant=\"elevated\">\n          <h3 className=\"text-xl font-bold text-[#004E89] mb-4\">\n            Platform Statistics / إحصائيات المنصة\n          </h3>\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n              <span className=\"text-gray-700\">Total Teachers / المدرسين</span>\n              <Badge variant=\"primary\">{stats?.totalTeachers || 0}</Badge>\n            </div>\n            <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n              <span className=\"text-gray-700\">Total Sessions / الحصص</span>\n              <Badge variant=\"info\">{stats?.totalSessions || 0}</Badge>\n            </div>\n            <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n              <span className=\"text-gray-700\">Pending Subscriptions / اشتراكات معلقة</span>\n              <Badge variant=\"warning\">{stats?.pendingSubscriptions || 0}</Badge>\n            </div>\n          </div>\n        </Card>\n\n        <Card variant=\"elevated\" className=\"bg-gradient-to-r from-purple-50 to-pink-50\">\n          <h3 className=\"text-xl font-bold text-[#004E89] mb-4\">\n            Quick Actions / إجراءات سريعة\n          </h3>\n          <div className=\"grid gap-3\">\n            <div className=\"bg-white rounded-lg p-3 flex items-start gap-2 shadow-sm\">\n              <Users className=\"h-5 w-5 text-[#004E89] flex-shrink-0 mt-0.5\" />\n              <div>\n                <p className=\"font-medium text-gray-900\">Manage Users</p>\n                <p className=\"text-sm text-gray-600\">Activate/deactivate accounts in Users tab / إدارة المستخدمين</p>\n              </div>\n            </div>\n            <div className=\"bg-white rounded-lg p-3 flex items-start gap-2 shadow-sm\">\n              <CreditCard className=\"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5\" />\n              <div>\n                <p className=\"font-medium text-gray-900\">Approve Subscriptions</p>\n                <p className=\"text-sm text-gray-600\">Review payments in Subscriptions tab / مراجعة الدفعات</p>\n              </div>\n            </div>\n            <div className=\"bg-white rounded-lg p-3 flex items-start gap-2 shadow-sm\">\n              <Activity className=\"h-5 w-5 text-purple-600 flex-shrink-0 mt-0.5\" />\n              <div>\n                <p className=\"font-medium text-gray-900\">Monitor System</p>\n                <p className=\"text-sm text-gray-600\">Track activity logs in System tab / مراقبة نشاط النظام</p>\n              </div>\n            </div>\n          </div>\n        </Card>\n      </div>\n    </div>\n  )\n}\n","size_bytes":7172},"lib/translations.ts":{"content":"export const translations = {\n  ar: {\n    // Navigation\n    home: 'الرئيسية',\n    about: 'من نحن',\n    packages: 'الباقات',\n    contact: 'اتصل بنا',\n    login: 'تسجيل الدخول',\n    logout: 'تسجيل الخروج',\n    dashboard: 'لوحة التحكم',\n    \n    // Home Page\n    heroTitle: 'تعلم الإنجليزية مع مستر يوسف',\n    heroSubtitle: 'منصة تعليم اللغة الإنجليزية عبر الإنترنت مع دروس حية تفاعلية',\n    joinUs: 'انضم إلينا',\n    contactWhatsApp: 'واتساب',\n    \n    // Features\n    liveClasses: 'حصص مباشرة',\n    levelAssessment: 'تقييم المستوى',\n    smartLearning: 'تعلم ذكي',\n    \n    // Packages\n    ourPackages: 'باقاتنا',\n    viewAllPackages: 'عرض جميع الباقات',\n    singleLevel: 'مستوى واحد',\n    monthly: 'شهري',\n    quarterly: 'ربع سنوي',\n    premium: 'بريميوم',\n    sar: 'ريال',\n    lessons: 'حصة',\n    months: 'أشهر',\n    bestValue: 'أفضل قيمة',\n    \n    // Auth\n    welcomeBack: 'مرحباً بعودتك',\n    signIn: 'قم بتسجيل الدخول',\n    email: 'البريد الإلكتروني',\n    password: 'كلمة المرور',\n    createAccount: 'أنشئ حسابك لبدء التعلم',\n    name: 'الاسم',\n    phone: 'رقم الهاتف',\n    register: 'تسجيل',\n    \n    // Dashboard\n    myWords: 'كلماتي',\n    mySessions: 'حصصي',\n    mySubscriptions: 'اشتراكاتي',\n    profile: 'الملف الشخصي',\n    students: 'الطلاب',\n    teachers: 'المعلمين',\n    system: 'النظام',\n    \n    // Words\n    addWord: 'إضافة كلمة',\n    englishWord: 'الكلمة بالإنجليزية',\n    arabicMeaning: 'المعنى بالعربية',\n    exampleSentence: 'جملة مثال',\n    known: 'محفوظة',\n    unknown: 'غير محفوظة',\n    totalWords: 'إجمالي الكلمات',\n    save: 'حفظ',\n    cancel: 'إلغاء',\n    delete: 'حذف',\n    export: 'تصدير',\n    exportToExcel: 'تصدير إلى Excel',\n    \n    // Common\n    loading: 'جاري التحميل...',\n    error: 'خطأ',\n    success: 'نجاح',\n    confirm: 'تأكيد',\n    active: 'نشط',\n    inactive: 'غير نشط',\n    activate: 'تفعيل',\n    deactivate: 'إلغاء التفعيل',\n    back: 'رجوع',\n    settings: 'الإعدادات',\n    language: 'ar',\n  },\n  en: {\n    // Navigation\n    home: 'Home',\n    about: 'About',\n    packages: 'Packages',\n    contact: 'Contact',\n    login: 'Login',\n    logout: 'Logout',\n    dashboard: 'Dashboard',\n    \n    // Home Page\n    heroTitle: 'Learn English with Mister Youssef',\n    heroSubtitle: 'Professional online English learning platform with live interactive classes',\n    joinUs: 'Join Us',\n    contactWhatsApp: 'WhatsApp',\n    \n    // Features\n    liveClasses: 'Live Classes',\n    levelAssessment: 'Level Assessment',\n    smartLearning: 'Smart Learning',\n    \n    // Packages\n    ourPackages: 'Our Packages',\n    viewAllPackages: 'View All Packages',\n    singleLevel: 'Single Level',\n    monthly: 'Monthly',\n    quarterly: 'Quarterly',\n    premium: 'Premium',\n    sar: 'SAR',\n    lessons: 'lessons',\n    months: 'months',\n    bestValue: 'Best Value',\n    \n    // Auth\n    welcomeBack: 'Welcome Back',\n    signIn: 'Sign in to your account',\n    email: 'Email',\n    password: 'Password',\n    createAccount: 'Create your account to start learning',\n    name: 'Name',\n    phone: 'Phone',\n    register: 'Register',\n    \n    // Dashboard\n    myWords: 'My Words',\n    mySessions: 'My Sessions',\n    mySubscriptions: 'My Subscriptions',\n    profile: 'Profile',\n    students: 'Students',\n    teachers: 'Teachers',\n    system: 'System',\n    \n    // Words\n    addWord: 'Add Word',\n    englishWord: 'English Word',\n    arabicMeaning: 'Arabic Meaning',\n    exampleSentence: 'Example Sentence',\n    known: 'Known',\n    unknown: 'Unknown',\n    totalWords: 'Total Words',\n    save: 'Save',\n    cancel: 'Cancel',\n    delete: 'Delete',\n    export: 'Export',\n    exportToExcel: 'Export to Excel',\n    \n    // Common\n    loading: 'Loading...',\n    error: 'Error',\n    success: 'Success',\n    confirm: 'Confirm',\n    active: 'Active',\n    inactive: 'Inactive',\n    activate: 'Activate',\n    deactivate: 'Deactivate',\n    back: 'Back',\n    settings: 'Settings',\n    language: 'en',\n  }\n}\n\nexport type TranslationKey = keyof typeof translations.ar\n","size_bytes":4496},"scripts/reset-password.ts":{"content":"import { prisma } from '../lib/prisma'\nimport bcrypt from 'bcryptjs'\n\nasync function resetPasswords() {\n  try {\n    const password = 'admin123'\n    const hashedPassword = await bcrypt.hash(password, 10)\n    \n    await prisma.user.update({\n      where: { email: 'admin@youspeak.com' },\n      data: { passwordHash: hashedPassword },\n    })\n    console.log('✅ Admin password updated: admin123')\n    \n    await prisma.user.update({\n      where: { email: 'teacher@youspeak.com' },\n      data: { passwordHash: hashedPassword },\n    })\n    console.log('✅ Teacher password updated: admin123')\n    \n    await prisma.user.update({\n      where: { email: 'student2@test.com' },\n      data: { passwordHash: hashedPassword },\n    })\n    console.log('✅ Student password updated: admin123')\n    \n    console.log('\\n=== Login Credentials ===')\n    console.log('Admin: admin@youspeak.com / admin123')\n    console.log('Teacher: teacher@youspeak.com / admin123')\n    console.log('Student: student2@test.com / admin123')\n  } catch (error) {\n    console.error('Error:', error)\n  } finally {\n    await prisma.$disconnect()\n  }\n}\n\nresetPasswords()\n","size_bytes":1130},"middleware.ts":{"content":"import { withAuth } from 'next-auth/middleware'\n\nexport default withAuth({\n  pages: {\n    signIn: '/auth/login',\n  },\n})\n\nexport const config = {\n  matcher: [\n    '/dashboard/:path*',\n  ],\n}\n","size_bytes":191},"components/layout/Container.tsx":{"content":"import React from 'react';\nimport { cva, type VariantProps } from 'class-variance-authority';\nimport { cn } from '@/lib/utils';\n\nconst containerVariants = cva('w-full mx-auto', {\n  variants: {\n    size: {\n      sm: 'max-w-screen-sm',\n      md: 'max-w-screen-md',\n      lg: 'max-w-screen-lg',\n      xl: 'max-w-screen-xl',\n      '2xl': 'max-w-screen-2xl',\n      full: 'max-w-full',\n    },\n    padding: {\n      none: 'px-0',\n      sm: 'px-4 sm:px-6',\n      md: 'px-4 sm:px-6 lg:px-8',\n      lg: 'px-6 sm:px-8 lg:px-12',\n    },\n  },\n  defaultVariants: {\n    size: 'xl',\n    padding: 'md',\n  },\n});\n\nexport interface ContainerProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof containerVariants> {}\n\nconst Container = React.forwardRef<HTMLDivElement, ContainerProps>(\n  ({ className, size, padding, ...props }, ref) => {\n    return (\n      <div\n        ref={ref}\n        className={cn(containerVariants({ size, padding, className }))}\n        {...props}\n      />\n    );\n  }\n);\n\nContainer.displayName = 'Container';\n\nexport default Container;\n","size_bytes":1064},"attached_assets/use-toast_1763165145844.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"scripts/check-tables.js":{"content":"const { PrismaClient } = require('@prisma/client');\n\nconst prisma = new PrismaClient();\n\nasync function checkTables() {\n  try {\n    // First check what tables exist in the schema\n    const tables = await prisma.$queryRaw`\n      SELECT table_name \n      FROM information_schema.tables \n      WHERE table_schema = 'youspeak_exercisein'\n      ORDER BY table_name\n    `;\n    \n    console.log('Tables in youspeak_exercisein schema:');\n    console.log(JSON.stringify(tables, null, 2));\n    \n    // Now try to get user data\n    console.log('\\nTrying to fetch a user...');\n    const user = await prisma.user.findFirst({\n      select: {\n        id: true,\n        email: true,\n        name: true,\n        role: true,\n        isActive: true,\n        passwordHash: true\n      }\n    });\n    \n    if (user) {\n      console.log('\\n✅ User found:');\n      console.log('   Email:', user.email);\n      console.log('   Name:', user.name);\n      console.log('   Role:', user.role);\n      console.log('   Active:', user.isActive);\n      console.log('   Has passwordHash?:', !!user.passwordHash);\n      console.log('   passwordHash value:', user.passwordHash ? user.passwordHash.substring(0, 20) + '...' : 'NULL');\n    } else {\n      console.log('\\n❌ No users found');\n    }\n    \n  } catch (error) {\n    console.error('Error:', error.message);\n    console.error('Stack:', error.stack);\n  } finally {\n    await prisma.$disconnect();\n  }\n}\n\ncheckTables();\n","size_bytes":1435},"app/api/teacher/assignments/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'TEACHER') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const teacherProfile = await prisma.teacherProfile.findUnique({\n      where: { userId: session.user.id }\n    })\n\n    if (!teacherProfile) {\n      return NextResponse.json({ error: 'Teacher profile not found' }, { status: 404 })\n    }\n\n    const assignments = await prisma.assignment.findMany({\n      where: {\n        Session: {\n          teacherId: teacherProfile.id\n        }\n      },\n      include: {\n        Session: true,\n        Submission: {\n          include: {\n            User: true\n          }\n        }\n      },\n      orderBy: {\n        createdAt: 'desc'\n      }\n    })\n\n    return NextResponse.json(assignments)\n  } catch (error) {\n    console.error('Error fetching assignments:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'TEACHER') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const teacherProfile = await prisma.teacherProfile.findUnique({\n      where: { userId: session.user.id }\n    })\n\n    if (!teacherProfile) {\n      return NextResponse.json({ error: 'Teacher profile not found' }, { status: 404 })\n    }\n\n    const { title, description, sessionId, dueDate } = await request.json()\n\n    if (!title) {\n      return NextResponse.json({ error: 'Title is required' }, { status: 400 })\n    }\n\n    if (sessionId) {\n      const session = await prisma.session.findUnique({\n        where: { id: sessionId }\n      })\n\n      if (!session || session.teacherId !== teacherProfile.id) {\n        return NextResponse.json({ error: 'Invalid session' }, { status: 400 })\n      }\n    }\n\n    const assignment = await prisma.assignment.create({\n      data: {\n        id: `assignment_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        title,\n        description: description || null,\n        sessionId: sessionId || null,\n        dueDate: dueDate ? new Date(dueDate) : null\n      }\n    })\n\n    return NextResponse.json(assignment)\n  } catch (error) {\n    console.error('Error creating assignment:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":2700},"app/packages/page.tsx":{"content":"import Link from 'next/link'\nimport { Check, ArrowLeft } from 'lucide-react'\nimport { prisma } from '@/lib/prisma'\nimport FloatingContactButtons from '@/components/FloatingContactButtons'\nimport AppHeader from '@/components/layout/AppHeader'\n\nexport const dynamic = 'force-dynamic'\n\nexport default async function PackagesPage() {\n  const packages = await prisma.package.findMany({\n    where: { isActive: true },\n    orderBy: { price: 'asc' }\n  })\n\n  return (\n    <div className=\"min-h-screen bg-[#F5F1E8]\">\n      <AppHeader variant=\"marketing\">\n        <Link\n          href=\"/\"\n          className=\"px-4 py-2 sm:px-6 sm:py-2 rounded-lg border-2 border-[#004E89] text-[#004E89] hover:bg-[#004E89] hover:text-white transition-colors flex items-center gap-2 text-sm sm:text-base\"\n        >\n          <ArrowLeft className=\"h-4 w-4\" />\n          <span className=\"hidden sm:inline\">Back to Home / العودة للرئيسية</span>\n          <span className=\"sm:hidden\">Back / عودة</span>\n        </Link>\n        <Link\n          href=\"/auth/login\"\n          className=\"px-4 py-2 sm:px-6 sm:py-2 rounded-lg bg-[#004E89] text-white hover:bg-[#003A6B] transition-colors text-sm sm:text-base\"\n        >\n          Login / تسجيل الدخول\n        </Link>\n      </AppHeader>\n\n      <main className=\"container mx-auto px-3 sm:px-4 md:px-6 py-6 sm:py-8 md:py-12\">\n        <div className=\"text-center mb-8 sm:mb-10 md:mb-12\">\n          <h2 className=\"text-2xl sm:text-3xl md:text-4xl font-bold text-black mb-3 sm:mb-4\">\n            Our Packages / باقاتنا\n          </h2>\n          <p className=\"text-base sm:text-lg md:text-xl text-black max-w-3xl mx-auto px-4\">\n            Choose the perfect learning package for your English journey\n          </p>\n          <p className=\"text-base sm:text-lg md:text-xl text-black max-w-3xl mx-auto px-4\" dir=\"rtl\">\n            اختر الباقة المثالية لرحلتك في تعلم اللغة الإنجليزية\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-5 md:gap-6 max-w-7xl mx-auto mb-8 sm:mb-10 md:mb-12\">\n          {packages.map((pkg, index) => {\n            const isRecommended = pkg.title === 'Monthly' || pkg.titleAr === 'شهري'\n            const isPopular = pkg.lessonsCount === 12\n\n            return (\n              <div\n                key={pkg.id}\n                className={`relative bg-white rounded-2xl shadow-xl overflow-hidden transform transition-all hover:scale-105 ${\n                  isRecommended ? 'ring-4 ring-[#004E89]' : ''\n                }`}\n              >\n                {isRecommended && (\n                  <div className=\"absolute top-0 right-0 bg-[#004E89] text-white px-3 sm:px-4 py-1 rounded-bl-lg font-semibold text-xs sm:text-sm\">\n                    Recommended / موصى به\n                  </div>\n                )}\n\n                <div className={`p-4 sm:p-6 md:p-8 ${isRecommended ? 'bg-gradient-to-br from-[#004E89] to-[#1a6ba8]' : 'bg-[#F5F1E8]'}`}>\n                  <h3 className={`text-xl sm:text-2xl font-bold mb-2 ${isRecommended ? 'text-white' : 'text-black'}`}>\n                    {pkg.title}\n                  </h3>\n                  <p className={`text-base sm:text-lg ${isRecommended ? 'text-white/90' : 'text-black'}`}>\n                    {pkg.titleAr}\n                  </p>\n                </div>\n\n                <div className=\"p-4 sm:p-6 md:p-8\">\n                  <div className=\"text-center mb-4 sm:mb-6\">\n                    <p className=\"text-3xl sm:text-4xl md:text-5xl font-bold text-black mb-2\">\n                      {pkg.price}\n                      <span className=\"text-xl sm:text-2xl text-black\"> SAR</span>\n                    </p>\n                    <p className=\"text-sm sm:text-base text-black\">\n                      {Math.ceil(pkg.durationDays / 30)} month(s) / شهر\n                    </p>\n                  </div>\n\n                  <div className=\"space-y-2 sm:space-y-3 mb-6 sm:mb-8\">\n                    <div className=\"flex items-start gap-2\">\n                      <Check className=\"h-4 w-4 sm:h-5 sm:w-5 text-[#004E89] flex-shrink-0 mt-0.5\" />\n                      <p className=\"text-sm sm:text-base text-black\">\n                        {pkg.lessonsCount} live sessions / حصة مباشرة\n                      </p>\n                    </div>\n                    <div className=\"flex items-start gap-2\">\n                      <Check className=\"h-4 w-4 sm:h-5 sm:w-5 text-[#004E89] flex-shrink-0 mt-0.5\" />\n                      <p className=\"text-sm sm:text-base text-black\">\n                        60-minute interactive classes / حصص تفاعلية 60 دقيقة\n                      </p>\n                    </div>\n                    <div className=\"flex items-start gap-2\">\n                      <Check className=\"h-4 w-4 sm:h-5 sm:w-5 text-[#004E89] flex-shrink-0 mt-0.5\" />\n                      <p className=\"text-sm sm:text-base text-black\">\n                        Homework & corrections / واجبات وتصحيح\n                      </p>\n                    </div>\n                    <div className=\"flex items-start gap-2\">\n                      <Check className=\"h-4 w-4 sm:h-5 sm:w-5 text-[#004E89] flex-shrink-0 mt-0.5\" />\n                      <p className=\"text-sm sm:text-base text-black\">\n                        Vocabulary tracking / تتبع الكلمات\n                      </p>\n                    </div>\n                    {pkg.description && (\n                      <div className=\"flex items-start gap-2\">\n                        <Check className=\"h-5 w-5 text-[#004E89] flex-shrink-0 mt-0.5\" />\n                        <p className=\"text-black\">{pkg.description}</p>\n                      </div>\n                    )}\n                    {pkg.descriptionAr && (\n                      <div className=\"flex items-start gap-2\">\n                        <Check className=\"h-5 w-5 text-[#004E89] flex-shrink-0 mt-0.5\" />\n                        <p className=\"text-black\" dir=\"rtl\">{pkg.descriptionAr}</p>\n                      </div>\n                    )}\n                  </div>\n\n                  <Link\n                    href=\"/auth/register\"\n                    className={`block w-full text-center px-4 sm:px-6 py-2.5 sm:py-3 rounded-lg font-semibold transition-colors text-sm sm:text-base ${\n                      isRecommended\n                        ? 'bg-[#004E89] text-white hover:bg-[#003A6A]'\n                        : 'bg-gray-200 text-[#004E89] hover:bg-gray-300'\n                    }`}\n                  >\n                    Get Started / ابدأ الآن\n                  </Link>\n                </div>\n              </div>\n            )\n          })}\n        </div>\n\n        <div className=\"bg-[#F5F1E8] rounded-2xl shadow-xl p-4 sm:p-6 md:p-8 max-w-4xl mx-auto border-2 border-[#d4c9b8]\">\n          <h3 className=\"text-xl sm:text-2xl font-bold text-black mb-4 sm:mb-6 text-center\">\n            How It Works / كيف يعمل\n          </h3>\n          <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6\">\n            <div className=\"text-center\">\n              <div className=\"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 bg-[#004E89] text-white rounded-full flex items-center justify-center text-xl sm:text-2xl font-bold mx-auto mb-3 sm:mb-4\">\n                1\n              </div>\n              <h4 className=\"font-semibold text-black mb-2 text-sm sm:text-base\">Register / سجل</h4>\n              <p className=\"text-xs sm:text-sm text-black\">\n                Create your account and select a package\n              </p>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 bg-[#004E89] text-white rounded-full flex items-center justify-center text-xl sm:text-2xl font-bold mx-auto mb-3 sm:mb-4\">\n                2\n              </div>\n              <h4 className=\"font-semibold text-black mb-2 text-sm sm:text-base\">Pay / ادفع</h4>\n              <p className=\"text-xs sm:text-sm text-black\">\n                Contact us via WhatsApp for payment details\n              </p>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 bg-[#004E89] text-white rounded-full flex items-center justify-center text-xl sm:text-2xl font-bold mx-auto mb-3 sm:mb-4\">\n                3\n              </div>\n              <h4 className=\"font-semibold text-black mb-2 text-sm sm:text-base\">Learn / تعلم</h4>\n              <p className=\"text-xs sm:text-sm text-black\">\n                Start attending live interactive sessions\n              </p>\n            </div>\n          </div>\n\n          <div className=\"mt-6 sm:mt-8 text-center\">\n            <p className=\"text-sm sm:text-base text-black mb-2 sm:mb-3 px-4\">\n              Need help choosing? Contact us on WhatsApp\n            </p>\n            <p className=\"text-sm sm:text-base text-black mb-3 sm:mb-4 px-4\" dir=\"rtl\">\n              تحتاج مساعدة في الاختيار؟ تواصل معنا عبر الواتساب\n            </p>\n            <a\n              href=\"https://wa.me/201091515594\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"inline-block px-6 sm:px-8 py-2.5 sm:py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition-colors text-sm sm:text-base\"\n            >\n              Contact WhatsApp / واتساب\n            </a>\n          </div>\n        </div>\n      </main>\n\n      <footer className=\"bg-[#F5F1E8] text-black py-6 sm:py-8 mt-8 sm:mt-12 md:mt-16 border-t-2 border-[#d4c9b8]\">\n        <div className=\"container mx-auto px-4 sm:px-6 text-center\">\n          <p className=\"mb-3 sm:mb-2 text-base sm:text-lg\">Contact Us: youspeak.help@gmail.com</p>\n          <p className=\"mb-3 sm:mb-2 text-base sm:text-lg\">WhatsApp: +201091515594</p>\n          <p className=\"text-sm sm:text-base mt-4 sm:mt-4\">Made with ❤️ by MA3K Company</p>\n        </div>\n      </footer>\n\n      <FloatingContactButtons />\n    </div>\n  )\n}","size_bytes":10129},"app/api/admin/stats/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || (session.user.role !== 'ADMIN' && session.user.role !== 'ASSISTANT')) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const oneWeekAgo = new Date()\n    oneWeekAgo.setDate(oneWeekAgo.getDate() - 7)\n\n    const [\n      totalUsers,\n      totalStudents,\n      activeStudents,\n      totalTeachers,\n      totalSessions,\n      sessionsThisWeek,\n      pendingSubscriptions,\n      paidSubscriptions\n    ] = await Promise.all([\n      prisma.user.count(),\n      prisma.user.count({ where: { role: 'STUDENT' } }),\n      prisma.user.count({ where: { role: 'STUDENT', isActive: true } }),\n      prisma.user.count({ where: { role: 'TEACHER' } }),\n      prisma.session.count(),\n      prisma.session.count({\n        where: {\n          startTime: { gte: oneWeekAgo }\n        }\n      }),\n      prisma.subscription.count({ where: { paid: false } }),\n      prisma.subscription.findMany({\n        where: { paid: true },\n        include: { package: true }\n      })\n    ])\n\n    const totalRevenue = paidSubscriptions.reduce((sum, sub) => sum + sub.package.price, 0)\n\n    return NextResponse.json({\n      totalUsers,\n      totalStudents,\n      activeStudents,\n      totalTeachers,\n      totalSessions,\n      sessionsThisWeek,\n      pendingSubscriptions,\n      totalRevenue\n    })\n  } catch (error) {\n    console.error('Error fetching admin stats:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":1774},"app/api/chat/conversations/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\nexport async function GET(req: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const userId = session.user.id\n\n    const sentMessages = await prisma.chat.findMany({\n      where: { fromUserId: userId },\n      select: { toUserId: true },\n      distinct: ['toUserId']\n    })\n\n    const receivedMessages = await prisma.chat.findMany({\n      where: { toUserId: userId },\n      select: { fromUserId: true },\n      distinct: ['fromUserId']\n    })\n\n    const userIds = new Set([\n      ...sentMessages.map(m => m.toUserId),\n      ...receivedMessages.map(m => m.fromUserId)\n    ])\n\n    const conversations = await Promise.all(\n      Array.from(userIds).map(async (otherUserId) => {\n        const lastMessage = await prisma.chat.findFirst({\n          where: {\n            OR: [\n              { fromUserId: userId, toUserId: otherUserId },\n              { fromUserId: otherUserId, toUserId: userId }\n            ]\n          },\n          orderBy: { createdAt: 'desc' },\n          include: {\n            User_Chat_fromUserIdToUser: {\n              select: { id: true, name: true, profilePhoto: true }\n            },\n            User_Chat_toUserIdToUser: {\n              select: { id: true, name: true, profilePhoto: true }\n            }\n          }\n        })\n\n        const unreadCount = await prisma.chat.count({\n          where: {\n            fromUserId: otherUserId,\n            toUserId: userId,\n            isSaved: false\n          }\n        })\n\n        const otherUser = await prisma.user.findUnique({\n          where: { id: otherUserId },\n          select: {\n            id: true,\n            name: true,\n            email: true,\n            role: true,\n            profilePhoto: true\n          }\n        })\n\n        return {\n          user: otherUser,\n          lastMessage,\n          unreadCount\n        }\n      })\n    )\n\n    conversations.sort((a, b) => {\n      const aTime = a.lastMessage?.createdAt || new Date(0)\n      const bTime = b.lastMessage?.createdAt || new Date(0)\n      return bTime.getTime() - aTime.getTime()\n    })\n\n    return NextResponse.json({ conversations })\n  } catch (error) {\n    console.error('Error fetching conversations:', error)\n    return NextResponse.json({ error: 'Failed to fetch conversations' }, { status: 500 })\n  }\n}\n","size_bytes":2578},"app/api/words/discover/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\nconst WORD_LEVELS = {\n  beginner: [\n    { word: 'hello', arabic: 'مرحبا', example: 'Hello, how are you?', imageUrl: 'https://images.unsplash.com/photo-1582134901-e89318a4df25?w=400' },\n    { word: 'book', arabic: 'كتاب', example: 'I read a book every day.', imageUrl: 'https://images.unsplash.com/photo-1495446815901-a7297e633e8d?w=400' },\n    { word: 'water', arabic: 'ماء', example: 'I drink water.', imageUrl: 'https://images.unsplash.com/photo-1548839140-29a749e1cf4d?w=400' },\n    { word: 'friend', arabic: 'صديق', example: 'She is my best friend.', imageUrl: 'https://images.unsplash.com/photo-1529156069898-49953e39b3ac?w=400' },\n    { word: 'happy', arabic: 'سعيد', example: 'I am very happy today.', imageUrl: 'https://images.unsplash.com/photo-1469571486292-0ba58a3f068b?w=400' },\n    { word: 'food', arabic: 'طعام', example: 'This food is delicious.', imageUrl: 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=400' },\n    { word: 'school', arabic: 'مدرسة', example: 'I go to school every day.', imageUrl: 'https://images.unsplash.com/photo-1580582932707-520aed937b7b?w=400' },\n    { word: 'family', arabic: 'عائلة', example: 'My family is very important to me.', imageUrl: 'https://images.unsplash.com/photo-1511895426328-dc8714191300?w=400' },\n    { word: 'house', arabic: 'بيت', example: 'I live in a big house.', imageUrl: 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=400' },\n    { word: 'beautiful', arabic: 'جميل', example: 'The sunset is beautiful.', imageUrl: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400' },\n    { word: 'learn', arabic: 'يتعلم', example: 'I learn English every day.', imageUrl: 'https://images.unsplash.com/photo-1503676260728-1c00da094a0b?w=400' },\n    { word: 'work', arabic: 'عمل', example: 'I work from home.', imageUrl: 'https://images.unsplash.com/photo-1497215728101-856f4ea42174?w=400' },\n    { word: 'time', arabic: 'وقت', example: 'What time is it?', imageUrl: 'https://images.unsplash.com/photo-1501139083538-0139583c060f?w=400' },\n    { word: 'day', arabic: 'يوم', example: 'Have a nice day!', imageUrl: 'https://images.unsplash.com/photo-1470252649378-9c29740c9fa8?w=400' },\n    { word: 'night', arabic: 'ليل', example: 'Good night, sleep well.', imageUrl: 'https://images.unsplash.com/photo-1493514789931-586cb221d7a7?w=400' }\n  ],\n  intermediate: [\n    { word: 'accomplish', arabic: 'ينجز', example: 'I want to accomplish my goals.', imageUrl: 'https://images.unsplash.com/photo-1484480974693-6ca0a78fb36b?w=400' },\n    { word: 'consider', arabic: 'يعتبر', example: 'Please consider my proposal.', imageUrl: 'https://images.unsplash.com/photo-1516534775068-ba3e7458af70?w=400' },\n    { word: 'develop', arabic: 'يطور', example: 'We need to develop new skills.', imageUrl: 'https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=400' },\n    { word: 'enthusiastic', arabic: 'متحمس', example: 'She was enthusiastic about the project.', imageUrl: 'https://images.unsplash.com/photo-1508672019048-805c876b67e2?w=400' },\n    { word: 'significant', arabic: 'مهم/كبير', example: 'This is a significant achievement.', imageUrl: 'https://images.unsplash.com/photo-1552664730-d307ca884978?w=400' },\n    { word: 'appreciate', arabic: 'يقدر', example: 'I appreciate your help.', imageUrl: 'https://images.unsplash.com/photo-1533461502717-83546f485d24?w=400' },\n    { word: 'challenge', arabic: 'تحدي', example: 'This is a difficult challenge.', imageUrl: 'https://images.unsplash.com/photo-1571902943202-507ec2618e8f?w=400' },\n    { word: 'opportunity', arabic: 'فرصة', example: 'This is a great opportunity.', imageUrl: 'https://images.unsplash.com/photo-1523287562758-66c7fc58967f?w=400' },\n    { word: 'experience', arabic: 'خبرة', example: 'She has a lot of experience.', imageUrl: 'https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?w=400' },\n    { word: 'necessary', arabic: 'ضروري', example: 'It is necessary to practice.', imageUrl: 'https://images.unsplash.com/photo-1505576399279-565b52d4ac71?w=400' },\n    { word: 'determine', arabic: 'يقرر', example: 'We need to determine the best approach.', imageUrl: 'https://images.unsplash.com/photo-1531498681614-bc9dcbd97d24?w=400' },\n    { word: 'particularly', arabic: 'بشكل خاص', example: 'I particularly enjoy reading.', imageUrl: 'https://images.unsplash.com/photo-1497633762265-9d179a990aa6?w=400' },\n    { word: 'establish', arabic: 'يؤسس', example: 'They want to establish a new company.', imageUrl: 'https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=400' },\n    { word: 'benefit', arabic: 'فائدة', example: 'Exercise has many benefits.', imageUrl: 'https://images.unsplash.com/photo-1476480862126-209bfaa8edc8?w=400' },\n    { word: 'essential', arabic: 'أساسي', example: 'Water is essential for life.', imageUrl: 'https://images.unsplash.com/photo-1504868584819-f8e8b4b6d7e3?w=400' }\n  ],\n  advanced: [\n    { word: 'comprehensive', arabic: 'شامل', example: 'We need a comprehensive solution.', imageUrl: 'https://images.unsplash.com/photo-1504639725590-34d0984388bd?w=400' },\n    { word: 'inevitable', arabic: 'حتمي', example: 'Change is inevitable.', imageUrl: 'https://images.unsplash.com/photo-1495364141860-b0d03eccd065?w=400' },\n    { word: 'meticulous', arabic: 'دقيق جدا', example: 'He is meticulous in his work.', imageUrl: 'https://images.unsplash.com/photo-1450101499163-c8848c66ca85?w=400' },\n    { word: 'pragmatic', arabic: 'عملي', example: 'We need a pragmatic approach.', imageUrl: 'https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=400' },\n    { word: 'resilient', arabic: 'مرن/صلب', example: 'She is resilient in difficult times.', imageUrl: 'https://images.unsplash.com/photo-1520333789090-1afc82db536a?w=400' },\n    { word: 'articulate', arabic: 'فصيح', example: 'He is very articulate in his speech.', imageUrl: 'https://images.unsplash.com/photo-1475721027785-f74eccf877e2?w=400' },\n    { word: 'ambiguous', arabic: 'غامض', example: 'The statement was ambiguous.', imageUrl: 'https://images.unsplash.com/photo-1518335935020-cfd9b7fe0e8d?w=400' },\n    { word: 'diminish', arabic: 'يقلل', example: 'Time will diminish the pain.', imageUrl: 'https://images.unsplash.com/photo-1509023464722-18d996393ca8?w=400' },\n    { word: 'elaborate', arabic: 'مفصل', example: 'Please elaborate on your idea.', imageUrl: 'https://images.unsplash.com/photo-1542626991-cbc4e32524cc?w=400' },\n    { word: 'facilitate', arabic: 'يسهل', example: 'Technology facilitates communication.', imageUrl: 'https://images.unsplash.com/photo-1519389950473-47ba0277781c?w=400' },\n    { word: 'inherent', arabic: 'متأصل', example: 'There are inherent risks in any venture.', imageUrl: 'https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?w=400' },\n    { word: 'perspective', arabic: 'منظور', example: 'Consider different perspectives.', imageUrl: 'https://images.unsplash.com/photo-1551651653-c5cad6080e19?w=400' },\n    { word: 'substantial', arabic: 'كبير', example: 'We made substantial progress.', imageUrl: 'https://images.unsplash.com/photo-1581287053822-fd7bf4f4bfec?w=400' },\n    { word: 'intricate', arabic: 'معقد', example: 'The design is intricate and detailed.', imageUrl: 'https://images.unsplash.com/photo-1550063873-ab792950096b?w=400' },\n    { word: 'profound', arabic: 'عميق', example: 'He had a profound impact on society.', imageUrl: 'https://images.unsplash.com/photo-1556761175-5973dc0f32e7?w=400' }\n  ]\n}\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'STUDENT') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const { searchParams } = new URL(request.url)\n    const level = searchParams.get('level') || 'beginner'\n\n    const existingWords = await prisma.word.findMany({\n      where: { studentId: session.user.id },\n      select: { englishWord: true }\n    })\n\n    const knownWords = new Set(existingWords.map(w => w.englishWord.toLowerCase()))\n    \n    const allWords = WORD_LEVELS[level as keyof typeof WORD_LEVELS] || WORD_LEVELS.beginner\n    \n    const newWords = allWords.filter(w => !knownWords.has(w.word.toLowerCase()))\n    \n    const shuffled = newWords.sort(() => Math.random() - 0.5)\n    const selected = shuffled.slice(0, 10)\n\n    return NextResponse.json({ words: selected, level })\n  } catch (error) {\n    console.error('Error fetching discover words:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'STUDENT') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const { word, arabic, example, known, imageUrl } = await request.json()\n\n    const existingWord = await prisma.word.findFirst({\n      where: {\n        studentId: session.user.id,\n        englishWord: word\n      }\n    })\n\n    if (!existingWord) {\n      await prisma.word.create({\n        data: {\n          id: `word_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n          studentId: session.user.id,\n          englishWord: word,\n          arabicMeaning: arabic,\n          exampleSentence: example,\n          imageUrl: imageUrl || null,\n          known: known,\n          reviewCount: known ? 1 : 0\n        }\n      })\n    } else {\n      await prisma.word.update({\n        where: { id: existingWord.id },\n        data: { \n          known: known, \n          reviewCount: known ? { increment: 1 } : existingWord.reviewCount \n        }\n      })\n    }\n\n    return NextResponse.json({ success: true })\n  } catch (error) {\n    console.error('Error saving word:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":10225},"attached_assets/useTodayAssignment_1763165145844.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"./useAuth\";\n\nexport interface DailyAssignment {\n  id: string;\n  studentId: string;\n  assignmentDate: string;\n  memorization: string | null; // JSON string of memorization ranges\n  review: string | null; // JSON string of review ranges\n  mistakes: string | null;\n  notes: string | null;\n  assignedBy: string | null;\n  createdAt: string;\n}\n\nexport interface VerseRange {\n  surah: number;\n  startVerse: number;\n  endVerse: number;\n}\n\nexport function useTodayAssignment() {\n  const { user } = useAuth();\n  const studentId = (user as any)?.studentId;\n\n  const { data: assignment, isLoading, error } = useQuery<DailyAssignment>({\n    queryKey: ['/api/student/assignment/today'],\n    enabled: !!studentId && user?.role === 'student',\n    retry: false, // Don't retry if no assignment today\n  });\n\n  const parseVerseRanges = (jsonString: string | null): VerseRange[] => {\n    if (!jsonString) return [];\n    try {\n      const parsed = JSON.parse(jsonString);\n      return Array.isArray(parsed) ? parsed : [];\n    } catch {\n      return [];\n    }\n  };\n\n  const memorizationRanges = assignment ? parseVerseRanges(assignment.memorization) : [];\n  const reviewRanges = assignment ? parseVerseRanges(assignment.review) : [];\n\n  const isVerseInRange = (surahNumber: number, ayahNumber: number, ranges: VerseRange[]): boolean => {\n    return ranges.some(range => \n      range.surah === surahNumber && \n      ayahNumber >= range.startVerse && \n      ayahNumber <= range.endVerse\n    );\n  };\n\n  const isMemorization = (surahNumber: number, ayahNumber: number) => {\n    return isVerseInRange(surahNumber, ayahNumber, memorizationRanges);\n  };\n\n  const isReview = (surahNumber: number, ayahNumber: number) => {\n    return isVerseInRange(surahNumber, ayahNumber, reviewRanges);\n  };\n\n  return {\n    assignment,\n    isLoading,\n    error,\n    memorizationRanges,\n    reviewRanges,\n    isMemorization,\n    isReview,\n  };\n}\n","size_bytes":1975},"components/ui/Badge.tsx":{"content":"import React from 'react';\nimport { cva, type VariantProps } from 'class-variance-authority';\nimport { cn } from '@/lib/utils';\n\nconst badgeVariants = cva(\n  'inline-flex items-center gap-1.5 rounded-full font-medium transition-colors',\n  {\n    variants: {\n      variant: {\n        primary: 'bg-primary-100 text-primary-700 border border-primary-200',\n        accent: 'bg-accent-100 text-accent-800 border border-accent-200',\n        success: 'bg-success-100 text-success-700 border border-success-200',\n        error: 'bg-error-100 text-error-700 border border-error-200',\n        warning: 'bg-warning-100 text-warning-700 border border-warning-200',\n        info: 'bg-info-100 text-info-700 border border-info-200',\n        neutral: 'bg-neutral-100 text-neutral-700 border border-neutral-200 dark:bg-neutral-800 dark:text-neutral-300 dark:border-neutral-700',\n        solid: 'bg-primary text-white',\n      },\n      size: {\n        sm: 'px-2 py-0.5 text-xs',\n        md: 'px-2.5 py-1 text-sm',\n        lg: 'px-3 py-1.5 text-base',\n      },\n    },\n    defaultVariants: {\n      variant: 'primary',\n      size: 'md',\n    },\n  }\n);\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLSpanElement>,\n    VariantProps<typeof badgeVariants> {\n  icon?: React.ReactNode;\n}\n\nconst Badge = React.forwardRef<HTMLSpanElement, BadgeProps>(\n  ({ className, variant, size, icon, children, ...props }, ref) => {\n    return (\n      <span\n        className={cn(badgeVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      >\n        {icon && <span aria-hidden=\"true\">{icon}</span>}\n        {children}\n      </span>\n    );\n  }\n);\n\nBadge.displayName = 'Badge';\n\nexport default Badge;\n","size_bytes":1702},"app/api/admin/subscriptions/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || (session.user.role !== 'ADMIN' && session.user.role !== 'ASSISTANT')) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const subscriptions = await prisma.subscription.findMany({\n      include: {\n        user: {\n          select: {\n            name: true,\n            email: true\n          }\n        },\n        package: true\n      },\n      orderBy: {\n        createdAt: 'desc'\n      }\n    })\n\n    return NextResponse.json(subscriptions)\n  } catch (error) {\n    console.error('Error fetching subscriptions:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":957},"app/dashboard/teacher/TeacherDashboardClient.tsx":{"content":"'use client'\n\nimport { useState } from 'react'\nimport { signOut } from 'next-auth/react'\nimport { useRouter } from 'next/navigation'\nimport { \n  Home, Users, Calendar, BookOpen, MessageCircle, LogOut \n} from 'lucide-react'\nimport Button from '@/components/ui/Button'\nimport Card from '@/components/ui/Card'\nimport FloatingContactButtons from '@/components/FloatingContactButtons'\nimport ChatBox from '@/components/ChatBox'\nimport ConversationsList from '@/components/ConversationsList'\nimport HomeTab from './components/HomeTab'\nimport StudentsTab from './components/StudentsTab'\nimport SessionsTab from './components/SessionsTab'\nimport AssignmentsTab from './components/AssignmentsTab'\n\ninterface TeacherDashboardClientProps {\n  user: {\n    name: string\n    email: string\n    teacherProfileId: string\n  }\n}\n\nexport default function TeacherDashboardClient({ user }: TeacherDashboardClientProps) {\n  const router = useRouter()\n  const [activeTab, setActiveTab] = useState('home')\n  const [sidebarOpen, setSidebarOpen] = useState(false)\n\n  const handleSignOut = async () => {\n    await signOut({ redirect: false })\n    router.push('/auth/login')\n  }\n\n  const menuItems = [\n    { id: 'home', label: 'Home / الرئيسية', icon: Home },\n    { id: 'students', label: 'Students / الطلاب', icon: Users },\n    { id: 'sessions', label: 'Sessions / الحصص', icon: Calendar },\n    { id: 'assignments', label: 'Assignments / الواجبات', icon: BookOpen },\n    { id: 'chat', label: 'Chat / الدردشة', icon: MessageCircle },\n  ]\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-[#F5F5DC] to-white\">\n      <header className=\"bg-[#004E89] text-white shadow-lg\">\n        <div className=\"container mx-auto px-4 py-3 sm:py-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-2 sm:gap-4\">\n              <button\n                className=\"lg:hidden p-2 hover:bg-white/10 rounded-lg\"\n                onClick={() => setSidebarOpen(!sidebarOpen)}\n              >\n                <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h16\" />\n                </svg>\n              </button>\n              <h1 className=\"text-xl sm:text-2xl font-bold\">Youspeak</h1>\n              <span className=\"text-xs sm:text-sm bg-white/20 px-2 sm:px-3 py-1 rounded-full hidden sm:inline\">Teacher Portal</span>\n            </div>\n            <div className=\"flex items-center gap-2 sm:gap-4\">\n              <span className=\"text-xs sm:text-sm hidden sm:block\">{user.name}</span>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={handleSignOut}\n                className=\"text-white border-white hover:bg-white hover:text-[#004E89] text-xs sm:text-sm px-2 sm:px-4\"\n              >\n                <LogOut className=\"h-4 w-4 sm:mr-2\" />\n                <span className=\"hidden sm:inline\">Logout / خروج</span>\n              </Button>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"container mx-auto px-4 py-4 sm:py-6\">\n        <div className=\"flex flex-col lg:flex-row gap-4 sm:gap-6\">\n          {/* Mobile Sidebar Overlay */}\n          {sidebarOpen && (\n            <div \n              className=\"fixed inset-0 bg-black/50 z-40 lg:hidden\"\n              onClick={() => setSidebarOpen(false)}\n            />\n          )}\n\n          {/* Sidebar */}\n          <div className={`\n            fixed lg:static inset-y-0 left-0 z-50 lg:z-auto\n            w-64 lg:w-auto lg:flex-none\n            transform lg:transform-none transition-transform duration-300\n            ${sidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}\n          `}>\n            <Card variant=\"elevated\" padding=\"none\" className=\"h-full lg:h-auto\">\n              <div className=\"p-4 border-b border-gray-200\">\n                <div className=\"flex items-center justify-between lg:justify-start gap-3\">\n                  <div className=\"flex items-center gap-3 flex-1\">\n                    <div className=\"w-10 h-10 sm:w-12 sm:h-12 bg-[#004E89] rounded-full flex items-center justify-center text-white text-lg sm:text-xl font-bold\">\n                      {user.name?.charAt(0).toUpperCase()}\n                    </div>\n                    <div>\n                      <p className=\"font-semibold text-gray-900 text-sm sm:text-base\">{user.name}</p>\n                      <p className=\"text-xs sm:text-sm text-gray-600\">Teacher / مدرس</p>\n                    </div>\n                  </div>\n                  <button \n                    className=\"lg:hidden p-2 hover:bg-gray-100 rounded-lg\"\n                    onClick={() => setSidebarOpen(false)}\n                  >\n                    <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                    </svg>\n                  </button>\n                </div>\n              </div>\n              <nav className=\"p-2\">\n                {menuItems.map((item) => {\n                  const Icon = item.icon\n                  return (\n                    <button\n                      key={item.id}\n                      onClick={() => {\n                        setActiveTab(item.id)\n                        setSidebarOpen(false)\n                      }}\n                      className={`w-full flex items-center gap-3 px-3 sm:px-4 py-2 sm:py-3 rounded-lg transition-colors mb-1 ${\n                        activeTab === item.id\n                          ? 'bg-[#004E89] text-white'\n                          : 'text-gray-700 hover:bg-gray-100'\n                      }`}\n                    >\n                      <Icon className=\"h-5 w-5\" />\n                      <span className=\"text-xs sm:text-sm font-medium\">{item.label}</span>\n                    </button>\n                  )\n                })}\n              </nav>\n            </Card>\n          </div>\n\n          <div className=\"flex-1 min-w-0\">\n            {activeTab === 'home' && <HomeTab teacherProfileId={user.teacherProfileId} />}\n            {activeTab === 'students' && <StudentsTab teacherProfileId={user.teacherProfileId} />}\n            {activeTab === 'sessions' && <SessionsTab teacherProfileId={user.teacherProfileId} />}\n            {activeTab === 'assignments' && <AssignmentsTab teacherProfileId={user.teacherProfileId} />}\n            {activeTab === 'chat' && <ChatTab />}\n          </div>\n        </div>\n      </div>\n      <FloatingContactButtons />\n    </div>\n  )\n}\n\nfunction ChatTab() {\n  const [selectedUser, setSelectedUser] = useState<any>(null)\n\n  return (\n    <div>\n      <h2 className=\"text-2xl sm:text-3xl font-bold text-[#004E89] mb-4 sm:mb-6\">\n        Chat / الدردشة\n      </h2>\n      <div className=\"flex flex-col lg:flex-row gap-4 h-[calc(100vh-250px)] sm:h-[calc(100vh-300px)]\">\n        <div className=\"lg:flex-none lg:w-1/3\">\n          <Card variant=\"elevated\" padding=\"none\" className=\"h-full overflow-hidden\">\n            <div className=\"bg-gradient-to-r from-[#004E89] to-[#1A5F7A] p-4 text-white\">\n              <h3 className=\"font-bold text-lg\">المحادثات</h3>\n            </div>\n            <div className=\"overflow-y-auto h-[calc(100%-60px)]\">\n              <ConversationsList \n                onSelectConversation={setSelectedUser}\n                selectedUserId={selectedUser?.id}\n              />\n            </div>\n          </Card>\n        </div>\n        <div className=\"lg:col-span-2 h-full\">\n          {selectedUser ? (\n            <ChatBox \n              otherUser={selectedUser}\n              onClose={() => setSelectedUser(null)}\n            />\n          ) : (\n            <Card variant=\"elevated\" className=\"h-full flex flex-col items-center justify-center text-gray-400\">\n              <MessageCircle className=\"w-24 h-24 mb-4\" />\n              <p className=\"text-xl font-medium\">اختر محادثة للبدء</p>\n              <p className=\"text-sm mt-2\">حدد محادثة من القائمة لبدء الدردشة</p>\n            </Card>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}","size_bytes":8314},"scripts/check-users.ts":{"content":"import { prisma } from '../lib/prisma'\n\nasync function checkUsers() {\n  try {\n    const users = await prisma.user.findMany({\n      take: 5,\n      select: {\n        id: true,\n        email: true,\n        name: true,\n        role: true,\n        isActive: true,\n      },\n    })\n    \n    console.log('Users in database:')\n    console.log(JSON.stringify(users, null, 2))\n    console.log(`\\nTotal users found: ${users.length}`)\n  } catch (error) {\n    console.error('Error checking users:', error)\n  } finally {\n    await prisma.$disconnect()\n  }\n}\n\ncheckUsers()\n","size_bytes":557},"components/ui/Modal.tsx":{"content":"'use client';\n\nimport React, { useEffect } from 'react';\nimport { cn } from '@/lib/utils';\nimport { X } from 'lucide-react';\nimport Button from './Button';\n\nexport interface ModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  title?: string;\n  description?: string;\n  children: React.ReactNode;\n  footer?: React.ReactNode;\n  size?: 'sm' | 'md' | 'lg' | 'xl' | 'full';\n  closeOnBackdrop?: boolean;\n  showCloseButton?: boolean;\n  className?: string;\n}\n\nconst Modal = React.forwardRef<HTMLDivElement, ModalProps>(\n  (\n    {\n      isOpen,\n      onClose,\n      title,\n      description,\n      children,\n      footer,\n      size = 'md',\n      closeOnBackdrop = true,\n      showCloseButton = true,\n      className,\n    },\n    ref\n  ) => {\n    useEffect(() => {\n      if (isOpen) {\n        document.body.style.overflow = 'hidden';\n      } else {\n        document.body.style.overflow = 'unset';\n      }\n\n      return () => {\n        document.body.style.overflow = 'unset';\n      };\n    }, [isOpen]);\n\n    useEffect(() => {\n      const handleEscape = (event: KeyboardEvent) => {\n        if (event.key === 'Escape' && isOpen) {\n          onClose();\n        }\n      };\n\n      document.addEventListener('keydown', handleEscape);\n      return () => document.removeEventListener('keydown', handleEscape);\n    }, [isOpen, onClose]);\n\n    if (!isOpen) return null;\n\n    const sizeClasses = {\n      sm: 'max-w-sm',\n      md: 'max-w-md',\n      lg: 'max-w-lg',\n      xl: 'max-w-xl',\n      full: 'max-w-full mx-4',\n    };\n\n    return (\n      <div\n        className=\"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6 md:p-8\"\n        role=\"dialog\"\n        aria-modal=\"true\"\n        aria-labelledby={title ? 'modal-title' : undefined}\n        aria-describedby={description ? 'modal-description' : undefined}\n      >\n        <div\n          className=\"fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity\"\n          onClick={closeOnBackdrop ? onClose : undefined}\n          aria-hidden=\"true\"\n        />\n        <div\n          ref={ref}\n          className={cn(\n            'relative w-full bg-white rounded-lg shadow-xl transition-all dark:bg-neutral-900 max-h-[90vh] overflow-hidden flex flex-col',\n            sizeClasses[size],\n            className\n          )}\n        >\n          {(title || showCloseButton) && (\n            <div className=\"flex items-start justify-between border-b border-neutral-200 px-6 py-4 dark:border-neutral-800\">\n              <div className=\"flex-1\">\n                {title && (\n                  <h2\n                    id=\"modal-title\"\n                    className=\"text-lg font-semibold text-neutral-900 dark:text-neutral-100 rtl:text-right\"\n                  >\n                    {title}\n                  </h2>\n                )}\n                {description && (\n                  <p\n                    id=\"modal-description\"\n                    className=\"mt-1 text-sm text-neutral-500 dark:text-neutral-400 rtl:text-right\"\n                  >\n                    {description}\n                  </p>\n                )}\n              </div>\n              {showCloseButton && (\n                <button\n                  onClick={onClose}\n                  className=\"ml-4 text-neutral-400 hover:text-neutral-600 transition-colors rtl:ml-0 rtl:mr-4\"\n                  aria-label=\"Close modal\"\n                >\n                  <X className=\"h-5 w-5\" aria-hidden=\"true\" />\n                </button>\n              )}\n            </div>\n          )}\n          <div className=\"flex-1 overflow-y-auto px-6 py-4\">{children}</div>\n          {footer && (\n            <div className=\"border-t border-neutral-200 px-6 py-4 dark:border-neutral-800\">\n              {footer}\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n);\n\nModal.displayName = 'Modal';\n\nexport default Modal;\n","size_bytes":3833},"lib/utils/exportToExcel.ts":{"content":"import * as XLSX from 'xlsx'\n\ninterface Word {\n  englishWord: string\n  arabicMeaning: string\n  exampleSentence: string | null\n  known: boolean\n  createdAt: string\n}\n\nexport function exportWordsToExcel(words: Word[], filename: string = 'my-words.xlsx', onlyUnknown: boolean = false) {\n  const filteredWords = onlyUnknown ? words.filter(w => !w.known) : words\n  \n  const data = filteredWords.map(word => ({\n    'English Word': word.englishWord,\n    'Arabic Meaning': word.arabicMeaning,\n    'Example Sentence': word.exampleSentence || '',\n    'Status': word.known ? 'Known' : 'Unknown',\n    'Added Date': new Date(word.createdAt).toLocaleDateString('en-GB')\n  }))\n\n  const worksheet = XLSX.utils.json_to_sheet(data)\n  \n  const colWidths = [\n    { wch: 20 },\n    { wch: 20 },\n    { wch: 40 },\n    { wch: 10 },\n    { wch: 15 }\n  ]\n  worksheet['!cols'] = colWidths\n\n  const workbook = XLSX.utils.book_new()\n  XLSX.utils.book_append_sheet(workbook, worksheet, 'Words')\n\n  XLSX.writeFile(workbook, filename)\n}\n","size_bytes":1003},"app/api/sessions/student/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'STUDENT') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const sessions = await prisma.sessionStudent.findMany({\n      where: { studentId: session.user.id },\n      include: {\n        Session: {\n          include: {\n            TeacherProfile: {\n              include: { User: true }\n            }\n          }\n        }\n      },\n      orderBy: {\n        Session: { startTime: 'desc' }\n      }\n    })\n\n    return NextResponse.json(sessions)\n  } catch (error) {\n    console.error('Error fetching sessions:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":980},"attached_assets/MySessionPage_1763165075106.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '../components/ui/card';\nimport { Button } from '../components/ui/button';\nimport { Badge } from '../components/ui/badge';\nimport { Video, Clock, Calendar, CheckCircle2, XCircle, Loader2 } from 'lucide-react';\nimport { useToast } from '../hooks/use-toast';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { format } from 'date-fns';\nimport { ar } from 'date-fns/locale';\nimport { useAuth } from '../hooks/useAuth';\n\ninterface SessionAccess {\n  id: string;\n  sessionDate: string;\n  startTime: string;\n  endTime: string;\n  isEnabled: boolean;\n  enabledAt?: string;\n  roomToken?: string;\n  roomId?: string;\n}\n\ninterface Assignment {\n  id: string;\n  assignmentDate: string;\n  memorization: string;\n  review: string;\n  mistakes?: string;\n  notes?: string;\n}\n\ninterface MySessionPageProps {\n  onBack?: () => void;\n}\n\nexport default function MySessionPage({ onBack }: MySessionPageProps = {}) {\n  const [sessions, setSessions] = useState<SessionAccess[]>([]);\n  const [todayAssignment, setTodayAssignment] = useState<Assignment | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [joiningSession, setJoiningSession] = useState<string | null>(null);\n  const [activeRoomId, setActiveRoomId] = useState<string | null>(null);\n  const { toast } = useToast();\n  const { user } = useAuth();\n\n  useEffect(() => {\n    if (!user) return;\n    \n    fetchSessions();\n    if (user.role === 'student') {\n      fetchTodayAssignment();\n    }\n\n    const ws = new WebSocket(`${window.location.protocol === 'https:' ? 'wss:' : 'ws:'}//${window.location.host}/ws`);\n    \n    ws.onopen = () => {\n      const userId = sessionStorage.getItem('userId');\n      if (userId && user.role) {\n        ws.send(JSON.stringify({\n          type: 'auth',\n          payload: { userId, role: user.role }\n        }));\n      }\n    };\n    \n    ws.onmessage = (event) => {\n      const data = JSON.parse(event.data);\n      if (data.type === 'session_enabled') {\n        console.log('📢 Session enabled notification received:', data.data);\n        toast({\n          title: \"🎉 تم تفعيل الحصة!\",\n          description: \"يمكنك الآن الدخول للحصة المباشرة\",\n        });\n        fetchSessions();\n      } else if (data.type === 'new_assignment') {\n        toast({\n          title: \"📚 تكليف جديد!\",\n          description: \"تم إضافة تكليف جديد لك\",\n        });\n        fetchTodayAssignment();\n      }\n    };\n    \n    return () => ws.close();\n  }, [user]);\n\n  const fetchSessions = async () => {\n    try {\n      const endpoint = user?.role === 'supervisor' || user?.role === 'admin' \n        ? '/api/sheikh/sessions?range=upcoming'\n        : '/api/student/sessions';\n      const response = await fetch(endpoint);\n      if (response.ok) {\n        const data = await response.json();\n        setSessions(data);\n      }\n    } catch (error) {\n      console.error('Error fetching sessions:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchTodayAssignment = async () => {\n    try {\n      const response = await fetch('/api/student/assignment/today');\n      if (response.ok) {\n        const data = await response.json();\n        setTodayAssignment(data);\n      }\n    } catch (error) {\n      console.error('Error fetching assignment:', error);\n    }\n  };\n\n  const joinSession = async (session: SessionAccess) => {\n    if (!session.isEnabled) {\n      toast({\n        title: \"الحصة غير مفعلة\",\n        description: \"انتظر حتى يفعل الشيخ الحصة\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!session.roomToken) {\n      toast({\n        title: \"خطأ\",\n        description: \"لم يتم إنشاء غرفة الحصة بعد، الرجاء المحاولة مرة أخرى\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setJoiningSession(session.id);\n    \n    setTimeout(() => {\n      window.open(`/session/${session.roomToken}`, '_blank', 'noopener,noreferrer');\n      setJoiningSession(null);\n      \n      toast({\n        title: \"🎉 تم فتح الحصة\",\n        description: \"تم فتح الحصة المباشرة في نافذة جديدة\",\n      });\n    }, 500);\n  };\n\n  const parseAssignmentRanges = (jsonString: string) => {\n    try {\n      const ranges = JSON.parse(jsonString);\n      if (Array.isArray(ranges)) {\n        return ranges.map(r => `${r.surahName}: من آية ${r.fromAyah} إلى ${r.toAyah}`).join(' • ');\n      }\n      return jsonString;\n    } catch {\n      return jsonString;\n    }\n  };\n\n  const isSheikhRole = user?.role === 'supervisor' || user?.role === 'admin';\n\n  if (loading) {\n    return (\n      <div className={`min-h-screen ${\n        isSheikhRole\n          ? 'bg-gradient-to-br from-emerald-400 via-green-500 to-teal-500'\n          : 'bg-gradient-to-br from-emerald-50 via-teal-50 to-cyan-50'\n      } flex items-center justify-center p-6`} dir=\"rtl\">\n        <motion.div \n          initial={{ opacity: 0, scale: 0.9 }}\n          animate={{ opacity: 1, scale: 1 }}\n          className=\"text-center\"\n        >\n          <div className={`w-16 h-16 border-4 ${\n            isSheikhRole \n              ? 'border-white border-t-transparent'\n              : 'border-emerald-500 border-t-transparent'\n          } rounded-full animate-spin mx-auto mb-4`}></div>\n          <p className={`text-lg font-medium ${\n            isSheikhRole ? 'text-white' : 'text-emerald-700'\n          }`}>جاري التحميل...</p>\n        </motion.div>\n      </div>\n    );\n  }\n\n  const todaysSessions = sessions.filter(s => s.sessionDate === new Date().toISOString().split('T')[0]);\n  const hasEnabledSession = todaysSessions.some(s => s.isEnabled);\n\n  return (\n    <div className={`min-h-screen ${\n      isSheikhRole && hasEnabledSession\n        ? 'bg-gradient-to-br from-emerald-400 via-green-500 to-teal-500'\n        : 'bg-gradient-to-br from-emerald-50 via-teal-50 to-cyan-50'\n    }`} dir=\"rtl\">\n      {/* Header with Back Button */}\n      <div className={`${\n        isSheikhRole && hasEnabledSession\n          ? 'bg-gradient-to-r from-emerald-700 to-green-700'\n          : 'bg-gradient-to-r from-emerald-600 to-teal-600'\n      } text-white p-4 sticky top-0 z-50 shadow-lg`}>\n        <div className=\"max-w-6xl mx-auto flex justify-between items-center gap-4\">\n          <h1 className=\"text-xl md:text-2xl font-bold\">حصتي 📚</h1>\n          {onBack && (\n            <Button\n              onClick={onBack}\n              variant=\"ghost\"\n              className=\"bg-white/20 hover:bg-white/30 text-white\"\n              data-testid=\"button-back-my-session\"\n            >\n              ← العودة\n            </Button>\n          )}\n        </div>\n      </div>\n\n      <div className=\"max-w-6xl mx-auto space-y-6 p-6\">\n\n        {/* Today's Assignment */}\n        {todayAssignment && (\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n          >\n            <Card className=\"border-0 shadow-2xl bg-gradient-to-r from-amber-500 to-orange-600 text-white overflow-hidden relative\">\n              <div className=\"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-32 -mt-32\"></div>\n              <CardHeader className=\"relative z-10\">\n                <CardTitle className=\"text-2xl flex items-center gap-3\">\n                  <div className=\"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center\">\n                    📖\n                  </div>\n                  تكليف اليوم\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"relative z-10 space-y-4\">\n                <div className=\"bg-white/10 backdrop-blur-sm rounded-xl p-4 space-y-3\">\n                  <div>\n                    <h4 className=\"font-bold text-lg mb-2\">الحفظ الجديد:</h4>\n                    <p className=\"text-amber-50 text-lg\">{parseAssignmentRanges(todayAssignment.memorization)}</p>\n                  </div>\n                  <div>\n                    <h4 className=\"font-bold text-lg mb-2\">المراجعة:</h4>\n                    <p className=\"text-amber-50 text-lg\">{parseAssignmentRanges(todayAssignment.review)}</p>\n                  </div>\n                  {todayAssignment.mistakes && (\n                    <div>\n                      <h4 className=\"font-bold text-lg mb-2\">الأخطاء:</h4>\n                      <p className=\"text-amber-50\">{todayAssignment.mistakes}</p>\n                    </div>\n                  )}\n                  {todayAssignment.notes && (\n                    <div>\n                      <h4 className=\"font-bold text-lg mb-2\">ملاحظات:</h4>\n                      <p className=\"text-amber-50\">{todayAssignment.notes}</p>\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          </motion.div>\n        )}\n\n        {/* Today's Sessions */}\n        <div className=\"space-y-4\">\n          <h2 className={`text-3xl font-bold mb-4 ${\n            isSheikhRole && hasEnabledSession ? 'text-white' : 'text-gray-800'\n          }`}>حصص اليوم</h2>\n          \n          {todaysSessions.length === 0 ? (\n            <Card className={`border-0 shadow-xl ${\n              isSheikhRole && hasEnabledSession \n                ? 'bg-white/20 backdrop-blur-md'\n                : 'bg-white/80 backdrop-blur-sm'\n            }`}>\n              <CardContent className=\"p-16 text-center\">\n                <div className={`w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6 ${\n                  isSheikhRole && hasEnabledSession\n                    ? 'bg-white/20'\n                    : 'bg-gray-100'\n                }`}>\n                  <Calendar className={`w-12 h-12 ${\n                    isSheikhRole && hasEnabledSession ? 'text-white' : 'text-gray-400'\n                  }`} />\n                </div>\n                <h3 className={`text-2xl font-bold mb-2 ${\n                  isSheikhRole && hasEnabledSession ? 'text-white' : 'text-gray-800'\n                }`}>لا توجد حصص مجدولة اليوم</h3>\n                <p className={`text-lg ${\n                  isSheikhRole && hasEnabledSession ? 'text-white/90' : 'text-gray-500'\n                }`}>ستظهر حصصك هنا عندما يتم جدولتها</p>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"grid gap-4\">\n              <AnimatePresence>\n                {todaysSessions.map((session, index) => (\n                  <motion.div\n                    key={session.id}\n                    initial={{ opacity: 0, x: -20 }}\n                    animate={{ opacity: 1, x: 0 }}\n                    exit={{ opacity: 0, x: 20 }}\n                    transition={{ delay: index * 0.1 }}\n                  >\n                    <Card className={`border-0 shadow-xl overflow-hidden ${\n                      session.isEnabled \n                        ? 'bg-gradient-to-r from-green-500 to-emerald-600 text-white'\n                        : 'bg-gradient-to-r from-gray-400 to-gray-500 text-white'\n                    }`}>\n                      <CardContent className=\"p-6\">\n                        <div className=\"flex items-center justify-between\">\n                          <div className=\"flex-1\">\n                            <div className=\"flex items-center gap-3 mb-3\">\n                              <div className=\"w-14 h-14 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center\">\n                                <Video className=\"w-7 h-7\" />\n                              </div>\n                              <div>\n                                <h3 className=\"text-2xl font-bold\">الحصة المباشرة</h3>\n                                <div className=\"flex items-center gap-2 text-sm opacity-90 mt-1\">\n                                  <Clock className=\"w-4 h-4\" />\n                                  <span>{session.startTime} - {session.endTime}</span>\n                                </div>\n                              </div>\n                            </div>\n                            \n                            {session.isEnabled ? (\n                              <Badge className=\"bg-white/30 text-white border-white/50 text-sm px-3 py-1\">\n                                <CheckCircle2 className=\"w-4 h-4 ml-1\" />\n                                الحصة مفعلة - يمكنك الدخول الآن\n                              </Badge>\n                            ) : (\n                              <Badge className=\"bg-white/20 text-white border-white/40 text-sm px-3 py-1\">\n                                <XCircle className=\"w-4 h-4 ml-1\" />\n                                في انتظار التفعيل\n                              </Badge>\n                            )}\n                          </div>\n                          \n                          <Button\n                            onClick={() => joinSession(session)}\n                            disabled={!session.isEnabled || joiningSession === session.id}\n                            className={`${\n                              session.isEnabled\n                                ? 'bg-white text-emerald-700 hover:bg-emerald-50'\n                                : 'bg-white/20 text-white cursor-not-allowed'\n                            } shadow-lg px-8 py-6 text-lg font-bold`}\n                            data-testid={`button-join-session-${session.id}`}\n                          >\n                            {joiningSession === session.id ? (\n                              <>\n                                <Loader2 className=\"w-5 h-5 ml-2 animate-spin\" />\n                                جاري الانضمام...\n                              </>\n                            ) : (\n                              <>\n                                <Video className=\"w-5 h-5 ml-2\" />\n                                انضم للحصة\n                              </>\n                            )}\n                          </Button>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  </motion.div>\n                ))}\n              </AnimatePresence>\n            </div>\n          )}\n        </div>\n\n        {/* All Sessions */}\n        {sessions.filter(s => s.sessionDate !== new Date().toISOString().split('T')[0]).length > 0 && (\n          <div className=\"space-y-4\">\n            <h2 className={`text-2xl font-bold mb-4 ${\n              isSheikhRole && hasEnabledSession ? 'text-white' : 'text-gray-800'\n            }`}>الحصص القادمة</h2>\n            \n            <div className=\"grid gap-3\">\n              {sessions\n                .filter(s => s.sessionDate !== new Date().toISOString().split('T')[0])\n                .map((session, index) => (\n                  <Card key={session.id} className={`border-0 shadow-lg ${\n                    isSheikhRole && hasEnabledSession\n                      ? 'bg-white/20 backdrop-blur-md'\n                      : 'bg-white/80 backdrop-blur-sm'\n                  }`}>\n                    <CardContent className=\"p-4\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-3\">\n                          <Calendar className={`w-10 h-10 ${\n                            isSheikhRole && hasEnabledSession ? 'text-white' : 'text-blue-600'\n                          }`} />\n                          <div>\n                            <h4 className={`font-bold ${\n                              isSheikhRole && hasEnabledSession ? 'text-white' : 'text-gray-800'\n                            }`}>\n                              {format(new Date(session.sessionDate), 'EEEE، d MMMM yyyy', { locale: ar })}\n                            </h4>\n                            <p className={`text-sm ${\n                              isSheikhRole && hasEnabledSession ? 'text-white/90' : 'text-gray-600'\n                            }`}>\n                              {session.startTime} - {session.endTime}\n                            </p>\n                          </div>\n                        </div>\n                        <Badge className={\n                          isSheikhRole && hasEnabledSession\n                            ? 'bg-white/30 text-white border-white/50'\n                            : 'bg-blue-100 text-blue-700 border-blue-200'\n                        }>\n                          قادمة\n                        </Badge>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n            </div>\n          </div>\n        )}\n      </div>\n\n    </div>\n  );\n}\n","size_bytes":16907},"attached_assets/LiveSessionRoom_1763165088517.tsx":{"content":"import { useState, useEffect, useRef, useCallback } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from '@/components/ui/dropdown-menu';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\nimport { \n  Video, \n  Mic, \n  MicOff, \n  VideoOff, \n  PhoneOff, \n  MessageSquare,\n  Send,\n  Users,\n  Monitor,\n  MonitorOff,\n  Pencil,\n  Shield,\n  MoreVertical,\n  Settings,\n  Hand,\n  Smile,\n  ThumbsUp,\n  Heart,\n  UserMinus,\n  Lock,\n  Unlock\n} from 'lucide-react';\nimport { useLiveSessionWebRTC } from '@/hooks/useLiveSessionWebRTC';\nimport { LiveWhiteboard } from '@/components/LiveWhiteboard';\nimport { useAuth } from '@/hooks/useAuth';\nimport type { DrawCommand } from '@/hooks/useWhiteboard';\n\ninterface LiveSessionRoomProps {\n  roomId: string;\n  studentId: string;\n  sheikhId: string;\n  onLeave: () => void;\n}\n\nexport default function LiveSessionRoom({ roomId, onLeave }: LiveSessionRoomProps) {\n  const { user } = useAuth();\n  const [newMessage, setNewMessage] = useState('');\n  const [activeTab, setActiveTab] = useState<'video' | 'whiteboard'>('video');\n  const [whiteboardEnabled, setWhiteboardEnabled] = useState(false);\n  const [processedWhiteboardCommands, setProcessedWhiteboardCommands] = useState<Set<string>>(new Set());\n  const whiteboardExecuteRef = useRef<((command: DrawCommand) => void) | null>(null);\n  const [showAdvancedOptions, setShowAdvancedOptions] = useState(false);\n\n  const {\n    isAudioEnabled,\n    isVideoEnabled,\n    isScreenSharing,\n    participants,\n    messages,\n    isConnected,\n    localVideoRef,\n    remoteVideoRef,\n    screenVideoRef,\n    toggleAudio,\n    toggleVideo,\n    startScreenShare,\n    stopScreenShare,\n    sendMessage,\n    sendWhiteboardCommand,\n    whiteboardCommands,\n    leaveRoom,\n    toggleHandRaise,\n    sendReaction,\n    muteParticipant,\n    muteAll,\n    removeParticipant,\n    lockRoom,\n    isAudioMutedByHost\n  } = useLiveSessionWebRTC(roomId, onLeave);\n\n  const isShamsikh = user?.role === 'supervisor' || user?.role === 'admin';\n\n  const handleSendMessage = () => {\n    if (!newMessage.trim()) return;\n    sendMessage(newMessage);\n    setNewMessage('');\n  };\n\n  const handleWhiteboardCommand = (command: DrawCommand) => {\n    if (isConnected) {\n      sendWhiteboardCommand(command);\n    }\n  };\n\n  const handleExecuteRemoteCommand = useCallback((command: DrawCommand) => {\n    if (whiteboardExecuteRef.current) {\n      whiteboardExecuteRef.current(command);\n    }\n  }, []);\n\n  const isValidWhiteboardCommand = (command: any): command is DrawCommand => {\n    if (!command || typeof command !== 'object') return false;\n    if (!command.type || typeof command.type !== 'string') return false;\n    return true;\n  };\n\n  useEffect(() => {\n    whiteboardCommands.forEach((cmdData: any) => {\n      if (processedWhiteboardCommands.has(cmdData.id)) {\n        return;\n      }\n\n      if (!cmdData.id || !cmdData.userId || !cmdData.timestamp) {\n        console.warn('Invalid whiteboard command metadata:', cmdData);\n        setProcessedWhiteboardCommands(prev => new Set(prev).add(cmdData.id || Date.now().toString()));\n        return;\n      }\n\n      if (cmdData.command && \n          cmdData.userId !== user?.id && \n          isValidWhiteboardCommand(cmdData.command)) {\n        handleExecuteRemoteCommand(cmdData.command);\n      }\n      setProcessedWhiteboardCommands(prev => new Set(prev).add(cmdData.id));\n    });\n  }, [whiteboardCommands, processedWhiteboardCommands, user?.id, handleExecuteRemoteCommand]);\n\n  const toggleWhiteboard = () => {\n    setWhiteboardEnabled(!whiteboardEnabled);\n    if (!whiteboardEnabled) {\n      setActiveTab('whiteboard');\n    }\n  };\n\n  return (\n    <div className=\"h-screen overflow-y-auto bg-gradient-to-br from-emerald-900 via-teal-800 to-cyan-900\" dir=\"rtl\">\n      {/* Header */}\n      <div className=\"sticky top-0 z-50 bg-gradient-to-r from-emerald-600 to-teal-600 p-2 md:p-4 shadow-lg\">\n        <div className=\"max-w-7xl mx-auto flex items-center justify-between flex-wrap gap-2 md:gap-4\">\n          <div className=\"flex items-center gap-2 md:gap-4\">\n            <div className=\"w-8 h-8 md:w-12 md:h-12 bg-white/20 rounded-full flex items-center justify-center\">\n              <Video className=\"w-4 h-4 md:w-6 md:h-6 text-white\" />\n            </div>\n            <div>\n              <h2 className=\"text-base md:text-2xl font-bold text-white\">الحصة المباشرة</h2>\n              <div className=\"flex items-center gap-2 md:gap-3 text-white/80 text-xs md:text-sm flex-wrap\">\n                <Badge className=\"bg-green-500 text-white text-xs\">\n                  <span className=\"w-2 h-2 bg-white rounded-full inline-block ml-1 animate-pulse\"></span>\n                  {isConnected ? 'متصل' : 'غير متصل'}\n                </Badge>\n                <span className=\"hidden md:flex items-center gap-1\">\n                  <Users className=\"w-3 h-3 md:w-4 md:h-4\" />\n                  {participants.length} مشاركين\n                </span>\n                {isShamsikh && (\n                  <Badge className=\"bg-amber-500 text-white flex items-center gap-1 text-xs\">\n                    <Shield className=\"w-3 h-3\" />\n                    <span className=\"hidden md:inline\">مشرف</span>\n                  </Badge>\n                )}\n              </div>\n            </div>\n          </div>\n\n          {/* Control Buttons */}\n          <div className=\"flex items-center gap-1 md:gap-2 flex-wrap\">\n            {isShamsikh && (\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    className=\"flex items-center gap-1 md:gap-2 text-xs md:text-sm\"\n                    data-testid=\"button-controls-menu\"\n                  >\n                    <Settings className=\"w-4 h-4\" />\n                    <span className=\"hidden md:inline\">أدوات التحكم</span>\n                    <MoreVertical className=\"w-3 h-3\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"end\" className=\"w-48\">\n                  <DropdownMenuItem onClick={toggleWhiteboard} data-testid=\"menu-toggle-whiteboard\">\n                    <Pencil className=\"w-4 h-4 ml-2\" />\n                    {whiteboardEnabled ? 'إخفاء السبورة' : 'إظهار السبورة'}\n                  </DropdownMenuItem>\n                  <DropdownMenuItem \n                    onClick={isScreenSharing ? stopScreenShare : startScreenShare}\n                    data-testid=\"menu-toggle-screen-share\"\n                  >\n                    {isScreenSharing ? <MonitorOff className=\"w-4 h-4 ml-2\" /> : <Monitor className=\"w-4 h-4 ml-2\" />}\n                    {isScreenSharing ? 'إيقاف مشاركة الشاشة' : 'مشاركة الشاشة'}\n                  </DropdownMenuItem>\n                  <DropdownMenuItem onClick={() => setShowAdvancedOptions(true)} data-testid=\"menu-advanced-options\">\n                    <Settings className=\"w-4 h-4 ml-2\" />\n                    الإعدادات المتقدمة\n                  </DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n            )}\n\n            <Button\n              size=\"sm\"\n              variant=\"destructive\"\n              onClick={leaveRoom}\n              className=\"flex items-center gap-1 md:gap-2 text-xs md:text-sm\"\n              data-testid=\"button-leave-session\"\n            >\n              <PhoneOff className=\"w-3 h-3 md:w-5 md:h-5\" />\n              <span>مغادرة</span>\n            </Button>\n          </div>\n        </div>\n      </div>\n      {/* Main Content */}\n      <div className=\"p-4 pb-8 min-h-[calc(100vh-80px)]\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4\">\n          {/* Video & Whiteboard Section */}\n          <div className=\"lg:col-span-2 space-y-4\">\n            {/* View Toggle Buttons */}\n            <div className=\"flex gap-2 bg-black/40 p-1 rounded-lg\">\n              <Button\n                variant={activeTab === 'video' ? 'default' : 'ghost'}\n                onClick={() => setActiveTab('video')}\n                className=\"flex-1\"\n                data-testid=\"button-view-video\"\n              >\n                <Video className=\"w-4 h-4 ml-2\" />\n                الفيديو\n              </Button>\n              <Button\n                variant={activeTab === 'whiteboard' ? 'default' : 'ghost'}\n                onClick={() => setActiveTab('whiteboard')}\n                className=\"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2 flex-1 bg-[#095241]\"\n                data-testid=\"button-view-whiteboard\"\n              >\n                <Pencil className=\"w-4 h-4 ml-2\" />\n                السبورة البيضاء\n              </Button>\n            </div>\n\n            {/* Video Section - Always mounted, hidden when whiteboard active */}\n            <div className={activeTab === 'video' ? 'block space-y-4' : 'hidden'}>\n              {/* Remote Video */}\n              <Card className=\"bg-black/40 border-emerald-500/30 h-[400px] md:h-[500px]\">\n                <CardContent className=\"p-4 h-full\">\n                  <div className=\"relative h-full bg-gray-900 rounded-lg overflow-hidden\">\n                    <video\n                      ref={remoteVideoRef}\n                      autoPlay\n                      playsInline\n                      className=\"w-full h-full object-cover\"\n                      data-testid=\"video-remote\"\n                    />\n                    {participants.length === 0 && (\n                      <div className=\"absolute inset-0 flex items-center justify-center\">\n                        <div className=\"text-center text-white/60\">\n                          <Users className=\"w-16 h-16 mx-auto mb-4\" />\n                          <p className=\"text-lg\">في انتظار انضمام المشاركين...</p>\n                        </div>\n                      </div>\n                    )}\n                    {isScreenSharing && (\n                      <div className=\"absolute top-4 right-4\">\n                        <Badge className=\"bg-red-500 text-white flex items-center gap-1\">\n                          <Monitor className=\"w-3 h-3\" />\n                          يشارك الشاشة\n                        </Badge>\n                      </div>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Local Video */}\n              <Card className=\"bg-black/40 border-emerald-500/30 h-[250px] md:h-[300px]\">\n                <CardContent className=\"p-4 h-full\">\n                  <div className=\"relative h-full bg-gray-900 rounded-lg overflow-hidden\">\n                    <video\n                      ref={localVideoRef}\n                      autoPlay\n                      muted\n                      playsInline\n                      className=\"w-full h-full object-cover\"\n                      data-testid=\"video-local\"\n                    />\n                    <div className=\"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex flex-col items-center gap-3\">\n                      {/* Main Controls */}\n                      <div className=\"flex items-center gap-3\">\n                        <Button\n                          size=\"icon\"\n                          variant={isAudioEnabled ? \"default\" : \"destructive\"}\n                          onClick={toggleAudio}\n                          className=\"rounded-full w-12 h-12\"\n                          data-testid=\"button-toggle-audio\"\n                          disabled={isAudioMutedByHost}\n                          title={isAudioMutedByHost ? \"تم كتم صوتك من قبل المشرف\" : \"\"}\n                        >\n                          {isAudioEnabled ? <Mic className=\"w-5 h-5\" /> : <MicOff className=\"w-5 h-5\" />}\n                        </Button>\n\n                        <Button\n                          size=\"icon\"\n                          variant={isVideoEnabled ? \"default\" : \"destructive\"}\n                          onClick={toggleVideo}\n                          className=\"rounded-full w-12 h-12\"\n                          data-testid=\"button-toggle-video\"\n                        >\n                          {isVideoEnabled ? <Video className=\"w-5 h-5\" /> : <VideoOff className=\"w-5 h-5\" />}\n                        </Button>\n                        \n                        {!isShamsikh && (\n                          <Button\n                            size=\"icon\"\n                            variant=\"outline\"\n                            onClick={toggleHandRaise}\n                            className=\"rounded-full w-12 h-12 bg-white/10 border-white/30\"\n                            data-testid=\"button-raise-hand\"\n                          >\n                            <Hand className=\"w-5 h-5 text-yellow-400\" />\n                          </Button>\n                        )}\n                      </div>\n                      \n                      {/* Reaction Buttons */}\n                      {!isShamsikh && (\n                        <div className=\"flex items-center gap-2 bg-black/50 px-3 py-2 rounded-full\">\n                          <Button\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={() => sendReaction('👍')}\n                            className=\"w-10 h-10 text-2xl p-0\"\n                            data-testid=\"button-reaction-thumbsup\"\n                          >\n                            👍\n                          </Button>\n                          <Button\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={() => sendReaction('❤️')}\n                            className=\"w-10 h-10 text-2xl p-0\"\n                            data-testid=\"button-reaction-heart\"\n                          >\n                            ❤️\n                          </Button>\n                          <Button\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={() => sendReaction('👏')}\n                            className=\"w-10 h-10 text-2xl p-0\"\n                            data-testid=\"button-reaction-clap\"\n                          >\n                            👏\n                          </Button>\n                          <Button\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={() => sendReaction('✋')}\n                            className=\"w-10 h-10 text-2xl p-0\"\n                            data-testid=\"button-reaction-raise\"\n                          >\n                            ✋\n                          </Button>\n                        </div>\n                      )}\n                    </div>\n                    <div className=\"absolute top-4 left-4\">\n                      <Badge className=\"bg-emerald-500 text-white\">\n                        أنت\n                      </Badge>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n\n            {/* Whiteboard Section - Always mounted, hidden when video active */}\n            <div className={activeTab === 'whiteboard' ? 'block' : 'hidden'}>\n              <div className=\"min-h-[700px]\">\n                <LiveWhiteboard\n                  roomToken={roomId}\n                  userId={user?.id || ''}\n                  isEnabled={isShamsikh || whiteboardEnabled}\n                  onSendCommand={handleWhiteboardCommand}\n                  onExecuteCommand={(executeFunc) => {\n                    whiteboardExecuteRef.current = executeFunc;\n                  }}\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Sidebar */}\n          <div className=\"space-y-4\">\n            {/* Participants */}\n            <Card className=\"bg-black/40 border-emerald-500/30\">\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-white flex items-center gap-2\">\n                  <Users className=\"w-5 h-5\" />\n                  المشاركون ({participants.length})\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-2\">\n                {isShamsikh && (\n                  <div className=\"flex gap-2 mb-3\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={muteAll}\n                      className=\"flex-1 bg-white/10 border-white/30 text-white hover:bg-white/20\"\n                      data-testid=\"button-mute-all\"\n                    >\n                      <MicOff className=\"w-4 h-4 ml-2\" />\n                      كتم الجميع\n                    </Button>\n                  </div>\n                )}\n                \n                {participants.map((participant: any) => (\n                  <div\n                    key={participant.userId}\n                    className=\"relative p-3 bg-white/10 rounded-lg\"\n                    data-testid={`participant-${participant.userId}`}\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-10 h-10 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-full flex items-center justify-center text-white font-bold relative\">\n                        {participant.role === 'supervisor' ? 'ش' : 'ط'}\n                        {participant.reaction && (\n                          <div className=\"absolute -top-2 -right-2 text-2xl animate-bounce\">\n                            {participant.reaction}\n                          </div>\n                        )}\n                      </div>\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center gap-2 bg-[#0a5447]\">\n                          <p className=\"text-white font-medium\">\n                            {participant.role === 'supervisor' ? 'الشيخ' : 'الطالب'}\n                          </p>\n                          {participant.isHandRaised && (\n                            <Badge className=\"bg-yellow-500 text-black flex items-center gap-1\">\n                              <Hand className=\"w-3 h-3\" />\n                              يد مرفوعة\n                            </Badge>\n                          )}\n                          {participant.isAudioMutedByHost && (\n                            <Badge variant=\"destructive\" className=\"flex items-center gap-1\">\n                              <MicOff className=\"w-3 h-3\" />\n                              مكتوم\n                            </Badge>\n                          )}\n                        </div>\n                        <p className=\"text-white/60 text-sm\">\n                          {participant.role}\n                        </p>\n                      </div>\n                      \n                      {isShamsikh && participant.userId !== user?.id && (\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button\n                              size=\"icon\"\n                              variant=\"ghost\"\n                              className=\"h-8 w-8 text-white hover:bg-white/20\"\n                              data-testid={`button-participant-menu-${participant.userId}`}\n                            >\n                              <MoreVertical className=\"w-4 h-4\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuItem\n                              onClick={() => muteParticipant(participant.userId, !participant.isAudioMutedByHost)}\n                              data-testid={`menu-mute-participant-${participant.userId}`}\n                            >\n                              <MicOff className=\"w-4 h-4 ml-2\" />\n                              {participant.isAudioMutedByHost ? 'إلغاء الكتم' : 'كتم الصوت'}\n                            </DropdownMenuItem>\n                            <DropdownMenuItem\n                              onClick={() => removeParticipant(participant.userId)}\n                              className=\"text-red-600\"\n                              data-testid={`menu-remove-participant-${participant.userId}`}\n                            >\n                              <UserMinus className=\"w-4 h-4 ml-2\" />\n                              إزالة من الحصة\n                            </DropdownMenuItem>\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      )}\n                      \n                      {!isShamsikh && (\n                        <Badge className=\"bg-green-500 text-white\">\n                          متصل\n                        </Badge>\n                      )}\n                    </div>\n                  </div>\n                ))}\n                {participants.length === 0 && (\n                  <div className=\"text-center text-white/60 py-8\">\n                    <p>لا يوجد مشاركون آخرون</p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            {/* Chat */}\n            <Card className=\"bg-black/40 border-emerald-500/30 flex flex-col max-h-[500px]\">\n              <CardHeader className=\"pb-3 flex-shrink-0\">\n                <CardTitle className=\"text-white flex items-center gap-2\">\n                  <MessageSquare className=\"w-5 h-5\" />\n                  المحادثة\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"flex flex-col flex-1 overflow-hidden p-4\">\n                <div className=\"flex-1 overflow-y-auto space-y-2 mb-3 pr-2\" style={{ maxHeight: 'calc(500px - 150px)' }}>\n                  {messages.map((msg: any) => (\n                    <div\n                      key={msg.id}\n                      className=\"bg-white/10 p-3 rounded-lg\"\n                      data-testid={`message-${msg.id}`}\n                    >\n                      <div className=\"flex items-center justify-between mb-1\">\n                        <span className=\"text-emerald-400 font-medium text-sm\">\n                          {msg.userName}\n                        </span>\n                        <span className=\"text-white/50 text-xs\">\n                          {msg.timestamp}\n                        </span>\n                      </div>\n                      <p className=\"text-white\">{msg.text}</p>\n                    </div>\n                  ))}\n                  {messages.length === 0 && (\n                    <div className=\"text-center text-white/60 py-8\">\n                      <MessageSquare className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                      <p>لا توجد رسائل بعد</p>\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"flex gap-2 flex-shrink-0\">\n                  <Input\n                    value={newMessage}\n                    onChange={(e) => setNewMessage(e.target.value)}\n                    onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}\n                    placeholder=\"اكتب رسالة...\"\n                    className=\"flex-1 bg-white/10 border-white/20 text-white placeholder:text-white/50\"\n                    data-testid=\"input-chat-message\"\n                  />\n                  <Button\n                    onClick={handleSendMessage}\n                    className=\"bg-emerald-600 hover:bg-emerald-700\"\n                    data-testid=\"button-send-message\"\n                  >\n                    <Send className=\"w-5 h-5\" />\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n\n      {/* Advanced Options Dialog */}\n      <Dialog open={showAdvancedOptions} onOpenChange={setShowAdvancedOptions}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>الإعدادات المتقدمة</DialogTitle>\n            <DialogDescription>\n              تحكم في إعدادات الصوت والفيديو والمشاركة\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-6 py-4\">\n            {/* Screen Share Options */}\n            <div className=\"space-y-3\">\n              <h4 className=\"text-sm font-semibold text-foreground\">مشاركة الشاشة</h4>\n              <div className=\"flex items-center justify-between\">\n                <Label htmlFor=\"screen-audio\" className=\"text-sm\">\n                  مشاركة صوت النظام\n                </Label>\n                <Switch id=\"screen-audio\" />\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <Label htmlFor=\"high-quality\" className=\"text-sm\">\n                  جودة عالية\n                </Label>\n                <Switch id=\"high-quality\" />\n              </div>\n            </div>\n\n            {/* Video Options */}\n            <div className=\"space-y-3 border-t pt-3\">\n              <h4 className=\"text-sm font-semibold text-foreground\">الفيديو</h4>\n              <div className=\"flex items-center justify-between\">\n                <Label htmlFor=\"hd-video\" className=\"text-sm\">\n                  فيديو عالي الدقة\n                </Label>\n                <Switch id=\"hd-video\" defaultChecked />\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <Label htmlFor=\"mirror-video\" className=\"text-sm\">\n                  عكس الفيديو\n                </Label>\n                <Switch id=\"mirror-video\" />\n              </div>\n            </div>\n\n            {/* Audio Options */}\n            <div className=\"space-y-3 border-t pt-3\">\n              <h4 className=\"text-sm font-semibold text-foreground\">الصوت</h4>\n              <div className=\"flex items-center justify-between\">\n                <Label htmlFor=\"noise-cancel\" className=\"text-sm\">\n                  إلغاء الضوضاء\n                </Label>\n                <Switch id=\"noise-cancel\" defaultChecked />\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <Label htmlFor=\"echo-cancel\" className=\"text-sm\">\n                  إلغاء الصدى\n                </Label>\n                <Switch id=\"echo-cancel\" defaultChecked />\n              </div>\n            </div>\n\n            {/* Session Info */}\n            <div className=\"space-y-2 border-t pt-3\">\n              <h4 className=\"text-sm font-semibold text-foreground\">معلومات الجلسة</h4>\n              <div className=\"text-sm text-muted-foreground space-y-1\">\n                <div className=\"flex justify-between\">\n                  <span>معرّف الغرفة:</span>\n                  <code className=\"bg-muted px-2 py-1 rounded text-xs\">{roomId.slice(0, 8)}...</code>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>الحالة:</span>\n                  <Badge variant={isConnected ? \"default\" : \"destructive\"} className=\"text-xs\">\n                    {isConnected ? 'متصل' : 'غير متصل'}\n                  </Badge>\n                </div>\n              </div>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":28418},"components/ui/Input.tsx":{"content":"import React from 'react';\nimport { cva, type VariantProps } from 'class-variance-authority';\nimport { cn } from '@/lib/utils';\nimport { AlertCircle, Check } from 'lucide-react';\n\nconst inputVariants = cva(\n  'flex w-full rounded-lg border bg-white px-4 py-2 text-base text-black transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-neutral-400 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-50 rtl:text-right',\n  {\n    variants: {\n      variant: {\n        default: 'border-neutral-300 focus-visible:ring-primary-500 focus-visible:border-primary-500',\n        error: 'border-error-500 focus-visible:ring-error-500 text-error-900',\n        success: 'border-success-500 focus-visible:ring-success-500 text-success-900',\n      },\n      inputSize: {\n        sm: 'h-9 text-sm px-3',\n        md: 'h-11 text-base px-4',\n        lg: 'h-13 text-lg px-5',\n      },\n    },\n    defaultVariants: {\n      variant: 'default',\n      inputSize: 'md',\n    },\n  }\n);\n\nexport interface InputProps\n  extends Omit<React.InputHTMLAttributes<HTMLInputElement>, 'size'>,\n    VariantProps<typeof inputVariants> {\n  label?: string;\n  error?: string;\n  success?: string;\n  hint?: string;\n  leftIcon?: React.ReactNode;\n  rightIcon?: React.ReactNode;\n  inputSize?: 'sm' | 'md' | 'lg';\n}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  (\n    {\n      className,\n      variant,\n      inputSize,\n      label,\n      error,\n      success,\n      hint,\n      leftIcon,\n      rightIcon,\n      id,\n      ...props\n    },\n    ref\n  ) => {\n    const inputId = id || label?.toLowerCase().replace(/\\s+/g, '-');\n    const showError = error && variant === 'error';\n    const showSuccess = success && variant === 'success';\n\n    return (\n      <div className=\"w-full space-y-1.5\">\n        {label && (\n          <label\n            htmlFor={inputId}\n            className=\"block text-sm font-medium text-black rtl:text-right\"\n          >\n            {label}\n          </label>\n        )}\n        <div className=\"relative\">\n          {leftIcon && (\n            <div className=\"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400 rtl:left-auto rtl:right-3\">\n              {leftIcon}\n            </div>\n          )}\n          <input\n            id={inputId}\n            className={cn(\n              inputVariants({ variant, inputSize }),\n              leftIcon && 'pl-10 rtl:pr-10 rtl:pl-4',\n              (rightIcon || showError || showSuccess) && 'pr-10 rtl:pl-10 rtl:pr-4',\n              className\n            )}\n            ref={ref}\n            aria-invalid={showError ? true : undefined}\n            aria-describedby={\n              showError\n                ? `${inputId}-error`\n                : showSuccess\n                ? `${inputId}-success`\n                : hint\n                ? `${inputId}-hint`\n                : undefined\n            }\n            {...props}\n          />\n          {showError && (\n            <div className=\"absolute right-3 top-1/2 -translate-y-1/2 text-error-500 rtl:right-auto rtl:left-3\">\n              <AlertCircle className=\"h-5 w-5\" aria-hidden=\"true\" />\n            </div>\n          )}\n          {showSuccess && (\n            <div className=\"absolute right-3 top-1/2 -translate-y-1/2 text-success-500 rtl:right-auto rtl:left-3\">\n              <Check className=\"h-5 w-5\" aria-hidden=\"true\" />\n            </div>\n          )}\n          {!showError && !showSuccess && rightIcon && (\n            <div className=\"absolute right-3 top-1/2 -translate-y-1/2 text-neutral-400 rtl:right-auto rtl:left-3\">\n              {rightIcon}\n            </div>\n          )}\n        </div>\n        {showError && (\n          <p id={`${inputId}-error`} className=\"text-sm text-error-600 rtl:text-right\" role=\"alert\">\n            {error}\n          </p>\n        )}\n        {showSuccess && (\n          <p id={`${inputId}-success`} className=\"text-sm text-success-600 rtl:text-right\">\n            {success}\n          </p>\n        )}\n        {hint && !showError && !showSuccess && (\n          <p id={`${inputId}-hint`} className=\"text-sm text-neutral-500 rtl:text-right\">\n            {hint}\n          </p>\n        )}\n      </div>\n    );\n  }\n);\n\nInput.displayName = 'Input';\n\nexport default Input;\n","size_bytes":4304},"components/Navigation.tsx":{"content":"'use client'\n\nimport Link from 'next/link'\nimport { usePathname } from 'next/navigation'\nimport ThemeToggle from './ThemeToggle'\nimport LanguageToggle from './LanguageToggle'\nimport { useTranslation } from '@/lib/hooks/useTranslation'\n\ninterface NavigationProps {\n  isAuthenticated?: boolean\n  userRole?: string\n}\n\nexport default function Navigation({ isAuthenticated = false, userRole }: NavigationProps) {\n  const pathname = usePathname()\n  const { t } = useTranslation()\n  \n  return (\n    <nav className=\"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 sticky top-0 z-50\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div className=\"flex items-center justify-between h-16\">\n          <div className=\"flex items-center gap-8\">\n            <Link href=\"/\" className=\"flex items-center\">\n              <h1 className=\"text-xl sm:text-2xl font-bold text-[#004E89] dark:text-blue-400\">\n                Youspeak\n              </h1>\n            </Link>\n            \n            {!isAuthenticated && (\n              <div className=\"hidden md:flex items-center gap-6\">\n                <Link \n                  href=\"/\" \n                  className={`text-sm font-medium hover:text-[#004E89] dark:hover:text-blue-400 transition-colors ${pathname === '/' ? 'text-[#004E89] dark:text-blue-400' : 'text-gray-700 dark:text-gray-300'}`}\n                >\n                  {t('home')}\n                </Link>\n                <Link \n                  href=\"/packages\" \n                  className={`text-sm font-medium hover:text-[#004E89] dark:hover:text-blue-400 transition-colors ${pathname === '/packages' ? 'text-[#004E89] dark:text-blue-400' : 'text-gray-700 dark:text-gray-300'}`}\n                >\n                  {t('packages')}\n                </Link>\n              </div>\n            )}\n          </div>\n\n          <div className=\"flex items-center gap-3\">\n            <ThemeToggle />\n            <LanguageToggle />\n            \n            {isAuthenticated ? (\n              <Link\n                href=\"/dashboard\"\n                className=\"px-4 py-2 bg-[#004E89] dark:bg-blue-600 text-white rounded-lg hover:bg-[#003A6A] dark:hover:bg-blue-700 transition-colors text-sm font-medium\"\n              >\n                {t('dashboard')}\n              </Link>\n            ) : (\n              <Link\n                href=\"/auth/login\"\n                className=\"px-4 py-2 bg-[#004E89] dark:bg-blue-600 text-white rounded-lg hover:bg-[#003A6A] dark:hover:bg-blue-700 transition-colors text-sm font-medium\"\n              >\n                {t('login')}\n              </Link>\n            )}\n          </div>\n        </div>\n      </div>\n    </nav>\n  )\n}\n","size_bytes":2693},"app/api/teacher/students/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'TEACHER') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const teacherProfile = await prisma.teacherProfile.findUnique({\n      where: { userId: session.user.id }\n    })\n\n    if (!teacherProfile) {\n      return NextResponse.json({ error: 'Teacher profile not found' }, { status: 404 })\n    }\n\n    const studentEnrollments = await prisma.sessionStudent.findMany({\n      where: {\n        Session: {\n          teacherId: teacherProfile.id\n        }\n      },\n      include: {\n        User: {\n          include: {\n            StudentProfile: true\n          }\n        }\n      }\n    })\n\n    const uniqueStudents = new Map()\n    for (const enrollment of studentEnrollments) {\n      if (!uniqueStudents.has(enrollment.studentId)) {\n        const [sessionsCount, wordsCount] = await Promise.all([\n          prisma.sessionStudent.count({\n            where: {\n              studentId: enrollment.studentId,\n              Session: { teacherId: teacherProfile.id }\n            }\n          }),\n          prisma.word.count({\n            where: { studentId: enrollment.studentId }\n          })\n        ])\n\n        uniqueStudents.set(enrollment.studentId, {\n          id: enrollment.User.id,\n          name: enrollment.User.name,\n          email: enrollment.User.email,\n          phone: enrollment.User.phone,\n          isActive: enrollment.User.isActive,\n          studentProfile: {\n            levelCurrent: enrollment.User.StudentProfile?.levelCurrent,\n            sessionsAttended: 0\n          },\n          sessionsCount,\n          wordsCount\n        })\n      }\n    }\n\n    return NextResponse.json(Array.from(uniqueStudents.values()))\n  } catch (error) {\n    console.error('Error fetching students:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":2161},"app/layout.tsx":{"content":"import type { Metadata } from \"next\";\nimport { Geist, Geist_Mono } from \"next/font/google\";\nimport \"./globals.css\";\nimport { ThemeProvider } from \"@/lib/contexts/ThemeContext\";\nimport SessionProvider from \"@/lib/providers/SessionProvider\";\nimport SplashScreen from \"@/components/SplashScreen\";\n\nconst geistSans = Geist({\n  variable: \"--font-geist-sans\",\n  subsets: [\"latin\"],\n});\n\nconst geistMono = Geist_Mono({\n  variable: \"--font-geist-mono\",\n  subsets: [\"latin\"],\n});\n\nexport const metadata: Metadata = {\n  title: \"Youspeak - Learn English with Mister Youssef\",\n  description: \"Professional online English learning platform with live interactive classes\",\n};\n\nexport default function RootLayout({\n  children,\n}: Readonly<{\n  children: React.ReactNode;\n}>) {\n  return (\n    <html lang=\"ar\" suppressHydrationWarning>\n      <body\n        className={`${geistSans.variable} ${geistMono.variable} antialiased`}\n        suppressHydrationWarning\n      >\n        <SessionProvider>\n          <ThemeProvider>\n            <SplashScreen />\n            {children}\n          </ThemeProvider>\n        </SessionProvider>\n      </body>\n    </html>\n  );\n}\n","size_bytes":1140},"app/ui-showcase/page.tsx":{"content":"'use client';\n\nimport { useState } from 'react';\nimport Button from '@/components/ui/Button';\nimport Input from '@/components/ui/Input';\nimport Card from '@/components/ui/Card';\nimport Modal from '@/components/ui/Modal';\nimport Badge from '@/components/ui/Badge';\nimport LoadingSpinner from '@/components/ui/LoadingSpinner';\nimport Alert from '@/components/ui/Alert';\nimport Tabs from '@/components/ui/Tabs';\nimport { Table, TableHeader, TableBody, TableRow, TableHead, TableCell, TableCaption } from '@/components/ui/Table';\nimport Navbar, { NavLink } from '@/components/layout/Navbar';\nimport Sidebar, { SidebarItem } from '@/components/layout/Sidebar';\nimport Footer from '@/components/layout/Footer';\nimport Container from '@/components/layout/Container';\nimport { \n  Home, \n  Settings, \n  Users, \n  Mail, \n  Lock, \n  Search,\n  ChevronRight,\n  Star,\n  Heart,\n  Download,\n  Upload,\n  Check\n} from 'lucide-react';\n\nexport default function UIShowcase() {\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [inputValue, setInputValue] = useState('');\n  const [showAlert, setShowAlert] = useState(true);\n  const [isRTL, setIsRTL] = useState(false);\n\n  return (\n    <div className={isRTL ? 'rtl' : 'ltr'} dir={isRTL ? 'rtl' : 'ltr'}>\n      <Navbar\n        logo={\n          <div className=\"flex items-center gap-2\">\n            <div className=\"h-8 w-8 rounded-lg bg-primary flex items-center justify-center\">\n              <span className=\"text-white font-bold text-sm\">YS</span>\n            </div>\n            <span className=\"font-semibold text-lg\">Youspeak UI</span>\n          </div>\n        }\n      >\n        <NavLink href=\"#components\" active>Components</NavLink>\n        <NavLink href=\"#layout\">Layout</NavLink>\n        <NavLink href=\"#theme\">Theme</NavLink>\n        <Button size=\"sm\" variant=\"primary\">Get Started</Button>\n      </Navbar>\n\n      <Container size=\"2xl\" className=\"py-12 space-y-16\">\n        <div className=\"text-center space-y-4\">\n          <h1 className=\"text-4xl sm:text-5xl font-bold text-neutral-900 dark:text-neutral-100\">\n            Youspeak UI Components\n          </h1>\n          <p className=\"text-lg text-neutral-600 dark:text-neutral-400 max-w-2xl mx-auto\">\n            Professional, accessible, and mobile-first UI components built with React, TypeScript, and Tailwind CSS 4\n          </p>\n          <div className=\"flex gap-4 justify-center items-center flex-wrap\">\n            <Button onClick={() => setIsRTL(!isRTL)}>\n              Toggle {isRTL ? 'LTR' : 'RTL'} Mode\n            </Button>\n            <Badge variant=\"success\" icon={<Check className=\"h-3 w-3\" />}>\n              100% Mobile Compatible\n            </Badge>\n            <Badge variant=\"info\">TypeScript</Badge>\n            <Badge variant=\"accent\">Accessible</Badge>\n          </div>\n        </div>\n\n        <section id=\"buttons\" className=\"space-y-6\">\n          <div>\n            <h2 className=\"text-3xl font-bold text-neutral-900 dark:text-neutral-100 mb-2\">Buttons</h2>\n            <p className=\"text-neutral-600 dark:text-neutral-400\">Multiple variants and sizes with loading states</p>\n          </div>\n          \n          <Card>\n            <div className=\"space-y-6\">\n              <div>\n                <h3 className=\"text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-3\">Variants</h3>\n                <div className=\"flex flex-wrap gap-3\">\n                  <Button variant=\"primary\">Primary</Button>\n                  <Button variant=\"secondary\">Secondary</Button>\n                  <Button variant=\"accent\">Accent</Button>\n                  <Button variant=\"outline\">Outline</Button>\n                  <Button variant=\"ghost\">Ghost</Button>\n                  <Button variant=\"danger\">Danger</Button>\n                  <Button variant=\"success\">Success</Button>\n                </div>\n              </div>\n\n              <div>\n                <h3 className=\"text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-3\">Sizes</h3>\n                <div className=\"flex flex-wrap items-center gap-3\">\n                  <Button size=\"sm\">Small</Button>\n                  <Button size=\"md\">Medium</Button>\n                  <Button size=\"lg\">Large</Button>\n                  <Button size=\"xl\">Extra Large</Button>\n                </div>\n              </div>\n\n              <div>\n                <h3 className=\"text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-3\">With Icons & Loading</h3>\n                <div className=\"flex flex-wrap gap-3\">\n                  <Button leftIcon={<Download className=\"h-4 w-4\" />}>Download</Button>\n                  <Button rightIcon={<ChevronRight className=\"h-4 w-4\" />}>Continue</Button>\n                  <Button loading>Loading...</Button>\n                  <Button variant=\"outline\" disabled>Disabled</Button>\n                </div>\n              </div>\n\n              <div>\n                <h3 className=\"text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-3\">Full Width (Mobile)</h3>\n                <Button fullWidth variant=\"primary\">Full Width Button</Button>\n              </div>\n            </div>\n          </Card>\n        </section>\n\n        <section id=\"inputs\" className=\"space-y-6\">\n          <div>\n            <h2 className=\"text-3xl font-bold text-neutral-900 dark:text-neutral-100 mb-2\">Inputs</h2>\n            <p className=\"text-neutral-600 dark:text-neutral-400\">Form inputs with validation, icons, and error states</p>\n          </div>\n\n          <Card>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <Input\n                label=\"Email Address\"\n                type=\"email\"\n                placeholder=\"you@example.com\"\n                leftIcon={<Mail className=\"h-4 w-4\" />}\n                hint=\"We'll never share your email\"\n              />\n              \n              <Input\n                label=\"Password\"\n                type=\"password\"\n                placeholder=\"Enter password\"\n                leftIcon={<Lock className=\"h-4 w-4\" />}\n              />\n\n              <Input\n                label=\"Search\"\n                placeholder=\"Search...\"\n                leftIcon={<Search className=\"h-4 w-4\" />}\n                inputSize=\"lg\"\n              />\n\n              <Input\n                label=\"With Error\"\n                variant=\"error\"\n                error=\"This field is required\"\n                defaultValue=\"invalid@\"\n              />\n\n              <Input\n                label=\"With Success\"\n                variant=\"success\"\n                success=\"Email is available!\"\n                defaultValue=\"available@example.com\"\n              />\n\n              <Input\n                label=\"Small Size\"\n                inputSize=\"sm\"\n                placeholder=\"Small input\"\n              />\n            </div>\n          </Card>\n        </section>\n\n        <section id=\"cards\" className=\"space-y-6\">\n          <div>\n            <h2 className=\"text-3xl font-bold text-neutral-900 dark:text-neutral-100 mb-2\">Cards</h2>\n            <p className=\"text-neutral-600 dark:text-neutral-400\">Flexible content containers</p>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            <Card variant=\"default\">\n              <h3 className=\"font-semibold text-lg mb-2\">Default Card</h3>\n              <p className=\"text-neutral-600 dark:text-neutral-400\">\n                Simple card with default styling and medium padding.\n              </p>\n            </Card>\n\n            <Card variant=\"elevated\">\n              <h3 className=\"font-semibold text-lg mb-2\">Elevated Card</h3>\n              <p className=\"text-neutral-600 dark:text-neutral-400\">\n                Card with enhanced shadow on hover for emphasis.\n              </p>\n            </Card>\n\n            <Card variant=\"outlined\">\n              <h3 className=\"font-semibold text-lg mb-2\">Outlined Card</h3>\n              <p className=\"text-neutral-600 dark:text-neutral-400\">\n                Card with prominent border and no shadow.\n              </p>\n            </Card>\n          </div>\n\n          <Card\n            header={\n              <div>\n                <h3 className=\"font-semibold text-lg\">Card with Header & Footer</h3>\n                <p className=\"text-sm text-neutral-500 mt-1\">Optional header and footer sections</p>\n              </div>\n            }\n            footer={\n              <div className=\"flex gap-3 justify-end\">\n                <Button variant=\"ghost\" size=\"sm\">Cancel</Button>\n                <Button size=\"sm\">Save Changes</Button>\n              </div>\n            }\n          >\n            <p className=\"text-neutral-600 dark:text-neutral-400\">\n              This card demonstrates the header and footer props. Great for forms, dialogs, and structured content.\n            </p>\n          </Card>\n        </section>\n\n        <section id=\"badges\" className=\"space-y-6\">\n          <div>\n            <h2 className=\"text-3xl font-bold text-neutral-900 dark:text-neutral-100 mb-2\">Badges</h2>\n            <p className=\"text-neutral-600 dark:text-neutral-400\">Status indicators and labels</p>\n          </div>\n\n          <Card>\n            <div className=\"space-y-6\">\n              <div>\n                <h3 className=\"text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-3\">Variants</h3>\n                <div className=\"flex flex-wrap gap-2\">\n                  <Badge variant=\"primary\">Primary</Badge>\n                  <Badge variant=\"accent\">Accent</Badge>\n                  <Badge variant=\"success\">Success</Badge>\n                  <Badge variant=\"error\">Error</Badge>\n                  <Badge variant=\"warning\">Warning</Badge>\n                  <Badge variant=\"info\">Info</Badge>\n                  <Badge variant=\"neutral\">Neutral</Badge>\n                  <Badge variant=\"solid\">Solid</Badge>\n                </div>\n              </div>\n\n              <div>\n                <h3 className=\"text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-3\">Sizes</h3>\n                <div className=\"flex flex-wrap items-center gap-2\">\n                  <Badge size=\"sm\">Small</Badge>\n                  <Badge size=\"md\">Medium</Badge>\n                  <Badge size=\"lg\">Large</Badge>\n                </div>\n              </div>\n\n              <div>\n                <h3 className=\"text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-3\">With Icons</h3>\n                <div className=\"flex flex-wrap gap-2\">\n                  <Badge variant=\"success\" icon={<Check className=\"h-3 w-3\" />}>Completed</Badge>\n                  <Badge variant=\"error\" icon={<Star className=\"h-3 w-3\" />}>Featured</Badge>\n                  <Badge variant=\"info\" icon={<Heart className=\"h-3 w-3\" />}>Favorite</Badge>\n                </div>\n              </div>\n            </div>\n          </Card>\n        </section>\n\n        <section id=\"alerts\" className=\"space-y-6\">\n          <div>\n            <h2 className=\"text-3xl font-bold text-neutral-900 dark:text-neutral-100 mb-2\">Alerts</h2>\n            <p className=\"text-neutral-600 dark:text-neutral-400\">Contextual feedback messages</p>\n          </div>\n\n          <div className=\"space-y-4\">\n            <Alert variant=\"info\" title=\"Information\">\n              This is an informational alert with a title and description.\n            </Alert>\n\n            <Alert variant=\"success\" title=\"Success!\">\n              Your changes have been saved successfully.\n            </Alert>\n\n            <Alert variant=\"warning\" title=\"Warning\">\n              Please review your input before proceeding.\n            </Alert>\n\n            {showAlert && (\n              <Alert \n                variant=\"error\" \n                title=\"Error\" \n                dismissible \n                onDismiss={() => setShowAlert(false)}\n              >\n                An error occurred. Please try again later.\n              </Alert>\n            )}\n          </div>\n        </section>\n\n        <section id=\"loading\" className=\"space-y-6\">\n          <div>\n            <h2 className=\"text-3xl font-bold text-neutral-900 dark:text-neutral-100 mb-2\">Loading Spinners</h2>\n            <p className=\"text-neutral-600 dark:text-neutral-400\">Loading states and indicators</p>\n          </div>\n\n          <Card>\n            <div className=\"space-y-6\">\n              <div>\n                <h3 className=\"text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-3\">Sizes</h3>\n                <div className=\"flex flex-wrap items-center gap-6\">\n                  <LoadingSpinner size=\"xs\" />\n                  <LoadingSpinner size=\"sm\" />\n                  <LoadingSpinner size=\"md\" />\n                  <LoadingSpinner size=\"lg\" />\n                  <LoadingSpinner size=\"xl\" />\n                </div>\n              </div>\n\n              <div>\n                <h3 className=\"text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-3\">Variants</h3>\n                <div className=\"flex flex-wrap gap-6\">\n                  <LoadingSpinner variant=\"primary\" label=\"Loading...\" />\n                  <LoadingSpinner variant=\"accent\" label=\"Processing...\" />\n                  <LoadingSpinner variant=\"neutral\" label=\"Please wait...\" />\n                </div>\n              </div>\n            </div>\n          </Card>\n        </section>\n\n        <section id=\"tabs\" className=\"space-y-6\">\n          <div>\n            <h2 className=\"text-3xl font-bold text-neutral-900 dark:text-neutral-100 mb-2\">Tabs</h2>\n            <p className=\"text-neutral-600 dark:text-neutral-400\">Organize content into switchable views</p>\n          </div>\n\n          <Card>\n            <Tabs defaultValue=\"overview\">\n              <Tabs.List>\n                <Tabs.Trigger value=\"overview\">Overview</Tabs.Trigger>\n                <Tabs.Trigger value=\"features\">Features</Tabs.Trigger>\n                <Tabs.Trigger value=\"pricing\">Pricing</Tabs.Trigger>\n                <Tabs.Trigger value=\"support\">Support</Tabs.Trigger>\n              </Tabs.List>\n              <Tabs.Content value=\"overview\">\n                <h3 className=\"font-semibold text-lg mb-2\">Overview</h3>\n                <p className=\"text-neutral-600 dark:text-neutral-400\">\n                  Welcome to the overview section. This is where you'll find general information about our services.\n                </p>\n              </Tabs.Content>\n              <Tabs.Content value=\"features\">\n                <h3 className=\"font-semibold text-lg mb-2\">Features</h3>\n                <ul className=\"list-disc list-inside space-y-2 text-neutral-600 dark:text-neutral-400\">\n                  <li>Fully responsive design</li>\n                  <li>TypeScript support</li>\n                  <li>Accessibility built-in</li>\n                  <li>RTL language support</li>\n                </ul>\n              </Tabs.Content>\n              <Tabs.Content value=\"pricing\">\n                <h3 className=\"font-semibold text-lg mb-2\">Pricing</h3>\n                <p className=\"text-neutral-600 dark:text-neutral-400\">\n                  Our pricing is competitive and transparent. Contact us for more information.\n                </p>\n              </Tabs.Content>\n              <Tabs.Content value=\"support\">\n                <h3 className=\"font-semibold text-lg mb-2\">Support</h3>\n                <p className=\"text-neutral-600 dark:text-neutral-400\">\n                  24/7 customer support available. Reach out anytime you need help.\n                </p>\n              </Tabs.Content>\n            </Tabs>\n          </Card>\n        </section>\n\n        <section id=\"tables\" className=\"space-y-6\">\n          <div>\n            <h2 className=\"text-3xl font-bold text-neutral-900 dark:text-neutral-100 mb-2\">Tables</h2>\n            <p className=\"text-neutral-600 dark:text-neutral-400\">Responsive data tables</p>\n          </div>\n\n          <Table>\n            <TableCaption>A list of recent students</TableCaption>\n            <TableHeader>\n              <TableRow>\n                <TableHead>Name</TableHead>\n                <TableHead>Email</TableHead>\n                <TableHead>Status</TableHead>\n                <TableHead className=\"text-right rtl:text-left\">Progress</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              <TableRow>\n                <TableCell className=\"font-medium\">Ahmed Ali</TableCell>\n                <TableCell>ahmed@example.com</TableCell>\n                <TableCell>\n                  <Badge variant=\"success\" size=\"sm\">Active</Badge>\n                </TableCell>\n                <TableCell className=\"text-right rtl:text-left\">75%</TableCell>\n              </TableRow>\n              <TableRow>\n                <TableCell className=\"font-medium\">Sara Mohammed</TableCell>\n                <TableCell>sara@example.com</TableCell>\n                <TableCell>\n                  <Badge variant=\"success\" size=\"sm\">Active</Badge>\n                </TableCell>\n                <TableCell className=\"text-right rtl:text-left\">92%</TableCell>\n              </TableRow>\n              <TableRow>\n                <TableCell className=\"font-medium\">Omar Hassan</TableCell>\n                <TableCell>omar@example.com</TableCell>\n                <TableCell>\n                  <Badge variant=\"warning\" size=\"sm\">Pending</Badge>\n                </TableCell>\n                <TableCell className=\"text-right rtl:text-left\">45%</TableCell>\n              </TableRow>\n              <TableRow>\n                <TableCell className=\"font-medium\">Fatima Zaid</TableCell>\n                <TableCell>fatima@example.com</TableCell>\n                <TableCell>\n                  <Badge variant=\"success\" size=\"sm\">Active</Badge>\n                </TableCell>\n                <TableCell className=\"text-right rtl:text-left\">88%</TableCell>\n              </TableRow>\n            </TableBody>\n          </Table>\n        </section>\n\n        <section id=\"modal\" className=\"space-y-6\">\n          <div>\n            <h2 className=\"text-3xl font-bold text-neutral-900 dark:text-neutral-100 mb-2\">Modal</h2>\n            <p className=\"text-neutral-600 dark:text-neutral-400\">Accessible dialog windows</p>\n          </div>\n\n          <Card>\n            <div className=\"flex flex-wrap gap-3\">\n              <Button onClick={() => setIsModalOpen(true)}>Open Modal</Button>\n            </div>\n          </Card>\n\n          <Modal\n            isOpen={isModalOpen}\n            onClose={() => setIsModalOpen(false)}\n            title=\"Welcome to Youspeak\"\n            description=\"Join thousands of students learning English\"\n            size=\"md\"\n            footer={\n              <div className=\"flex gap-3 justify-end\">\n                <Button variant=\"ghost\" onClick={() => setIsModalOpen(false)}>\n                  Cancel\n                </Button>\n                <Button onClick={() => setIsModalOpen(false)}>\n                  Get Started\n                </Button>\n              </div>\n            }\n          >\n            <div className=\"space-y-4\">\n              <p className=\"text-neutral-600 dark:text-neutral-400\">\n                Start your English learning journey today with interactive classes, \n                professional instructors, and a supportive community.\n              </p>\n              <Input\n                label=\"Enter your email\"\n                type=\"email\"\n                placeholder=\"you@example.com\"\n                leftIcon={<Mail className=\"h-4 w-4\" />}\n              />\n            </div>\n          </Modal>\n        </section>\n\n        <section id=\"layout\" className=\"space-y-6\">\n          <div>\n            <h2 className=\"text-3xl font-bold text-neutral-900 dark:text-neutral-100 mb-2\">Layout Components</h2>\n            <p className=\"text-neutral-600 dark:text-neutral-400\">Structural components for page layout</p>\n          </div>\n\n          <Card>\n            <div className=\"space-y-6\">\n              <div>\n                <h3 className=\"font-semibold text-lg mb-3\">Sidebar Example</h3>\n                <div className=\"h-64 border-2 border-dashed border-neutral-300 dark:border-neutral-700 rounded-lg overflow-hidden flex\">\n                  <Sidebar\n                    header={<div className=\"font-semibold\">Menu</div>}\n                    footer={<div className=\"text-xs text-neutral-500\">v1.0.0</div>}\n                  >\n                    <SidebarItem icon={<Home className=\"h-4 w-4\" />} active>\n                      Home\n                    </SidebarItem>\n                    <SidebarItem icon={<Users className=\"h-4 w-4\" />}>\n                      Students\n                    </SidebarItem>\n                    <SidebarItem icon={<Settings className=\"h-4 w-4\" />}>\n                      Settings\n                    </SidebarItem>\n                  </Sidebar>\n                  <div className=\"flex-1 p-6 bg-neutral-50 dark:bg-neutral-900/50\">\n                    <p className=\"text-neutral-600 dark:text-neutral-400\">Main content area</p>\n                  </div>\n                </div>\n              </div>\n\n              <div>\n                <h3 className=\"font-semibold text-lg mb-3\">Container Sizes</h3>\n                <div className=\"space-y-3\">\n                  <Container size=\"sm\" padding=\"sm\" className=\"bg-primary-50 dark:bg-primary-900/20 py-2\">\n                    <p className=\"text-sm\">Small container (max-w-screen-sm)</p>\n                  </Container>\n                  <Container size=\"md\" padding=\"sm\" className=\"bg-accent-50 dark:bg-accent-900/20 py-2\">\n                    <p className=\"text-sm\">Medium container (max-w-screen-md)</p>\n                  </Container>\n                  <Container size=\"lg\" padding=\"sm\" className=\"bg-success-50 dark:bg-success-900/20 py-2\">\n                    <p className=\"text-sm\">Large container (max-w-screen-lg)</p>\n                  </Container>\n                </div>\n              </div>\n            </div>\n          </Card>\n        </section>\n      </Container>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":21895},"lib/prisma.ts":{"content":"import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nconst getDatabaseUrl = () => {\n  const url = process.env.DATABASE_URL || process.env.EXTERNAL_DATABASE_URL;\n  \n  if (!url) {\n    const awsDbHost = process.env.AWS_DB_HOST;\n    const awsDbPort = process.env.AWS_DB_PORT;\n    const awsDbName = process.env.AWS_DB_NAME;\n    const awsDbUser = process.env.AWS_DB_USER;\n    const awsDbPassword = process.env.AWS_DB_PASSWORD;\n    \n    if (awsDbHost && awsDbPort && awsDbName && awsDbUser && awsDbPassword) {\n      return `postgresql://${awsDbUser}:${awsDbPassword}@${awsDbHost}:${awsDbPort}/${awsDbName}?schema=youspeak_exercisein`;\n    }\n    \n    if (process.env.NODE_ENV === 'production') {\n      throw new Error('DATABASE_URL is required in production. Set DATABASE_URL or all AWS_DB_* variables.');\n    }\n    \n    return 'postgresql://user:password@localhost:5432/db?schema=youspeak_exercisein';\n  }\n  \n  return url;\n};\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient({\n  datasources: {\n    db: {\n      url: getDatabaseUrl(),\n    },\n  },\n})\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n","size_bytes":1217},"app/globals.css":{"content":"@import \"tailwindcss\";\n\n:root {\n  --background: #F5F1E8;\n  --foreground: #000000;\n  \n  --primary: #004E89;\n  --primary-foreground: #ffffff;\n  \n  --accent: #FFD700;\n  --accent-foreground: #000000;\n  \n  --success: #22c55e;\n  --error: #ef4444;\n  --warning: #f59e0b;\n  --info: #3b82f6;\n  \n  --border: #d4c9b8;\n  --radius: 0.5rem;\n  \n  --card-bg: #F5F1E8;\n}\n\n@theme inline {\n  --color-background: var(--background);\n  --color-foreground: var(--foreground);\n  --font-sans: var(--font-geist-sans);\n  --font-mono: var(--font-geist-mono);\n}\n\n.dark {\n  --background: #F5F1E8;\n  --foreground: #000000;\n  --border: #d4c9b8;\n  --primary: #004E89;\n  --primary-foreground: #ffffff;\n  --card-bg: #F5F1E8;\n  --input-bg: #ffffff;\n  --accent: #FFD700;\n  --success: #22c55e;\n  --error: #ef4444;\n  --warning: #f59e0b;\n  --info: #004E89;\n}\n\n:root.dark {\n  color-scheme: light;\n}\n\n@media (prefers-color-scheme: dark) {\n  :root {\n    --background: #F5F1E8;\n    --foreground: #000000;\n    --border: #d4c9b8;\n  }\n}\n\nbody {\n  background: #F5F1E8 !important;\n  color: #000000 !important;\n  font-family: Arial, Helvetica, sans-serif;\n  transition: background-color 0.3s ease, color 0.3s ease;\n}\n\n.text-auto-contrast {\n  color: #000000;\n}\n\n.bg-auto-contrast {\n  background: var(--background);\n}\n\nh1, h2, h3, h4, h5, h6, p, span, div, label {\n  color: #000000;\n}\n\n* {\n  scroll-behavior: smooth;\n}\n\n[dir=\"rtl\"] {\n  direction: rtl;\n  text-align: right;\n}\n\n[dir=\"ltr\"] {\n  direction: ltr;\n  text-align: left;\n}\n\nhtml {\n  background: #F5F1E8 !important;\n}\n\nmain, section, div, header, footer {\n  background-color: transparent;\n}\n\n.dark body,\n.dark main,\n.dark section {\n  background: #F5F1E8 !important;\n  color: #000000 !important;\n}\n\n@supports (font-variation-settings: normal) {\n  body {\n    font-family: var(--font-sans), system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif;\n  }\n}\n\n@layer utilities {\n  .text-balance {\n    text-wrap: balance;\n  }\n}\n\n@keyframes fade-out {\n  0% {\n    opacity: 1;\n  }\n  80% {\n    opacity: 1;\n  }\n  100% {\n    opacity: 0;\n    visibility: hidden;\n  }\n}\n\n.animate-fade-out {\n  animation: fade-out 2.5s ease-in-out forwards;\n}\n\n@media (max-width: 640px) {\n  .container {\n    padding-left: 1rem;\n    padding-right: 1rem;\n  }\n  \n  h1 {\n    font-size: 1.5rem;\n  }\n  \n  h2 {\n    font-size: 1.25rem;\n  }\n  \n  h3 {\n    font-size: 1.125rem;\n  }\n}\n\n::-webkit-scrollbar {\n  width: 10px;\n  height: 10px;\n}\n\n::-webkit-scrollbar-track {\n  background: #f1f1f1;\n}\n\n::-webkit-scrollbar-thumb {\n  background: #888;\n  border-radius: 5px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: #555;\n}\n\n.dark ::-webkit-scrollbar-track {\n  background: #1e293b;\n}\n\n.dark ::-webkit-scrollbar-thumb {\n  background: #475569;\n}\n\n.dark ::-webkit-scrollbar-thumb:hover {\n  background: #64748b;\n}\n","size_bytes":2812},"components/SplashScreen.tsx":{"content":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport Image from 'next/image';\nimport { motion } from 'framer-motion';\n\nexport default function SplashScreen() {\n  const [isVisible, setIsVisible] = useState(true);\n  const [currentStep, setCurrentStep] = useState(0);\n\n  useEffect(() => {\n    const timer1 = setTimeout(() => setCurrentStep(1), 800);\n    const timer2 = setTimeout(() => setCurrentStep(2), 1600);\n    const timer3 = setTimeout(() => setCurrentStep(3), 2400);\n    const timer4 = setTimeout(() => setIsVisible(false), 4000);\n\n    return () => {\n      clearTimeout(timer1);\n      clearTimeout(timer2);\n      clearTimeout(timer3);\n      clearTimeout(timer4);\n    };\n  }, []);\n\n  if (!isVisible) return null;\n\n  const steps = [\n    { text: 'Your', color: '#000000' },\n    { text: 'English', color: '#004E89' },\n    { text: 'Steps', color: '#000000' }\n  ];\n\n  return (\n    <div className=\"fixed inset-0 z-[9999] flex items-center justify-center overflow-hidden\" style={{ backgroundColor: '#F5F1E8' }}>\n      \n      <div className=\"text-center relative z-10\">\n        <motion.div\n          initial={{ scale: 0, rotate: -180, opacity: 0 }}\n          animate={{ scale: 1, rotate: 0, opacity: 1 }}\n          transition={{ duration: 0.7, ease: \"easeOut\" }}\n          className=\"mb-12 flex justify-center\"\n        >\n          <div className=\"relative\">\n            <motion.div\n              className=\"absolute inset-0 bg-gradient-to-br from-[#004E89] to-[#0066CC] blur-3xl opacity-30 rounded-full\"\n              animate={{ scale: [1, 1.3, 1] }}\n              transition={{ duration: 2, repeat: Infinity, ease: \"easeInOut\" }}\n            />\n            <div className=\"w-36 h-36 bg-white rounded-3xl shadow-2xl flex items-center justify-center relative overflow-hidden\">\n              <div className=\"absolute inset-0 bg-gradient-to-br from-[#004E89]/5 to-transparent\"></div>\n              <Image\n                src=\"/logo.png\"\n                alt=\"Youspeak Logo\"\n                width={110}\n                height={110}\n                className=\"relative z-10\"\n                style={{ width: 'auto', height: 'auto' }}\n                priority\n              />\n            </div>\n          </div>\n        </motion.div>\n\n        <motion.h1\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.3, duration: 0.6 }}\n          className=\"text-7xl font-extrabold mb-12 bg-gradient-to-r from-[#004E89] to-[#0066CC] bg-clip-text text-transparent\"\n        >\n          Youspeak\n        </motion.h1>\n\n        <div className=\"flex flex-col items-center justify-center gap-2 mb-12 min-h-[200px]\">\n          {steps.map((step, index) => (\n            currentStep >= index && (\n              <motion.div\n                key={index}\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ \n                  duration: 0.5,\n                  ease: \"easeOut\"\n                }}\n                className=\"text-5xl font-extrabold tracking-wide\"\n                style={{ color: step.color }}\n              >\n                {step.text.split('').map((char, charIndex) => (\n                  <motion.span\n                    key={charIndex}\n                    initial={{ opacity: 0 }}\n                    animate={{ opacity: 1 }}\n                    transition={{\n                      delay: charIndex * 0.05,\n                      duration: 0.1\n                    }}\n                  >\n                    {char}\n                  </motion.span>\n                ))}\n              </motion.div>\n            )\n          ))}\n        </div>\n\n        <div className=\"flex items-center justify-center gap-3 mb-8\">\n          {[0, 1, 2].map((i) => (\n            <motion.div\n              key={i}\n              initial={{ width: 12, height: 12, backgroundColor: '#d1c4b0' }}\n              animate={{\n                width: currentStep >= i ? 60 : 12,\n                height: currentStep >= i ? 12 : 12,\n                backgroundColor: currentStep >= i ? '#004E89' : '#d1c4b0'\n              }}\n              transition={{ duration: 0.4, ease: \"easeInOut\" }}\n              className=\"rounded-full shadow-lg\"\n            />\n          ))}\n        </div>\n\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: [0, 0.7, 0] }}\n          transition={{ duration: 1.2, repeat: Infinity }}\n          className=\"text-gray-700 text-lg font-semibold tracking-wide\"\n        >\n          جاري التحميل • Loading...\n        </motion.div>\n      </div>\n\n      {/* Decorative Elements */}\n      <motion.div\n        className=\"absolute top-16 left-16 text-6xl opacity-10\"\n        animate={{ \n          rotate: [0, 15, -15, 0],\n          y: [0, -10, 0]\n        }}\n        transition={{ duration: 4, repeat: Infinity, ease: \"easeInOut\" }}\n      >\n        📚\n      </motion.div>\n      <motion.div\n        className=\"absolute bottom-20 right-20 text-5xl opacity-10\"\n        animate={{ \n          rotate: [0, -20, 20, 0],\n          scale: [1, 1.2, 1]\n        }}\n        transition={{ duration: 3, repeat: Infinity, ease: \"easeInOut\" }}\n      >\n        ✨\n      </motion.div>\n      <motion.div\n        className=\"absolute top-1/3 right-1/4 text-4xl opacity-10\"\n        animate={{ \n          y: [-15, 15, -15],\n          x: [-10, 10, -10]\n        }}\n        transition={{ duration: 5, repeat: Infinity, ease: \"easeInOut\" }}\n      >\n        🎓\n      </motion.div>\n      <motion.div\n        className=\"absolute bottom-1/3 left-1/4 text-5xl opacity-10\"\n        animate={{ \n          rotate: [0, 360],\n          scale: [1, 1.1, 1]\n        }}\n        transition={{ duration: 8, repeat: Infinity, ease: \"linear\" }}\n      >\n        🌟\n      </motion.div>\n      \n      {/* Geometric Decorations */}\n      <div className=\"absolute top-32 right-32 w-20 h-20 border-4 border-[#004E89]/10 rounded-lg rotate-12\"></div>\n      <div className=\"absolute bottom-40 left-20 w-16 h-16 border-4 border-[#004E89]/10 rounded-full\"></div>\n    </div>\n  );\n}\n","size_bytes":6077},"app/api/words/import/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\nimport { v4 as uuidv4 } from 'uuid'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'STUDENT') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const { words } = await request.json()\n\n    if (!words || !Array.isArray(words)) {\n      return NextResponse.json({ error: 'Invalid words data' }, { status: 400 })\n    }\n\n    const createdWords = []\n\n    for (const word of words) {\n      const { englishWord, arabicMeaning, exampleSentence } = word\n\n      if (!englishWord) continue\n\n      let translation = arabicMeaning\n\n      if (!translation) {\n        try {\n          const response = await fetch(\n            `https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=ar&dt=t&q=${encodeURIComponent(englishWord)}`\n          )\n\n          if (response.ok) {\n            const data = await response.json()\n            translation = data[0]?.[0]?.[0] || englishWord\n          } else {\n            translation = englishWord\n          }\n        } catch (error) {\n          console.error('Translation failed for:', englishWord)\n          translation = englishWord\n        }\n      }\n\n      const created = await prisma.word.create({\n        data: {\n          id: uuidv4(),\n          studentId: session.user.id,\n          englishWord,\n          arabicMeaning: translation,\n          exampleSentence: exampleSentence || null,\n        },\n      })\n\n      createdWords.push({\n        ...created,\n        createdAt: created.createdAt.toISOString(),\n        updatedAt: created.updatedAt.toISOString(),\n      })\n    }\n\n    return NextResponse.json({ \n      success: true, \n      count: createdWords.length,\n      words: createdWords \n    })\n  } catch (error) {\n    console.error('Error importing words:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":2128},"components/layout/Sidebar.tsx":{"content":"'use client';\n\nimport React, { useState } from 'react';\nimport { cn } from '@/lib/utils';\nimport { ChevronLeft, ChevronRight } from 'lucide-react';\n\nexport interface SidebarProps {\n  children: React.ReactNode;\n  className?: string;\n  defaultCollapsed?: boolean;\n  collapsible?: boolean;\n  header?: React.ReactNode;\n  footer?: React.ReactNode;\n}\n\nconst Sidebar: React.FC<SidebarProps> = ({\n  children,\n  className,\n  defaultCollapsed = false,\n  collapsible = true,\n  header,\n  footer,\n}) => {\n  const [isCollapsed, setIsCollapsed] = useState(defaultCollapsed);\n\n  return (\n    <aside\n      className={cn(\n        'relative flex flex-col border-r border-neutral-200 bg-white dark:bg-neutral-900 dark:border-neutral-800 transition-all duration-300',\n        isCollapsed ? 'w-16' : 'w-64',\n        className\n      )}\n      aria-label=\"Sidebar\"\n    >\n      {header && (\n        <div className={cn('border-b border-neutral-200 dark:border-neutral-800 p-4', isCollapsed && 'px-2')}>\n          {header}\n        </div>\n      )}\n\n      <div className=\"flex-1 overflow-y-auto p-4\">\n        <nav className=\"space-y-1\">{children}</nav>\n      </div>\n\n      {footer && (\n        <div className={cn('border-t border-neutral-200 dark:border-neutral-800 p-4', isCollapsed && 'px-2')}>\n          {footer}\n        </div>\n      )}\n\n      {collapsible && (\n        <button\n          onClick={() => setIsCollapsed(!isCollapsed)}\n          className=\"absolute -right-3 top-8 z-10 flex h-6 w-6 items-center justify-center rounded-full border border-neutral-200 bg-white text-neutral-700 hover:bg-neutral-50 dark:bg-neutral-900 dark:border-neutral-800 dark:text-neutral-300 dark:hover:bg-neutral-800 transition-colors\"\n          aria-label={isCollapsed ? 'Expand sidebar' : 'Collapse sidebar'}\n          aria-expanded={!isCollapsed}\n        >\n          {isCollapsed ? (\n            <ChevronRight className=\"h-4 w-4 rtl:rotate-180\" aria-hidden=\"true\" />\n          ) : (\n            <ChevronLeft className=\"h-4 w-4 rtl:rotate-180\" aria-hidden=\"true\" />\n          )}\n        </button>\n      )}\n    </aside>\n  );\n};\n\nexport interface SidebarItemProps {\n  icon?: React.ReactNode;\n  children: React.ReactNode;\n  active?: boolean;\n  href?: string;\n  onClick?: () => void;\n  className?: string;\n}\n\nexport const SidebarItem: React.FC<SidebarItemProps> = ({\n  icon,\n  children,\n  active = false,\n  href,\n  onClick,\n  className,\n}) => {\n  const Component = href ? 'a' : 'button';\n\n  return (\n    <Component\n      href={href}\n      onClick={onClick}\n      className={cn(\n        'flex w-full items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium transition-colors rtl:flex-row-reverse',\n        active\n          ? 'bg-primary-50 text-primary dark:bg-primary-900/20'\n          : 'text-neutral-700 hover:bg-neutral-100 dark:text-neutral-300 dark:hover:bg-neutral-800',\n        className\n      )}\n      aria-current={active ? 'page' : undefined}\n    >\n      {icon && <span className=\"flex-shrink-0\" aria-hidden=\"true\">{icon}</span>}\n      <span className=\"truncate\">{children}</span>\n    </Component>\n  );\n};\n\nexport default Sidebar;\n","size_bytes":3099},"app/api/translate/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { text, sourceLang = 'en', targetLang = 'ar' } = await request.json()\n\n    if (!text) {\n      return NextResponse.json({ error: 'Text is required' }, { status: 400 })\n    }\n\n    const response = await fetch(\n      `https://translate.googleapis.com/translate_a/single?client=gtx&sl=${sourceLang}&tl=${targetLang}&dt=t&q=${encodeURIComponent(text)}`\n    )\n\n    if (!response.ok) {\n      throw new Error('Translation failed')\n    }\n\n    const data = await response.json()\n    const translation = data[0]?.[0]?.[0] || text\n\n    return NextResponse.json({ translation })\n  } catch (error) {\n    console.error('Translation error:', error)\n    return NextResponse.json(\n      { error: 'Translation service unavailable' },\n      { status: 500 }\n    )\n  }\n}\n","size_bytes":875},"app/dashboard/admin/components/UsersTab.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { Users, UserPlus, CheckCircle, XCircle, Shield } from 'lucide-react'\nimport Card from '@/components/ui/Card'\nimport Badge from '@/components/ui/Badge'\nimport Button from '@/components/ui/Button'\nimport LoadingSpinner from '@/components/ui/LoadingSpinner'\nimport Alert from '@/components/ui/Alert'\nimport Modal from '@/components/ui/Modal'\nimport Input from '@/components/ui/Input'\n\ninterface User {\n  id: string\n  name: string\n  email: string\n  role: string\n  isActive: boolean\n  phone: string | null\n  createdAt: string\n}\n\nexport default function UsersTab() {\n  const [users, setUsers] = useState<User[]>([])\n  const [loading, setLoading] = useState(true)\n  const [filter, setFilter] = useState<'ALL' | 'STUDENT' | 'TEACHER'>('ALL')\n  const [showCreateTeacher, setShowCreateTeacher] = useState(false)\n  const [newTeacher, setNewTeacher] = useState({\n    name: '',\n    email: '',\n    password: '',\n    phone: '',\n    bio: ''\n  })\n  const [submitting, setSubmitting] = useState(false)\n\n  useEffect(() => {\n    fetchUsers()\n  }, [])\n\n  async function fetchUsers() {\n    try {\n      const response = await fetch('/api/admin/users')\n      if (response.ok) {\n        const data = await response.json()\n        setUsers(data)\n      }\n    } catch (error) {\n      console.error('Error fetching users:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  async function toggleUserStatus(userId: string, currentStatus: boolean) {\n    if (!confirm(`Are you sure you want to ${currentStatus ? 'deactivate' : 'activate'} this user?`)) {\n      return\n    }\n\n    try {\n      const response = await fetch(`/api/admin/users/${userId}/toggle`, {\n        method: 'PATCH'\n      })\n\n      if (response.ok) {\n        await fetchUsers()\n        alert('User status updated successfully')\n      } else {\n        alert('Failed to update user status')\n      }\n    } catch (error) {\n      console.error('Error updating user status:', error)\n      alert('Error updating user status')\n    }\n  }\n\n  async function handleCreateTeacher() {\n    if (!newTeacher.name || !newTeacher.email || !newTeacher.password) {\n      alert('Please fill in all required fields (name, email, password)')\n      return\n    }\n\n    setSubmitting(true)\n    try {\n      const response = await fetch('/api/admin/users', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(newTeacher)\n      })\n\n      if (response.ok) {\n        await fetchUsers()\n        setNewTeacher({ name: '', email: '', password: '', phone: '', bio: '' })\n        setShowCreateTeacher(false)\n        alert('Teacher account created successfully!')\n      } else {\n        const data = await response.json()\n        alert(data.error || 'Failed to create teacher')\n      }\n    } catch (error) {\n      console.error('Error creating teacher:', error)\n      alert('Error creating teacher')\n    } finally {\n      setSubmitting(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <LoadingSpinner size=\"lg\" />\n      </div>\n    )\n  }\n\n  const filteredUsers = users.filter(u => filter === 'ALL' || u.role === filter)\n  const students = users.filter(u => u.role === 'STUDENT')\n  const teachers = users.filter(u => u.role === 'TEACHER')\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <h2 className=\"text-3xl font-bold text-[#004E89]\">\n          Users / المستخدمين\n        </h2>\n        <Button\n          variant=\"primary\"\n          onClick={() => setShowCreateTeacher(true)}\n        >\n          <UserPlus className=\"h-4 w-4 mr-2\" />\n          Add Teacher / إضافة مدرس\n        </Button>\n      </div>\n\n      <div className=\"grid md:grid-cols-3 gap-4\">\n        <Card variant=\"elevated\">\n          <div className=\"text-center\">\n            <p className=\"text-2xl font-bold text-[#004E89]\">{users.length}</p>\n            <p className=\"text-sm text-gray-600\">Total Users / المستخدمين</p>\n          </div>\n        </Card>\n        <Card variant=\"elevated\">\n          <div className=\"text-center\">\n            <p className=\"text-2xl font-bold text-[#004E89]\">{students.length}</p>\n            <p className=\"text-sm text-gray-600\">Students / الطلاب</p>\n          </div>\n        </Card>\n        <Card variant=\"elevated\">\n          <div className=\"text-center\">\n            <p className=\"text-2xl font-bold text-[#004E89]\">{teachers.length}</p>\n            <p className=\"text-sm text-gray-600\">Teachers / المدرسين</p>\n          </div>\n        </Card>\n      </div>\n\n      <div className=\"flex gap-2\">\n        <Button\n          variant={filter === 'ALL' ? 'primary' : 'outline'}\n          onClick={() => setFilter('ALL')}\n        >\n          All ({users.length})\n        </Button>\n        <Button\n          variant={filter === 'STUDENT' ? 'primary' : 'outline'}\n          onClick={() => setFilter('STUDENT')}\n        >\n          Students ({students.length})\n        </Button>\n        <Button\n          variant={filter === 'TEACHER' ? 'primary' : 'outline'}\n          onClick={() => setFilter('TEACHER')}\n        >\n          Teachers ({teachers.length})\n        </Button>\n      </div>\n\n      <div className=\"space-y-4\">\n        {filteredUsers.length === 0 ? (\n          <Alert variant=\"info\">\n            <p>No users found.</p>\n          </Alert>\n        ) : (\n          filteredUsers.map((user) => (\n            <Card key={user.id} variant=\"elevated\">\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex items-start gap-3 flex-1\">\n                  <div className=\"w-12 h-12 bg-[#004E89] rounded-full flex items-center justify-center text-white text-lg font-bold\">\n                    {user.name?.charAt(0).toUpperCase()}\n                  </div>\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-1\">\n                      <h3 className=\"text-lg font-bold text-gray-900\">{user.name}</h3>\n                      <Badge variant={user.role === 'ADMIN' ? 'accent' : user.role === 'TEACHER' ? 'primary' : 'info'}>\n                        {user.role === 'ADMIN' && <Shield className=\"h-3 w-3 mr-1\" />}\n                        {user.role}\n                      </Badge>\n                      {user.isActive ? (\n                        <Badge variant=\"success\">\n                          <CheckCircle className=\"h-3 w-3 mr-1\" />\n                          Active\n                        </Badge>\n                      ) : (\n                        <Badge variant=\"warning\">\n                          <XCircle className=\"h-3 w-3 mr-1\" />\n                          Inactive\n                        </Badge>\n                      )}\n                    </div>\n                    <p className=\"text-sm text-gray-600 mb-1\">{user.email}</p>\n                    {user.phone && (\n                      <p className=\"text-sm text-gray-600\">Phone: {user.phone}</p>\n                    )}\n                    <p className=\"text-xs text-gray-500 mt-2\">\n                      Joined: {new Date(user.createdAt).toLocaleDateString('ar-EG')}\n                    </p>\n                  </div>\n                </div>\n                {user.role !== 'ADMIN' && (\n                  <Button\n                    variant={user.isActive ? 'outline' : 'primary'}\n                    size=\"sm\"\n                    onClick={() => toggleUserStatus(user.id, user.isActive)}\n                  >\n                    {user.isActive ? 'Deactivate / تعطيل' : 'Activate / تفعيل'}\n                  </Button>\n                )}\n              </div>\n            </Card>\n          ))\n        )}\n      </div>\n\n      {showCreateTeacher && (\n        <Modal\n          isOpen={true}\n          onClose={() => setShowCreateTeacher(false)}\n          title=\"Create New Teacher Account / إنشاء حساب مدرس جديد\"\n        >\n          <div className=\"space-y-4\">\n            <Input\n              label=\"Full Name / الاسم الكامل *\"\n              value={newTeacher.name}\n              onChange={(e) => setNewTeacher({ ...newTeacher, name: e.target.value })}\n              placeholder=\"e.g., Ahmed Hassan\"\n            />\n            <Input\n              label=\"Email Address / البريد الإلكتروني *\"\n              type=\"email\"\n              value={newTeacher.email}\n              onChange={(e) => setNewTeacher({ ...newTeacher, email: e.target.value })}\n              placeholder=\"teacher@example.com\"\n            />\n            <Input\n              label=\"Password / كلمة المرور *\"\n              type=\"password\"\n              value={newTeacher.password}\n              onChange={(e) => setNewTeacher({ ...newTeacher, password: e.target.value })}\n              placeholder=\"Secure password\"\n            />\n            <Input\n              label=\"Phone Number / رقم الهاتف (Optional)\"\n              value={newTeacher.phone}\n              onChange={(e) => setNewTeacher({ ...newTeacher, phone: e.target.value })}\n              placeholder=\"+966XXXXXXXXX\"\n            />\n            <div>\n              <label className=\"block text-sm font-medium text-gray-900 mb-2\">\n                Bio / السيرة الذاتية (Optional)\n              </label>\n              <textarea\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#004E89]\"\n                value={newTeacher.bio}\n                onChange={(e) => setNewTeacher({ ...newTeacher, bio: e.target.value })}\n                placeholder=\"Teacher background and experience...\"\n                rows={3}\n              />\n            </div>\n            <div className=\"flex gap-2\">\n              <Button\n                variant=\"primary\"\n                fullWidth\n                onClick={handleCreateTeacher}\n                disabled={submitting}\n              >\n                {submitting ? 'Creating...' : 'Create Teacher / إنشاء'}\n              </Button>\n              <Button\n                variant=\"outline\"\n                fullWidth\n                onClick={() => setShowCreateTeacher(false)}\n              >\n                Cancel / إلغاء\n              </Button>\n            </div>\n          </div>\n        </Modal>\n      )}\n    </div>\n  )\n}\n","size_bytes":10384},"components/FloatingContactButtons.tsx":{"content":"'use client'\n\nimport { useState } from 'react'\nimport { MessageCircle, Send, Mail, X, Clock } from 'lucide-react'\n\nexport default function FloatingContactButtons() {\n  const [isOpen, setIsOpen] = useState(false)\n  const [message, setMessage] = useState('')\n  \n  // تحديد ساعات العمل\n  const isWithinWorkingHours = () => {\n    const now = new Date()\n    const currentHour = now.getHours()\n    const currentDay = now.getDay()\n    \n    // ساعات العمل: الأحد-الخميس 9 صباحًا - 9 مساءً\n    const isWeekday = currentDay >= 0 && currentDay <= 4\n    const isWorkingHour = currentHour >= 9 && currentHour < 21\n    \n    return isWeekday && isWorkingHour\n  }\n\n  const handleWhatsAppSend = () => {\n    const phoneNumber = '201091515594'\n    const text = encodeURIComponent(message || 'مرحباً، أحتاج إلى المساعدة')\n    window.open(`https://wa.me/${phoneNumber}?text=${text}`, '_blank')\n  }\n\n  const handleEmailSend = () => {\n    const email = 'youspeak.help@gmail.com'\n    const subject = encodeURIComponent('استفسار - Youspeak')\n    const body = encodeURIComponent(message || 'مرحباً،\\n\\nأحتاج إلى المساعدة في...')\n    window.location.href = `mailto:${email}?subject=${subject}&body=${body}`\n  }\n\n  const isAvailable = isWithinWorkingHours()\n\n  return (\n    <>\n      {/* زر الدعم الفني العائم */}\n      <div className=\"fixed bottom-8 right-8 z-50\">\n        <button\n          onClick={() => setIsOpen(!isOpen)}\n          className=\"group relative w-14 h-14 bg-gradient-to-br from-gray-800 to-gray-900 rounded-full flex items-center justify-center text-white shadow-xl hover:shadow-2xl transition-all duration-300 hover:scale-110\"\n          aria-label=\"الدعم الفني\"\n        >\n          {/* أيقونة الرسالة */}\n          <MessageCircle className=\"w-6 h-6 transition-transform group-hover:scale-110\" />\n          \n          {/* تأثير التوهج */}\n          <div className=\"absolute inset-0 rounded-full bg-gradient-to-br from-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300\"></div>\n          \n          {/* مؤشر الحالة */}\n          <div className=\"absolute -top-1 -right-1\">\n            <div className={`w-4 h-4 ${isAvailable ? 'bg-emerald-500' : 'bg-amber-500'} rounded-full border-2 border-white`}>\n              <div className={`w-full h-full ${isAvailable ? 'bg-emerald-500' : 'bg-amber-500'} rounded-full animate-ping opacity-75`}></div>\n            </div>\n          </div>\n        </button>\n      </div>\n\n      {/* النافذة المنبثقة */}\n      {isOpen && (\n        <div className=\"fixed bottom-28 right-8 z-50 w-80 sm:w-96 bg-white rounded-2xl shadow-2xl border border-gray-200 overflow-hidden animate-in slide-in-from-bottom-5 duration-300\">\n          {/* العنوان */}\n          <div className=\"bg-gradient-to-r from-[#004E89] to-[#1A5F7A] p-4 text-white\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <MessageCircle className=\"w-6 h-6\" />\n                <div>\n                  <h3 className=\"font-bold text-lg\">الدعم الفني</h3>\n                  <div className=\"flex items-center gap-2 text-sm opacity-90\">\n                    <Clock className=\"w-3 h-3\" />\n                    <span>\n                      {isAvailable ? 'متاح الآن ✅' : 'غير متاح حالياً 🟡'}\n                    </span>\n                  </div>\n                </div>\n              </div>\n              <button\n                onClick={() => setIsOpen(false)}\n                className=\"hover:bg-white/20 rounded-full p-1 transition-colors\"\n              >\n                <X className=\"w-5 h-5\" />\n              </button>\n            </div>\n          </div>\n\n          {/* المحتوى */}\n          <div className=\"p-5\">\n            {/* ساعات العمل */}\n            <div className=\"mb-4 p-3 bg-gradient-to-r from-blue-50 to-cyan-50 rounded-lg border border-blue-100\">\n              <p className=\"text-sm text-gray-700 font-medium mb-1\">⏰ ساعات العمل:</p>\n              <p className=\"text-xs text-gray-600\">الأحد - الخميس: 9 صباحاً - 9 مساءً</p>\n              <p className=\"text-xs text-gray-600\">الجمعة - السبت: عطلة</p>\n            </div>\n\n            {/* حقل الرسالة */}\n            <div className=\"mb-4\">\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                كيف يمكننا مساعدتك؟\n              </label>\n              <textarea\n                value={message}\n                onChange={(e) => setMessage(e.target.value)}\n                placeholder=\"اكتب رسالتك هنا...\"\n                className=\"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#004E89] focus:border-transparent resize-none text-right\"\n                rows={4}\n                dir=\"rtl\"\n              />\n            </div>\n\n            {/* أزرار الإرسال */}\n            <div className=\"space-y-2\">\n              {/* زر WhatsApp */}\n              <button\n                onClick={handleWhatsAppSend}\n                className=\"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-4 py-3 rounded-lg font-medium flex items-center justify-center gap-2 transition-all duration-300 hover:shadow-lg hover:scale-105\"\n              >\n                <Send className=\"w-4 h-4\" />\n                <span>إرسال عبر واتساب</span>\n                <span className=\"text-lg\">💬</span>\n              </button>\n\n              {/* زر البريد الإلكتروني */}\n              <button\n                onClick={handleEmailSend}\n                className=\"w-full bg-gradient-to-r from-[#004E89] to-[#1A5F7A] hover:from-[#003A6A] hover:to-[#004E89] text-white px-4 py-3 rounded-lg font-medium flex items-center justify-center gap-2 transition-all duration-300 hover:shadow-lg hover:scale-105\"\n              >\n                <Mail className=\"w-4 h-4\" />\n                <span>إرسال عبر البريد</span>\n                <span className=\"text-lg\">✉️</span>\n              </button>\n            </div>\n\n            {/* ملاحظة */}\n            {!isAvailable && (\n              <div className=\"mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg\">\n                <p className=\"text-xs text-amber-800 text-center\">\n                  نحن خارج ساعات العمل حالياً. سنرد عليك في أقرب وقت ممكن!\n                </p>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n    </>\n  )\n}\n","size_bytes":6777},"app/api/admin/subscriptions/[id]/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { prisma } from '@/lib/prisma'\nimport { requireAdmin, parseJsonBody, isNextResponse } from '@/lib/auth-helpers'\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const admin = await requireAdmin()\n    if (isNextResponse(admin)) return admin\n\n    const { id } = await params\n\n    const subscription = await prisma.subscription.findUnique({\n      where: { id },\n      include: {\n        user: {\n          select: {\n            id: true,\n            name: true,\n            email: true,\n            phone: true\n          }\n        },\n        package: true\n      }\n    })\n\n    if (!subscription) {\n      return NextResponse.json({ error: 'Subscription not found' }, { status: 404 })\n    }\n\n    return NextResponse.json(subscription)\n  } catch (error) {\n    console.error('Error fetching subscription:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const admin = await requireAdmin()\n    if (isNextResponse(admin)) return admin\n\n    const { id } = await params\n\n    const body = await parseJsonBody<{\n      paid?: boolean\n      receiptUrl?: string\n      startDate?: string\n      endDate?: string\n    }>(request)\n    if (isNextResponse(body)) return body\n\n    const { paid, receiptUrl, startDate, endDate } = body\n\n    const existingSubscription = await prisma.subscription.findUnique({\n      where: { id }\n    })\n\n    if (!existingSubscription) {\n      return NextResponse.json({ error: 'Subscription not found' }, { status: 404 })\n    }\n\n    const updateData: any = {}\n    if (paid !== undefined) updateData.paid = paid\n    if (receiptUrl !== undefined) updateData.receiptUrl = receiptUrl\n    if (startDate !== undefined) updateData.startDate = startDate ? new Date(startDate) : null\n    if (endDate !== undefined) updateData.endDate = endDate ? new Date(endDate) : null\n    updateData.updatedAt = new Date()\n\n    const updatedSubscription = await prisma.subscription.update({\n      where: { id },\n      data: updateData,\n      include: {\n        user: {\n          select: {\n            id: true,\n            name: true,\n            email: true\n          }\n        },\n        package: true\n      }\n    })\n\n    return NextResponse.json(updatedSubscription)\n  } catch (error) {\n    console.error('Error updating subscription:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const admin = await requireAdmin()\n    if (isNextResponse(admin)) return admin\n\n    const { id } = await params\n\n    const existingSubscription = await prisma.subscription.findUnique({\n      where: { id }\n    })\n\n    if (!existingSubscription) {\n      return NextResponse.json({ error: 'Subscription not found' }, { status: 404 })\n    }\n\n    await prisma.subscription.delete({\n      where: { id }\n    })\n\n    return NextResponse.json({ success: true }, { status: 200 })\n  } catch (error) {\n    console.error('Error deleting subscription:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":3372},"attached_assets/useAuth_1763165145843.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\n\nexport interface User {\n  id: string;\n  email: string;\n  firstName: string;\n  lastName: string;\n  role: 'student' | 'supervisor' | 'admin';\n  phoneNumber?: string;\n  registrationCompleted: boolean;\n  studentId?: string;\n  currentLevel?: string;\n  memorizedSurahs?: string;\n}\n\nexport function useAuth() {\n  const { data: user, isLoading, refetch, error } = useQuery<User>({\n    queryKey: [\"/api/auth/user\"],\n    queryFn: async () => {\n      const response = await fetch('/api/auth/user', {\n        credentials: 'include'\n      });\n\n      if (!response.ok) {\n        throw new Error('Not authenticated');\n      }\n\n      const userData = await response.json();\n      console.log('[useAuth] User data received:', userData);\n      return userData;\n    },\n    retry: false,\n    staleTime: Infinity, // لا تعتبر البيانات قديمة أبداً\n    gcTime: Infinity, // احتفظ بالبيانات في الذاكرة\n    refetchInterval: false,\n    refetchOnWindowFocus: false,\n    refetchOnMount: false,\n    refetchOnReconnect: false,\n  });\n\n  const logout = async () => {\n    try {\n      await fetch('/api/auth/logout', {\n        method: 'POST',\n        credentials: 'include'\n      });\n\n      // Clear query cache and refetch\n      refetch();\n\n      // Redirect to home page\n      window.location.href = '/';\n    } catch (error) {\n      console.error('Logout error:', error);\n    }\n  };\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user && !error,\n    isStudent: user?.role === 'student',\n    isSupervisor: user?.role === 'supervisor',\n    isAdmin: user?.role === 'admin',\n    logout,\n    refetch,\n  };\n}","size_bytes":1682},"app/dashboard/teacher/components/SessionsTab.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { Calendar, Clock, Users, Plus, Video } from 'lucide-react'\nimport Card from '@/components/ui/Card'\nimport Badge from '@/components/ui/Badge'\nimport Alert from '@/components/ui/Alert'\nimport Button from '@/components/ui/Button'\nimport LoadingSpinner from '@/components/ui/LoadingSpinner'\nimport Modal from '@/components/ui/Modal'\nimport Input from '@/components/ui/Input'\n\ninterface Session {\n  id: string\n  title: string\n  startTime: string\n  endTime: string\n  status: string\n  roomId: string | null\n  students: Array<{\n    id: string\n    student: {\n      name: string\n    }\n  }>\n}\n\nexport default function SessionsTab({ teacherProfileId }: { teacherProfileId: string }) {\n  const router = useRouter()\n  const [sessions, setSessions] = useState<Session[]>([])\n  const [loading, setLoading] = useState(true)\n  const [showCreateForm, setShowCreateForm] = useState(false)\n  const [newSession, setNewSession] = useState({\n    title: '',\n    startTime: '',\n    endTime: ''\n  })\n  const [submitting, setSubmitting] = useState(false)\n\n  useEffect(() => {\n    fetchSessions()\n  }, [])\n\n  async function fetchSessions() {\n    try {\n      const response = await fetch('/api/teacher/sessions')\n      if (response.ok) {\n        const data = await response.json()\n        setSessions(data)\n      }\n    } catch (error) {\n      console.error('Error fetching sessions:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  async function handleCreateSession() {\n    if (!newSession.title || !newSession.startTime || !newSession.endTime) {\n      alert('Please fill all fields')\n      return\n    }\n\n    setSubmitting(true)\n    try {\n      const response = await fetch('/api/teacher/sessions', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(newSession)\n      })\n\n      if (response.ok) {\n        await fetchSessions()\n        setNewSession({ title: '', startTime: '', endTime: '' })\n        setShowCreateForm(false)\n        alert('Session created successfully!')\n      } else {\n        alert('Failed to create session')\n      }\n    } catch (error) {\n      console.error('Error creating session:', error)\n      alert('Error creating session')\n    } finally {\n      setSubmitting(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <LoadingSpinner size=\"lg\" />\n      </div>\n    )\n  }\n\n  const upcomingSessions = sessions.filter(s => \n    new Date(s.startTime) > new Date() && s.status === 'SCHEDULED'\n  )\n  const pastSessions = sessions.filter(s => \n    new Date(s.startTime) <= new Date() || s.status !== 'SCHEDULED'\n  )\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <h2 className=\"text-3xl font-bold text-primary-600 dark:text-primary-300\">\n          My Sessions / حصصي\n        </h2>\n        <Button\n          variant=\"primary\"\n          onClick={() => setShowCreateForm(true)}\n        >\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Create Session / إنشاء حصة\n        </Button>\n      </div>\n\n      <div>\n        <h3 className=\"text-xl font-semibold text-neutral-900 dark:text-neutral-100 mb-4\">\n          Upcoming Sessions / الحصص القادمة ({upcomingSessions.length})\n        </h3>\n        {upcomingSessions.length === 0 ? (\n          <Alert variant=\"info\">\n            <p>No upcoming sessions. Create a new session to get started!</p>\n            <p>لا توجد حصص قادمة. قم بإنشاء حصة جديدة للبدء!</p>\n          </Alert>\n        ) : (\n          <div className=\"space-y-4\">\n            {upcomingSessions.map((session) => (\n              <Card key={session.id} variant=\"elevated\">\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <h3 className=\"text-lg font-bold text-primary-600 dark:text-primary-300\">{session.title}</h3>\n                      <Badge variant=\"primary\">Upcoming</Badge>\n                    </div>\n                    <div className=\"space-y-1 text-sm text-neutral-600 dark:text-neutral-400\">\n                      <div className=\"flex items-center gap-2\">\n                        <Calendar className=\"h-4 w-4\" />\n                        <span>{new Date(session.startTime).toLocaleDateString('ar-EG', {\n                          weekday: 'long',\n                          year: 'numeric',\n                          month: 'long',\n                          day: 'numeric'\n                        })}</span>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Clock className=\"h-4 w-4\" />\n                        <span>\n                          {new Date(session.startTime).toLocaleTimeString('ar-EG', {\n                            hour: '2-digit',\n                            minute: '2-digit'\n                          })}\n                          {' - '}\n                          {new Date(session.endTime).toLocaleTimeString('ar-EG', {\n                            hour: '2-digit',\n                            minute: '2-digit'\n                          })}\n                        </span>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Users className=\"h-4 w-4\" />\n                        <span>{session.students.length} student(s) enrolled</span>\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"flex flex-col gap-2\">\n                    <Button \n                      variant=\"primary\" \n                      size=\"sm\"\n                      onClick={() => router.push(`/session/${session.id}`)}\n                    >\n                      <Video className=\"h-4 w-4 mr-2\" />\n                      Start / ابدأ\n                    </Button>\n                  </div>\n                </div>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n\n      <div>\n        <h3 className=\"text-xl font-semibold text-neutral-900 dark:text-neutral-100 mb-4\">\n          Past Sessions / الحصص السابقة ({pastSessions.length})\n        </h3>\n        {pastSessions.length === 0 ? (\n          <Alert variant=\"info\">\n            <p>No past sessions yet.</p>\n            <p>لا توجد حصص سابقة بعد.</p>\n          </Alert>\n        ) : (\n          <div className=\"space-y-4\">\n            {pastSessions.slice(0, 10).map((session) => (\n              <Card key={session.id} variant=\"elevated\">\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <h3 className=\"text-lg font-bold text-neutral-700 dark:text-neutral-300\">{session.title}</h3>\n                      <Badge variant=\"neutral\">Completed</Badge>\n                    </div>\n                    <div className=\"space-y-1 text-sm text-neutral-600 dark:text-neutral-400\">\n                      <div className=\"flex items-center gap-2\">\n                        <Calendar className=\"h-4 w-4\" />\n                        <span>{new Date(session.startTime).toLocaleDateString('ar-EG')}</span>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Users className=\"h-4 w-4\" />\n                        <span>{session.students.length} student(s)</span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {showCreateForm && (\n        <Modal\n          isOpen={true}\n          onClose={() => setShowCreateForm(false)}\n          title=\"Create New Session / إنشاء حصة جديدة\"\n        >\n          <div className=\"space-y-4\">\n            <Input\n              label=\"Session Title / عنوان الحصة\"\n              value={newSession.title}\n              onChange={(e) => setNewSession({ ...newSession, title: e.target.value })}\n              placeholder=\"e.g., English Conversation - Lesson 1\"\n            />\n            <Input\n              label=\"Start Time / وقت البداية\"\n              type=\"datetime-local\"\n              value={newSession.startTime}\n              onChange={(e) => setNewSession({ ...newSession, startTime: e.target.value })}\n            />\n            <Input\n              label=\"End Time / وقت النهاية\"\n              type=\"datetime-local\"\n              value={newSession.endTime}\n              onChange={(e) => setNewSession({ ...newSession, endTime: e.target.value })}\n            />\n            <div className=\"flex gap-2\">\n              <Button\n                variant=\"primary\"\n                fullWidth\n                onClick={handleCreateSession}\n                disabled={submitting}\n              >\n                {submitting ? 'Creating...' : 'Create / إنشاء'}\n              </Button>\n              <Button\n                variant=\"outline\"\n                fullWidth\n                onClick={() => setShowCreateForm(false)}\n              >\n                Cancel / إلغاء\n              </Button>\n            </div>\n          </div>\n        </Modal>\n      )}\n    </div>\n  )\n}\n","size_bytes":9506},"app/dashboard/student/test-words/page.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { motion, AnimatePresence } from 'framer-motion'\nimport { Check, X, Trophy, Brain, BookOpen, Keyboard, ArrowRight } from 'lucide-react'\nimport Button from '@/components/ui/Button'\nimport Input from '@/components/ui/Input'\n\ninterface Word {\n  id: string\n  englishWord: string\n  arabicMeaning: string\n  exampleSentence: string\n  known: boolean\n}\n\ntype TestMode = 'select' | 'multiple-choice' | 'writing'\ntype QuestionType = 'en-to-ar' | 'ar-to-en'\n\ninterface Question {\n  word: Word\n  type: QuestionType\n  options?: string[]\n  correctAnswer: string\n}\n\nexport default function TestWordsPage() {\n  const [mode, setMode] = useState<TestMode | null>(null)\n  const [questions, setQuestions] = useState<Question[]>([])\n  const [currentIndex, setCurrentIndex] = useState(0)\n  const [score, setScore] = useState(0)\n  const [answers, setAnswers] = useState<boolean[]>([])\n  const [userAnswer, setUserAnswer] = useState('')\n  const [showResult, setShowResult] = useState(false)\n  const [isCorrect, setIsCorrect] = useState(false)\n  const [loading, setLoading] = useState(false)\n  const [testComplete, setTestComplete] = useState(false)\n\n  const loadWords = async (testMode: TestMode) => {\n    setLoading(true)\n    try {\n      const res = await fetch('/api/words')\n      const data = await res.json()\n      const knownWords = data.words.filter((w: Word) => w.known)\n\n      if (knownWords.length < 5) {\n        alert('تحتاج على الأقل 5 كلمات معروفة لبدء الاختبار')\n        setMode(null)\n        setLoading(false)\n        return\n      }\n\n      const shuffled = knownWords.sort(() => Math.random() - 0.5).slice(0, 10)\n      const generatedQuestions = shuffled.map((word: Word) => {\n        const questionType: QuestionType = Math.random() > 0.5 ? 'en-to-ar' : 'ar-to-en'\n\n        if (testMode === 'multiple-choice') {\n          const correctAnswer = questionType === 'en-to-ar' ? word.arabicMeaning : word.englishWord\n          const wrongOptions = knownWords\n            .filter((w: Word) => w.id !== word.id)\n            .sort(() => Math.random() - 0.5)\n            .slice(0, 3)\n            .map((w: Word) => questionType === 'en-to-ar' ? w.arabicMeaning : w.englishWord)\n\n          const options = [correctAnswer, ...wrongOptions].sort(() => Math.random() - 0.5)\n\n          return {\n            word,\n            type: questionType,\n            options,\n            correctAnswer\n          }\n        }\n\n        return {\n          word,\n          type: questionType,\n          correctAnswer: questionType === 'en-to-ar' ? word.arabicMeaning : word.englishWord\n        }\n      })\n\n      setQuestions(generatedQuestions)\n      setCurrentIndex(0)\n      setScore(0)\n      setAnswers([])\n      setTestComplete(false)\n    } catch (error) {\n      console.error('Error loading words:', error)\n      alert('حدث خطأ في تحميل الكلمات')\n      setMode(null)\n    }\n    setLoading(false)\n  }\n\n  const handleAnswer = (answer: string) => {\n    const currentQuestion = questions[currentIndex]\n    const correct = answer.trim().toLowerCase() === currentQuestion.correctAnswer.trim().toLowerCase()\n\n    setIsCorrect(correct)\n    setShowResult(true)\n\n    if (correct) {\n      setScore(score + 1)\n      setAnswers([...answers, true])\n    } else {\n      setAnswers([...answers, false])\n    }\n\n    setTimeout(() => {\n      if (currentIndex < questions.length - 1) {\n        setCurrentIndex(currentIndex + 1)\n        setUserAnswer('')\n        setShowResult(false)\n      } else {\n        setTestComplete(true)\n      }\n    }, 2000)\n  }\n\n  if (!mode) {\n    return (\n      <div className=\"min-h-screen bg-[#F5F5DC] p-4 md:p-8\">\n        <div className=\"max-w-4xl mx-auto\">\n          <div className=\"mb-8 text-center\">\n            <div className=\"flex items-center justify-center gap-3 mb-4\">\n              <div className=\"bg-blue-600 p-3 rounded-xl\">\n                <Brain className=\"h-10 w-10 text-white\" />\n              </div>\n              <h1 className=\"text-4xl font-bold text-black\">اختبر نفسك</h1>\n            </div>\n            <p className=\"text-black text-lg\">Test Your Vocabulary Knowledge</p>\n          </div>\n\n          <div className=\"grid md:grid-cols-2 gap-6\">\n            <motion.button\n              whileHover={{ scale: 1.05 }}\n              whileTap={{ scale: 0.95 }}\n              onClick={() => {\n                setMode('multiple-choice')\n                loadWords('multiple-choice')\n              }}\n              className=\"bg-white border-2 border-blue-600 rounded-2xl p-8 text-left shadow-lg hover:shadow-xl transition-all\"\n            >\n              <BookOpen className=\"h-12 w-12 text-blue-600 mb-4\" />\n              <h3 className=\"text-2xl font-bold text-black mb-2\">اختيار من متعدد</h3>\n              <p className=\"text-black opacity-70\">Multiple Choice Test</p>\n              <p className=\"text-black text-sm mt-3\">اختر الإجابة الصحيحة من 4 خيارات</p>\n            </motion.button>\n\n            <motion.button\n              whileHover={{ scale: 1.05 }}\n              whileTap={{ scale: 0.95 }}\n              onClick={() => {\n                setMode('writing')\n                loadWords('writing')\n              }}\n              className=\"bg-white border-2 border-blue-600 rounded-2xl p-8 text-left shadow-lg hover:shadow-xl transition-all\"\n            >\n              <Keyboard className=\"h-12 w-12 text-blue-600 mb-4\" />\n              <h3 className=\"text-2xl font-bold text-black mb-2\">اختبار الكتابة</h3>\n              <p className=\"text-black opacity-70\">Writing Test</p>\n              <p className=\"text-black text-sm mt-3\">اكتب الإجابة الصحيحة بنفسك</p>\n            </motion.button>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-[#F5F5DC] flex items-center justify-center\">\n        <div className=\"text-black text-2xl\">جاري تحميل الأسئلة...</div>\n      </div>\n    )\n  }\n\n  if (testComplete) {\n    const percentage = Math.round((score / questions.length) * 100)\n    return (\n      <div className=\"min-h-screen bg-[#F5F5DC] p-4 md:p-8\">\n        <div className=\"max-w-2xl mx-auto\">\n          <motion.div\n            initial={{ scale: 0 }}\n            animate={{ scale: 1 }}\n            className=\"bg-white border-2 border-blue-600 rounded-3xl p-12 text-center shadow-xl\"\n          >\n            <Trophy className=\"h-24 w-24 text-blue-600 mx-auto mb-6\" />\n            <h2 className=\"text-4xl font-bold text-black mb-4\">انتهى الاختبار!</h2>\n            <div className=\"text-6xl font-bold text-blue-600 mb-4\">{percentage}%</div>\n            <p className=\"text-2xl text-black mb-8\">\n              {score} من {questions.length} إجابة صحيحة\n            </p>\n\n            <div className=\"space-y-3 mb-8\">\n              {questions.map((q, idx) => (\n                <div\n                  key={idx}\n                  className={`p-4 rounded-xl border-2 ${\n                    answers[idx] \n                      ? 'bg-green-50 border-green-500' \n                      : 'bg-red-50 border-red-500'\n                  }`}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-black font-semibold\">\n                      {q.type === 'en-to-ar' ? q.word.englishWord : q.word.arabicMeaning}\n                    </span>\n                    {answers[idx] ? (\n                      <Check className=\"h-6 w-6 text-green-600\" />\n                    ) : (\n                      <X className=\"h-6 w-6 text-red-600\" />\n                    )}\n                  </div>\n                  <div className=\"text-sm text-black opacity-70 mt-1\">\n                    الإجابة: {q.correctAnswer}\n                  </div>\n                </div>\n              ))}\n            </div>\n\n            <div className=\"flex gap-4 justify-center\">\n              <Button\n                variant=\"primary\"\n                size=\"lg\"\n                onClick={() => {\n                  setMode(null)\n                  setTestComplete(false)\n                }}\n              >\n                اختبار جديد\n              </Button>\n              <Button\n                variant=\"secondary\"\n                size=\"lg\"\n                onClick={() => window.location.href = '/dashboard/student'}\n              >\n                العودة للوحة التحكم\n              </Button>\n            </div>\n          </motion.div>\n        </div>\n      </div>\n    )\n  }\n\n  const currentQuestion = questions[currentIndex]\n\n  return (\n    <div className=\"min-h-screen bg-[#F5F5DC] p-4 md:p-8\">\n      <div className=\"max-w-3xl mx-auto\">\n        {/* Progress */}\n        <div className=\"mb-8\">\n          <div className=\"flex justify-between items-center mb-2\">\n            <span className=\"text-black font-semibold\">\n              السؤال {currentIndex + 1} من {questions.length}\n            </span>\n            <span className=\"text-black font-semibold\">النقاط: {score}</span>\n          </div>\n          <div className=\"w-full bg-white rounded-full h-3 border-2 border-blue-600\">\n            <div\n              className=\"bg-blue-600 h-full rounded-full transition-all\"\n              style={{ width: `${((currentIndex + 1) / questions.length) * 100}%` }}\n            />\n          </div>\n        </div>\n\n        {/* Question Card */}\n        <AnimatePresence mode=\"wait\">\n          <motion.div\n            key={currentIndex}\n            initial={{ x: 100, opacity: 0 }}\n            animate={{ x: 0, opacity: 1 }}\n            exit={{ x: -100, opacity: 0 }}\n            className=\"bg-white border-2 border-blue-600 rounded-3xl p-12 shadow-xl\"\n          >\n            <div className=\"text-center mb-8\">\n              <h3 className=\"text-3xl font-bold text-black mb-4\">\n                {currentQuestion.type === 'en-to-ar' \n                  ? currentQuestion.word.englishWord\n                  : currentQuestion.word.arabicMeaning}\n              </h3>\n              <p className=\"text-black opacity-70\">\n                {currentQuestion.type === 'en-to-ar' \n                  ? 'ما معنى هذه الكلمة بالعربي؟'\n                  : 'What is the English word for this?'}\n              </p>\n            </div>\n\n            {mode === 'multiple-choice' && currentQuestion.options ? (\n              <div className=\"space-y-3\">\n                {currentQuestion.options.map((option, idx) => (\n                  <motion.button\n                    key={idx}\n                    whileHover={{ scale: 1.02 }}\n                    whileTap={{ scale: 0.98 }}\n                    onClick={() => !showResult && handleAnswer(option)}\n                    disabled={showResult}\n                    className={`w-full p-6 rounded-xl border-2 text-left font-semibold text-lg transition-all ${\n                      showResult\n                        ? option === currentQuestion.correctAnswer\n                          ? 'bg-green-500 border-green-600 text-white'\n                          : 'bg-gray-200 border-gray-300 text-black opacity-50'\n                        : 'bg-white border-blue-600 text-black hover:bg-blue-50'\n                    }`}\n                  >\n                    <div className=\"flex items-center justify-between\">\n                      <span>{option}</span>\n                      {showResult && option === currentQuestion.correctAnswer && (\n                        <Check className=\"h-6 w-6\" />\n                      )}\n                    </div>\n                  </motion.button>\n                ))}\n              </div>\n            ) : (\n              <div>\n                <Input\n                  value={userAnswer}\n                  onChange={(e) => setUserAnswer(e.target.value)}\n                  placeholder=\"اكتب الإجابة هنا...\"\n                  disabled={showResult}\n                  inputSize=\"lg\"\n                  className=\"mb-4 text-black\"\n                  onKeyPress={(e) => {\n                    if (e.key === 'Enter' && userAnswer.trim() && !showResult) {\n                      handleAnswer(userAnswer)\n                    }\n                  }}\n                />\n                <Button\n                  variant=\"primary\"\n                  size=\"lg\"\n                  fullWidth\n                  onClick={() => handleAnswer(userAnswer)}\n                  disabled={!userAnswer.trim() || showResult}\n                >\n                  تأكيد <ArrowRight className=\"h-5 w-5 mr-2\" />\n                </Button>\n              </div>\n            )}\n\n            {showResult && (\n              <motion.div\n                initial={{ scale: 0 }}\n                animate={{ scale: 1 }}\n                className={`mt-6 p-6 rounded-xl border-2 ${\n                  isCorrect \n                    ? 'bg-green-50 border-green-500' \n                    : 'bg-red-50 border-red-500'\n                }`}\n              >\n                <div className=\"flex items-center gap-3 mb-2\">\n                  {isCorrect ? (\n                    <Check className=\"h-8 w-8 text-green-600\" />\n                  ) : (\n                    <X className=\"h-8 w-8 text-red-600\" />\n                  )}\n                  <span className={`text-2xl font-bold ${isCorrect ? 'text-green-600' : 'text-red-600'}`}>\n                    {isCorrect ? 'صحيح!' : 'خطأ!'}\n                  </span>\n                </div>\n                {!isCorrect && (\n                  <p className=\"text-black\">\n                    الإجابة الصحيحة: <strong>{currentQuestion.correctAnswer}</strong>\n                  </p>\n                )}\n              </motion.div>\n            )}\n          </motion.div>\n        </AnimatePresence>\n      </div>\n    </div>\n  )\n}","size_bytes":13855},"lib/socket.ts":{"content":"import { Server as HTTPServer } from 'http'\nimport { Server as SocketIOServer } from 'socket.io'\nimport { NextApiResponse } from 'next'\n\nexport type NextApiResponseServerIO = NextApiResponse & {\n  socket: {\n    server: HTTPServer & {\n      io?: SocketIOServer\n    }\n  }\n}\n\nexport const initSocketServer = (httpServer: HTTPServer) => {\n  const io = new SocketIOServer(httpServer, {\n    path: '/api/socket/io',\n    addTrailingSlash: false,\n    cors: {\n      origin: '*',\n      methods: ['GET', 'POST']\n    }\n  })\n\n  io.on('connection', (socket) => {\n    console.log('✅ Socket connected:', socket.id)\n\n    socket.on('join-room', (userId: string) => {\n      socket.join(`user-${userId}`)\n      console.log(`User ${userId} joined room`)\n    })\n\n    socket.on('send-message', (data) => {\n      const { toUserId, fromUserId, message } = data\n      io.to(`user-${toUserId}`).emit('new-message', {\n        fromUserId,\n        message,\n        timestamp: new Date()\n      })\n    })\n\n    socket.on('disconnect', () => {\n      console.log('❌ Socket disconnected:', socket.id)\n    })\n  })\n\n  return io\n}\n","size_bytes":1095},"app/dashboard/admin/components/SubscriptionsTab.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { CreditCard, CheckCircle, Clock, XCircle } from 'lucide-react'\nimport Card from '@/components/ui/Card'\nimport Badge from '@/components/ui/Badge'\nimport Button from '@/components/ui/Button'\nimport LoadingSpinner from '@/components/ui/LoadingSpinner'\nimport Alert from '@/components/ui/Alert'\n\ninterface Subscription {\n  id: string\n  paid: boolean\n  receiptUrl: string | null\n  startDate: string | null\n  endDate: string | null\n  createdAt: string\n  student: {\n    name: string\n    email: string\n  }\n  package: {\n    title: string\n    titleAr: string\n    price: number\n    lessonsCount: number\n    durationDays: number\n  }\n}\n\nexport default function SubscriptionsTab() {\n  const [subscriptions, setSubscriptions] = useState<Subscription[]>([])\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    fetchSubscriptions()\n  }, [])\n\n  async function fetchSubscriptions() {\n    try {\n      const response = await fetch('/api/admin/subscriptions')\n      if (response.ok) {\n        const data = await response.json()\n        setSubscriptions(data)\n      }\n    } catch (error) {\n      console.error('Error fetching subscriptions:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  async function approveSubscription(subscriptionId: string) {\n    if (!confirm('Are you sure you want to approve this subscription?')) {\n      return\n    }\n\n    try {\n      const response = await fetch(`/api/admin/subscriptions/${subscriptionId}/approve`, {\n        method: 'PATCH'\n      })\n\n      if (response.ok) {\n        await fetchSubscriptions()\n        alert('Subscription approved successfully! Student account activated.')\n      } else {\n        alert('Failed to approve subscription')\n      }\n    } catch (error) {\n      console.error('Error approving subscription:', error)\n      alert('Error approving subscription')\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <LoadingSpinner size=\"lg\" />\n      </div>\n    )\n  }\n\n  const pendingSubscriptions = subscriptions.filter(s => !s.paid)\n  const approvedSubscriptions = subscriptions.filter(s => s.paid)\n\n  return (\n    <div className=\"space-y-6\">\n      <h2 className=\"text-3xl font-bold text-[#004E89]\">\n        Subscriptions / الاشتراكات\n      </h2>\n\n      <div className=\"grid md:grid-cols-2 gap-4\">\n        <Card variant=\"elevated\">\n          <div className=\"text-center\">\n            <p className=\"text-2xl font-bold text-orange-600\">{pendingSubscriptions.length}</p>\n            <p className=\"text-sm text-gray-600\">Pending Approval / في انتظار الموافقة</p>\n          </div>\n        </Card>\n        <Card variant=\"elevated\">\n          <div className=\"text-center\">\n            <p className=\"text-2xl font-bold text-green-600\">{approvedSubscriptions.length}</p>\n            <p className=\"text-sm text-gray-600\">Approved / موافق عليها</p>\n          </div>\n        </Card>\n      </div>\n\n      <div>\n        <h3 className=\"text-xl font-semibold text-gray-900 mb-4\">\n          Pending Subscriptions / اشتراكات معلقة ({pendingSubscriptions.length})\n        </h3>\n        {pendingSubscriptions.length === 0 ? (\n          <Alert variant=\"success\">\n            <CheckCircle className=\"h-5 w-5\" />\n            <p>No pending subscriptions!</p>\n            <p>لا توجد اشتراكات معلقة!</p>\n          </Alert>\n        ) : (\n          <div className=\"space-y-4\">\n            {pendingSubscriptions.map((sub) => (\n              <Card key={sub.id} variant=\"elevated\" className=\"border-l-4 border-orange-500\">\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <h3 className=\"text-lg font-bold text-gray-900\">{sub.student.name}</h3>\n                      <Badge variant=\"warning\">\n                        <Clock className=\"h-3 w-3 mr-1\" />\n                        Pending Payment\n                      </Badge>\n                    </div>\n                    <p className=\"text-sm text-gray-600 mb-2\">{sub.student.email}</p>\n                    <div className=\"bg-blue-50 p-3 rounded-lg mb-2\">\n                      <p className=\"font-medium text-gray-900\">\n                        {sub.package.title} / {sub.package.titleAr}\n                      </p>\n                      <p className=\"text-sm text-gray-700\">\n                        {sub.package.price} SAR • {sub.package.lessonsCount} lessons • {Math.ceil(sub.package.durationDays / 30)} month(s)\n                      </p>\n                    </div>\n                    <p className=\"text-xs text-gray-500\">\n                      Requested: {new Date(sub.createdAt).toLocaleString('ar-EG')}\n                    </p>\n                  </div>\n                  <div className=\"flex flex-col gap-2 ml-4\">\n                    <Button\n                      variant=\"primary\"\n                      size=\"sm\"\n                      onClick={() => approveSubscription(sub.id)}\n                    >\n                      <CheckCircle className=\"h-4 w-4 mr-1\" />\n                      Approve / موافقة\n                    </Button>\n                    {sub.receiptUrl && (\n                      <a href={sub.receiptUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n                        <Button variant=\"outline\" size=\"sm\" fullWidth>\n                          View Receipt\n                        </Button>\n                      </a>\n                    )}\n                  </div>\n                </div>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n\n      <div>\n        <h3 className=\"text-xl font-semibold text-gray-900 mb-4\">\n          Approved Subscriptions / اشتراكات موافق عليها ({approvedSubscriptions.length})\n        </h3>\n        {approvedSubscriptions.length === 0 ? (\n          <Alert variant=\"info\">\n            <p>No approved subscriptions yet.</p>\n            <p>لا توجد اشتراكات موافق عليها بعد.</p>\n          </Alert>\n        ) : (\n          <div className=\"space-y-4\">\n            {approvedSubscriptions.slice(0, 10).map((sub) => (\n              <Card key={sub.id} variant=\"elevated\">\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <h3 className=\"text-lg font-bold text-gray-900\">{sub.student.name}</h3>\n                      <Badge variant=\"success\">\n                        <CheckCircle className=\"h-3 w-3 mr-1\" />\n                        Paid\n                      </Badge>\n                    </div>\n                    <p className=\"text-sm text-gray-600 mb-2\">{sub.student.email}</p>\n                    <p className=\"font-medium text-gray-900\">\n                      {sub.package.title} / {sub.package.titleAr}\n                    </p>\n                    <p className=\"text-sm text-gray-600\">\n                      {sub.package.price} SAR\n                    </p>\n                    {sub.startDate && sub.endDate && (\n                      <p className=\"text-xs text-gray-500 mt-2\">\n                        Active: {new Date(sub.startDate).toLocaleDateString('ar-EG')} - {new Date(sub.endDate).toLocaleDateString('ar-EG')}\n                      </p>\n                    )}\n                  </div>\n                </div>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n","size_bytes":7618},"attached_assets/LiveSession_1763165088516.tsx":{"content":"import { useEffect } from 'react';\nimport { useRoute } from 'wouter';\nimport LiveSessionRoom from './LiveSessionRoom';\nimport { useAuth } from '@/hooks/useAuth';\nimport { useLocation } from 'wouter';\nimport { Loader2 } from 'lucide-react';\n\nexport default function LiveSession() {\n  const [, params] = useRoute('/session/:roomToken');\n  const { user, isLoading } = useAuth();\n  const [, setLocation] = useLocation();\n\n  useEffect(() => {\n    document.body.style.overflow = 'hidden';\n    return () => {\n      document.body.style.overflow = 'auto';\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!isLoading && !user) {\n      setLocation('/login');\n    }\n  }, [isLoading, user, setLocation]);\n\n  useEffect(() => {\n    if (!isLoading && user && !params?.roomToken) {\n      setLocation('/my-session');\n    }\n  }, [isLoading, user, params?.roomToken, setLocation]);\n\n  if (isLoading) {\n    return (\n      <div className=\"fixed inset-0 bg-gradient-to-br from-emerald-900 via-teal-800 to-cyan-900 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <Loader2 className=\"w-16 h-16 text-white animate-spin mx-auto mb-4\" />\n          <p className=\"text-white text-xl\">جاري التحميل...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!user || !params?.roomToken) {\n    return null;\n  }\n\n  const handleLeave = () => {\n    setLocation('/my-session');\n  };\n\n  return (\n    <LiveSessionRoom\n      roomId={params.roomToken}\n      studentId={user.role === 'student' ? user.id : ''}\n      sheikhId={user.role === 'supervisor' ? user.id : ''}\n      onLeave={handleLeave}\n    />\n  );\n}\n","size_bytes":1606},"lib/hooks/useTranslation.ts":{"content":"import { useTheme } from '../contexts/ThemeContext'\nimport { translations, TranslationKey } from '../translations'\n\nexport function useTranslation() {\n  const { language } = useTheme()\n  \n  const t = (key: TranslationKey): string => {\n    return translations[language][key] || key\n  }\n  \n  return { t, language }\n}\n","size_bytes":315},"app/api/teacher/assignments/[id]/grade/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'TEACHER') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const teacherProfile = await prisma.teacherProfile.findUnique({\n      where: { userId: session.user.id }\n    })\n\n    if (!teacherProfile) {\n      return NextResponse.json({ error: 'Teacher profile not found' }, { status: 404 })\n    }\n\n    const { grade, feedback, grammarErrors } = await request.json()\n\n    if (grade === undefined || grade === null) {\n      return NextResponse.json({ error: 'Grade is required' }, { status: 400 })\n    }\n\n    const { id: submissionId } = await params\n\n    const submission = await prisma.submission.findUnique({\n      where: { id: submissionId },\n      include: {\n        Assignment: {\n          include: {\n            Session: true\n          }\n        }\n      }\n    })\n\n    if (!submission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 })\n    }\n\n    if (submission.Assignment && submission.Assignment.Session && submission.Assignment.Session.teacherId !== teacherProfile.id) {\n      return NextResponse.json({ error: 'Not authorized to grade this submission' }, { status: 403 })\n    }\n\n    const updatedSubmission = await prisma.submission.update({\n      where: { id: submissionId },\n      data: {\n        grade: parseFloat(grade.toString()),\n        feedback: feedback || null,\n        grammarErrors: grammarErrors || null\n      }\n    })\n\n    return NextResponse.json(updatedSubmission)\n  } catch (error) {\n    console.error('Error grading submission:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":2017},"app/api/teacher/sessions/[id]/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { prisma } from '@/lib/prisma'\nimport { requireTeacher, parseJsonBody, isNextResponse } from '@/lib/auth-helpers'\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const teacher = await requireTeacher()\n    if (isNextResponse(teacher)) return teacher\n\n    const { id } = await params\n\n    const sessionData = await prisma.session.findFirst({\n      where: {\n        id,\n        teacherId: teacher.teacherProfileId\n      },\n      include: {\n        TeacherProfile: {\n          include: {\n            User: {\n              select: {\n                name: true,\n                email: true\n              }\n            }\n          }\n        },\n        SessionStudent: {\n          include: {\n            User: {\n              select: {\n                name: true,\n                email: true\n              }\n            }\n          }\n        }\n      }\n    })\n\n    if (!sessionData) {\n      return NextResponse.json({ error: 'Session not found' }, { status: 404 })\n    }\n\n    return NextResponse.json({\n      ...sessionData,\n      teacher: {\n        name: sessionData.TeacherProfile.User.name\n      }\n    })\n  } catch (error) {\n    console.error('Error fetching session:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const teacher = await requireTeacher()\n    if (isNextResponse(teacher)) return teacher\n\n    const { id } = await params\n    \n    const body = await parseJsonBody<{ title?: string; startTime?: string; endTime?: string; status?: string }>(request)\n    if (isNextResponse(body)) return body\n\n    const { title, startTime, endTime, status } = body\n\n    const existingSession = await prisma.session.findUnique({\n      where: { id }\n    })\n\n    if (!existingSession) {\n      return NextResponse.json({ error: 'Session not found' }, { status: 404 })\n    }\n\n    if (existingSession.teacherId !== teacher.teacherProfileId) {\n      return NextResponse.json({ error: 'Forbidden' }, { status: 403 })\n    }\n\n    const updateData: any = {}\n    if (title !== undefined) updateData.title = title\n    if (startTime !== undefined) updateData.startTime = new Date(startTime)\n    if (endTime !== undefined) updateData.endTime = new Date(endTime)\n    if (status !== undefined) updateData.status = status\n    updateData.updatedAt = new Date()\n\n    const updatedSession = await prisma.session.update({\n      where: { id },\n      data: updateData,\n      include: {\n        SessionStudent: {\n          include: {\n            User: true\n          }\n        }\n      }\n    })\n\n    return NextResponse.json(updatedSession)\n  } catch (error) {\n    console.error('Error updating session:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const teacher = await requireTeacher()\n    if (isNextResponse(teacher)) return teacher\n\n    const { id } = await params\n\n    const existingSession = await prisma.session.findUnique({\n      where: { id }\n    })\n\n    if (!existingSession) {\n      return NextResponse.json({ error: 'Session not found' }, { status: 404 })\n    }\n\n    if (existingSession.teacherId !== teacher.teacherProfileId) {\n      return NextResponse.json({ error: 'Forbidden' }, { status: 403 })\n    }\n\n    await prisma.session.delete({\n      where: { id }\n    })\n\n    return NextResponse.json({ success: true }, { status: 200 })\n  } catch (error) {\n    console.error('Error deleting session:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":3843},"app/dashboard/admin/page.tsx":{"content":"import { redirect } from 'next/navigation'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport AdminDashboardClient from './AdminDashboardClient'\n\nexport default async function AdminDashboardPage() {\n  const session = await getServerSession(authOptions)\n\n  if (!session) {\n    redirect('/auth/login')\n  }\n\n  if (session.user.role !== 'ADMIN' && session.user.role !== 'ASSISTANT') {\n    redirect('/dashboard')\n  }\n\n  return (\n    <AdminDashboardClient\n      user={{\n        name: session.user.name,\n        email: session.user.email,\n        role: session.user.role,\n      }}\n    />\n  )\n}\n","size_bytes":629},"app/api/auth/register/route.ts":{"content":"import { NextResponse } from 'next/server'\nimport { prisma } from '@/lib/prisma'\nimport bcrypt from 'bcryptjs'\nimport { z } from 'zod'\n\nconst registerSchema = z.object({\n  name: z.string().min(2),\n  email: z.string().email(),\n  password: z.string().min(6),\n  phone: z.string().min(10),\n  age: z.number().min(5).max(100),\n  levelInitial: z.enum(['A1', 'A2', 'B1', 'B2']),\n  goal: z.string().min(1),\n  preferredTime: z.string().min(1),\n})\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json()\n    const validatedData = registerSchema.parse(body)\n\n    const existingUser = await prisma.user.findUnique({\n      where: { email: validatedData.email },\n    })\n\n    if (existingUser) {\n      return NextResponse.json(\n        { error: 'User already exists' },\n        { status: 400 }\n      )\n    }\n\n    const hashedPassword = await bcrypt.hash(validatedData.password, 10)\n\n    const user = await prisma.user.create({\n      data: {\n        id: `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        name: validatedData.name,\n        email: validatedData.email,\n        passwordHash: hashedPassword,\n        phone: validatedData.phone,\n        role: 'STUDENT',\n        isActive: false,\n        StudentProfile: {\n          create: {\n            id: `profile_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n            age: validatedData.age,\n            levelInitial: validatedData.levelInitial,\n            goal: validatedData.goal,\n            preferredTime: validatedData.preferredTime,\n          },\n        },\n      },\n      include: {\n        StudentProfile: true,\n      },\n    })\n\n    await prisma.auditLog.create({\n      data: {\n        id: `audit_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        action: 'USER_REGISTERED',\n        userId: user.id,\n        details: JSON.stringify({\n          name: user.name,\n          email: user.email,\n          phone: user.phone,\n        }),\n      },\n    })\n\n    return NextResponse.json({\n      message: 'Registration successful. Your account is pending activation.',\n      user: {\n        id: user.id,\n        name: user.name,\n        email: user.email,\n        isActive: user.isActive,\n      },\n    })\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return NextResponse.json(\n        { error: 'Invalid data', details: error.issues },\n        { status: 400 }\n      )\n    }\n\n    console.error('Registration error:', error)\n    return NextResponse.json(\n      { error: 'Registration failed' },\n      { status: 500 }\n    )\n  }\n}\n","size_bytes":2566},"app/api/teacher/assignments/[id]/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { prisma } from '@/lib/prisma'\nimport { requireTeacher, parseJsonBody, isNextResponse } from '@/lib/auth-helpers'\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const teacher = await requireTeacher()\n    if (isNextResponse(teacher)) return teacher\n\n    const { id } = await params\n\n    const assignment = await prisma.assignment.findFirst({\n      where: {\n        id,\n        Session: {\n          teacherId: teacher.teacherProfileId\n        }\n      },\n      include: {\n        Session: true,\n        Submission: {\n          include: {\n            User: true\n          }\n        }\n      }\n    })\n\n    if (!assignment) {\n      return NextResponse.json({ error: 'Assignment not found' }, { status: 404 })\n    }\n\n    return NextResponse.json(assignment)\n  } catch (error) {\n    console.error('Error fetching assignment:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const teacher = await requireTeacher()\n    if (isNextResponse(teacher)) return teacher\n\n    const { id } = await params\n\n    const body = await parseJsonBody<{\n      title?: string\n      description?: string\n      dueDate?: string\n      sessionId?: string\n    }>(request)\n    if (isNextResponse(body)) return body\n\n    const { title, description, dueDate, sessionId } = body\n\n    const existingAssignment = await prisma.assignment.findFirst({\n      where: {\n        id,\n        Session: {\n          teacherId: teacher.teacherProfileId\n        }\n      }\n    })\n\n    if (!existingAssignment) {\n      return NextResponse.json({ error: 'Assignment not found' }, { status: 404 })\n    }\n\n    if (sessionId) {\n      const session = await prisma.session.findUnique({\n        where: { id: sessionId }\n      })\n\n      if (!session || session.teacherId !== teacher.teacherProfileId) {\n        return NextResponse.json({ error: 'Invalid session' }, { status: 400 })\n      }\n    }\n\n    const updateData: any = {}\n    if (title !== undefined) updateData.title = title\n    if (description !== undefined) updateData.description = description\n    if (dueDate !== undefined) updateData.dueDate = dueDate ? new Date(dueDate) : null\n    if (sessionId !== undefined) updateData.sessionId = sessionId\n    updateData.updatedAt = new Date()\n\n    const updatedAssignment = await prisma.assignment.update({\n      where: { id },\n      data: updateData,\n      include: {\n        Session: true,\n        Submission: {\n          include: {\n            User: true\n          }\n        }\n      }\n    })\n\n    return NextResponse.json(updatedAssignment)\n  } catch (error) {\n    console.error('Error updating assignment:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const teacher = await requireTeacher()\n    if (isNextResponse(teacher)) return teacher\n\n    const { id } = await params\n\n    const existingAssignment = await prisma.assignment.findFirst({\n      where: {\n        id,\n        Session: {\n          teacherId: teacher.teacherProfileId\n        }\n      }\n    })\n\n    if (!existingAssignment) {\n      return NextResponse.json({ error: 'Assignment not found' }, { status: 404 })\n    }\n\n    await prisma.assignment.delete({\n      where: { id }\n    })\n\n    return NextResponse.json({ success: true }, { status: 200 })\n  } catch (error) {\n    console.error('Error deleting assignment:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":3787},"app/chat/page.tsx":{"content":"'use client'\n\nimport { useState } from 'react'\nimport { useSession } from 'next-auth/react'\nimport { redirect } from 'next/navigation'\nimport ChatBox from '@/components/ChatBox'\nimport ConversationsList from '@/components/ConversationsList'\nimport { MessageCircle, ArrowRight } from 'lucide-react'\nimport Button from '@/components/ui/Button'\n\nexport const dynamic = 'force-dynamic'\nexport const runtime = 'nodejs'\n\nexport default function ChatPage() {\n  const { data: session, status } = useSession()\n  const [selectedUser, setSelectedUser] = useState<any>(null)\n\n  if (status === 'loading') {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-white dark:bg-neutral-900\">\n        <div className=\"text-center\">\n          <div className=\"w-16 h-16 border-4 border-primary-600 dark:border-primary-400 border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n          <p className=\"text-neutral-600 dark:text-neutral-400\">جاري التحميل...</p>\n        </div>\n      </div>\n    )\n  }\n\n  if (!session) {\n    redirect('/auth/login')\n  }\n\n  return (\n    <div className=\"min-h-screen bg-[#F5F1E8]\">\n      {/* Header */}\n      <div className=\"bg-[#004E89] text-white p-4 sm:p-6 shadow-lg\">\n        <div className=\"container mx-auto flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-4\">\n          <div className=\"flex items-center gap-3 sm:gap-4 w-full sm:w-auto\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => redirect('/')} // Assuming redirecting to homepage\n              className=\"text-white hover:bg-white/20 p-2 sm:p-2\"\n            >\n              <ArrowRight className=\"h-5 w-5 sm:h-6 sm:w-6\" />\n            </Button>\n            <div>\n              <h1 className=\"text-xl sm:text-2xl md:text-3xl font-bold\">💬 المحادثات</h1>\n              <p className=\"text-xs sm:text-sm text-gray-200 mt-1\">تواصل مع المدرسين والطلاب</p>\n            </div>\n          </div>\n          {/* Placeholder for logout button if needed, not present in original */}\n        </div>\n      </div>\n\n      <div className=\"container mx-auto px-3 sm:px-4 py-4 sm:py-6 md:py-8\">\n        <div className=\"mb-4 sm:mb-6 hidden\"> {/* Hidden as per original structure */}\n          <h1 className=\"text-2xl sm:text-3xl font-bold text-black flex items-center gap-2 sm:gap-3\">\n            <MessageCircle className=\"w-6 h-6 sm:w-8 sm:h-8 text-[#004E89]\" />\n            الرسائل\n          </h1>\n          <p className=\"text-sm sm:text-base text-black mt-1 sm:mt-2\">تواصل مع المدرسين والطلاب</p>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6 h-[calc(100vh-180px)] sm:h-[calc(100vh-200px)]\">\n          {/* Conversations List */}\n          <div className=\"lg:col-span-1 bg-[#F5F1E8] rounded-lg shadow-lg overflow-hidden border-2 border-[#d4c9b8]\">\n            <div className=\"bg-[#004E89] p-3 sm:p-4 text-white\">\n              <h2 className=\"font-bold text-base sm:text-lg\">المحادثات</h2>\n            </div>\n            <div className=\"overflow-y-auto h-[calc(100%-52px)] sm:h-[calc(100%-60px)]\">\n              <ConversationsList\n                onSelectConversation={setSelectedUser}\n                selectedUserId={selectedUser?.id}\n              />\n            </div>\n          </div>\n\n          {/* Chat Box */}\n          <div className=\"lg:col-span-2\">\n            {selectedUser ? (\n              <ChatBox\n                otherUser={selectedUser}\n                onClose={() => setSelectedUser(null)}\n              />\n            ) : (\n              <div className=\"h-full bg-[#F5F1E8] rounded-lg shadow-lg flex flex-col items-center justify-center text-black border-2 border-[#d4c9b8] p-4\">\n                <MessageCircle className=\"w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 mb-3 sm:mb-4 text-[#004E89]\" />\n                <p className=\"text-lg sm:text-xl font-medium text-center\">اختر محادثة للبدء</p>\n                <p className=\"text-xs sm:text-sm mt-1 sm:mt-2 text-center\">حدد محادثة من القائمة على اليسار</p>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n      <footer className=\"w-full py-4 sm:py-6 text-center text-sm sm:text-base text-black bg-[#F5F1E8] border-t-2 border-[#d4c9b8] mt-4 sm:mt-6 md:mt-8\">\n        <p className=\"px-4\">Made with ❤️ by MA3K Company</p>\n      </footer>\n    </div>\n  )\n}","size_bytes":4501},"components/ui/Table.tsx":{"content":"import React from 'react';\nimport { cn } from '@/lib/utils';\n\nexport interface TableProps extends React.HTMLAttributes<HTMLTableElement> {\n  responsive?: boolean;\n}\n\nconst Table = React.forwardRef<HTMLTableElement, TableProps>(\n  ({ className, responsive = true, children, ...props }, ref) => {\n    const table = (\n      <table\n        ref={ref}\n        className={cn(\n          'w-full caption-bottom text-sm border-collapse',\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </table>\n    );\n\n    if (responsive) {\n      return (\n        <div className=\"w-full overflow-x-auto rounded-lg border border-neutral-200 dark:border-neutral-800\">\n          {table}\n        </div>\n      );\n    }\n\n    return table;\n  }\n);\n\nTable.displayName = 'Table';\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead\n    ref={ref}\n    className={cn(\n      'bg-neutral-50 dark:bg-neutral-900 border-b border-neutral-200 dark:border-neutral-800',\n      className\n    )}\n    {...props}\n  />\n));\n\nTableHeader.displayName = 'TableHeader';\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn('[&_tr:last-child]:border-0', className)}\n    {...props}\n  />\n));\n\nTableBody.displayName = 'TableBody';\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      'bg-neutral-50 dark:bg-neutral-900 border-t border-neutral-200 dark:border-neutral-800 font-medium',\n      className\n    )}\n    {...props}\n  />\n));\n\nTableFooter.displayName = 'TableFooter';\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      'border-b border-neutral-200 dark:border-neutral-800 transition-colors hover:bg-neutral-50 dark:hover:bg-neutral-900/50',\n      className\n    )}\n    {...props}\n  />\n));\n\nTableRow.displayName = 'TableRow';\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      'h-12 px-4 text-left align-middle font-semibold text-neutral-900 dark:text-neutral-100 rtl:text-right [&:has([role=checkbox])]:pr-0',\n      className\n    )}\n    {...props}\n  />\n));\n\nTableHead.displayName = 'TableHead';\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\n      'p-4 align-middle text-neutral-700 dark:text-neutral-300 rtl:text-right [&:has([role=checkbox])]:pr-0',\n      className\n    )}\n    {...props}\n  />\n));\n\nTableCell.displayName = 'TableCell';\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn('mt-4 text-sm text-neutral-500 dark:text-neutral-400 rtl:text-right', className)}\n    {...props}\n  />\n));\n\nTableCaption.displayName = 'TableCaption';\n\nexport { Table, TableHeader, TableBody, TableFooter, TableHead, TableRow, TableCell, TableCaption };\n","size_bytes":3471},"scripts/check-db-fields.js":{"content":"const { PrismaClient } = require('@prisma/client');\n\nconst prisma = new PrismaClient();\n\nasync function checkFields() {\n  try {\n    // Query directly using raw SQL to check column names\n    const result = await prisma.$queryRaw`\n      SELECT column_name, data_type \n      FROM information_schema.columns \n      WHERE table_schema = 'youspeak_exercisein' \n      AND table_name = 'User'\n      ORDER BY ordinal_position\n    `;\n    \n    console.log('Columns in User table:');\n    console.log(JSON.stringify(result, null, 2));\n    \n  } catch (error) {\n    console.error('Error:', error.message);\n  } finally {\n    await prisma.$disconnect();\n  }\n}\n\ncheckFields();\n","size_bytes":659},"app/api/subscriptions/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'STUDENT') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const subscriptions = await prisma.subscription.findMany({\n      where: { studentId: session.user.id },\n      include: { package: true },\n      orderBy: { createdAt: 'desc' }\n    })\n\n    return NextResponse.json(subscriptions)\n  } catch (error) {\n    console.error('Error fetching subscriptions:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'STUDENT') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const body = await request.json()\n    const { packageId, receiptUrl } = body\n\n    if (!packageId) {\n      return NextResponse.json({ error: 'Package ID is required' }, { status: 400 })\n    }\n\n    const subscription = await prisma.subscription.create({\n      data: {\n        id: `sub_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        studentId: session.user.id,\n        packageId,\n        receiptUrl: receiptUrl || null,\n        paid: false\n      }\n    })\n\n    return NextResponse.json(subscription, { status: 201 })\n  } catch (error) {\n    console.error('Error creating subscription:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":1786},"app/api/words/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\nimport { v4 as uuidv4 } from 'uuid'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'STUDENT') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const words = await prisma.word.findMany({\n      where: { studentId: session.user.id },\n      orderBy: { createdAt: 'desc' }\n    })\n\n    return NextResponse.json(words)\n  } catch (error) {\n    console.error('Error fetching words:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'STUDENT') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const body = await request.json()\n    const { englishWord, arabicMeaning, exampleSentence } = body\n\n    if (!englishWord || !arabicMeaning) {\n      return NextResponse.json({ error: 'Missing required fields' }, { status: 400 })\n    }\n\n    const word = await prisma.word.create({\n      data: {\n        id: uuidv4(),\n        studentId: session.user.id,\n        englishWord,\n        arabicMeaning,\n        exampleSentence: exampleSentence || null\n      }\n    })\n\n    const serializedWord = {\n      ...word,\n      createdAt: word.createdAt.toISOString(),\n      updatedAt: word.updatedAt.toISOString()\n    }\n\n    return NextResponse.json(serializedWord, { status: 201 })\n  } catch (error) {\n    console.error('Error creating word:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":1881},"prisma/setup-db.js":{"content":"const { Client } = require('pg');\n\nconst client = new Client({\n  connectionString: process.env.EXTERNAL_DATABASE_URL,\n  options: '-c search_path=public'\n});\n\nasync function setup() {\n  try {\n    await client.connect();\n    console.log('✅ Connected');\n    \n    // Set search path for this session\n    await client.query('SET search_path TO public;');\n    \n    // Create enums\n    await client.query(`CREATE TYPE \"UserRole\" AS ENUM ('STUDENT', 'TEACHER', 'ADMIN', 'ASSISTANT', 'GUEST');`);\n    console.log('✅ Enums created');\n    \n    await client.end();\n  } catch (error) {\n    console.error('Error:', error.message);\n    try { await client.end(); } catch(e) {}\n  }\n}\n\nsetup();\n","size_bytes":681},"scripts/test-connection.js":{"content":"const { PrismaClient } = require('@prisma/client');\n\nconst prisma = new PrismaClient({\n  log: ['query', 'info', 'warn', 'error'],\n});\n\nasync function testConnection() {\n  try {\n    console.log('Testing database connection...');\n    console.log('DATABASE_URL is set:', !!process.env.DATABASE_URL);\n    console.log('');\n    \n    // Try a simple query\n    const result = await prisma.$queryRaw`SELECT current_database(), current_schema()`;\n    console.log('✅ Connected to database:');\n    console.log(result);\n    \n    // Try to list schemas\n    const schemas = await prisma.$queryRaw`\n      SELECT schema_name \n      FROM information_schema.schemata \n      WHERE schema_name NOT IN ('pg_catalog', 'information_schema', 'pg_toast')\n      ORDER BY schema_name\n    `;\n    console.log('\\n📂 Available schemas:');\n    console.log(schemas);\n    \n  } catch (error) {\n    console.error('❌ Connection error:', error.message);\n    console.error('Stack:', error.stack);\n  } finally {\n    await prisma.$disconnect();\n  }\n}\n\ntestConnection();\n","size_bytes":1034},"app/api/admin/packages/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { prisma } from '@/lib/prisma'\nimport { requireAdmin, parseJsonBody, isNextResponse } from '@/lib/auth-helpers'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const admin = await requireAdmin()\n    if (isNextResponse(admin)) return admin\n\n    const packages = await prisma.package.findMany({\n      orderBy: { createdAt: 'desc' }\n    })\n\n    return NextResponse.json(packages)\n  } catch (error) {\n    console.error('Error fetching packages:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const admin = await requireAdmin()\n    if (isNextResponse(admin)) return admin\n\n    const body = await parseJsonBody<{\n      title: string\n      titleAr: string\n      description?: string\n      descriptionAr?: string\n      price: number\n      lessonsCount: number\n      durationDays: number\n      isActive?: boolean\n    }>(request)\n    if (isNextResponse(body)) return body\n\n    const { title, titleAr, description, descriptionAr, price, lessonsCount, durationDays, isActive } = body\n\n    if (!title || !titleAr || price === undefined || !lessonsCount || !durationDays) {\n      return NextResponse.json({ error: 'Missing required fields' }, { status: 400 })\n    }\n\n    if (price < 0 || lessonsCount < 1 || durationDays < 1) {\n      return NextResponse.json({ error: 'Invalid values' }, { status: 400 })\n    }\n\n    const newPackage = await prisma.package.create({\n      data: {\n        id: `pkg_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        title,\n        titleAr,\n        description: description || null,\n        descriptionAr: descriptionAr || null,\n        price,\n        lessonsCount,\n        durationDays,\n        isActive: isActive !== undefined ? isActive : true\n      }\n    })\n\n    return NextResponse.json(newPackage, { status: 201 })\n  } catch (error) {\n    console.error('Error creating package:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":2105},"lib/providers/SessionProvider.tsx":{"content":"'use client'\n\nimport { SessionProvider as NextAuthSessionProvider } from 'next-auth/react'\n\nexport default function SessionProvider({ children }: { children: React.ReactNode }) {\n  return <NextAuthSessionProvider>{children}</NextAuthSessionProvider>\n}\n","size_bytes":252},"prisma/create-tables.js":{"content":"const { Client } = require('pg');\n\nconst client = new Client({\n  connectionString: process.env.EXTERNAL_DATABASE_URL\n});\n\nasync function createTables() {\n  try {\n    await client.connect();\n    console.log('✅ Connected successfully');\n    \n    // Create enums\n    await client.query(`\n      DO $$ BEGIN\n        CREATE TYPE \"UserRole\" AS ENUM ('STUDENT', 'TEACHER', 'ADMIN', 'ASSISTANT', 'GUEST');\n      EXCEPTION\n        WHEN duplicate_object THEN null;\n      END $$;\n    `);\n    console.log('✅ UserRole enum created');\n    \n    await client.query(`\n      DO $$ BEGIN\n        CREATE TYPE \"SessionStatus\" AS ENUM ('SCHEDULED', 'ONGOING', 'COMPLETED', 'CANCELLED');\n      EXCEPTION\n        WHEN duplicate_object THEN null;\n      END $$;\n    `);\n    console.log('✅ SessionStatus enum created');\n    \n    await client.query(`\n      DO $$ BEGIN\n        CREATE TYPE \"LanguageLevel\" AS ENUM ('A1', 'A2', 'B1', 'B2');\n      EXCEPTION\n        WHEN duplicate_object THEN null;\n      END $$;\n    `);\n    console.log('✅ LanguageLevel enum created');\n    \n    // Create User table\n    await client.query(`\n      CREATE TABLE IF NOT EXISTS \"User\" (\n        id TEXT PRIMARY KEY DEFAULT gen_random_uuid()::text,\n        email TEXT UNIQUE NOT NULL,\n        name TEXT NOT NULL,\n        phone TEXT,\n        \"passwordHash\" TEXT NOT NULL,\n        role \"UserRole\" DEFAULT 'STUDENT'::\\\"UserRole\\\" NOT NULL,\n        \"profilePhoto\" TEXT,\n        \"isActive\" BOOLEAN DEFAULT false NOT NULL,\n        \"createdAt\" TIMESTAMP(3) DEFAULT CURRENT_TIMESTAMP NOT NULL,\n        \"updatedAt\" TIMESTAMP(3) NOT NULL\n      );\n    `);\n    console.log('✅ User table created');\n    \n    await client.end();\n    console.log('✅ Basic tables created! Now running prisma db push...');\n  } catch (error) {\n    console.error('❌ Error:', error.message);\n    console.error(error);\n    await client.end();\n    process.exit(1);\n  }\n}\n\ncreateTables();\n","size_bytes":1910},"README.md":{"content":"This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).\n\n## Getting Started\n\nFirst, run the development server:\n\n```bash\nnpm run dev\n# or\nyarn dev\n# or\npnpm dev\n# or\nbun dev\n```\n\nOpen [http://localhost:3000](http://localhost:3000) with your browser to see the result.\n\nYou can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.\n\nThis project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.\n\n## Learn More\n\nTo learn more about Next.js, take a look at the following resources:\n\n- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.\n- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.\n\nYou can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!\n\n## Deploy on Vercel\n\nThe easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.\n\nCheck out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.\n","size_bytes":1450},"attached_assets/schema_1763165430387.ts":{"content":"import { sql } from 'drizzle-orm';\nimport {\n  index,\n  jsonb,\n  pgTable,\n  pgSchema,\n  timestamp,\n  varchar,\n  text,\n  integer,\n  boolean,\n  decimal,\n  date,\n  unique,\n} from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nconst bustanSchema = pgSchema(\"bustan\");\n\n// Session storage table (required for Replit Auth)\nexport const sessions = bustanSchema.table(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// User storage table (required for Replit Auth)\nexport const users = bustanSchema.table(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: varchar(\"email\").unique(),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  // Additional fields for Islamic education platform\n  role: varchar(\"role\").default(\"student\"), // student, supervisor, admin\n  passwordHash: varchar(\"password_hash\"), // Secure password storage for all roles\n  phoneNumber: varchar(\"phone_number\"),\n  age: integer(\"age\"),\n  educationLevel: varchar(\"education_level\"),\n  quranExperience: varchar(\"quran_experience\"),\n  memorization_level: varchar(\"memorization_level\"), // مستوى الحفظ: لم أبدأ، أقل من جزء، جزء واحد، أكثر من جزء، إلخ\n  learningGoals: text(\"learning_goals\"),\n  preferredTime: varchar(\"preferred_time\"),\n  whatsappNumber: varchar(\"whatsapp_number\"),\n  emailVerified: boolean(\"email_verified\").default(false), // للتحقق من البريد الإلكتروني\n  passwordResetToken: varchar(\"password_reset_token\"), // رمز إعادة تعيين كلمة المرور\n  passwordResetExpiry: timestamp(\"password_reset_expiry\"), // تاريخ انتهاء الرمز\n  isActive: boolean(\"is_active\").default(true),\n  registrationCompleted: boolean(\"registration_completed\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Courses table\nexport const courses = bustanSchema.table(\"courses\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  titleAr: varchar(\"title_ar\").notNull(),\n  titleEn: varchar(\"title_en\"),\n  descriptionAr: text(\"description_ar\"),\n  descriptionEn: text(\"description_en\"),\n  startDate: timestamp(\"start_date\").notNull(),\n  endDate: timestamp(\"end_date\"),\n  instructorId: varchar(\"instructor_id\").references(() => instructors.id),\n  createdBy: varchar(\"created_by\").references(() => users.id), // Sheikh who created the course\n  level: varchar(\"level\").notNull(), // beginner, intermediate, advanced\n  category: varchar(\"category\").notNull(), // quran, fiqh, ramadan\n  maxStudents: integer(\"max_students\").default(50),\n  currentStudents: integer(\"current_students\").default(0),\n  price: integer(\"price\").default(0), // in cents\n  isPaid: boolean(\"is_paid\").default(false), // whether course requires payment\n  thumbnailUrl: varchar(\"thumbnail_url\"), // course thumbnail image\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Instructors table\nexport const instructors = bustanSchema.table(\"instructors\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  nameAr: varchar(\"name_ar\").notNull(),\n  nameEn: varchar(\"name_en\"),\n  titleAr: varchar(\"title_ar\"),\n  titleEn: varchar(\"title_en\"),\n  bioAr: text(\"bio_ar\"),\n  bioEn: text(\"bio_en\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  qualifications: text(\"qualifications\"),\n  experience: text(\"experience\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Course Enrollments table\nexport const courseEnrollments = bustanSchema.table(\"course_enrollments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  courseId: varchar(\"course_id\").references(() => courses.id).notNull(),\n  enrollmentDate: timestamp(\"enrollment_date\").defaultNow(),\n  status: varchar(\"status\").default(\"enrolled\"), // enrolled, completed, dropped\n  progress: integer(\"progress\").default(0), // percentage\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Contact messages table\nexport const contactMessages = bustanSchema.table(\"contact_messages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: varchar(\"name\").notNull(),\n  email: varchar(\"email\").notNull(),\n  phone: varchar(\"phone\"),\n  subject: varchar(\"subject\").notNull(),\n  message: text(\"message\").notNull(),\n  isRead: boolean(\"is_read\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Students table for detailed student management\nexport const students = bustanSchema.table(\"students\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id),\n  sheikhId: varchar(\"sheikh_id\").references(() => users.id), // Sheikh assigned to this student\n  studentName: varchar(\"student_name\").notNull(),\n  passwordHash: varchar(\"password_hash\").notNull(), // Hashed password for security\n  phoneNumber: varchar(\"phone_number\"), // رقم الهاتف\n  dateOfBirth: date(\"date_of_birth\"),\n  grade: varchar(\"grade\"), // الصف الدراسي\n  monthlySessionsCount: integer(\"monthly_sessions_count\").default(0),\n  monthlyPrice: decimal(\"monthly_price\", { precision: 10, scale: 2 }).default(\"0\"),\n  isPaid: boolean(\"is_paid\").default(false),\n  isActive: boolean(\"is_active\").default(true),\n  memorizedSurahs: text(\"memorized_surahs\"), // JSON string of memorized surahs\n  currentLevel: varchar(\"current_level\").default(\"beginner\"), // beginner, intermediate, advanced\n  notes: text(\"notes\"), // ملاحظات عامة\n  whatsappContact: varchar(\"whatsapp_contact\").default(\"+966532441566\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Student sessions/classes table\nexport const studentSessions = bustanSchema.table(\"student_sessions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  studentId: varchar(\"student_id\").references(() => students.id).notNull(),\n  sessionNumber: integer(\"session_number\").notNull(),\n  sessionDate: date(\"session_date\").notNull(),\n  sessionTime: varchar(\"session_time\"), // e.g., \"4:00 PM\"\n  evaluationGrade: varchar(\"evaluation_grade\"), // ممتاز، جيد جداً، جيد، مقبول\n  nextSessionDate: date(\"next_session_date\"),\n  newMaterial: text(\"new_material\"), // الجديد\n  reviewMaterial: text(\"review_material\"), // المراجعة\n  notes: text(\"notes\"),\n  attended: boolean(\"attended\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Student recitation errors table - enhanced with Sheikh notes\nexport const studentErrors = bustanSchema.table(\"student_errors\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  studentId: varchar(\"student_id\").references(() => students.id).notNull(),\n  sheikhId: varchar(\"sheikh_id\").references(() => users.id),\n  surahNumber: integer(\"surah_number\").notNull(),\n  surahName: varchar(\"surah_name\").notNull(),\n  ayahNumber: integer(\"ayah_number\").notNull(),\n  wordIndex: integer(\"word_index\"), // specific word if applicable\n  errorType: varchar(\"error_type\").default(\"recitation\"), // recitation, memorization, tajweed\n  errorDescription: text(\"error_description\"),\n  sheikhNote: text(\"sheikh_note\"), // Sheikh's detailed feedback\n  severity: varchar(\"severity\").default(\"medium\"), // low, medium, high\n  isResolved: boolean(\"is_resolved\").default(false),\n  resolvedDate: date(\"resolved_date\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"student_errors_student_idx\").on(table.studentId),\n  index(\"student_errors_surah_ayah_idx\").on(table.surahNumber, table.ayahNumber),\n]);\n\n// Student payments and subscriptions\nexport const studentPayments = bustanSchema.table(\"student_payments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  studentId: varchar(\"student_id\").references(() => students.id).notNull(),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  currency: varchar(\"currency\").default(\"SAR\"),\n  paymentDate: timestamp(\"payment_date\").defaultNow(),\n  paymentMethod: varchar(\"payment_method\").default(\"whatsapp\"), // whatsapp, bank, cash\n  subscriptionPeriod: varchar(\"subscription_period\").default(\"monthly\"), // monthly, quarterly, yearly\n  sessionsIncluded: integer(\"sessions_included\").notNull(),\n  sessionsRemaining: integer(\"sessions_remaining\").notNull(),\n  expiryDate: date(\"expiry_date\"),\n  status: varchar(\"status\").default(\"active\"), // active, expired, pending\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Class schedules\nexport const classSchedules = bustanSchema.table(\"class_schedules\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  studentId: varchar(\"student_id\").references(() => students.id).notNull(),\n  dayOfWeek: integer(\"day_of_week\").notNull(), // 0-6 (Sunday=0)\n  startTime: varchar(\"start_time\").notNull(), // HH:MM format\n  endTime: varchar(\"end_time\").notNull(), // HH:MM format\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Quizzes/Exams table for courses\nexport const quizzes = bustanSchema.table(\"quizzes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  courseId: varchar(\"course_id\").references(() => courses.id).notNull(),\n  titleAr: varchar(\"title_ar\").notNull(),\n  titleEn: varchar(\"title_en\"),\n  passingScore: integer(\"passing_score\").default(75), // percentage\n  timeLimit: integer(\"time_limit\"), // minutes\n  questions: text(\"questions\"), // JSON string\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Quiz attempts table\nexport const quizAttempts = bustanSchema.table(\"quiz_attempts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  quizId: varchar(\"quiz_id\").references(() => quizzes.id).notNull(),\n  studentId: varchar(\"student_id\").references(() => students.id).notNull(),\n  score: integer(\"score\").notNull(), // percentage\n  answers: text(\"answers\"), // JSON string\n  passed: boolean(\"passed\").default(false),\n  attemptDate: timestamp(\"attempt_date\").defaultNow(),\n  completedAt: timestamp(\"completed_at\"),\n  antiCheatLog: text(\"anti_cheat_log\"), // JSON string for monitoring\n});\n\n// Session access control table\nexport const sessionAccess = bustanSchema.table(\"session_access\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  studentId: varchar(\"student_id\").references(() => students.id).notNull(),\n  scheduleId: varchar(\"schedule_id\").references(() => classSchedules.id).notNull(),\n  sessionDate: date(\"session_date\").notNull(),\n  startTime: varchar(\"start_time\").notNull(),\n  endTime: varchar(\"end_time\").notNull(),\n  zoomLink: varchar(\"zoom_link\"), // Nullable zoom link for online sessions\n  isEnabled: boolean(\"is_enabled\").default(false),\n  enabledBy: varchar(\"enabled_by\").references(() => users.id),\n  enabledAt: timestamp(\"enabled_at\"),\n});\n\n// Student daily assignments table\nexport const dailyAssignments = bustanSchema.table(\"daily_assignments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  studentId: varchar(\"student_id\").references(() => students.id).notNull(),\n  assignmentDate: date(\"assignment_date\").notNull(),\n  memorization: text(\"memorization\"), // New verses to memorize\n  review: text(\"review\"), // Verses to review\n  mistakes: text(\"mistakes\"), // JSON string of today's mistakes\n  notes: text(\"notes\"),\n  assignedBy: varchar(\"assigned_by\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Educational trips table\nexport const trips = bustanSchema.table(\"trips\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  titleAr: varchar(\"title_ar\").notNull(),\n  titleEn: varchar(\"title_en\"),\n  descriptionAr: text(\"description_ar\"),\n  descriptionEn: text(\"description_en\"),\n  tripDate: date(\"trip_date\").notNull(),\n  location: varchar(\"location\").notNull(),\n  capacity: integer(\"capacity\").default(50),\n  currentEnrollments: integer(\"current_enrollments\").default(0),\n  price: integer(\"price\").default(0), // in halalas (smallest SAR unit)\n  imageUrl: varchar(\"image_url\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Trip enrollments table\nexport const tripEnrollments = bustanSchema.table(\"trip_enrollments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  tripId: varchar(\"trip_id\").references(() => trips.id).notNull(),\n  enrollmentDate: timestamp(\"enrollment_date\").defaultNow(),\n  status: varchar(\"status\").default(\"enrolled\"), // enrolled, completed, cancelled\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  unique(\"trip_enrollments_user_trip_unique\").on(table.userId, table.tripId),\n]);\n\n// Student personal Quran notes table - for students to save their own notes on verses\nexport const quranNotes = bustanSchema.table(\"quran_notes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  studentId: varchar(\"student_id\").references(() => users.id).notNull(),\n  sheikhId: varchar(\"sheikh_id\").references(() => users.id), // null if student's own note\n  surahNumber: integer(\"surah_number\").notNull(),\n  ayahNumber: integer(\"ayah_number\").notNull(),\n  note: text(\"note\"),\n  noteText: text(\"note_text\"), // alternate field name for compatibility\n  noteType: varchar(\"note_type\").default(\"student\"), // student, sheikh_general, sheikh_error, sheikh_improvement\n  tags: text(\"tags\"), // JSON string of tags\n  isVisible: boolean(\"is_visible\").default(true), // visible to student\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"quran_notes_student_idx\").on(table.studentId),\n  index(\"quran_notes_sheikh_idx\").on(table.sheikhId),\n  index(\"quran_notes_surah_ayah_idx\").on(table.surahNumber, table.ayahNumber),\n]);\n\n// Quran progress table - to track reading progress\nexport const quranProgress = bustanSchema.table(\"quran_progress\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  studentId: varchar(\"student_id\").references(() => users.id).notNull(),\n  lastSurah: integer(\"last_surah\").default(1),\n  lastAyah: integer(\"last_ayah\").default(1),\n  bookmarkedVerses: text(\"bookmarked_verses\"), // JSON string of bookmarked verses\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  unique(\"quran_progress_student_unique\").on(table.studentId),\n]);\n\n// Supervisors table - for supervisor management\nexport const supervisors = bustanSchema.table(\"supervisors\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id),\n  name: varchar(\"name\").notNull(),\n  whatsappNumber: varchar(\"whatsapp_number\").notNull(),\n  specialization: varchar(\"specialization\"), // Quran, Fiqh, General\n  experience: text(\"experience\"),\n  qualifications: text(\"qualifications\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Student notes table - for supervisor notes on students\nexport const studentNotes = bustanSchema.table(\"student_notes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  studentId: varchar(\"student_id\").references(() => students.id).notNull(),\n  authorId: varchar(\"author_id\").references(() => users.id).notNull(), // Who wrote the note\n  note: text(\"note\").notNull(),\n  noteType: varchar(\"note_type\").default(\"general\"), // general, behavioral, academic, attendance\n  isPrivate: boolean(\"is_private\").default(false), // Visible to parents or not\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Course modules/content table\nexport const courseModules = bustanSchema.table(\"course_modules\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  courseId: varchar(\"course_id\").references(() => courses.id).notNull(),\n  titleAr: varchar(\"title_ar\").notNull(),\n  titleEn: varchar(\"title_en\"),\n  descriptionAr: text(\"description_ar\"),\n  descriptionEn: text(\"description_en\"),\n  contentAr: text(\"content_ar\"), // Module content in Arabic\n  contentEn: text(\"content_en\"), // Module content in English\n  orderIndex: integer(\"order_index\").notNull().default(0), // Module order in course\n  videoUrl: varchar(\"video_url\"), // Optional video link\n  documentUrl: varchar(\"document_url\"), // Optional document link\n  duration: integer(\"duration\"), // Duration in minutes\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Course stages/lessons - for organizing course into stages\nexport const courseStages = bustanSchema.table(\"course_stages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  moduleId: varchar(\"module_id\").references(() => courseModules.id).notNull(),\n  titleAr: varchar(\"title_ar\").notNull(),\n  titleEn: varchar(\"title_en\"),\n  descriptionAr: text(\"description_ar\"),\n  descriptionEn: text(\"description_en\"),\n  orderIndex: integer(\"order_index\").notNull().default(0),\n  isLocked: boolean(\"is_locked\").default(false), // locked until previous stage is completed\n  passingScore: integer(\"passing_score\").default(75), // minimum score to pass this stage\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Course uploads - for multimedia content (videos, images, documents)\nexport const courseUploads = bustanSchema.table(\"course_uploads\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  courseId: varchar(\"course_id\").references(() => courses.id).notNull(),\n  stageId: varchar(\"stage_id\").references(() => courseStages.id), // optional - link to specific stage\n  uploadedBy: varchar(\"uploaded_by\").references(() => users.id).notNull(), // Sheikh who uploaded\n  fileUrl: varchar(\"file_url\").notNull(),\n  fileName: varchar(\"file_name\").notNull(),\n  fileType: varchar(\"file_type\").notNull(), // video, image, pdf, document\n  fileSize: integer(\"file_size\"), // in bytes\n  titleAr: varchar(\"title_ar\"),\n  titleEn: varchar(\"title_en\"),\n  descriptionAr: text(\"description_ar\"),\n  descriptionEn: text(\"description_en\"),\n  orderIndex: integer(\"order_index\").notNull().default(0),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Exam questions table\nexport const examQuestions = bustanSchema.table(\"exam_questions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  courseId: varchar(\"course_id\").references(() => courses.id).notNull(),\n  questionAr: text(\"question_ar\").notNull(),\n  questionEn: text(\"question_en\"),\n  optionsAr: text(\"options_ar\").notNull(), // JSON array of options in Arabic\n  optionsEn: text(\"options_en\"), // JSON array of options in English\n  correctAnswer: integer(\"correct_answer\").notNull(), // Index of correct option (0-based)\n  explanation: text(\"explanation\"), // Explanation for the correct answer\n  points: integer(\"points\").default(1), // Points for this question\n  orderIndex: integer(\"order_index\").notNull().default(0),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Student exam attempts table\nexport const examAttempts = bustanSchema.table(\"exam_attempts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  studentId: varchar(\"student_id\").references(() => users.id).notNull(),\n  courseId: varchar(\"course_id\").references(() => courses.id).notNull(),\n  answers: text(\"answers\").notNull(), // JSON object mapping question ID to answer index\n  score: integer(\"score\").notNull(), // Total score achieved\n  totalPoints: integer(\"total_points\").notNull(), // Total possible points\n  percentage: decimal(\"percentage\", { precision: 5, scale: 2 }).notNull(), // Percentage score\n  passed: boolean(\"passed\").notNull().default(false), // true if >= 75%\n  startTime: timestamp(\"start_time\").notNull(),\n  submitTime: timestamp(\"submit_time\").notNull(),\n  timeTaken: integer(\"time_taken\"), // Time taken in seconds\n  certificateIssued: boolean(\"certificate_issued\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Live session rooms - for built-in live classes (replaces Zoom)\nexport const liveRooms = bustanSchema.table(\"live_rooms\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  studentId: varchar(\"student_id\").references(() => students.id).notNull(),\n  sheikhId: varchar(\"sheikh_id\").references(() => users.id).notNull(),\n  sessionDate: timestamp(\"session_date\").notNull(),\n  sessionTime: varchar(\"session_time\").notNull(),\n  roomToken: varchar(\"room_token\").unique().notNull().default(sql`gen_random_uuid()`),\n  status: varchar(\"status\").default(\"scheduled\"), // scheduled, active, completed, cancelled\n  startedAt: timestamp(\"started_at\"),\n  endedAt: timestamp(\"ended_at\"),\n  duration: integer(\"duration\"), // in minutes\n  isEnabled: boolean(\"is_enabled\").default(false),\n  enabledAt: timestamp(\"enabled_at\"),\n  notes: text(\"notes\"),\n  password: varchar(\"password\"), // Optional password for session\n  allowedStudentIds: varchar(\"allowed_student_ids\").array(), // Array of student IDs allowed to join\n  entryAccessWindowMinutes: integer(\"entry_access_window_minutes\").default(15), // Minutes before/after start time to allow entry\n  cancellationReason: text(\"cancellation_reason\"), // Reason if cancelled\n  cancelledBy: varchar(\"cancelled_by\").references(() => users.id), // Who cancelled the session\n  cancelledAt: timestamp(\"cancelled_at\"), // When it was cancelled\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"live_rooms_student_idx\").on(table.studentId),\n  index(\"live_rooms_sheikh_idx\").on(table.sheikhId),\n  index(\"live_rooms_token_idx\").on(table.roomToken),\n]);\n\n// Live session participants - tracks who's in each live session\nexport const roomParticipants = bustanSchema.table(\"room_participants\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  roomId: varchar(\"room_id\").references(() => liveRooms.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  role: varchar(\"role\").notNull(), // sheikh, student\n  joinedAt: timestamp(\"joined_at\").defaultNow(),\n  leftAt: timestamp(\"left_at\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Live annotations - Sheikh's real-time annotations on student's Quran\nexport const liveAnnotations = bustanSchema.table(\"live_annotations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  roomId: varchar(\"room_id\").references(() => liveRooms.id).notNull(),\n  sheikhId: varchar(\"sheikh_id\").references(() => users.id).notNull(),\n  studentId: varchar(\"student_id\").references(() => students.id).notNull(),\n  surahNumber: integer(\"surah_number\").notNull(),\n  ayahNumber: integer(\"ayah_number\").notNull(),\n  wordIndex: integer(\"word_index\"), // null for full ayah annotation\n  annotationType: varchar(\"annotation_type\").notNull(), // highlight, note, error, correction\n  highlightColor: varchar(\"highlight_color\"), // for highlights\n  noteText: text(\"note_text\"), // for notes\n  isPermanent: boolean(\"is_permanent\").default(true), // keep after session ends\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"live_annotations_room_idx\").on(table.roomId),\n  index(\"live_annotations_student_idx\").on(table.studentId),\n  index(\"live_annotations_surah_ayah_idx\").on(table.surahNumber, table.ayahNumber),\n]);\n\n// Session access control - controls when students can access session links\nexport const sessionAccessControl = bustanSchema.table(\"session_access_control\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  studentId: varchar(\"student_id\").references(() => students.id).notNull(),\n  sessionDate: date(\"session_date\").notNull(),\n  sessionTime: varchar(\"session_time\").notNull(), // e.g., \"4:00 PM\"\n  isEnabled: boolean(\"is_enabled\").default(false), // Sheikh controls this\n  enabledAt: timestamp(\"enabled_at\"), // When sheikh enabled access\n  enabledBy: varchar(\"enabled_by\").references(() => users.id), // Sheikh who enabled\n  expiresAt: timestamp(\"expires_at\"), // Optional expiry time\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Messages table - for real-time chat between teacher and students\nexport const messages = bustanSchema.table(\"messages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  senderId: varchar(\"sender_id\").references(() => users.id).notNull(),\n  receiverId: varchar(\"receiver_id\").references(() => users.id), // null for group messages\n  content: text(\"content\").notNull(),\n  messageType: varchar(\"message_type\").default(\"text\"), // text, image, file\n  isRead: boolean(\"is_read\").default(false),\n  readAt: timestamp(\"read_at\"),\n  isGroupMessage: boolean(\"is_group_message\").default(false), // For broadcasting to all students\n  roomId: varchar(\"room_id\"), // للربط بغرفة محادثة محددة\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Notifications table - for student notifications\nexport const notifications = bustanSchema.table(\"notifications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  titleAr: varchar(\"title_ar\").notNull(),\n  titleEn: varchar(\"title_en\"),\n  messageAr: text(\"message_ar\").notNull(),\n  messageEn: text(\"message_en\"),\n  type: varchar(\"type\").notNull(), // lesson, assignment, announcement, system\n  isRead: boolean(\"is_read\").default(false),\n  readAt: timestamp(\"read_at\"),\n  actionUrl: varchar(\"action_url\"), // URL to navigate when clicked\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"notifications_user_idx\").on(table.userId),\n  index(\"notifications_read_idx\").on(table.isRead),\n]);\n\n// Quran word highlights table - for highlighting and annotating individual words\nexport const quranWordHighlights = bustanSchema.table(\"quran_word_highlights\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  studentId: varchar(\"student_id\").references(() => users.id).notNull(),\n  surahNumber: integer(\"surah_number\").notNull(),\n  ayahNumber: integer(\"ayah_number\").notNull(),\n  wordIndex: integer(\"word_index\").notNull(), // Position of word in ayah (0-based)\n  wordText: varchar(\"word_text\").notNull(), // The actual word text for reference\n  highlightColor: varchar(\"highlight_color\").default(\"red\"), // red, yellow, blue, green\n  note: text(\"note\"), // Optional note for this word\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Quran memorization tracking table - tracks which ayahs are being memorized and review progress\nexport const quranMemorization = bustanSchema.table(\"quran_memorization\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  studentId: varchar(\"student_id\").references(() => users.id).notNull(),\n  surahNumber: integer(\"surah_number\").notNull(),\n  fromAyah: integer(\"from_ayah\").notNull(),\n  toAyah: integer(\"to_ayah\").notNull(),\n  status: varchar(\"status\").default(\"in_progress\"), // in_progress, completed, reviewing\n  masteryLevel: integer(\"mastery_level\").default(0), // 0-100\n  lastReviewed: timestamp(\"last_reviewed\"),\n  nextReviewDate: timestamp(\"next_review_date\"), // Calculated next review date based on spaced repetition\n  reviewCount: integer(\"review_count\").default(0),\n  lastDifficulty: varchar(\"last_difficulty\"), // easy, medium, hard - last review difficulty rating\n  mistakes: text(\"mistakes\"), // JSON string of common mistakes\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Quran reading statistics table - tracks daily reading and progress\nexport const quranReadingStats = bustanSchema.table(\"quran_reading_stats\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  studentId: varchar(\"student_id\").references(() => users.id).notNull(),\n  readingDate: date(\"reading_date\").notNull(),\n  ayahsRead: integer(\"ayahs_read\").default(0),\n  pagesRead: integer(\"pages_read\").default(0),\n  minutesSpent: integer(\"minutes_spent\").default(0),\n  surahsCompleted: text(\"surahs_completed\"), // JSON array of surah numbers completed today\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  unique(\"quran_reading_stats_student_date_unique\").on(table.studentId, table.readingDate),\n]);\n\n// Quran ayah markers table - for marking individual ayahs for memorization or review\nexport const quranAyahMarkers = bustanSchema.table(\"quran_ayah_markers\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  studentId: varchar(\"student_id\").references(() => users.id).notNull(),\n  surahNumber: integer(\"surah_number\").notNull(),\n  ayahNumber: integer(\"ayah_number\").notNull(),\n  markerType: varchar(\"marker_type\", { enum: ['memorization', 'review', 'bookmark', 'completed'] }).notNull(),\n  markerColor: varchar(\"marker_color\", { enum: ['blue', 'green', 'yellow', 'red', 'orange'] }).default(\"blue\"),\n  isActive: boolean(\"is_active\").default(true),\n  priority: integer(\"priority\").default(0), // for ordering markers\n  note: text(\"note\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"quran_ayah_markers_student_idx\").on(table.studentId),\n  index(\"quran_ayah_markers_surah_ayah_idx\").on(table.surahNumber, table.ayahNumber),\n  unique(\"quran_ayah_markers_unique\").on(table.studentId, table.surahNumber, table.ayahNumber, table.markerType),\n]);\n\n// Quran recitation attempts table - tracks recitation practice and corrections\nexport const quranRecitationAttempts = bustanSchema.table(\"quran_recitation_attempts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  studentId: varchar(\"student_id\").references(() => users.id).notNull(),\n  surahNumber: integer(\"surah_number\").notNull(),\n  fromAyah: integer(\"from_ayah\").notNull(),\n  toAyah: integer(\"to_ayah\").notNull(),\n  attemptDate: timestamp(\"attempt_date\").defaultNow(),\n  totalAyahs: integer(\"total_ayahs\").notNull(),\n  correctAyahs: integer(\"correct_ayahs\").default(0),\n  mistakes: text(\"mistakes\"), // JSON array of mistakes {ayahNumber, type, description}\n  score: integer(\"score\"), // percentage score 0-100\n  duration: integer(\"duration\"), // duration in seconds\n  isCompleted: boolean(\"is_completed\").default(false),\n  mode: varchar(\"mode\", { enum: ['practice', 'test', 'review'] }).default(\"practice\"),\n  feedback: text(\"feedback\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"quran_recitation_attempts_student_idx\").on(table.studentId),\n  index(\"quran_recitation_attempts_date_idx\").on(table.attemptDate),\n  index(\"quran_recitation_attempts_student_surah_date_idx\").on(table.studentId, table.surahNumber, table.attemptDate),\n]);\n\n// Certificates table - for course completion and achievements\nexport const certificates = bustanSchema.table(\"certificates\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  studentId: varchar(\"student_id\").references(() => users.id).notNull(),\n  courseId: varchar(\"course_id\").references(() => courses.id),\n  examAttemptId: varchar(\"exam_attempt_id\").references(() => examAttempts.id), // Link to exam attempt\n  titleAr: varchar(\"title_ar\").notNull(),\n  titleEn: varchar(\"title_en\"),\n  descriptionAr: text(\"description_ar\"),\n  descriptionEn: text(\"description_en\"),\n  issuedAt: timestamp(\"issued_at\").defaultNow(),\n  issuedBy: varchar(\"issued_by\").references(() => users.id), // Supervisor who issued\n  code: varchar(\"code\").unique().notNull().default(sql`gen_random_uuid()`), // UUID for QR verification\n  certificateNumber: varchar(\"certificate_number\").unique().notNull().default(sql`gen_random_uuid()`), // Unique certificate number\n  grade: varchar(\"grade\"), // ممتاز، جيد جداً، جيد\n  score: integer(\"score\"), // Exam score if from exam\n  teacherName: varchar(\"teacher_name\"),\n  qrImageDataUrl: text(\"qr_image_data_url\"), // Base64 QR code image\n  verificationToken: varchar(\"verification_token\").unique().notNull().default(sql`gen_random_uuid()`), // For QR verification\n  status: varchar(\"status\").default(\"valid\"), // valid, revoked, expired\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"certificates_code_idx\").on(table.code),\n  index(\"certificates_verification_token_idx\").on(table.verificationToken),\n  index(\"certificates_number_idx\").on(table.certificateNumber),\n]);\n\n// Create insert schemas\nexport const insertUserSchema = createInsertSchema(users).pick({\n  email: true,\n  firstName: true,\n  lastName: true,\n  profileImageUrl: true,\n  phoneNumber: true,\n  age: true,\n  educationLevel: true,\n  quranExperience: true,\n  learningGoals: true,\n  preferredTime: true,\n  whatsappNumber: true,\n});\n\nexport const insertCourseSchema = createInsertSchema(courses).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertInstructorSchema = createInsertSchema(instructors).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertEnrollmentSchema = createInsertSchema(courseEnrollments).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertContactMessageSchema = createInsertSchema(contactMessages).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertStudentSchema = createInsertSchema(students).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const studentUpdateSchema = insertStudentSchema.partial().extend({\n  phoneNumber: z.string().optional(),\n  monthlyPrice: z.string().or(z.number()).optional(),\n  monthlySessionsCount: z.number().optional(),\n});\n\nexport const insertStudentSessionSchema = createInsertSchema(studentSessions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertStudentErrorSchema = createInsertSchema(studentErrors).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertStudentPaymentSchema = createInsertSchema(studentPayments).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertClassScheduleSchema = createInsertSchema(classSchedules).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertSessionAccessSchema = createInsertSchema(sessionAccess).omit({\n  id: true,\n  enabledAt: true,\n});\n\nexport const insertDailyAssignmentSchema = createInsertSchema(dailyAssignments).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertTripSchema = createInsertSchema(trips).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertTripEnrollmentSchema = createInsertSchema(tripEnrollments).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertQuranNoteSchema = createInsertSchema(quranNotes).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertQuranProgressSchema = createInsertSchema(quranProgress).omit({\n  id: true,\n  updatedAt: true,\n});\n\nexport const insertSupervisorSchema = createInsertSchema(supervisors).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertStudentNoteSchema = createInsertSchema(studentNotes).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertCourseModuleSchema = createInsertSchema(courseModules).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertCourseStageSchema = createInsertSchema(courseStages).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertCourseUploadSchema = createInsertSchema(courseUploads).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertExamQuestionSchema = createInsertSchema(examQuestions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertExamAttemptSchema = createInsertSchema(examAttempts).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertSessionAccessControlSchema = createInsertSchema(sessionAccessControl).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertCertificateSchema = createInsertSchema(certificates).omit({\n  id: true,\n  createdAt: true,\n  code: true, // Auto-generated UUID\n  verificationToken: true, // Auto-generated UUID\n  certificateNumber: true, // Auto-generated UUID\n});\n\nexport const insertMessageSchema = createInsertSchema(messages).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertNotificationSchema = createInsertSchema(notifications).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertLiveAnnotationSchema = createInsertSchema(liveAnnotations).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertLiveRoomSchema = createInsertSchema(liveRooms).omit({\n  id: true,\n  roomToken: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertRoomParticipantSchema = createInsertSchema(roomParticipants).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertQuranWordHighlightSchema = createInsertSchema(quranWordHighlights).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertQuranMemorizationSchema = createInsertSchema(quranMemorization).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertQuranReadingStatsSchema = createInsertSchema(quranReadingStats).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const ayahMarkerTypeEnum = z.enum(['memorization', 'review', 'bookmark', 'completed']);\nexport const ayahMarkerColorEnum = z.enum(['blue', 'green', 'yellow', 'red', 'orange']);\nexport const recitationModeEnum = z.enum(['practice', 'test', 'review']);\n\nexport const insertQuranAyahMarkerSchema = createInsertSchema(quranAyahMarkers).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n}).extend({\n  markerType: ayahMarkerTypeEnum,\n  markerColor: ayahMarkerColorEnum.optional(),\n});\n\nexport const insertQuranRecitationAttemptSchema = createInsertSchema(quranRecitationAttempts).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  mode: recitationModeEnum.optional(),\n});\n\n// Export types\nexport type UpsertUser = typeof users.$inferInsert;\nexport type User = typeof users.$inferSelect;\nexport type Course = typeof courses.$inferSelect;\nexport type InsertCourse = z.infer<typeof insertCourseSchema>;\nexport type Instructor = typeof instructors.$inferSelect;\nexport type InsertInstructor = z.infer<typeof insertInstructorSchema>;\nexport type CourseEnrollment = typeof courseEnrollments.$inferSelect;\nexport type InsertEnrollment = z.infer<typeof insertEnrollmentSchema>;\nexport type ContactMessage = typeof contactMessages.$inferSelect;\nexport type InsertContactMessage = z.infer<typeof insertContactMessageSchema>;\n\nexport type Student = typeof students.$inferSelect;\nexport type InsertStudent = z.infer<typeof insertStudentSchema>;\nexport type StudentSession = typeof studentSessions.$inferSelect;\nexport type InsertStudentSession = z.infer<typeof insertStudentSessionSchema>;\nexport type StudentError = typeof studentErrors.$inferSelect;\nexport type InsertStudentError = z.infer<typeof insertStudentErrorSchema>;\nexport type StudentPayment = typeof studentPayments.$inferSelect;\nexport type InsertStudentPayment = z.infer<typeof insertStudentPaymentSchema>;\nexport type ClassSchedule = typeof classSchedules.$inferSelect;\nexport type InsertClassSchedule = z.infer<typeof insertClassScheduleSchema>;\nexport type SessionAccess = typeof sessionAccess.$inferSelect;\nexport type InsertSessionAccess = z.infer<typeof insertSessionAccessSchema>;\nexport type DailyAssignment = typeof dailyAssignments.$inferSelect;\nexport type InsertDailyAssignment = z.infer<typeof insertDailyAssignmentSchema>;\n\nexport type Trip = typeof trips.$inferSelect;\nexport type InsertTrip = z.infer<typeof insertTripSchema>;\nexport type TripEnrollment = typeof tripEnrollments.$inferSelect;\nexport type InsertTripEnrollment = z.infer<typeof insertTripEnrollmentSchema>;\nexport type QuranNote = typeof quranNotes.$inferSelect;\nexport type InsertQuranNote = z.infer<typeof insertQuranNoteSchema>;\nexport type QuranProgress = typeof quranProgress.$inferSelect;\nexport type InsertQuranProgress = z.infer<typeof insertQuranProgressSchema>;\nexport type Supervisor = typeof supervisors.$inferSelect;\nexport type InsertSupervisor = z.infer<typeof insertSupervisorSchema>;\nexport type StudentNote = typeof studentNotes.$inferSelect;\nexport type InsertStudentNote = z.infer<typeof insertStudentNoteSchema>;\nexport type CourseModule = typeof courseModules.$inferSelect;\nexport type InsertCourseModule = z.infer<typeof insertCourseModuleSchema>;\nexport type CourseStage = typeof courseStages.$inferSelect;\nexport type InsertCourseStage = z.infer<typeof insertCourseStageSchema>;\nexport type CourseUpload = typeof courseUploads.$inferSelect;\nexport type InsertCourseUpload = z.infer<typeof insertCourseUploadSchema>;\nexport type ExamQuestion = typeof examQuestions.$inferSelect;\nexport type InsertExamQuestion = z.infer<typeof insertExamQuestionSchema>;\nexport type ExamAttempt = typeof examAttempts.$inferSelect;\nexport type InsertExamAttempt = z.infer<typeof insertExamAttemptSchema>;\nexport type SessionAccessControl = typeof sessionAccessControl.$inferSelect;\nexport type InsertSessionAccessControl = z.infer<typeof insertSessionAccessControlSchema>;\nexport type Certificate = typeof certificates.$inferSelect;\nexport type InsertCertificate = z.infer<typeof insertCertificateSchema>;\nexport type Message = typeof messages.$inferSelect;\nexport type InsertMessage = z.infer<typeof insertMessageSchema>;\nexport type Notification = typeof notifications.$inferSelect;\nexport type InsertNotification = z.infer<typeof insertNotificationSchema>;\nexport type LiveAnnotation = typeof liveAnnotations.$inferSelect;\nexport type InsertLiveAnnotation = z.infer<typeof insertLiveAnnotationSchema>;\nexport type LiveRoom = typeof liveRooms.$inferSelect;\nexport type InsertLiveRoom = z.infer<typeof insertLiveRoomSchema>;\nexport type RoomParticipant = typeof roomParticipants.$inferSelect;\nexport type InsertRoomParticipant = z.infer<typeof insertRoomParticipantSchema>;\nexport type QuranWordHighlight = typeof quranWordHighlights.$inferSelect;\nexport type InsertQuranWordHighlight = z.infer<typeof insertQuranWordHighlightSchema>;\nexport type QuranMemorization = typeof quranMemorization.$inferSelect;\nexport type InsertQuranMemorization = z.infer<typeof insertQuranMemorizationSchema>;\nexport type QuranReadingStats = typeof quranReadingStats.$inferSelect;\nexport type InsertQuranReadingStats = z.infer<typeof insertQuranReadingStatsSchema>;\nexport type QuranAyahMarker = typeof quranAyahMarkers.$inferSelect;\nexport type InsertQuranAyahMarker = z.infer<typeof insertQuranAyahMarkerSchema>;\nexport type QuranRecitationAttempt = typeof quranRecitationAttempts.$inferSelect;\nexport type InsertQuranRecitationAttempt = z.infer<typeof insertQuranRecitationAttemptSchema>;\n\n// Draw command schema for whiteboard validation\nexport const drawCommandSchema = z.object({\n  type: z.enum(['start', 'draw', 'end', 'clear', 'erase', 'shape', 'text', 'undo', 'redo']),\n  x: z.number().min(0).max(10000).default(0),\n  y: z.number().min(0).max(10000).default(0),\n  x2: z.number().min(0).max(10000).optional(),\n  y2: z.number().min(0).max(10000).optional(),\n  color: z.string().regex(/^#[0-9A-Fa-f]{6}$/).optional(),\n  lineWidth: z.number().min(1).max(50).optional(),\n  id: z.string().optional(),\n  userId: z.string().optional(),\n  commandId: z.string().optional(),\n  clientId: z.string().optional(),\n  shape: z.enum(['rectangle', 'circle', 'line', 'arrow']).optional(),\n  text: z.string().max(500).optional(),\n  filled: z.boolean().optional(),\n});\n\nexport type DrawCommand = z.infer<typeof drawCommandSchema>;\n\n// Extended types for Sheikh session view (joins session with student and room data)\nexport interface SheikhSessionView extends SessionAccess {\n  studentName: string;\n  studentPhone: string | null;\n  roomToken?: string | null;\n  roomId?: string | null;\n  roomStatus?: string | null;\n}\n\n","size_bytes":45125},"components/ui/Button.tsx":{"content":"import React from 'react';\nimport { cva, type VariantProps } from 'class-variance-authority';\nimport { cn } from '@/lib/utils';\nimport { Loader2 } from 'lucide-react';\n\nconst buttonVariants = cva(\n  'inline-flex items-center justify-center gap-2 rounded-lg font-medium transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 active:scale-95',\n  {\n    variants: {\n      variant: {\n        primary: 'bg-[#004E89] text-white hover:bg-[#003A6B] focus-visible:ring-[#004E89] shadow-sm',\n        secondary: 'bg-[#F5F1E8] text-black hover:bg-[#E8E4D8] focus-visible:ring-neutral-500 border border-[#d4c9b8]',\n        accent: 'bg-accent text-neutral-900 hover:bg-accent-600 focus-visible:ring-accent-500 shadow-sm',\n        outline: 'border-2 border-primary bg-transparent text-primary hover:bg-primary hover:text-white focus-visible:ring-primary-500',\n        ghost: 'bg-transparent hover:bg-neutral-100 text-neutral-900 dark:hover:bg-neutral-800 dark:text-neutral-100',\n        danger: 'bg-error text-white hover:bg-error-600 focus-visible:ring-error-500 shadow-sm',\n        success: 'bg-success text-white hover:bg-success-600 focus-visible:ring-success-500 shadow-sm',\n      },\n      size: {\n        sm: 'h-9 px-3 text-sm',\n        md: 'h-11 px-5 text-base',\n        lg: 'h-13 px-7 text-lg',\n        xl: 'h-15 px-9 text-xl',\n        icon: 'h-10 w-10',\n      },\n      fullWidth: {\n        true: 'w-full',\n      },\n    },\n    defaultVariants: {\n      variant: 'primary',\n      size: 'md',\n    },\n  }\n);\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  loading?: boolean;\n  leftIcon?: React.ReactNode;\n  rightIcon?: React.ReactNode;\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  (\n    {\n      className,\n      variant,\n      size,\n      fullWidth,\n      loading = false,\n      disabled,\n      leftIcon,\n      rightIcon,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    return (\n      <button\n        className={cn(buttonVariants({ variant, size, fullWidth, className }))}\n        ref={ref}\n        disabled={disabled || loading}\n        aria-busy={loading}\n        {...props}\n      >\n        {loading && <Loader2 className=\"h-4 w-4 animate-spin\" aria-hidden=\"true\" />}\n        {!loading && leftIcon && <span aria-hidden=\"true\">{leftIcon}</span>}\n        {children}\n        {!loading && rightIcon && <span aria-hidden=\"true\">{rightIcon}</span>}\n      </button>\n    );\n  }\n);\n\nButton.displayName = 'Button';\n\nexport default Button;\n","size_bytes":2636},"components/ui/Card.tsx":{"content":"import React from 'react';\nimport { cva, type VariantProps } from 'class-variance-authority';\nimport { cn } from '@/lib/utils';\n\nconst cardVariants = cva(\n  'rounded-xl transition-all duration-200',\n  {\n    variants: {\n      variant: {\n        default: 'bg-[#F5F1E8] border border-[#d4c9b8]',\n        elevated: 'bg-[#F5F1E8] shadow-lg',\n        outlined: 'bg-transparent border-2 border-[#d4c9b8]',\n      },\n      padding: {\n        none: 'p-0',\n        sm: 'p-4',\n        md: 'p-6',\n        lg: 'p-8',\n      },\n    },\n    defaultVariants: {\n      variant: 'default',\n      padding: 'md',\n    },\n  }\n);\n\nexport interface CardProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof cardVariants> {\n  header?: React.ReactNode;\n  footer?: React.ReactNode;\n}\n\nconst Card = React.forwardRef<HTMLDivElement, CardProps>(\n  ({ className, variant, padding, header, footer, children, ...props }, ref) => {\n    return (\n      <div\n        className={cn(cardVariants({ variant, padding: header || footer ? 'none' : padding, className }))}\n        ref={ref}\n        {...props}\n      >\n        {header && (\n          <div className=\"border-b border-neutral-200 px-6 py-4 dark:border-neutral-800\">\n            {header}\n          </div>\n        )}\n        <div className={cn(header || footer ? 'p-6' : '')}>{children}</div>\n        {footer && (\n          <div className=\"border-t border-neutral-200 px-6 py-4 dark:border-neutral-800\">\n            {footer}\n          </div>\n        )}\n      </div>\n    );\n  }\n);\n\nCard.displayName = 'Card';\n\nexport default Card;","size_bytes":1566},"app/api/auth/[...nextauth]/route.ts":{"content":"import NextAuth from 'next-auth'\nimport { authOptions } from '@/lib/auth'\n\nconst handler = NextAuth(authOptions)\n\nexport { handler as GET, handler as POST }\n","size_bytes":157},"attached_assets/useLiveSessionWebRTC_1763165145843.ts":{"content":"import { useEffect, useRef, useState } from 'react';\nimport { useAuth } from '@/hooks/useAuth';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface Participant {\n  userId: string;\n  role: string;\n  studentId?: string;\n  isHandRaised?: boolean;\n  isMuted?: boolean;\n  isAudioMutedByHost?: boolean;\n  reaction?: string;\n}\n\ninterface Message {\n  id: string;\n  userId: string;\n  userName: string;\n  text: string;\n  timestamp: string;\n  isPrivate?: boolean;\n}\n\nexport function useLiveSessionWebRTC(roomToken: string, onDisconnect?: () => void) {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  \n  const [isAudioEnabled, setIsAudioEnabled] = useState(true);\n  const [isVideoEnabled, setIsVideoEnabled] = useState(true);\n  const [isScreenSharing, setIsScreenSharing] = useState(false);\n  const [participants, setParticipants] = useState<Participant[]>([]);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [isConnected, setIsConnected] = useState(false);\n  const [remoteStreams, setRemoteStreams] = useState<Map<string, MediaStream>>(new Map());\n  const [isAudioMutedByHost, setIsAudioMutedByHost] = useState(false);\n  const [whiteboardCommands, setWhiteboardCommands] = useState<any[]>([]);\n  \n  const wsRef = useRef<WebSocket | null>(null);\n  const localStreamRef = useRef<MediaStream | null>(null);\n  const screenStreamRef = useRef<MediaStream | null>(null);\n  const originalVideoTrackRef = useRef<MediaStreamTrack | null>(null);\n  const peerConnectionRef = useRef<RTCPeerConnection | null>(null);\n  const localVideoRef = useRef<HTMLVideoElement | null>(null);\n  const remoteVideoRef = useRef<HTMLVideoElement | null>(null);\n  const screenVideoRef = useRef<HTMLVideoElement | null>(null);\n\n  // Initialize WebSocket connection\n  useEffect(() => {\n    const wsUrl = window.location.origin.replace(/^http/, 'ws') + '/ws';\n    const ws = new WebSocket(wsUrl);\n    wsRef.current = ws;\n\n    ws.onopen = () => {\n      console.log('🔌 WebSocket connected to live session');\n      \n      ws.send(JSON.stringify({\n        type: 'auth',\n        payload: { userId: user?.id, role: user?.role, studentId: user?.role === 'student' ? user?.id : undefined }\n      }));\n      \n      ws.send(JSON.stringify({\n        type: 'room:join',\n        payload: { roomToken }\n      }));\n      \n      setIsConnected(true);\n    };\n\n    ws.onmessage = (event) => {\n      const message = JSON.parse(event.data);\n      handleWebSocketMessage(message);\n    };\n\n    ws.onerror = (error) => {\n      console.error('❌ WebSocket error:', error);\n      toast({\n        variant: 'destructive',\n        title: 'خطأ في الاتصال',\n        description: 'حدث خطأ في الاتصال بالحصة'\n      });\n    };\n\n    ws.onclose = () => {\n      console.log('👋 WebSocket disconnected');\n      setIsConnected(false);\n    };\n\n    return () => {\n      if (ws.readyState === WebSocket.OPEN) {\n        ws.send(JSON.stringify({\n          type: 'room:leave',\n          payload: { roomToken }\n        }));\n      }\n      ws.close();\n      cleanupMedia();\n    };\n  }, [roomToken, user]);\n\n  // Get user media on mount\n  useEffect(() => {\n    async function initMedia() {\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia({\n          video: true,\n          audio: true\n        });\n        \n        localStreamRef.current = stream;\n        \n        if (localVideoRef.current) {\n          localVideoRef.current.srcObject = stream;\n        }\n        \n        console.log('📹 Local media acquired');\n      } catch (error) {\n        console.error('❌ Error getting media:', error);\n        toast({\n          variant: 'destructive',\n          title: 'خطأ في الوصول للكاميرا',\n          description: 'تأكد من السماح بالوصول للكاميرا والميكروفون'\n        });\n      }\n    }\n    \n    initMedia();\n    \n    return () => cleanupMedia();\n  }, []);\n\n  const handleWebSocketMessage = async (message: any) => {\n    const { type, payload } = message;\n\n    switch (type) {\n      case 'room:joined':\n        console.log('✅ Joined room:', payload.roomToken);\n        break;\n\n      case 'room:participants':\n        console.log('👥 Participants:', payload.participants);\n        setParticipants(payload.participants || []);\n        \n        const others = (payload.participants || []).filter((p: Participant) => p.userId !== user?.id);\n        if (others.length > 0 && user?.role === 'supervisor') {\n          await createOffer();\n        }\n        break;\n\n      case 'webrtc:offer':\n        console.log('📨 Received offer from:', payload.from);\n        await handleOffer(payload.data);\n        break;\n\n      case 'webrtc:answer':\n        console.log('📨 Received answer from:', payload.from);\n        await handleAnswer(payload.data);\n        break;\n\n      case 'webrtc:ice-candidate':\n        console.log('🧊 Received ICE candidate from:', payload.from);\n        await handleIceCandidate(payload.data);\n        break;\n\n      case 'chat_message':\n        setMessages(prev => [...prev, {\n          id: payload.id || Date.now().toString(),\n          userId: payload.senderId || payload.from || 'unknown',\n          userName: payload.senderName || payload.userName || 'مستخدم',\n          text: payload.content || payload.text || '',\n          timestamp: payload.createdAt \n            ? new Date(payload.createdAt).toLocaleTimeString('ar-SA')\n            : new Date().toLocaleTimeString('ar-SA')\n        }]);\n        break;\n\n      case 'whiteboard:command':\n        setWhiteboardCommands(prev => [...prev, {\n          id: payload.id || Date.now().toString(),\n          command: payload.command,\n          userId: payload.userId,\n          timestamp: payload.timestamp\n        }]);\n        break;\n\n      case 'room:hand-raised':\n      case 'room:hand-lowered':\n      case 'room:reaction':\n        setParticipants(prev => \n          prev.map(p => \n            p.userId === payload.userId\n              ? {\n                  ...p,\n                  isHandRaised: type === 'room:hand-raised' ? true : type === 'room:hand-lowered' ? false : p.isHandRaised,\n                  reaction: type === 'room:reaction' ? payload.reaction : p.reaction\n                }\n              : p\n          )\n        );\n        break;\n\n      case 'room:participant-muted':\n        if (payload.participantId === user?.id) {\n          setIsAudioMutedByHost(payload.shouldMute);\n          \n          if (localStreamRef.current) {\n            localStreamRef.current.getAudioTracks().forEach(track => {\n              track.enabled = !payload.shouldMute;\n            });\n            setIsAudioEnabled(!payload.shouldMute);\n          }\n          \n          toast({\n            variant: payload.shouldMute ? 'destructive' : 'default',\n            title: payload.shouldMute ? 'تم كتم صوتك من قبل المشرف' : 'سمح لك المشرف بفتح الميكروفون',\n            description: payload.shouldMute ? 'لا يمكنك فتح الميكروفون حتى يسمح المشرف' : 'يمكنك الآن فتح الميكروفون'\n          });\n        }\n        \n        setParticipants(prev => \n          prev.map(p => \n            p.userId === payload.participantId\n              ? { ...p, isAudioMutedByHost: payload.shouldMute }\n              : p\n          )\n        );\n        break;\n\n      case 'room:participant-removed':\n        if (payload.participantId === user?.id) {\n          toast({\n            variant: 'destructive',\n            title: 'تمت إزالتك من الحصة',\n            description: 'قام المشرف بإزالتك من الحصة'\n          });\n          leaveRoom();\n        } else {\n          setParticipants(prev => prev.filter(p => p.userId !== payload.participantId));\n        }\n        break;\n\n      case 'room:all-muted':\n        if (user?.role === 'student') {\n          setIsAudioMutedByHost(true);\n          \n          if (localStreamRef.current) {\n            localStreamRef.current.getAudioTracks().forEach(track => {\n              track.enabled = false;\n            });\n            setIsAudioEnabled(false);\n          }\n          \n          toast({\n            variant: 'destructive',\n            title: 'تم كتم الجميع',\n            description: 'قام المشرف بكتم صوت جميع المشاركين'\n          });\n        }\n        break;\n\n      default:\n        console.log('⚠️ Unknown message type:', type);\n    }\n  };\n\n  const createPeerConnection = () => {\n    if (peerConnectionRef.current) {\n      return peerConnectionRef.current;\n    }\n\n    const configuration = {\n      iceServers: [\n        { urls: 'stun:stun.l.google.com:19302' },\n        { urls: 'stun:stun1.l.google.com:19302' }\n      ]\n    };\n\n    const pc = new RTCPeerConnection(configuration);\n    peerConnectionRef.current = pc;\n\n    if (localStreamRef.current) {\n      localStreamRef.current.getTracks().forEach(track => {\n        pc.addTrack(track, localStreamRef.current!);\n      });\n    }\n\n    pc.onicecandidate = (event) => {\n      if (event.candidate && wsRef.current?.readyState === WebSocket.OPEN) {\n        wsRef.current.send(JSON.stringify({\n          type: 'webrtc:ice-candidate',\n          payload: event.candidate\n        }));\n      }\n    };\n\n    pc.ontrack = (event) => {\n      console.log('🎥 Remote track received');\n      const [remoteStream] = event.streams;\n      \n      if (remoteVideoRef.current) {\n        remoteVideoRef.current.srcObject = remoteStream;\n      }\n      \n      setRemoteStreams(prev => {\n        const newMap = new Map(prev);\n        newMap.set('remote', remoteStream);\n        return newMap;\n      });\n    };\n\n    pc.onconnectionstatechange = () => {\n      console.log('🔄 Connection state:', pc.connectionState);\n      if (pc.connectionState === 'failed') {\n        toast({\n          variant: 'destructive',\n          title: 'خطأ في الاتصال',\n          description: 'فشل الاتصال مع المشارك الآخر'\n        });\n      }\n    };\n\n    return pc;\n  };\n\n  const createOffer = async () => {\n    try {\n      const pc = createPeerConnection();\n      const offer = await pc.createOffer();\n      await pc.setLocalDescription(offer);\n\n      if (wsRef.current?.readyState === WebSocket.OPEN) {\n        wsRef.current.send(JSON.stringify({\n          type: 'webrtc:offer',\n          payload: offer\n        }));\n        console.log('📤 Offer sent');\n      }\n    } catch (error) {\n      console.error('❌ Error creating offer:', error);\n    }\n  };\n\n  const handleOffer = async (offer: RTCSessionDescriptionInit) => {\n    try {\n      const pc = createPeerConnection();\n      await pc.setRemoteDescription(new RTCSessionDescription(offer));\n      \n      const answer = await pc.createAnswer();\n      await pc.setLocalDescription(answer);\n\n      if (wsRef.current?.readyState === WebSocket.OPEN) {\n        wsRef.current.send(JSON.stringify({\n          type: 'webrtc:answer',\n          payload: answer\n        }));\n        console.log('📤 Answer sent');\n      }\n    } catch (error) {\n      console.error('❌ Error handling offer:', error);\n    }\n  };\n\n  const handleAnswer = async (answer: RTCSessionDescriptionInit) => {\n    try {\n      const pc = peerConnectionRef.current;\n      if (pc) {\n        await pc.setRemoteDescription(new RTCSessionDescription(answer));\n        console.log('✅ Answer applied');\n      }\n    } catch (error) {\n      console.error('❌ Error handling answer:', error);\n    }\n  };\n\n  const handleIceCandidate = async (candidate: RTCIceCandidateInit) => {\n    try {\n      const pc = peerConnectionRef.current;\n      if (pc) {\n        await pc.addIceCandidate(new RTCIceCandidate(candidate));\n        console.log('✅ ICE candidate added');\n      }\n    } catch (error) {\n      console.error('❌ Error adding ICE candidate:', error);\n    }\n  };\n\n  const toggleAudio = () => {\n    if (isAudioMutedByHost && !isAudioEnabled) {\n      toast({\n        variant: 'destructive',\n        title: 'لا يمكن فتح الميكروفون',\n        description: 'تم كتم صوتك من قبل المشرف'\n      });\n      return;\n    }\n    \n    if (localStreamRef.current) {\n      localStreamRef.current.getAudioTracks().forEach(track => {\n        track.enabled = !track.enabled;\n      });\n      setIsAudioEnabled(prev => !prev);\n    }\n  };\n\n  const toggleVideo = () => {\n    if (localStreamRef.current) {\n      localStreamRef.current.getVideoTracks().forEach(track => {\n        track.enabled = !track.enabled;\n      });\n      setIsVideoEnabled(prev => !prev);\n    }\n  };\n\n  const sendMessage = (text: string) => {\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      const senderName = user?.firstName && user?.lastName \n        ? `${user.firstName} ${user.lastName}`\n        : user?.firstName || 'مستخدم';\n      \n      wsRef.current.send(JSON.stringify({\n        type: 'chat_message',\n        payload: {\n          content: text,\n          senderId: user?.id,\n          senderName,\n          receiverId: null,\n          messageType: 'text',\n          isGroupMessage: true\n        }\n      }));\n    }\n  };\n\n  const sendWhiteboardCommand = (command: any) => {\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify({\n        type: 'whiteboard:command',\n        payload: {\n          command\n        }\n      }));\n    }\n  };\n\n  const leaveRoom = () => {\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify({\n        type: 'room:leave',\n        payload: { roomToken }\n      }));\n    }\n    cleanupMedia();\n    onDisconnect?.();\n  };\n\n  const startScreenShare = async () => {\n    try {\n      const screenStream = await navigator.mediaDevices.getDisplayMedia({\n        video: true,\n        audio: false\n      });\n      \n      screenStreamRef.current = screenStream;\n      \n      if (screenVideoRef.current) {\n        screenVideoRef.current.srcObject = screenStream;\n      }\n      \n      const pc = peerConnectionRef.current;\n      if (pc && localStreamRef.current) {\n        const videoTrack = screenStream.getVideoTracks()[0];\n        const sender = pc.getSenders().find(s => s.track?.kind === 'video');\n        \n        if (sender) {\n          originalVideoTrackRef.current = localStreamRef.current.getVideoTracks()[0];\n          \n          await sender.replaceTrack(videoTrack);\n          console.log('📺 Screen sharing started - audio tracks preserved, original camera saved');\n          setIsScreenSharing(true);\n          \n          videoTrack.onended = () => {\n            stopScreenShare();\n          };\n          \n          toast({\n            title: 'بدأت مشاركة الشاشة',\n            description: 'يمكن للطلاب رؤية شاشتك الآن - الصوت مستمر'\n          });\n        }\n      }\n    } catch (error) {\n      console.error('❌ Error starting screen share:', error);\n      toast({\n        variant: 'destructive',\n        title: 'خطأ في مشاركة الشاشة',\n        description: 'لم نتمكن من مشاركة شاشتك'\n      });\n    }\n  };\n\n  const stopScreenShare = async () => {\n    try {\n      if (screenStreamRef.current) {\n        screenStreamRef.current.getTracks().forEach(track => track.stop());\n        screenStreamRef.current = null;\n      }\n      \n      const pc = peerConnectionRef.current;\n      if (pc && originalVideoTrackRef.current) {\n        const sender = pc.getSenders().find(s => s.track?.kind === 'video');\n        \n        if (sender) {\n          await sender.replaceTrack(originalVideoTrackRef.current);\n          \n          if (localVideoRef.current) {\n            const newStream = new MediaStream();\n            newStream.addTrack(originalVideoTrackRef.current);\n            if (localStreamRef.current) {\n              localStreamRef.current.getAudioTracks().forEach(track => newStream.addTrack(track));\n            }\n            localVideoRef.current.srcObject = newStream;\n          }\n          \n          console.log('📺 Screen sharing stopped, camera restored');\n          setIsScreenSharing(false);\n          originalVideoTrackRef.current = null;\n          \n          toast({\n            title: 'توقفت مشاركة الشاشة',\n            description: 'عدت إلى الكاميرا'\n          });\n        }\n      }\n    } catch (error) {\n      console.error('❌ Error stopping screen share:', error);\n      toast({\n        variant: 'destructive',\n        title: 'خطأ',\n        description: 'حدث خطأ عند العودة للكاميرا'\n      });\n    }\n  };\n\n  const cleanupMedia = () => {\n    if (localStreamRef.current) {\n      localStreamRef.current.getTracks().forEach(track => track.stop());\n      localStreamRef.current = null;\n    }\n    \n    if (screenStreamRef.current) {\n      screenStreamRef.current.getTracks().forEach(track => track.stop());\n      screenStreamRef.current = null;\n    }\n    \n    if (peerConnectionRef.current) {\n      peerConnectionRef.current.close();\n      peerConnectionRef.current = null;\n    }\n  };\n\n  const toggleHandRaise = () => {\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify({\n        type: 'room:toggle-hand',\n        payload: { roomToken, userId: user?.id }\n      }));\n    }\n  };\n\n  const sendReaction = (reaction: string) => {\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify({\n        type: 'room:reaction',\n        payload: { roomToken, userId: user?.id, reaction }\n      }));\n      \n      setTimeout(() => {\n        if (wsRef.current?.readyState === WebSocket.OPEN) {\n          wsRef.current.send(JSON.stringify({\n            type: 'room:reaction',\n            payload: { roomToken, userId: user?.id, reaction: null }\n          }));\n        }\n      }, 3000);\n    }\n  };\n\n  const muteParticipant = (participantId: string, shouldMute: boolean) => {\n    if (wsRef.current?.readyState === WebSocket.OPEN && (user?.role === 'supervisor' || user?.role === 'admin')) {\n      wsRef.current.send(JSON.stringify({\n        type: 'room:mute-participant',\n        payload: { roomToken, participantId, shouldMute }\n      }));\n    }\n  };\n\n  const muteAll = () => {\n    if (wsRef.current?.readyState === WebSocket.OPEN && (user?.role === 'supervisor' || user?.role === 'admin')) {\n      wsRef.current.send(JSON.stringify({\n        type: 'room:mute-all',\n        payload: { roomToken }\n      }));\n      \n      toast({\n        title: 'تم كتم الجميع',\n        description: 'تم كتم صوت جميع المشاركين'\n      });\n    }\n  };\n\n  const removeParticipant = (participantId: string) => {\n    if (wsRef.current?.readyState === WebSocket.OPEN && (user?.role === 'supervisor' || user?.role === 'admin')) {\n      wsRef.current.send(JSON.stringify({\n        type: 'room:remove-participant',\n        payload: { roomToken, participantId }\n      }));\n    }\n  };\n\n  const lockRoom = (shouldLock: boolean) => {\n    if (wsRef.current?.readyState === WebSocket.OPEN && (user?.role === 'supervisor' || user?.role === 'admin')) {\n      wsRef.current.send(JSON.stringify({\n        type: 'room:lock',\n        payload: { roomToken, isLocked: shouldLock }\n      }));\n      \n      toast({\n        title: shouldLock ? 'تم قفل الغرفة' : 'تم فتح الغرفة',\n        description: shouldLock ? 'لن يتمكن أحد من الدخول' : 'يمكن للجميع الدخول الآن'\n      });\n    }\n  };\n\n  return {\n    isAudioEnabled,\n    isVideoEnabled,\n    isScreenSharing,\n    participants,\n    messages,\n    isConnected,\n    remoteStreams,\n    localVideoRef,\n    remoteVideoRef,\n    screenVideoRef,\n    toggleAudio,\n    toggleVideo,\n    startScreenShare,\n    stopScreenShare,\n    sendMessage,\n    sendWhiteboardCommand,\n    whiteboardCommands,\n    leaveRoom,\n    toggleHandRaise,\n    sendReaction,\n    muteParticipant,\n    muteAll,\n    removeParticipant,\n    lockRoom,\n    isAudioMutedByHost\n  };\n}\n","size_bytes":19967},"app/api/student/stats/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'STUDENT') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const userId = session.user.id\n\n    const [wordsCount, sessionsCount, activeSubscription] = await Promise.all([\n      prisma.word.count({\n        where: { studentId: userId }\n      }),\n      prisma.sessionStudent.count({\n        where: { studentId: userId, attended: true }\n      }),\n      prisma.subscription.findFirst({\n        where: {\n          studentId: userId,\n          paid: true,\n          endDate: { gte: new Date() }\n        },\n        include: { package: true }\n      })\n    ])\n\n    // Count pending assignments: assignments for sessions the student is enrolled in that have no submission\n    const studentAssignments = await prisma.assignment.findMany({\n      where: {\n        Session: {\n          SessionStudent: {\n            some: { studentId: userId }\n          }\n        }\n      },\n      include: {\n        Submission: {\n          where: { studentId: userId }\n        }\n      }\n    })\n    \n    const pendingAssignments = studentAssignments.filter(a => a.Submission.length === 0).length\n\n    const nextSession = await prisma.sessionStudent.findFirst({\n      where: {\n        studentId: userId,\n        Session: {\n          startTime: { gte: new Date() },\n          status: 'SCHEDULED'\n        }\n      },\n      include: {\n        Session: {\n          include: {\n            TeacherProfile: {\n              include: { User: true }\n            }\n          }\n        }\n      },\n      orderBy: {\n        Session: { startTime: 'asc' }\n      }\n    })\n\n    let activeSubDetails = null\n    if (activeSubscription) {\n      const attendedSessions = await prisma.sessionStudent.count({\n        where: {\n          studentId: userId,\n          attended: true,\n          Session: {\n            createdAt: {\n              gte: activeSubscription.startDate || new Date()\n            }\n          }\n        }\n      })\n      \n      const daysRemaining = activeSubscription.endDate \n        ? Math.ceil((new Date(activeSubscription.endDate).getTime() - new Date().getTime()) / (1000 * 60 * 60 * 24))\n        : 0\n      \n      activeSubDetails = {\n        packageTitle: activeSubscription.package.title,\n        packageTitleAr: activeSubscription.package.titleAr,\n        startDate: activeSubscription.startDate,\n        endDate: activeSubscription.endDate,\n        lessonsTotal: activeSubscription.package.lessonsCount,\n        lessonsRemaining: Math.max(0, activeSubscription.package.lessonsCount - attendedSessions),\n        daysRemaining: Math.max(0, daysRemaining)\n      }\n    }\n\n    return NextResponse.json({\n      wordsLearned: wordsCount,\n      sessionsAttended: sessionsCount,\n      pendingAssignments,\n      activeSubscription: activeSubDetails,\n      nextSession: nextSession ? {\n        id: nextSession.Session.id,\n        title: nextSession.Session.title,\n        startTime: nextSession.Session.startTime,\n        endTime: nextSession.Session.endTime,\n        teacherName: nextSession.Session.TeacherProfile.User.name\n      } : null\n    })\n  } catch (error) {\n    console.error('Error fetching student stats:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":3552},"components/layout/Navbar.tsx":{"content":"'use client';\n\nimport React, { useState } from 'react';\nimport { cn } from '@/lib/utils';\nimport { Menu, X } from 'lucide-react';\nimport Button from '@/components/ui/Button';\n\nexport interface NavbarProps {\n  logo?: React.ReactNode;\n  children?: React.ReactNode;\n  className?: string;\n  sticky?: boolean;\n}\n\nconst Navbar: React.FC<NavbarProps> = ({ logo, children, className, sticky = true }) => {\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\n\n  return (\n    <nav\n      className={cn(\n        'w-full border-b border-neutral-200 bg-white dark:bg-neutral-900 dark:border-neutral-800 z-40',\n        sticky && 'sticky top-0',\n        className\n      )}\n      role=\"navigation\"\n      aria-label=\"Main navigation\"\n    >\n      <div className=\"container mx-auto px-4 sm:px-6 lg:px-8\">\n        <div className=\"flex h-16 items-center justify-between\">\n          <div className=\"flex items-center gap-8\">\n            {logo && <div className=\"flex-shrink-0\">{logo}</div>}\n            <div className=\"hidden md:flex md:items-center md:gap-6\">{children}</div>\n          </div>\n\n          <button\n            onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}\n            className=\"md:hidden p-2 text-neutral-700 hover:text-neutral-900 dark:text-neutral-300 dark:hover:text-neutral-100 transition-colors\"\n            aria-label=\"Toggle mobile menu\"\n            aria-expanded={isMobileMenuOpen}\n          >\n            {isMobileMenuOpen ? (\n              <X className=\"h-6 w-6\" aria-hidden=\"true\" />\n            ) : (\n              <Menu className=\"h-6 w-6\" aria-hidden=\"true\" />\n            )}\n          </button>\n        </div>\n      </div>\n\n      {isMobileMenuOpen && (\n        <div\n          className=\"md:hidden border-t border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-900\"\n          role=\"menu\"\n        >\n          <div className=\"container mx-auto px-4 py-4 space-y-2\">{children}</div>\n        </div>\n      )}\n    </nav>\n  );\n};\n\nexport interface NavLinkProps {\n  href: string;\n  children: React.ReactNode;\n  active?: boolean;\n  className?: string;\n  onClick?: () => void;\n}\n\nexport const NavLink: React.FC<NavLinkProps> = ({\n  href,\n  children,\n  active = false,\n  className,\n  onClick,\n}) => {\n  return (\n    <a\n      href={href}\n      onClick={onClick}\n      className={cn(\n        'block px-3 py-2 text-sm font-medium transition-colors rounded-md rtl:text-right',\n        active\n          ? 'text-primary bg-primary-50 dark:bg-primary-900/20'\n          : 'text-neutral-700 hover:text-primary hover:bg-neutral-50 dark:text-neutral-300 dark:hover:bg-neutral-800',\n        className\n      )}\n      aria-current={active ? 'page' : undefined}\n    >\n      {children}\n    </a>\n  );\n};\n\nexport default Navbar;\n","size_bytes":2745},"prisma/create-schema.js":{"content":"const { Client } = require('pg');\n\nconst client = new Client({\n  connectionString: process.env.EXTERNAL_DATABASE_URL\n});\n\nasync function createSchema() {\n  try {\n    await client.connect();\n    console.log('✅ Connected successfully');\n    \n    // Create public schema\n    await client.query('CREATE SCHEMA IF NOT EXISTS public;');\n    console.log('✅ Public schema created');\n    \n    // Grant permissions\n    await client.query('GRANT ALL ON SCHEMA public TO youspeak_exercisein;');\n    console.log('✅ Permissions granted');\n    \n    // Set search path\n    await client.query('ALTER DATABASE youspeak_exercisein SET search_path TO public;');\n    console.log('✅ Search path set');\n    \n    await client.end();\n    console.log('✅ All done!');\n  } catch (error) {\n    console.error('❌ Error:', error.message);\n    await client.end();\n    process.exit(1);\n  }\n}\n\ncreateSchema();\n","size_bytes":887},"app/dashboard/student/components/PackagesTab.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { CreditCard, CheckCircle, Clock } from 'lucide-react'\nimport Card from '@/components/ui/Card'\nimport Badge from '@/components/ui/Badge'\nimport Alert from '@/components/ui/Alert'\nimport Button from '@/components/ui/Button'\nimport LoadingSpinner from '@/components/ui/LoadingSpinner'\n\ninterface Package {\n  id: string\n  title: string\n  titleAr: string\n  description: string | null\n  descriptionAr: string | null\n  price: number\n  lessonsCount: number\n  durationDays: number\n}\n\ninterface Subscription {\n  id: string\n  paid: boolean\n  receiptUrl: string | null\n  startDate: string | null\n  endDate: string | null\n  package: Package\n  createdAt: string\n}\n\nexport default function PackagesTab({ isActive }: { isActive: boolean }) {\n  const [packages, setPackages] = useState<Package[]>([])\n  const [subscriptions, setSubscriptions] = useState<Subscription[]>([])\n  const [loading, setLoading] = useState(true)\n  const [selecting, setSelecting] = useState(false)\n\n  useEffect(() => {\n    fetchData()\n  }, [])\n\n  async function fetchData() {\n    try {\n      const [packagesRes, subsRes] = await Promise.all([\n        fetch('/api/packages'),\n        fetch('/api/subscriptions')\n      ])\n\n      if (packagesRes.ok) {\n        const packagesData = await packagesRes.json()\n        setPackages(packagesData)\n      }\n\n      if (subsRes.ok) {\n        const subsData = await subsRes.json()\n        setSubscriptions(subsData)\n      }\n    } catch (error) {\n      console.error('Error fetching data:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  async function handleSelectPackage(packageId: string) {\n    setSelecting(true)\n    try {\n      const pkg = packages.find(p => p.id === packageId)\n      const response = await fetch('/api/subscriptions', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ packageId })\n      })\n\n      if (response.ok) {\n        const subscriptionData = await response.json()\n        const message = `مرحباً! 👋\\n\\nأرغب في الاشتراك في باقة:\\n📦 *${pkg?.titleAr}* (${pkg?.title})\\n💰 السعر: ${pkg?.price} SAR\\n📚 عدد الحصص: ${pkg?.lessonsCount}\\n⏱️ المدة: ${Math.ceil((pkg?.durationDays || 0) / 30)} شهر\\n\\nرقم الاشتراك: ${subscriptionData.id}\\n\\nالرجاء تزويدي بتفاصيل الدفع. شكراً! 🙏`\n        \n        const phoneNumber = '201091515594'\n        const encodedMessage = encodeURIComponent(message)\n        window.open(`https://wa.me/${phoneNumber}?text=${encodedMessage}`, '_blank')\n        \n        alert('تم اختيار الباقة بنجاح! سيتم التواصل معك عبر واتساب لإكمال الدفع.\\n\\nPackage selected successfully! We will contact you via WhatsApp to complete payment.')\n        await fetchData()\n      }\n    } catch (error) {\n      console.error('Error selecting package:', error)\n      alert('حدث خطأ. الرجاء المحاولة مرة أخرى.\\n\\nAn error occurred. Please try again.')\n    } finally {\n      setSelecting(false)\n    }\n  }\n\n  const activeSubscription = subscriptions.find(s => \n    s.paid && s.endDate && new Date(s.endDate) >= new Date()\n  )\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <LoadingSpinner size=\"lg\" />\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <h2 className=\"text-3xl font-bold text-[#004E89]\">\n        Packages / الباقات\n      </h2>\n\n      {activeSubscription && (\n        <Card variant=\"elevated\" className=\"bg-green-50 border-green-200\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center\">\n              <CheckCircle className=\"h-6 w-6 text-green-600\" />\n            </div>\n            <div className=\"flex-1\">\n              <h3 className=\"font-semibold text-gray-900\">Active Package / باقة نشطة</h3>\n              <p className=\"text-sm text-gray-700\">\n                {activeSubscription.package.title} - {activeSubscription.package.titleAr}\n              </p>\n              <p className=\"text-sm text-gray-600\">\n                Valid until: {new Date(activeSubscription.endDate!).toLocaleDateString('ar-EG')} / \n                صالحة حتى: {new Date(activeSubscription.endDate!).toLocaleDateString('ar-EG')}\n              </p>\n            </div>\n          </div>\n        </Card>\n      )}\n\n      <div className=\"grid md:grid-cols-3 gap-6\">\n        {packages.map((pkg) => {\n          const isRecommended = pkg.title === 'Monthly' || pkg.titleAr === 'شهري'\n          return (\n            <Card \n              key={pkg.id}\n              variant=\"elevated\"\n              className={isRecommended ? 'ring-2 ring-[#004E89]' : ''}\n            >\n              {isRecommended && (\n                <Badge variant=\"primary\" className=\"mb-4\">\n                  Recommended / موصى به\n                </Badge>\n              )}\n              <h3 className=\"text-xl font-bold text-[#004E89] mb-2\">{pkg.title}</h3>\n              <p className=\"text-gray-600 mb-4\">{pkg.titleAr}</p>\n              <p className=\"text-4xl font-bold text-[#004E89] mb-4\">{pkg.price} SAR</p>\n              <div className=\"mb-6 text-gray-700 space-y-1\">\n                <p>{pkg.lessonsCount} lessons / حصة</p>\n                <p>{Math.ceil(pkg.durationDays / 30)} month(s) / شهر</p>\n              </div>\n              {pkg.description && (\n                <p className=\"text-sm text-gray-600 mb-4\">{pkg.description}</p>\n              )}\n              <Button \n                variant={isRecommended ? 'primary' : 'outline'} \n                fullWidth\n                onClick={() => handleSelectPackage(pkg.id)}\n                disabled={selecting}\n              >\n                {selecting ? 'Processing...' : 'Select / اختر'}\n              </Button>\n            </Card>\n          )\n        })}\n      </div>\n\n      <Alert variant=\"info\">\n        <CreditCard className=\"h-5 w-5\" />\n        <div>\n          <p className=\"font-semibold\">Payment Instructions / تعليمات الدفع:</p>\n          <p className=\"text-sm mt-1\">\n            After selecting a package, you will receive payment details via WhatsApp at{' '}\n            <strong>+201091515594</strong>. Please send your payment receipt for verification.\n          </p>\n          <p className=\"text-sm mt-1\">\n            بعد اختيار الباقة، ستستلم تعليمات الدفع عبر الواتساب على{' '}\n            <strong>+201091515594</strong>. الرجاء إرسال إيصال الدفع للتحقق.\n          </p>\n        </div>\n      </Alert>\n\n      {subscriptions.length > 0 && (\n        <div>\n          <h3 className=\"text-xl font-semibold text-gray-900 mb-4\">\n            My Subscriptions / اشتراكاتي\n          </h3>\n          <div className=\"space-y-4\">\n            {subscriptions.map((sub) => (\n              <Card key={sub.id} variant=\"elevated\">\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <h3 className=\"text-lg font-bold text-gray-900\">\n                        {sub.package.title} / {sub.package.titleAr}\n                      </h3>\n                      {sub.paid ? (\n                        <Badge variant=\"success\">\n                          <CheckCircle className=\"h-3 w-3 mr-1\" />\n                          Paid / مدفوعة\n                        </Badge>\n                      ) : (\n                        <Badge variant=\"warning\">\n                          <Clock className=\"h-3 w-3 mr-1\" />\n                          Pending Payment / في انتظار الدفع\n                        </Badge>\n                      )}\n                    </div>\n                    <p className=\"text-sm text-gray-600\">\n                      Requested on: {new Date(sub.createdAt).toLocaleDateString('ar-EG')}\n                    </p>\n                    {sub.paid && sub.startDate && sub.endDate && (\n                      <p className=\"text-sm text-gray-600\">\n                        Active from {new Date(sub.startDate).toLocaleDateString('ar-EG')} to{' '}\n                        {new Date(sub.endDate).toLocaleDateString('ar-EG')}\n                      </p>\n                    )}\n                  </div>\n                  <p className=\"text-lg font-bold text-[#004E89]\">{sub.package.price} SAR</p>\n                </div>\n              </Card>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","size_bytes":8727},"prisma/seed.ts":{"content":"import { PrismaClient } from '@prisma/client'\nimport bcrypt from 'bcryptjs'\nimport { v4 as uuidv4 } from 'uuid'\n\nconst prisma = new PrismaClient({\n  datasources: {\n    db: {\n      url: process.env.EXTERNAL_DATABASE_URL,\n    },\n  },\n})\n\nasync function main() {\n  console.log('🌱 Starting database seed...')\n\n  const adminPassword = await bcrypt.hash('admin123', 10)\n  const admin = await prisma.user.upsert({\n    where: { email: 'admin@youspeak.com' },\n    update: {},\n    create: {\n      id: uuidv4(),\n      email: 'admin@youspeak.com',\n      name: 'Mister Youssef',\n      phone: '+201234567890',\n      passwordHash: adminPassword,\n      role: 'ADMIN',\n      isActive: true,\n    },\n  })\n  console.log('✅ Created admin:', admin.email)\n\n  const teacherPassword = await bcrypt.hash('teacher123', 10)\n  const teacher = await prisma.user.upsert({\n    where: { email: 'teacher@youspeak.com' },\n    update: {},\n    create: {\n      id: uuidv4(),\n      email: 'teacher@youspeak.com',\n      name: 'Sarah Ahmed',\n      phone: '+201234567891',\n      passwordHash: teacherPassword,\n      role: 'TEACHER',\n      isActive: true,\n    },\n  })\n  \n  await prisma.teacherProfile.upsert({\n    where: { userId: teacher.id },\n    update: {},\n    create: {\n      id: uuidv4(),\n      userId: teacher.id,\n      bio: 'Experienced English teacher with 5+ years of teaching',\n      subjects: 'English Grammar, Conversation, IELTS Preparation',\n    },\n  })\n  console.log('✅ Created teacher:', teacher.email)\n\n  const studentPassword = await bcrypt.hash('student123', 10)\n  \n  const students = [\n    { name: 'Ahmed Ali', email: 'ahmed@student.com', age: 25, level: 'Beginner', isActive: true },\n    { name: 'Fatima Hassan', email: 'fatima@student.com', age: 22, level: 'Intermediate', isActive: true },\n    { name: 'Omar Mahmoud', email: 'omar@student.com', age: 28, level: 'Advanced', isActive: false },\n  ]\n\n  const createdStudents = []\n  \n  for (const studentData of students) {\n    const student = await prisma.user.upsert({\n      where: { email: studentData.email },\n      update: {},\n      create: {\n        id: uuidv4(),\n        email: studentData.email,\n        name: studentData.name,\n        phone: `+20123456${Math.floor(Math.random() * 10000)}`,\n        passwordHash: studentPassword,\n        role: 'STUDENT',\n        isActive: studentData.isActive,\n      },\n    })\n    \n    await prisma.studentProfile.upsert({\n      where: { userId: student.id },\n      update: {},\n      create: {\n        id: uuidv4(),\n        userId: student.id,\n        age: studentData.age,\n        levelInitial: studentData.level,\n        levelCurrent: studentData.level,\n        targetLevel: 'Advanced',\n        goal: 'Improve English for career advancement',\n        preferredTime: 'Evening',\n        isVerified: studentData.isActive,\n      },\n    })\n    \n    createdStudents.push(student)\n    console.log(`✅ Created student: ${student.email}`)\n  }\n\n  await prisma.package.deleteMany({})\n  \n  const packages = [\n    {\n      id: uuidv4(),\n      title: 'Trial',\n      titleAr: 'جلسة تجريبية',\n      description: '20-minute introductory session',\n      descriptionAr: 'جلسة تعريفية 20 دقيقة',\n      price: 0,\n      lessonsCount: 1,\n      durationDays: 7,\n    },\n    {\n      id: uuidv4(),\n      title: 'Starter',\n      titleAr: 'باقة البداية',\n      description: 'Single level - 8 lessons valid for 2 months',\n      descriptionAr: 'مستوى واحد - 8 حصص صالحة لمدة شهرين',\n      price: 200,\n      lessonsCount: 8,\n      durationDays: 60,\n    },\n    {\n      id: uuidv4(),\n      title: 'Monthly',\n      titleAr: 'الباقة الشهرية',\n      description: '12 lessons - Great value',\n      descriptionAr: '12 حصة - قيمة رائعة',\n      price: 360,\n      lessonsCount: 12,\n      durationDays: 30,\n    },\n    {\n      id: uuidv4(),\n      title: 'Quarterly',\n      titleAr: 'الباقة الفصلية',\n      description: '36 lessons (3 months) - Best value',\n      descriptionAr: '36 حصة (3 أشهر) - أفضل قيمة',\n      price: 1000,\n      lessonsCount: 36,\n      durationDays: 90,\n    },\n  ]\n\n  await prisma.package.createMany({ data: packages })\n  console.log('✅ Created 4 packages')\n\n  const sampleWords = [\n    { english: 'hello', arabic: 'مرحبا', example: 'Hello, how are you?' },\n    { english: 'goodbye', arabic: 'وداعا', example: 'Goodbye, see you later!' },\n    { english: 'thank you', arabic: 'شكرا لك', example: 'Thank you for your help.' },\n    { english: 'please', arabic: 'من فضلك', example: 'Please come in.' },\n    { english: 'sorry', arabic: 'آسف', example: 'I am sorry for being late.' },\n    { english: 'yes', arabic: 'نعم', example: 'Yes, I agree with you.' },\n    { english: 'no', arabic: 'لا', example: 'No, I do not think so.' },\n    { english: 'good morning', arabic: 'صباح الخير', example: 'Good morning everyone!' },\n    { english: 'good night', arabic: 'تصبح على خير', example: 'Good night, sleep well.' },\n    { english: 'welcome', arabic: 'أهلا وسهلا', example: 'Welcome to our class!' },\n    { english: 'understand', arabic: 'أفهم', example: 'I understand the lesson.' },\n    { english: 'help', arabic: 'مساعدة', example: 'Can you help me, please?' },\n    { english: 'learn', arabic: 'تعلم', example: 'I want to learn English.' },\n    { english: 'study', arabic: 'دراسة', example: 'I study every day.' },\n    { english: 'practice', arabic: 'تمرين', example: 'Practice makes perfect.' },\n    { english: 'improve', arabic: 'تحسين', example: 'I want to improve my skills.' },\n    { english: 'speak', arabic: 'تحدث', example: 'I can speak English well.' },\n    { english: 'listen', arabic: 'استمع', example: 'Please listen carefully.' },\n    { english: 'read', arabic: 'قراءة', example: 'I read books every day.' },\n    { english: 'write', arabic: 'كتابة', example: 'I write in my journal.' },\n  ]\n\n  for (const student of createdStudents) {\n    if (student.isActive) {\n      const wordsToAdd = sampleWords.slice(0, Math.floor(Math.random() * 10) + 8)\n      \n      for (const wordData of wordsToAdd) {\n        await prisma.word.create({\n          data: {\n            id: uuidv4(),\n            studentId: student.id,\n            englishWord: wordData.english,\n            arabicMeaning: wordData.arabic,\n            exampleSentence: wordData.example,\n            known: Math.random() > 0.6,\n          },\n        })\n      }\n      \n      console.log(`✅ Added ${wordsToAdd.length} words for ${student.email}`)\n    }\n  }\n\n  console.log('\\n🎉 Seed completed successfully!')\n  console.log('\\n📝 Test Accounts:')\n  console.log('Admin: admin@youspeak.com / admin123')\n  console.log('Teacher: teacher@youspeak.com / teacher123')\n  console.log('Student 1: ahmed@student.com / student123 (Active)')\n  console.log('Student 2: fatima@student.com / student123 (Active)')\n  console.log('Student 3: omar@student.com / student123 (Inactive)')\n}\n\nmain()\n  .catch((e) => {\n    console.error('Error seeding database:', e)\n    process.exit(1)\n  })\n  .finally(async () => {\n    await prisma.$disconnect()\n  })\n","size_bytes":7172},"app/dashboard/student/components/HomeTab.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport Link from 'next/link'\nimport { Calendar, Trophy, BookOpen, Clock } from 'lucide-react'\nimport Card from '@/components/ui/Card'\nimport Button from '@/components/ui/Button'\nimport LoadingSpinner from '@/components/ui/LoadingSpinner'\n\ninterface HomeTabProps {\n  isActive: boolean\n}\n\ninterface Stats {\n  wordsLearned: number\n  sessionsAttended: number\n  pendingAssignments: number\n  activeSubscription: {\n    packageTitle: string\n    packageTitleAr: string\n    startDate: Date\n    endDate: Date\n    lessonsTotal: number\n    lessonsRemaining: number\n    daysRemaining: number\n  } | null\n  nextSession: {\n    id: string\n    title: string\n    startTime: Date\n    endTime: Date\n    teacherName: string\n  } | null\n}\n\nexport default function HomeTab({ isActive }: HomeTabProps) {\n  const [stats, setStats] = useState<Stats | null>(null)\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    fetchStats()\n  }, [])\n\n  async function fetchStats() {\n    try {\n      const response = await fetch('/api/student/stats')\n      if (response.ok) {\n        const data = await response.json()\n        setStats(data)\n      }\n    } catch (error) {\n      console.error('Error fetching stats:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <LoadingSpinner size=\"lg\" />\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <h2 className=\"text-3xl font-bold text-[#004E89]\">\n        Dashboard / لوحة التحكم\n      </h2>\n\n      <div className=\"grid md:grid-cols-3 gap-4\">\n        <Card variant=\"elevated\">\n          <div className=\"text-center\">\n            <div className=\"w-12 h-12 bg-blue-100 rounded-full mx-auto mb-3 flex items-center justify-center\">\n              <Calendar className=\"h-6 w-6 text-[#004E89]\" />\n            </div>\n            <h3 className=\"font-semibold text-gray-900 mb-1\">Next Session</h3>\n            {stats?.nextSession ? (\n              <>\n                <p className=\"text-sm text-gray-900 font-medium\">{stats.nextSession.title}</p>\n                <p className=\"text-xs text-gray-600\">\n                  {new Date(stats.nextSession.startTime).toLocaleString('ar-EG', {\n                    weekday: 'short',\n                    month: 'short',\n                    day: 'numeric',\n                    hour: '2-digit',\n                    minute: '2-digit'\n                  })}\n                </p>\n                <p className=\"text-xs text-gray-600\">مع {stats.nextSession.teacherName}</p>\n              </>\n            ) : (\n              <>\n                <p className=\"text-sm text-gray-600\">No upcoming sessions</p>\n                <p className=\"text-sm text-gray-600\">لا توجد حصص قادمة</p>\n              </>\n            )}\n          </div>\n        </Card>\n\n        <Card variant=\"elevated\">\n          <div className=\"text-center\">\n            <div className=\"w-12 h-12 bg-green-100 rounded-full mx-auto mb-3 flex items-center justify-center\">\n              <Trophy className=\"h-6 w-6 text-green-600\" />\n            </div>\n            <h3 className=\"font-semibold text-gray-900 mb-1\">Words Learned</h3>\n            <p className=\"text-2xl font-bold text-[#004E89]\">{stats?.wordsLearned || 0}</p>\n            <p className=\"text-sm text-gray-600\">كلمة محفوظة</p>\n          </div>\n        </Card>\n\n        <Card variant=\"elevated\">\n          <div className=\"text-center\">\n            <div className=\"w-12 h-12 bg-purple-100 rounded-full mx-auto mb-3 flex items-center justify-center\">\n              <BookOpen className=\"h-6 w-6 text-purple-600\" />\n            </div>\n            <h3 className=\"font-semibold text-gray-900 mb-1\">Pending Assignments</h3>\n            <p className=\"text-2xl font-bold text-[#004E89]\">{stats?.pendingAssignments || 0}</p>\n            <p className=\"text-sm text-gray-600\">واجب مطلوب</p>\n          </div>\n        </Card>\n      </div>\n\n      {stats?.activeSubscription && (\n        <Card variant=\"elevated\" className=\"bg-gradient-to-r from-green-50 to-blue-50 border-green-200\">\n          <h3 className=\"text-xl font-bold text-[#004E89] mb-4 flex items-center gap-2\">\n            <Clock className=\"h-6 w-6 text-green-600\" />\n            Active Package / باقة نشطة\n          </h3>\n          <div className=\"grid md:grid-cols-2 gap-4\">\n            <div className=\"space-y-3\">\n              <div>\n                <p className=\"text-sm text-gray-600\">Package Name / اسم الباقة</p>\n                <p className=\"text-lg font-semibold text-gray-900\">\n                  {stats.activeSubscription.packageTitle} / {stats.activeSubscription.packageTitleAr}\n                </p>\n              </div>\n              <div>\n                <p className=\"text-sm text-gray-600\">Subscription Period / فترة الاشتراك</p>\n                <p className=\"text-sm font-medium text-gray-900\">\n                  {new Date(stats.activeSubscription.startDate).toLocaleDateString('ar-EG')} -{' '}\n                  {new Date(stats.activeSubscription.endDate).toLocaleDateString('ar-EG')}\n                </p>\n              </div>\n            </div>\n            <div className=\"space-y-3\">\n              <div className=\"bg-white rounded-lg p-4 text-center\">\n                <p className=\"text-sm text-gray-600 mb-1\">Remaining Lessons / حصص متبقية</p>\n                <p className=\"text-3xl font-bold text-[#004E89]\">\n                  {stats.activeSubscription.lessonsRemaining}\n                </p>\n                <p className=\"text-sm text-gray-600\">\n                  of {stats.activeSubscription.lessonsTotal} / من {stats.activeSubscription.lessonsTotal}\n                </p>\n              </div>\n              <div className=\"bg-white rounded-lg p-4 text-center\">\n                <p className=\"text-sm text-gray-600 mb-1\">Days Remaining / أيام متبقية</p>\n                <p className=\"text-3xl font-bold text-green-600\">\n                  {stats.activeSubscription.daysRemaining}\n                </p>\n                <p className=\"text-sm text-gray-600\">days / يوم</p>\n              </div>\n            </div>\n          </div>\n        </Card>\n      )}\n\n      <Card variant=\"elevated\">\n        <h3 className=\"text-xl font-bold text-[#004E89] mb-4\">\n          Quick Actions / إجراءات سريعة\n        </h3>\n        <div className=\"grid md:grid-cols-2 gap-4\">\n          <Link href=\"https://wa.me/201091515594\" target=\"_blank\">\n            <Button variant=\"outline\" fullWidth>\n              Contact Support / تواصل مع الدعم\n            </Button>\n          </Link>\n          {isActive && (\n            <Button variant=\"primary\" fullWidth>\n              View All Sessions / عرض جميع الحصص\n            </Button>\n          )}\n        </div>\n      </Card>\n    </div>\n  )\n}\n","size_bytes":6915},"attached_assets/websocket_1763165382699.ts":{"content":"import { WebSocketServer, WebSocket } from \"ws\";\nimport type { Server } from \"http\";\nimport { drawCommandSchema } from \"@shared/schema\";\n\ninterface ClientMetadata {\n  ws: WebSocket;\n  userId: string;\n  role: \"student\" | \"supervisor\" | \"admin\";\n  studentId?: string;\n  roomToken?: string;\n}\n\ntype InboundMessage = {\n  type: \"auth\" | \"chat_message\" | \"student_update\" | \"new_student_registration\" |\n        \"assignment_update\" | \"session_enable\" | \"error_notification\" |\n        \"room:join\" | \"room:leave\" | \"webrtc:offer\" | \"webrtc:answer\" | \"webrtc:ice-candidate\" |\n        \"room:hand-raise\" | \"room:hand-lower\" | \"room:toggle-hand\" | \"room:reaction\" | \"room:mute-participant\" |\n        \"room:mute-all\" | \"room:all-muted\" | \"room:remove-participant\" | \"room:lock\" |\n        \"whiteboard:command\";\n  payload: any;\n};\n\nclass WebSocketService {\n  private wss: WebSocketServer | null = null;\n  private clients: Map<string, ClientMetadata> = new Map();\n  private sockets: Map<WebSocket, ClientMetadata> = new Map();\n  private rooms: Map<string, Set<string>> = new Map();\n\n  initialize(server: Server) {\n    this.wss = new WebSocketServer({ server, path: \"/ws\" });\n\n    this.wss.on(\"connection\", (ws, req) => {\n      console.log(\"🔌 New WebSocket connection\");\n\n      ws.on(\"message\", (message: string) => {\n        try {\n          const data = JSON.parse(message.toString()) as InboundMessage;\n          this.handleMessage(ws, data);\n        } catch (error) {\n          console.error(\"❌ Error parsing WebSocket message:\", error);\n        }\n      });\n\n      ws.on(\"close\", () => this.handleDisconnect(ws));\n      ws.on(\"error\", (error) => console.error(\"❌ WebSocket error:\", error));\n    });\n\n    console.log(\"✅ WebSocket server initialized on /ws\");\n  }\n\n  private handleMessage(ws: WebSocket, data: InboundMessage) {\n    const { type, payload } = data;\n\n    switch (type) {\n      case \"auth\":\n        this.handleAuth(ws, payload);\n        break;\n      case \"room:join\":\n        this.handleRoomJoin(ws, payload);\n        break;\n      case \"room:leave\":\n        this.handleRoomLeave(ws, payload?.roomToken);\n        break;\n      case \"webrtc:offer\":\n      case \"webrtc:answer\":\n      case \"webrtc:ice-candidate\":\n        this.handleWebRTCSignal(ws, type, payload);\n        break;\n      case \"room:hand-raise\":\n      case \"room:hand-lower\":\n        this.handleHandRaise(ws, type, payload);\n        break;\n      case \"room:toggle-hand\":\n        this.handleHandToggle(ws, payload);\n        break;\n      case \"room:reaction\":\n        this.handleReaction(ws, payload);\n        break;\n      case \"whiteboard:command\":\n        this.handleWhiteboardCommand(ws, payload);\n        break;\n      case \"room:mute-participant\":\n        this.handleParticipantMute(ws, payload);\n        break;\n      case \"room:all-muted\":\n        this.handleMuteAll(ws, payload);\n        break;\n      case \"room:remove-participant\":\n        this.handleParticipantRemove(ws, payload);\n        break;\n      case \"room:lock\":\n        this.handleRoomLock(ws, payload);\n        break;\n      case \"chat_message\":\n        void this.handleChatMessage(ws, payload);\n        break;\n      case \"student_update\":\n        this.broadcastToSupervisors(payload);\n        break;\n      case \"new_student_registration\":\n        this.notifySheikhOfNewStudent(payload);\n        break;\n      case \"assignment_update\":\n        this.sendToStudent(payload.studentId, { type: \"assignment_updated\", data: payload });\n        break;\n      case \"session_enable\":\n        this.handleSessionEnable(payload);\n        break;\n      case \"error_notification\":\n        this.broadcastToSupervisors({ type: \"student_error\", data: payload });\n        break;\n      default:\n        console.log(\"⚠️ Unknown message type:\", type);\n    }\n  }\n\n  private handleAuth(ws: WebSocket, payload: any) {\n    const { userId, role, studentId } = payload;\n    const metadata: ClientMetadata = { ws, userId, role, studentId };\n\n    this.clients.set(userId, metadata);\n    this.sockets.set(ws, metadata);\n\n    console.log(`✅ User ${userId} authenticated as ${role}`);\n\n    ws.send(JSON.stringify({ type: \"auth_success\", payload: { userId, role } }));\n  }\n\n  private handleRoomJoin(ws: WebSocket, payload: any) {\n    const client = this.sockets.get(ws);\n    if (!client) {\n      ws.send(JSON.stringify({ type: \"error\", payload: { message: \"Unauthorized\" } }));\n      return;\n    }\n\n    const { roomToken } = payload ?? {};\n    if (!roomToken) {\n      ws.send(JSON.stringify({ type: \"error\", payload: { message: \"roomToken required\" } }));\n      return;\n    }\n\n    client.roomToken = roomToken;\n\n    if (!this.rooms.has(roomToken)) {\n      this.rooms.set(roomToken, new Set());\n    }\n    this.rooms.get(roomToken)!.add(client.userId);\n\n    this.broadcastParticipants(roomToken);\n\n    ws.send(JSON.stringify({\n      type: \"room:joined\",\n      payload: { roomToken, participants: this.getParticipants(roomToken) }\n    }));\n  }\n\n  private handleRoomLeave(ws: WebSocket, roomToken?: string) {\n    const client = this.sockets.get(ws);\n    if (!client) return;\n    const token = roomToken ?? client.roomToken;\n    if (!token) return;\n\n    const members = this.rooms.get(token);\n    if (!members) return;\n\n    members.delete(client.userId);\n    \n    if (this.participantHandStates.has(token)) {\n      this.participantHandStates.get(token)!.delete(client.userId);\n      if (this.participantHandStates.get(token)!.size === 0) {\n        this.participantHandStates.delete(token);\n      }\n    }\n\n    if (members.size === 0) {\n      this.rooms.delete(token);\n      this.participantHandStates.delete(token);\n    }\n\n    client.roomToken = undefined;\n    this.broadcastParticipants(token);\n  }\n\n  private handleWebRTCSignal(ws: WebSocket, type: \"webrtc:offer\" | \"webrtc:answer\" | \"webrtc:ice-candidate\", payload: any) {\n    const client = this.sockets.get(ws);\n    if (!client?.roomToken) {\n      ws.send(JSON.stringify({ type: \"error\", payload: { message: \"Join a room first\" } }));\n      return;\n    }\n\n    const members = this.rooms.get(client.roomToken);\n    if (!members) return;\n\n    members.forEach((userId) => {\n      if (userId === client.userId) return;\n      const peer = this.clients.get(userId);\n      if (!peer) return;\n\n      peer.ws.send(JSON.stringify({\n        type,\n        payload: {\n          from: client.userId,\n          role: client.role,\n          data: payload,\n        },\n      }));\n    });\n  }\n\n  private broadcastParticipants(roomToken: string) {\n    const members = this.rooms.get(roomToken);\n    if (!members) return;\n\n    const participants = this.getParticipants(roomToken);\n\n    members.forEach((userId) => {\n      const client = this.clients.get(userId);\n      if (!client) return;\n      client.ws.send(JSON.stringify({\n        type: \"room:participants\",\n        payload: { roomToken, participants },\n      }));\n    });\n  }\n\n  private getParticipants(roomToken: string) {\n    const members = this.rooms.get(roomToken);\n    if (!members) return [];\n    return Array.from(members).map((userId) => {\n      const client = this.clients.get(userId);\n      return client\n        ? { userId: client.userId, role: client.role, studentId: client.studentId }\n        : { userId };\n    });\n  }\n\n  private handleDisconnect(ws: WebSocket) {\n    const client = this.sockets.get(ws);\n    if (!client) return;\n\n    this.clients.delete(client.userId);\n    this.sockets.delete(ws);\n\n    if (client.roomToken) {\n      this.handleRoomLeave(ws, client.roomToken);\n    }\n\n    console.log(`👋 User ${client.userId} disconnected`);\n  }\n\n  private broadcastToSupervisors(payload: any) {\n    this.clients.forEach((client) => {\n      if (client.role === \"supervisor\" || client.role === \"admin\") {\n        client.ws.send(JSON.stringify({ type: \"student_notification\", payload }));\n      }\n    });\n  }\n\n  private sendToStudent(studentId: string, payload: any) {\n    this.clients.forEach((client) => {\n      if (client.studentId === studentId || client.userId === studentId) {\n        client.ws.send(JSON.stringify(payload));\n      }\n    });\n  }\n\n  private async handleChatMessage(ws: WebSocket, payload: any) {\n    const { content, senderId, receiverId, isGroupMessage, messageType = \"text\" } = payload;\n    const client = this.sockets.get(ws);\n    \n    if (!client) {\n      ws.send(JSON.stringify({ type: \"error\", payload: { message: \"Unauthorized\" } }));\n      return;\n    }\n\n    const { storage } = await import(\"./storage\");\n    try {\n      const savedMessage = await storage.createMessage({ senderId, receiverId: receiverId || null, content, messageType, isGroupMessage: isGroupMessage || false });\n      \n      if (isGroupMessage && client.roomToken) {\n        this.broadcastToRoom(client.roomToken, { type: \"chat_message\", payload: savedMessage });\n      } else if (receiverId) {\n        this.sendChatMessageToUser(receiverId, savedMessage);\n      } else {\n        ws.send(JSON.stringify({ type: \"chat_message\", payload: savedMessage }));\n      }\n    } catch (error) {\n      console.error(\"❌ Error handling chat message:\", error);\n      ws.send(JSON.stringify({ type: \"error\", payload: { message: \"Failed to send message\" } }));\n    }\n  }\n\n  private broadcastToRoom(roomToken: string, message: any) {\n    const members = this.rooms.get(roomToken);\n    if (!members) return;\n\n    members.forEach((userId) => {\n      const client = this.clients.get(userId);\n      if (client) {\n        client.ws.send(JSON.stringify(message));\n      }\n    });\n  }\n\n  private sendChatMessageToUser(userId: string, message: any) {\n    const client = this.clients.get(userId);\n    if (client) {\n      client.ws.send(JSON.stringify({ type: \"chat_message\", payload: message }));\n    }\n  }\n\n  private handleSessionEnable(payload: any) {\n    const { studentId, sessionData } = payload;\n    this.sendToStudent(studentId, { type: \"session_enabled\", data: sessionData });\n  }\n\n  public notifySheikhOfNewStudent(studentData: any) {\n    this.broadcastToSupervisors({ type: \"new_student\", student: studentData, timestamp: new Date().toISOString() });\n  }\n\n  public notifyStudentOfAssignment(studentId: string, assignment: any) {\n    this.sendToStudent(studentId, { type: \"new_assignment\", data: assignment });\n  }\n\n  public enableSessionAccess(studentId: string, sessionData: any) {\n    this.sendToStudent(studentId, { type: \"session_enabled\", data: sessionData });\n  }\n\n  public notifyStudentOfCertificate(studentId: string, certificate: any) {\n    this.sendToStudent(studentId, { type: \"certificate_issued\", data: certificate });\n  }\n\n  public notifyStudentOfPayment(studentId: string, payment: any) {\n    this.sendToStudent(studentId, { type: \"payment_received\", data: payment });\n  }\n\n  public notifyStudentOfMeeting(studentId: string, meeting: any) {\n    this.sendToStudent(studentId, { type: \"meeting_scheduled\", data: meeting });\n  }\n\n  public notifyStudentOfQuranUpdate(studentId: string, updateData: any) {\n    this.sendToStudent(studentId, { type: \"quran_update\", data: updateData, timestamp: new Date().toISOString() });\n  }\n\n  public notifyStudentOfNewError(studentId: string, error: any) {\n    this.sendToStudent(studentId, { type: \"new_error_added\", data: error, timestamp: new Date().toISOString() });\n  }\n\n  public notifyStudentOfNoteUpdate(studentId: string, note: any) {\n    this.sendToStudent(studentId, { type: \"note_updated\", data: note, timestamp: new Date().toISOString() });\n  }\n\n  private handleHandRaise(ws: WebSocket, type: \"room:hand-raise\" | \"room:hand-lower\", payload: any) {\n    const client = this.sockets.get(ws);\n    if (!client?.roomToken) {\n      ws.send(JSON.stringify({ type: \"error\", payload: { message: \"Join a room first\" } }));\n      return;\n    }\n\n    const isRaised = type === \"room:hand-raise\";\n\n    this.broadcastToRoom(client.roomToken, {\n      type: isRaised ? \"room:hand-raised\" : \"room:hand-lowered\",\n      payload: { userId: client.userId, isHandRaised: isRaised }\n    });\n  }\n\n  private handleHandToggle(ws: WebSocket, payload: any) {\n    const client = this.sockets.get(ws);\n    if (!client?.roomToken) {\n      ws.send(JSON.stringify({ type: \"error\", payload: { message: \"Join a room first\" } }));\n      return;\n    }\n\n    const userId = client.userId;\n    const currentState = this.getParticipantHandState(client.roomToken, userId);\n    const newState = !currentState;\n\n    this.setParticipantHandState(client.roomToken, userId, newState);\n\n    this.broadcastToRoom(client.roomToken, {\n      type: newState ? \"room:hand-raised\" : \"room:hand-lowered\",\n      payload: { userId, isHandRaised: newState }\n    });\n  }\n\n  private participantHandStates: Map<string, Map<string, boolean>> = new Map();\n\n  private getParticipantHandState(roomToken: string, userId: string): boolean {\n    if (!this.participantHandStates.has(roomToken)) {\n      this.participantHandStates.set(roomToken, new Map());\n    }\n    return this.participantHandStates.get(roomToken)!.get(userId) || false;\n  }\n\n  private setParticipantHandState(roomToken: string, userId: string, state: boolean): void {\n    if (!this.participantHandStates.has(roomToken)) {\n      this.participantHandStates.set(roomToken, new Map());\n    }\n    this.participantHandStates.get(roomToken)!.set(userId, state);\n  }\n\n  private handleWhiteboardCommand(ws: WebSocket, payload: any) {\n    const client = this.sockets.get(ws);\n    if (!client?.roomToken) {\n      ws.send(JSON.stringify({ type: \"error\", payload: { message: \"Join a room first\" } }));\n      return;\n    }\n\n    const { command } = payload;\n\n    const validationResult = drawCommandSchema.safeParse(command);\n    if (!validationResult.success) {\n      console.warn('Invalid whiteboard command:', validationResult.error);\n      ws.send(JSON.stringify({ \n        type: \"error\", \n        payload: { message: \"Invalid whiteboard command format\" } \n      }));\n      return;\n    }\n\n    const members = this.rooms.get(client.roomToken);\n    if (!members || !members.has(client.userId)) {\n      ws.send(JSON.stringify({ type: \"error\", payload: { message: \"Not a member of this room\" } }));\n      return;\n    }\n\n    const sanitizePoints = (points: any): Array<{x: number, y: number}> | undefined => {\n      if (!Array.isArray(points) || points.length === 0) return undefined;\n      try {\n        return points\n          .filter(p => p && typeof p === 'object')\n          .map(p => ({\n            x: Number(p.x) || 0,\n            y: Number(p.y) || 0\n          }))\n          .slice(0, 10000);\n      } catch {\n        return undefined;\n      }\n    };\n\n    const sanitizedCommand: any = {\n      type: String(command.type).slice(0, 50),\n      userId: client.userId\n    };\n\n    if (command.x !== undefined && !isNaN(Number(command.x))) {\n      sanitizedCommand.x = Number(command.x);\n    }\n    if (command.y !== undefined && !isNaN(Number(command.y))) {\n      sanitizedCommand.y = Number(command.y);\n    }\n    if (command.width !== undefined && !isNaN(Number(command.width))) {\n      sanitizedCommand.width = Math.max(0, Math.min(10000, Number(command.width)));\n    }\n    if (command.height !== undefined && !isNaN(Number(command.height))) {\n      sanitizedCommand.height = Math.max(0, Math.min(10000, Number(command.height)));\n    }\n    if (command.color && typeof command.color === 'string') {\n      sanitizedCommand.color = String(command.color).slice(0, 20);\n    }\n    if (command.text && typeof command.text === 'string') {\n      sanitizedCommand.text = String(command.text).slice(0, 1000);\n    }\n    if (command.strokeWidth !== undefined && !isNaN(Number(command.strokeWidth))) {\n      sanitizedCommand.strokeWidth = Math.max(1, Math.min(100, Number(command.strokeWidth)));\n    }\n    if (command.lineWidth !== undefined && !isNaN(Number(command.lineWidth))) {\n      sanitizedCommand.lineWidth = Math.max(1, Math.min(100, Number(command.lineWidth)));\n    }\n    if (command.shape && typeof command.shape === 'string') {\n      sanitizedCommand.shape = String(command.shape).slice(0, 20);\n    }\n    if (command.filled !== undefined) {\n      sanitizedCommand.filled = Boolean(command.filled);\n    }\n    if (command.x2 !== undefined && !isNaN(Number(command.x2))) {\n      sanitizedCommand.x2 = Number(command.x2);\n    }\n    if (command.y2 !== undefined && !isNaN(Number(command.y2))) {\n      sanitizedCommand.y2 = Number(command.y2);\n    }\n    \n    const sanitizedPoints = sanitizePoints(command.points);\n    if (sanitizedPoints) {\n      sanitizedCommand.points = sanitizedPoints;\n    }\n\n    const commandId = `${client.roomToken}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n    const timestamp = new Date().toISOString();\n\n    this.broadcastToRoom(client.roomToken, {\n      type: \"whiteboard:command\",\n      payload: {\n        id: commandId,\n        command: sanitizedCommand,\n        userId: client.userId,\n        timestamp\n      }\n    });\n  }\n\n  private handleReaction(ws: WebSocket, payload: any) {\n    const client = this.sockets.get(ws);\n    if (!client?.roomToken) {\n      ws.send(JSON.stringify({ type: \"error\", payload: { message: \"Join a room first\" } }));\n      return;\n    }\n\n    const { reaction } = payload;\n\n    this.broadcastToRoom(client.roomToken, {\n      type: \"room:reaction\",\n      payload: { userId: client.userId, reaction }\n    });\n  }\n\n  private handleParticipantMute(ws: WebSocket, payload: any) {\n    const client = this.sockets.get(ws);\n    if (!client?.roomToken) {\n      ws.send(JSON.stringify({ type: \"error\", payload: { message: \"Join a room first\" } }));\n      return;\n    }\n\n    if (client.role !== \"supervisor\" && client.role !== \"admin\") {\n      ws.send(JSON.stringify({ type: \"error\", payload: { message: \"Only supervisors can mute participants\" } }));\n      return;\n    }\n\n    const { participantId, shouldMute } = payload;\n\n    this.broadcastToRoom(client.roomToken, {\n      type: \"room:participant-muted\",\n      payload: { participantId, shouldMute }\n    });\n  }\n\n  private handleMuteAll(ws: WebSocket, payload: any) {\n    const client = this.sockets.get(ws);\n    if (!client?.roomToken) {\n      ws.send(JSON.stringify({ type: \"error\", payload: { message: \"Join a room first\" } }));\n      return;\n    }\n\n    if (client.role !== \"supervisor\" && client.role !== \"admin\") {\n      ws.send(JSON.stringify({ type: \"error\", payload: { message: \"Only supervisors can mute all\" } }));\n      return;\n    }\n\n    this.broadcastToRoom(client.roomToken, {\n      type: \"room:all-muted\",\n      payload: { initiatorId: client.userId }\n    });\n  }\n\n  private handleParticipantRemove(ws: WebSocket, payload: any) {\n    const client = this.sockets.get(ws);\n    if (!client?.roomToken) {\n      ws.send(JSON.stringify({ type: \"error\", payload: { message: \"Join a room first\" } }));\n      return;\n    }\n\n    if (client.role !== \"supervisor\" && client.role !== \"admin\") {\n      ws.send(JSON.stringify({ type: \"error\", payload: { message: \"Only supervisors can remove participants\" } }));\n      return;\n    }\n\n    const { participantId } = payload;\n    const targetClient = this.clients.get(participantId);\n    \n    if (targetClient) {\n      targetClient.ws.send(JSON.stringify({\n        type: \"room:kicked\",\n        payload: { reason: \"Removed by supervisor\" }\n      }));\n\n      this.handleRoomLeave(targetClient.ws, client.roomToken);\n    }\n\n    this.broadcastToRoom(client.roomToken, {\n      type: \"room:participant-removed\",\n      payload: { participantId }\n    });\n  }\n\n  private handleRoomLock(ws: WebSocket, payload: any) {\n    const client = this.sockets.get(ws);\n    if (!client?.roomToken) {\n      ws.send(JSON.stringify({ type: \"error\", payload: { message: \"Join a room first\" } }));\n      return;\n    }\n\n    if (client.role !== \"supervisor\" && client.role !== \"admin\") {\n      ws.send(JSON.stringify({ type: \"error\", payload: { message: \"Only supervisors can lock/unlock rooms\" } }));\n      return;\n    }\n\n    const { locked } = payload;\n\n    this.broadcastToRoom(client.roomToken, {\n      type: \"room:lock-changed\",\n      payload: { locked }\n    });\n  }\n}\n\nexport const wsService = new WebSocketService();\n","size_bytes":19977},"attached_assets/LiveWhiteboard_1763165109551.tsx":{"content":"import { useWhiteboard, type DrawCommand } from '@/hooks/useWhiteboard';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { \n  Pencil, \n  Eraser, \n  Trash2, \n  Palette,\n  Minus,\n  Plus,\n  Square,\n  Circle,\n  ArrowRight,\n  Type,\n  PaintBucket,\n  Undo2,\n  Redo2,\n  Save,\n  Upload\n} from 'lucide-react';\nimport { Badge } from '@/components/ui/badge';\nimport { useEffect, useImperativeHandle, forwardRef, useRef } from 'react';\n\ninterface LiveWhiteboardProps {\n  roomToken: string;\n  userId: string;\n  isEnabled: boolean;\n  onSendCommand: (command: DrawCommand) => void;\n  onExecuteCommand: (executeFunc: (command: DrawCommand) => void) => void;\n}\n\nexport const LiveWhiteboard = forwardRef<any, LiveWhiteboardProps>(({ \n  roomToken, \n  userId, \n  isEnabled, \n  onSendCommand,\n  onExecuteCommand \n}, ref) => {\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  \n  const {\n    canvasRef,\n    tool,\n    setTool,\n    color,\n    setColor,\n    lineWidth,\n    setLineWidth,\n    filled,\n    setFilled,\n    startDrawing,\n    draw,\n    stopDrawing,\n    clearCanvas,\n    executeRemoteCommand,\n    undo,\n    redo,\n    canUndo,\n    canRedo,\n    saveAsImage,\n    saveAsJSON,\n    loadFromJSON\n  } = useWhiteboard({ \n    roomToken, \n    userId, \n    isEnabled, \n    onSendCommand \n  });\n\n  const handleLoadJSON = () => {\n    fileInputRef.current?.click();\n  };\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      const reader = new FileReader();\n      reader.onload = (event) => {\n        const content = event.target?.result as string;\n        loadFromJSON(content);\n      };\n      reader.readAsText(file);\n    }\n  };\n\n  useEffect(() => {\n    onExecuteCommand(executeRemoteCommand);\n  }, [executeRemoteCommand, onExecuteCommand]);\n\n  useImperativeHandle(ref, () => ({\n    executeRemoteCommand\n  }));\n\n  const colors = [\n    { value: '#000000', name: 'أسود' },\n    { value: '#FF0000', name: 'أحمر' },\n    { value: '#0000FF', name: 'أزرق' },\n    { value: '#00FF00', name: 'أخضر' },\n    { value: '#FFFF00', name: 'أصفر' },\n    { value: '#FF00FF', name: 'بنفسجي' },\n    { value: '#FFA500', name: 'برتقالي' },\n    { value: '#FFFFFF', name: 'أبيض' }\n  ];\n\n  const handleMouseDown = (e: React.MouseEvent<HTMLCanvasElement>) => {\n    if (!isEnabled) return;\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const rect = canvas.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    startDrawing(x, y);\n  };\n\n  const handleMouseMove = (e: React.MouseEvent<HTMLCanvasElement>) => {\n    if (!isEnabled) return;\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const rect = canvas.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    draw(x, y);\n  };\n\n  const handleMouseUp = (e: React.MouseEvent<HTMLCanvasElement>) => {\n    if (!isEnabled) return;\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const rect = canvas.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    stopDrawing(x, y);\n  };\n\n  const handleTouchStart = (e: React.TouchEvent<HTMLCanvasElement>) => {\n    if (!isEnabled) return;\n    e.preventDefault();\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const rect = canvas.getBoundingClientRect();\n    const touch = e.touches[0];\n    const x = touch.clientX - rect.left;\n    const y = touch.clientY - rect.top;\n    startDrawing(x, y);\n  };\n\n  const handleTouchMove = (e: React.TouchEvent<HTMLCanvasElement>) => {\n    if (!isEnabled) return;\n    e.preventDefault();\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const rect = canvas.getBoundingClientRect();\n    const touch = e.touches[0];\n    const x = touch.clientX - rect.left;\n    const y = touch.clientY - rect.top;\n    draw(x, y);\n  };\n\n  const handleTouchEnd = (e: React.TouchEvent<HTMLCanvasElement>) => {\n    if (!isEnabled) return;\n    e.preventDefault();\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const rect = canvas.getBoundingClientRect();\n    if (e.changedTouches && e.changedTouches.length > 0) {\n      const touch = e.changedTouches[0];\n      const x = touch.clientX - rect.left;\n      const y = touch.clientY - rect.top;\n      stopDrawing(x, y);\n    } else {\n      stopDrawing();\n    }\n  };\n\n  return (\n    <Card className=\"bg-black/40 border-emerald-500/30 h-full flex flex-col\">\n      <CardContent className=\"p-4 flex-1 flex flex-col gap-3\">\n        {/* Toolbar */}\n        <div className=\"flex items-center gap-2 flex-wrap\">\n          {/* Drawing Tools */}\n          <div className=\"flex gap-1\">\n            <Button\n              size=\"icon\"\n              variant={tool === 'pen' ? 'default' : 'outline'}\n              onClick={() => setTool('pen')}\n              disabled={!isEnabled}\n              className=\"bg-emerald-600 hover:bg-emerald-700\"\n              data-testid=\"button-whiteboard-pen\"\n            >\n              <Pencil className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              size=\"icon\"\n              variant={tool === 'eraser' ? 'default' : 'outline'}\n              onClick={() => setTool('eraser')}\n              disabled={!isEnabled}\n              className=\"bg-emerald-600 hover:bg-emerald-700\"\n              data-testid=\"button-whiteboard-eraser\"\n            >\n              <Eraser className=\"w-4 h-4\" />\n            </Button>\n          </div>\n\n          {/* Shape Tools */}\n          <div className=\"flex gap-1 border-r border-white/20 pr-2\">\n            <Button\n              size=\"icon\"\n              variant={tool === 'rectangle' ? 'default' : 'outline'}\n              onClick={() => setTool('rectangle')}\n              disabled={!isEnabled}\n              className=\"bg-emerald-600 hover:bg-emerald-700\"\n              data-testid=\"button-whiteboard-rectangle\"\n            >\n              <Square className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              size=\"icon\"\n              variant={tool === 'circle' ? 'default' : 'outline'}\n              onClick={() => setTool('circle')}\n              disabled={!isEnabled}\n              className=\"bg-emerald-600 hover:bg-emerald-700\"\n              data-testid=\"button-whiteboard-circle\"\n            >\n              <Circle className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              size=\"icon\"\n              variant={tool === 'line' ? 'default' : 'outline'}\n              onClick={() => setTool('line')}\n              disabled={!isEnabled}\n              className=\"bg-emerald-600 hover:bg-emerald-700\"\n              data-testid=\"button-whiteboard-line\"\n            >\n              <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" viewBox=\"0 0 24 24\">\n                <line x1=\"5\" y1=\"19\" x2=\"19\" y2=\"5\" />\n              </svg>\n            </Button>\n            <Button\n              size=\"icon\"\n              variant={tool === 'arrow' ? 'default' : 'outline'}\n              onClick={() => setTool('arrow')}\n              disabled={!isEnabled}\n              className=\"bg-emerald-600 hover:bg-emerald-700\"\n              data-testid=\"button-whiteboard-arrow\"\n            >\n              <ArrowRight className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              size=\"icon\"\n              variant={tool === 'text' ? 'default' : 'outline'}\n              onClick={() => setTool('text')}\n              disabled={!isEnabled}\n              className=\"bg-emerald-600 hover:bg-emerald-700\"\n              data-testid=\"button-whiteboard-text\"\n            >\n              <Type className=\"w-4 h-4\" />\n            </Button>\n          </div>\n\n          {/* Fill Toggle */}\n          {['rectangle', 'circle', 'line'].includes(tool) && (\n            <Button\n              size=\"icon\"\n              variant={filled ? 'default' : 'outline'}\n              onClick={() => setFilled(!filled)}\n              disabled={!isEnabled}\n              className=\"bg-blue-600 hover:bg-blue-700\"\n              data-testid=\"button-whiteboard-fill\"\n            >\n              <PaintBucket className=\"w-4 h-4\" />\n            </Button>\n          )}\n\n          {/* History Controls */}\n          <div className=\"flex gap-1 border-r border-white/20 pr-2\">\n            <Button\n              size=\"icon\"\n              variant=\"outline\"\n              onClick={undo}\n              disabled={!isEnabled || !canUndo}\n              className=\"bg-blue-600 hover:bg-blue-700\"\n              data-testid=\"button-whiteboard-undo\"\n              title=\"تراجع\"\n            >\n              <Undo2 className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              size=\"icon\"\n              variant=\"outline\"\n              onClick={redo}\n              disabled={!isEnabled || !canRedo}\n              className=\"bg-blue-600 hover:bg-blue-700\"\n              data-testid=\"button-whiteboard-redo\"\n              title=\"إعادة\"\n            >\n              <Redo2 className=\"w-4 h-4\" />\n            </Button>\n          </div>\n\n          {/* Save/Load Controls - Sheikh only */}\n          {isEnabled && (\n            <div className=\"flex gap-1 border-r border-white/20 pr-2\">\n              <Button\n                size=\"icon\"\n                variant=\"outline\"\n                onClick={saveAsImage}\n                className=\"bg-green-600 hover:bg-green-700\"\n                data-testid=\"button-whiteboard-save-image\"\n                title=\"حفظ كصورة\"\n              >\n                <Save className=\"w-4 h-4\" />\n              </Button>\n              <Button\n                size=\"icon\"\n                variant=\"outline\"\n                onClick={saveAsJSON}\n                className=\"bg-green-600 hover:bg-green-700\"\n                data-testid=\"button-whiteboard-save-json\"\n                title=\"حفظ كـ JSON\"\n              >\n                <Save className=\"w-4 h-4\" />\n              </Button>\n              <Button\n                size=\"icon\"\n                variant=\"outline\"\n                onClick={handleLoadJSON}\n                className=\"bg-purple-600 hover:bg-purple-700\"\n                data-testid=\"button-whiteboard-load\"\n                title=\"تحميل\"\n              >\n                <Upload className=\"w-4 h-4\" />\n              </Button>\n            </div>\n          )}\n\n          {/* Clear Button */}\n          <Button\n            size=\"icon\"\n            variant=\"destructive\"\n            onClick={clearCanvas}\n            disabled={!isEnabled}\n            data-testid=\"button-whiteboard-clear\"\n          >\n            <Trash2 className=\"w-4 h-4\" />\n          </Button>\n\n          {/* Line Width */}\n          <div className=\"flex items-center gap-2 bg-white/10 rounded-lg px-3 py-1\">\n            <Button\n              size=\"icon\"\n              variant=\"ghost\"\n              onClick={() => setLineWidth(Math.max(1, lineWidth - 1))}\n              disabled={!isEnabled}\n              className=\"h-8 w-8\"\n              data-testid=\"button-whiteboard-decrease-width\"\n            >\n              <Minus className=\"w-4 h-4 text-white\" />\n            </Button>\n            <Badge className=\"bg-white/20 text-white min-w-[40px] justify-center\">\n              {lineWidth}\n            </Badge>\n            <Button\n              size=\"icon\"\n              variant=\"ghost\"\n              onClick={() => setLineWidth(Math.min(20, lineWidth + 1))}\n              disabled={!isEnabled}\n              className=\"h-8 w-8\"\n              data-testid=\"button-whiteboard-increase-width\"\n            >\n              <Plus className=\"w-4 h-4 text-white\" />\n            </Button>\n          </div>\n\n          {/* Color Palette */}\n          {tool === 'pen' && (\n            <div className=\"flex items-center gap-2 bg-white/10 rounded-lg px-3 py-1\">\n              <Palette className=\"w-4 h-4 text-white\" />\n              <div className=\"flex gap-1\">\n                {colors.map((c) => (\n                  <button\n                    key={c.value}\n                    onClick={() => setColor(c.value)}\n                    disabled={!isEnabled}\n                    className={`w-6 h-6 rounded-full border-2 transition-all hover:scale-110 ${\n                      color === c.value ? 'border-white ring-2 ring-white/50' : 'border-white/30'\n                    }`}\n                    style={{ backgroundColor: c.value }}\n                    title={c.name}\n                    data-testid={`button-color-${c.value}`}\n                  />\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Status Badge */}\n          {!isEnabled && (\n            <Badge variant=\"destructive\" className=\"mr-auto\">\n              غير مفعّل - الشيخ فقط يمكنه الرسم\n            </Badge>\n          )}\n        </div>\n\n        {/* Canvas */}\n        <div className=\"flex-1 bg-white rounded-lg overflow-hidden relative min-h-[600px]\">\n          <canvas\n            ref={canvasRef}\n            className={`w-full h-full ${isEnabled ? 'cursor-crosshair' : 'cursor-not-allowed'}`}\n            onMouseDown={handleMouseDown}\n            onMouseMove={handleMouseMove}\n            onMouseUp={handleMouseUp}\n            onMouseLeave={handleMouseUp}\n            onTouchStart={handleTouchStart}\n            onTouchMove={handleTouchMove}\n            onTouchEnd={handleTouchEnd}\n            data-testid=\"canvas-whiteboard\"\n          />\n          {!isEnabled && (\n            <div className=\"absolute inset-0 flex items-center justify-center bg-black/50\">\n              <div className=\"text-white text-center\">\n                <Pencil className=\"w-16 h-16 mx-auto mb-4 opacity-50\" />\n                <p className=\"text-lg font-semibold\">السبورة غير مفعّلة</p>\n                <p className=\"text-sm opacity-80\">الشيخ فقط يمكنه الكتابة على السبورة</p>\n              </div>\n            </div>\n          )}\n        </div>\n        <input\n          ref={fileInputRef}\n          type=\"file\"\n          accept=\".json\"\n          onChange={handleFileChange}\n          className=\"hidden\"\n        />\n      </CardContent>\n    </Card>\n  );\n});\n\nLiveWhiteboard.displayName = 'LiveWhiteboard';\n","size_bytes":14294},"app/api/teacher/sessions/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'TEACHER') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const teacherProfile = await prisma.teacherProfile.findUnique({\n      where: { userId: session.user.id }\n    })\n\n    if (!teacherProfile) {\n      return NextResponse.json({ error: 'Teacher profile not found' }, { status: 404 })\n    }\n\n    const sessions = await prisma.session.findMany({\n      where: {\n        teacherId: teacherProfile.id\n      },\n      include: {\n        SessionStudent: {\n          include: {\n            User: true\n          }\n        }\n      },\n      orderBy: {\n        startTime: 'desc'\n      }\n    })\n\n    return NextResponse.json(sessions)\n  } catch (error) {\n    console.error('Error fetching sessions:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'TEACHER') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const teacherProfile = await prisma.teacherProfile.findUnique({\n      where: { userId: session.user.id }\n    })\n\n    if (!teacherProfile) {\n      return NextResponse.json({ error: 'Teacher profile not found' }, { status: 404 })\n    }\n\n    const { title, startTime, endTime } = await request.json()\n\n    if (!title || !startTime || !endTime) {\n      return NextResponse.json({ error: 'Missing required fields' }, { status: 400 })\n    }\n\n    const newSession = await prisma.session.create({\n      data: {\n        id: `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        teacherId: teacherProfile.id,\n        title,\n        startTime: new Date(startTime),\n        endTime: new Date(endTime),\n        status: 'SCHEDULED'\n      }\n    })\n\n    return NextResponse.json(newSession)\n  } catch (error) {\n    console.error('Error creating session:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":2378},"replit.md":{"content":"# Youspeak - English Learning Platform\n\n## Overview\nYouspeak is a bilingual (Arabic/English) online English learning platform designed for Mister Youssef. Its primary purpose is to provide an interactive and comprehensive environment for learning English, targeting a broad market with a focus on ease of use and effective learning methods. The platform offers live classes, vocabulary building tools, homework management, and a complete learning management system. Key capabilities include AI-powered grammar checking, interactive vocabulary discovery, and robust student/teacher/admin dashboards.\n\n## User Preferences\nI prefer simple language. I want iterative development. Ask before making major changes. I prefer detailed explanations. Do not make changes to the folder Z. Do not make changes to the file Y.\n\n## System Architecture\nThe platform is built on a modern web stack featuring **Next.js 16 (App Router)** with **React 19**, **TypeScript**, and **Tailwind CSS v4** for the frontend, ensuring a mobile-responsive and visually appealing user experience with dark mode support. Backend functionalities are handled by **Next.js API Routes** and a custom **Node.js server** for real-time capabilities.\n\n**Key Technical Implementations & Features:**\n-   **Authentication:** Secured with **NextAuth.js** and JWT strategy.\n-   **State Management:** Utilizes React's built-in hooks and context API.\n-   **Real-time Communication:** Implemented with **Socket.IO v4.8.1** for live chat between students and teachers.\n-   **Live Classes:** Integration with **Jitsi Meet SDK** for interactive video sessions.\n-   **AI Integration:** Leverages **OpenAI GPT-5** for an advanced grammar checker feature, providing intelligent feedback on student assignments.\n-   **Vocabulary Learning:** Features an interactive \"Discover Words\" system using swipe cards with framer-motion animations for an engaging learning experience.\n-   **Internationalization:** Full bilingual support (Arabic/English) integrated throughout the platform, including WhatsApp notifications.\n-   **Database Schema:** A robust schema with 12 core tables including Users, Sessions, Packages, Words, Assignments, and Chat, managed by Prisma ORM.\n-   **Dashboards:** Dedicated and feature-rich dashboards for Students, Teachers, and Admins, providing tailored functionalities and insights.\n-   **Workflow:** The development server runs on port 5000 with `node server.js` for Socket.IO integration, configured for Replit proxy.\n\n## External Dependencies\n-   **Database:** **PostgreSQL** hosted on AWS (configured via DATABASE_URL environment variable).\n-   **ORM:** **Prisma**.\n-   **Authentication:** **NextAuth.js** (requires NEXTAUTH_SECRET environment variable).\n-   **Real-time Communication:** **Socket.IO**.\n-   **Video Conferencing:** **Jitsi Meet SDK**.\n-   **AI Services:** **OpenAI GPT-5** (for grammar checking).\n-   **Translation Services:** **Google Translate API** (for word import and translation).\n-   **Communication:** **WhatsApp API** (for notifications, subscription flows, and support).\n\n## Recent Changes\n\n### November 15, 2025\n-   **Homepage Design Improvements:**\n    -   Removed theme toggle button from marketing homepage\n    -   Implemented professional beige gradient background (from-[#F5F1E8] via-[#E8DCC8] to-[#F5F1E8])\n    -   Redesigned hero section with gradient text effects and modern styling\n    -   Added trust indicators showing platform statistics (500+ Students, 50+ Teachers, etc.)\n    -   Enhanced feature cards with individual gradient colors and hover effects\n    -   Improved packages section with elegant design and BEST VALUE highlighting\n    -   Restructured footer with separated contact information and bottom credit section\n-   **Splash Screen Enhancements:**\n    -   Fixed background to solid beige (#F5F1E8) with inline style for guaranteed opacity\n    -   Changed text display to vertical layout (stacked words)\n    -   Implemented typewriter effect with character-by-character animation\n    -   Extended splash screen duration to 4 seconds\n    -   Maintained correct word order: Your → English → Steps\n    -   Added modern logo container with gradient background effect\n\n### November 14, 2025\n-   **AWS Database Connection Setup:** Successfully connected platform to AWS RDS PostgreSQL database\n    -   Database Host: youspeak.czu88we8syd5.eu-north-1.rds.amazonaws.com\n    -   Database Name: postgres\n    -   Schema: youspeak_exercisein\n    -   Port: 5432\n    -   Connection managed via environment variables (AWS_DB_HOST, AWS_DB_PORT, AWS_DB_NAME, AWS_DB_USER, AWS_DB_PASSWORD)\n    -   Created `start-server.js` to automatically construct DATABASE_URL from AWS credentials\n    -   All 12 tables verified and working: Assignment, AuditLog, Chat, Package, Session, SessionStudent, StudentProfile, Submission, Subscription, TeacherProfile, User, Word\n    -   Updated package.json to use new startup script\n-   **Production Build & Login Fixes:**\n    -   Fixed DATABASE_URL undefined error during production build on Render\n    -   Updated `lib/prisma.ts` to handle missing DATABASE_URL gracefully with proper fallback logic\n    -   Updated `start-server.js` to respect existing DATABASE_URL and only construct from AWS credentials when needed\n    -   Fixed login issues by activating all users and resetting passwords to standard test password\n    -   All user roles (Admin, Teacher, Student) can now login successfully\n    -   Created comprehensive deployment guide (DEPLOYMENT.md) for production deployment\n-   **Authentication Configuration:** \n    -   Configured NEXTAUTH_SECRET for secure session management\n    -   Authentication system now fully operational\n-   **Test Accounts Created:** Added test users for development and testing:\n    -   Admin account: admin@youspeak.com (password: 123456)\n    -   Teacher account: teacher@youspeak.com (password: 123456)\n    -   Student account: student@youspeak.com (password: 123456)\n-   **API Enhancements:** Added complete CRUD operations for all resources:\n    -   Sessions: Added PUT and DELETE endpoints for teachers (`/api/teacher/sessions/[id]`)\n    -   Assignments: Added GET, PUT, DELETE endpoints for teachers (`/api/teacher/assignments/[id]`)\n    -   Packages: Added POST (create), PUT, DELETE endpoints for admins (`/api/admin/packages`, `/api/admin/packages/[id]`)\n    -   Subscriptions: Added GET, PUT, DELETE endpoints for admins (`/api/admin/subscriptions/[id]`)\n    -   Chat: Added DELETE endpoint for messages (`/api/chat/messages/[id]`)\n-   **Authorization Helpers:** Created `lib/auth-helpers.ts` with reusable functions (`requireTeacher`, `requireAdmin`, `requireStudent`, `parseJsonBody`) to standardize authentication and authorization across endpoints\n-   **Code Quality:** Refactored endpoints to use shared authorization helpers, improving maintainability and consistency","size_bytes":6866},"scripts/seed-dummy-data.ts":{"content":"import { PrismaClient } from '@prisma/client'\nimport bcrypt from 'bcryptjs'\n\nconst prisma = new PrismaClient()\n\nasync function main() {\n  console.log('🌱 بدء إضافة البيانات الوهمية...')\n\n  const hashedPassword = await bcrypt.hash('admin123', 10)\n\n  const existingAdmin = await prisma.user.findFirst({\n    where: { email: 'admin@youspeak.com' }\n  })\n\n  if (!existingAdmin) {\n    await prisma.user.create({\n      data: {\n        id: 'admin-001',\n        name: 'Admin',\n        email: 'admin@youspeak.com',\n        passwordHash: hashedPassword,\n        role: 'ADMIN',\n        isActive: true\n      }\n    })\n    console.log('✅ تم إنشاء حساب المسؤول')\n  }\n\n  const existingTeacher = await prisma.user.findFirst({\n    where: { email: 'teacher@youspeak.com' }\n  })\n\n  if (!existingTeacher) {\n    const teacher = await prisma.user.create({\n      data: {\n        id: 'teacher-001',\n        name: 'محمد أحمد',\n        email: 'teacher@youspeak.com',\n        passwordHash: hashedPassword,\n        role: 'TEACHER',\n        isActive: true\n      }\n    })\n\n    await prisma.teacherProfile.create({\n      data: {\n        id: 'tp-001',\n        userId: teacher.id,\n        bio: 'مدرس لغة إنجليزية محترف مع 10 سنوات خبرة'\n      }\n    })\n    console.log('✅ تم إنشاء حساب المدرس')\n  }\n\n  const students = []\n  for (let i = 1; i <= 6; i++) {\n    const email = `student${i}@test.com`\n    const existing = await prisma.user.findFirst({ where: { email } })\n    \n    if (!existing) {\n      const student = await prisma.user.create({\n        data: {\n          id: `student-00${i}`,\n          name: `طالب ${i}`,\n          email,\n          passwordHash: hashedPassword,\n          role: 'STUDENT',\n          isActive: true\n        }\n      })\n\n      const level = i % 3 === 0 ? 'Advanced' : i % 2 === 0 ? 'Intermediate' : 'Beginner'\n      await prisma.studentProfile.create({\n        data: {\n          id: `sp-00${i}`,\n          userId: student.id,\n          levelInitial: level,\n          levelCurrent: level\n        }\n      })\n\n      students.push(student)\n      console.log(`✅ تم إنشاء حساب الطالب ${i}`)\n    }\n  }\n\n  const allStudents = await prisma.user.findMany({ \n    where: { role: 'STUDENT' } \n  })\n  \n  if (allStudents.length > 0) {\n    const words = [\n      { englishWord: 'hello', arabicMeaning: 'مرحبا', exampleSentence: 'Hello, how are you?' },\n      { englishWord: 'goodbye', arabicMeaning: 'وداعا', exampleSentence: 'Goodbye, see you later!' },\n      { englishWord: 'thank you', arabicMeaning: 'شكرا لك', exampleSentence: 'Thank you for your help.' },\n      { englishWord: 'please', arabicMeaning: 'من فضلك', exampleSentence: 'Please pass the salt.' },\n      { englishWord: 'sorry', arabicMeaning: 'آسف', exampleSentence: 'I am sorry for being late.' },\n      { englishWord: 'friend', arabicMeaning: 'صديق', exampleSentence: 'He is my best friend.' },\n      { englishWord: 'family', arabicMeaning: 'عائلة', exampleSentence: 'I love my family.' },\n      { englishWord: 'mother', arabicMeaning: 'أم', exampleSentence: 'My mother cooks delicious food.' },\n      { englishWord: 'father', arabicMeaning: 'أب', exampleSentence: 'My father works hard.' },\n      { englishWord: 'brother', arabicMeaning: 'أخ', exampleSentence: 'I have one brother.' },\n      { englishWord: 'sister', arabicMeaning: 'أخت', exampleSentence: 'My sister is younger than me.' },\n      { englishWord: 'teacher', arabicMeaning: 'معلم', exampleSentence: 'The teacher explained the lesson well.' },\n      { englishWord: 'student', arabicMeaning: 'طالب', exampleSentence: 'Every student needs to study.' },\n      { englishWord: 'book', arabicMeaning: 'كتاب', exampleSentence: 'I read an interesting book.' },\n      { englishWord: 'pen', arabicMeaning: 'قلم', exampleSentence: 'Can I borrow your pen?' },\n      { englishWord: 'paper', arabicMeaning: 'ورقة', exampleSentence: 'Please give me a piece of paper.' },\n      { englishWord: 'school', arabicMeaning: 'مدرسة', exampleSentence: 'I go to school every day.' },\n      { englishWord: 'house', arabicMeaning: 'منزل', exampleSentence: 'We live in a big house.' },\n      { englishWord: 'car', arabicMeaning: 'سيارة', exampleSentence: 'My father has a new car.' },\n      { englishWord: 'water', arabicMeaning: 'ماء', exampleSentence: 'Drink plenty of water daily.' }\n    ]\n\n    for (const student of allStudents) {\n      const existingWordsCount = await prisma.word.count({\n        where: { studentId: student.id }\n      })\n\n      if (existingWordsCount < 20) {\n        const wordsToAdd = 20 - existingWordsCount\n        for (let i = 0; i < wordsToAdd && i < words.length; i++) {\n          const wordData = words[i]\n          await prisma.word.create({\n            data: {\n              id: `word_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n              studentId: student.id,\n              ...wordData\n            }\n          })\n        }\n        console.log(`✅ تم إضافة ${wordsToAdd} كلمة للطالب ${student.name} (الإجمالي: ${existingWordsCount + wordsToAdd})`)\n      } else {\n        console.log(`⏭️  الطالب ${student.name} يملك ${existingWordsCount} كلمة بالفعل`)\n      }\n    }\n\n    const totalWords = await prisma.word.count()\n    const totalStudents = allStudents.length\n    console.log(`\\n📊 الإحصائيات النهائية: ${totalStudents} طالب، ${totalWords} كلمة`)\n  }\n\n  const packagesCount = await prisma.package.count()\n  if (packagesCount === 0) {\n    await prisma.package.createMany({\n      data: [\n        {\n          id: 'pkg-basic',\n          title: 'Basic Package',\n          titleAr: 'الباقة الأساسية',\n          description: '10 lessons per month',\n          descriptionAr: '10 جلسات شهرياً',\n          price: 99.99,\n          lessonsCount: 10,\n          durationDays: 30,\n          isActive: true\n        },\n        {\n          id: 'pkg-standard',\n          title: 'Standard Package',\n          titleAr: 'الباقة القياسية',\n          description: '20 lessons per month',\n          descriptionAr: '20 جلسة شهرياً',\n          price: 179.99,\n          lessonsCount: 20,\n          durationDays: 30,\n          isActive: true\n        },\n        {\n          id: 'pkg-premium',\n          title: 'Premium Package',\n          titleAr: 'الباقة المميزة',\n          description: 'Unlimited lessons',\n          descriptionAr: 'جلسات غير محدودة',\n          price: 299.99,\n          lessonsCount: 9999,\n          durationDays: 30,\n          isActive: true\n        }\n      ]\n    })\n    console.log('✅ تم إضافة 3 باقات')\n  }\n\n  console.log('🎉 تم إضافة جميع البيانات الوهمية بنجاح!')\n}\n\nmain()\n  .catch((e) => {\n    console.error('❌ خطأ:', e)\n    process.exit(1)\n  })\n  .finally(async () => {\n    await prisma.$disconnect()\n  })\n","size_bytes":7045},"scripts/check-login.js":{"content":"const { PrismaClient } = require('@prisma/client');\nconst bcrypt = require('bcryptjs');\n\nconst prisma = new PrismaClient();\n\nasync function checkLogin() {\n  try {\n    const testEmail = 'admin@youspeak.com';\n    const testPassword = '123456';\n    \n    console.log('Testing login for:', testEmail);\n    console.log('Password being tested:', testPassword);\n    console.log('');\n    \n    const user = await prisma.user.findUnique({\n      where: { email: testEmail }\n    });\n    \n    if (!user) {\n      console.log('❌ User not found!');\n      process.exit(1);\n    }\n    \n    console.log('✅ User found:');\n    console.log('   ID:', user.id);\n    console.log('   Name:', user.name);\n    console.log('   Email:', user.email);\n    console.log('   Role:', user.role);\n    console.log('   Active:', user.isActive);\n    console.log('   Password hash:', user.password);\n    console.log('');\n    \n    // Test password\n    const isValid = await bcrypt.compare(testPassword, user.password);\n    console.log('Password verification result:', isValid);\n    \n    if (isValid) {\n      console.log('✅ Password matches!');\n    } else {\n      console.log('❌ Password does NOT match!');\n      \n      // Let's try to create a new hash and compare\n      console.log('\\nTesting hash generation:');\n      const newHash = await bcrypt.hash(testPassword, 10);\n      console.log('New hash generated:', newHash);\n      const newCheck = await bcrypt.compare(testPassword, newHash);\n      console.log('New hash verification:', newCheck);\n    }\n    \n  } catch (error) {\n    console.error('Error:', error);\n  } finally {\n    await prisma.$disconnect();\n  }\n}\n\ncheckLogin();\n","size_bytes":1645},"app/api/chat/messages/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\nexport async function GET(req: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const { searchParams } = new URL(req.url)\n    const otherUserId = searchParams.get('userId')\n\n    if (!otherUserId) {\n      return NextResponse.json({ error: 'User ID required' }, { status: 400 })\n    }\n\n    const messages = await prisma.chat.findMany({\n      where: {\n        OR: [\n          { fromUserId: session.user.id, toUserId: otherUserId },\n          { fromUserId: otherUserId, toUserId: session.user.id }\n        ]\n      },\n      orderBy: { createdAt: 'asc' },\n      include: {\n        User_Chat_fromUserIdToUser: {\n          select: {\n            id: true,\n            name: true,\n            profilePhoto: true\n          }\n        }\n      }\n    })\n\n    return NextResponse.json({ messages })\n  } catch (error) {\n    console.error('Error fetching messages:', error)\n    return NextResponse.json({ error: 'Failed to fetch messages' }, { status: 500 })\n  }\n}\n\nexport async function POST(req: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const { toUserId, content, attachments } = await req.json()\n\n    if (!toUserId || !content) {\n      return NextResponse.json({ error: 'Missing required fields' }, { status: 400 })\n    }\n\n    const message = await prisma.chat.create({\n      data: {\n        id: `chat_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        fromUserId: session.user.id,\n        toUserId,\n        content,\n        attachments: attachments || null\n      },\n      include: {\n        User_Chat_fromUserIdToUser: {\n          select: {\n            id: true,\n            name: true,\n            profilePhoto: true\n          }\n        }\n      }\n    })\n\n    return NextResponse.json({ message })\n  } catch (error) {\n    console.error('Error sending message:', error)\n    return NextResponse.json({ error: 'Failed to send message' }, { status: 500 })\n  }\n}\n","size_bytes":2341},"lib/auth.ts":{"content":"import { NextAuthOptions } from 'next-auth'\nimport CredentialsProvider from 'next-auth/providers/credentials'\nimport { PrismaAdapter } from '@auth/prisma-adapter'\nimport { prisma } from './prisma'\nimport bcrypt from 'bcryptjs'\n\nexport const authOptions: NextAuthOptions = {\n  adapter: PrismaAdapter(prisma) as any,\n  providers: [\n    CredentialsProvider({\n      name: 'credentials',\n      credentials: {\n        email: { label: 'Email', type: 'email' },\n        password: { label: 'Password', type: 'password' },\n      },\n      async authorize(credentials) {\n        if (!credentials?.email || !credentials?.password) {\n          throw new Error('Invalid credentials')\n        }\n\n        const user = await prisma.user.findUnique({\n          where: {\n            email: credentials.email,\n          },\n          include: {\n            StudentProfile: true,\n            TeacherProfile: true,\n          },\n        })\n\n        if (!user || !user.passwordHash) {\n          throw new Error('Invalid credentials')\n        }\n\n        const isPasswordValid = await bcrypt.compare(\n          credentials.password,\n          user.passwordHash\n        )\n\n        if (!isPasswordValid) {\n          throw new Error('Invalid credentials')\n        }\n\n        return {\n          id: user.id,\n          email: user.email,\n          name: user.name,\n          role: user.role,\n          isActive: user.isActive,\n        }\n      },\n    }),\n  ],\n  session: {\n    strategy: 'jwt',\n  },\n  pages: {\n    signIn: '/auth/login',\n    error: '/auth/error',\n  },\n  callbacks: {\n    async jwt({ token, user }) {\n      if (user) {\n        token.id = user.id\n        token.role = user.role\n        token.isActive = user.isActive\n      }\n      return token\n    },\n    async session({ session, token }) {\n      if (session.user) {\n        session.user.id = token.id as string\n        session.user.role = token.role as string\n        session.user.isActive = token.isActive as boolean\n      }\n      return session\n    },\n  },\n  secret: process.env.NEXTAUTH_SECRET,\n}\n","size_bytes":2031},"app/api/assignments/student/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'STUDENT') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const assignments = await prisma.assignment.findMany({\n      where: {\n        Session: {\n          SessionStudent: {\n            some: { studentId: session.user.id }\n          }\n        }\n      },\n      include: {\n        Session: true,\n        Submission: {\n          where: { studentId: session.user.id }\n        }\n      },\n      orderBy: { dueDate: 'desc' }\n    })\n\n    return NextResponse.json(assignments)\n  } catch (error) {\n    console.error('Error fetching assignments:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'STUDENT') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const body = await request.json()\n    const { assignmentId, textAnswer, attachedFiles } = body\n\n    if (!assignmentId || !textAnswer) {\n      return NextResponse.json({ error: 'Missing required fields' }, { status: 400 })\n    }\n\n    // Verify the student is enrolled in the session that owns this assignment\n    const assignment = await prisma.assignment.findUnique({\n      where: { id: assignmentId },\n      include: {\n        Session: {\n          include: {\n            SessionStudent: {\n              where: { studentId: session.user.id }\n            }\n          }\n        }\n      }\n    })\n\n    if (!assignment || !assignment.Session) {\n      return NextResponse.json({ error: 'Assignment not found' }, { status: 404 })\n    }\n\n    if (assignment.Session.SessionStudent.length === 0) {\n      return NextResponse.json({ error: 'You are not enrolled in this session' }, { status: 403 })\n    }\n\n    // Check if student has already submitted this assignment\n    const existingSubmission = await prisma.submission.findFirst({\n      where: {\n        assignmentId,\n        studentId: session.user.id\n      }\n    })\n\n    if (existingSubmission) {\n      return NextResponse.json({ error: 'You have already submitted this assignment' }, { status: 400 })\n    }\n\n    const submission = await prisma.submission.create({\n      data: {\n        id: `submission_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        assignmentId,\n        studentId: session.user.id,\n        textAnswer,\n        attachedFiles: attachedFiles || null\n      }\n    })\n\n    return NextResponse.json(submission, { status: 201 })\n  } catch (error) {\n    console.error('Error creating submission:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":3036},"app/dashboard/student/StudentDashboardClient.tsx":{"content":"'use client'\n\nimport { useState } from 'react'\nimport { signOut } from 'next-auth/react'\nimport { useRouter } from 'next/navigation'\nimport Link from 'next/link'\nimport Image from 'next/image'\nimport { \n  Home, BookOpen, Calendar, MessageCircle, Trophy, \n  CreditCard, LogOut, CheckCircle, XCircle, Bell, Sparkles, Settings, Brain \n} from 'lucide-react'\nimport Button from '@/components/ui/Button'\nimport Card from '@/components/ui/Card'\nimport Alert from '@/components/ui/Alert'\nimport Badge from '@/components/ui/Badge'\nimport FloatingContactButtons from '@/components/FloatingContactButtons'\nimport ChatBox from '@/components/ChatBox'\nimport ConversationsList from '@/components/ConversationsList'\nimport HomeTab from './components/HomeTab'\nimport MyLearnTab from './components/MyLearnTab'\nimport SessionsTab from './components/SessionsTab'\nimport HomeworkTab from './components/HomeworkTab'\nimport PackagesTab from './components/PackagesTab'\n\ninterface StudentDashboardClientProps {\n  user: {\n    name: string\n    email: string\n    isActive: boolean\n  }\n}\n\nexport default function StudentDashboardClient({ user }: StudentDashboardClientProps) {\n  const router = useRouter()\n  const [activeTab, setActiveTab] = useState('home')\n  const [sidebarOpen, setSidebarOpen] = useState(false)\n  const isActive = user.isActive\n\n  const handleSignOut = async () => {\n    await signOut({ redirect: false })\n    router.push('/auth/login')\n  }\n\n  const menuItems = [\n    { id: 'home', label: 'Home / الرئيسية', icon: Home },\n    { id: 'mylearn', label: 'MyLearn / كلماتي', icon: BookOpen },\n    { id: 'discover', label: 'Discover Words / اكتشف الكلمات', icon: Sparkles, badge: 'جديد', disabled: !isActive },\n    { id: 'test', label: 'Test Yourself / اختبر نفسك', icon: Trophy, badge: 'جديد', disabled: !isActive },\n    { id: 'sessions', label: 'Sessions / الحصص', icon: Calendar },\n    { id: 'homework', label: 'Homework / الواجبات', icon: Trophy },\n    { id: 'packages', label: 'Packages / الباقات', icon: CreditCard },\n    { id: 'chat', label: 'Chat / الدردشة', icon: MessageCircle, disabled: !isActive },\n  ]\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-[#F5F5DC] to-white\">\n      {/* Header */}\n      <header className=\"bg-[#004E89] text-white shadow-lg\">\n        <div className=\"container mx-auto px-4 py-3 sm:py-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-2 sm:gap-4\">\n              <button\n                className=\"lg:hidden p-2 hover:bg-white/10 rounded-lg\"\n                onClick={() => setSidebarOpen(!sidebarOpen)}\n              >\n                <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h16\" />\n                </svg>\n              </button>\n              <Link href=\"/\" className=\"flex items-center gap-2 hover:opacity-80 transition-opacity\">\n                <Image src=\"/logo.png\" alt=\"Youspeak Logo\" width={40} height={40} className=\"rounded-lg\" />\n                <h1 className=\"text-xl sm:text-2xl font-bold\">Youspeak</h1>\n              </Link>\n              <Badge variant={isActive ? 'success' : 'warning'} className=\"hidden sm:flex\">\n                {isActive ? (\n                  <>\n                    <CheckCircle className=\"h-4 w-4 mr-1\" />\n                    Active / نشط\n                  </>\n                ) : (\n                  <>\n                    <XCircle className=\"h-4 w-4 mr-1\" />\n                    Pending / قيد التفعيل\n                  </>\n                )}\n              </Badge>\n            </div>\n            <div className=\"flex items-center gap-2 sm:gap-4\">\n              <span className=\"text-xs sm:text-sm hidden sm:block\">{user.name}</span>\n              <Link href=\"/settings\">\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"text-white border-white hover:bg-white hover:text-[#004E89] text-xs sm:text-sm px-2 sm:px-4\"\n                >\n                  <Settings className=\"h-4 w-4\" />\n                  <span className=\"hidden sm:inline ml-2\">إعدادات</span>\n                </Button>\n              </Link>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={handleSignOut}\n                className=\"text-white border-white hover:bg-white hover:text-[#004E89] text-xs sm:text-sm px-2 sm:px-4\"\n              >\n                <LogOut className=\"h-4 w-4 sm:mr-2\" />\n                <span className=\"hidden sm:inline\">Logout / خروج</span>\n              </Button>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Warning for inactive accounts */}\n      {!isActive && (\n        <div className=\"container mx-auto px-4 py-4\">\n          <Alert variant=\"warning\">\n            <Bell className=\"h-5 w-5\" />\n            <div>\n              <p className=\"font-semibold\">Account Pending Activation / الحساب قيد التفعيل</p>\n              <p className=\"text-sm mt-1\">\n                Your account is being reviewed. You will be contacted via WhatsApp at{' '}\n                <strong>+201091515594</strong> for payment confirmation and activation.\n              </p>\n              <p className=\"text-sm mt-1\">\n                حسابك قيد المراجعة. سيتم التواصل معك عبر الواتساب على{' '}\n                <strong>+201091515594</strong> لتأكيد الدفع والتفعيل.\n              </p>\n            </div>\n          </Alert>\n        </div>\n      )}\n\n      <div className=\"container mx-auto px-4 py-4 sm:py-6\">\n        <div className=\"flex flex-col lg:flex-row gap-4 sm:gap-6\">\n          {/* Mobile Sidebar Overlay */}\n          {sidebarOpen && (\n            <div \n              className=\"fixed inset-0 bg-black/50 z-40 lg:hidden\"\n              onClick={() => setSidebarOpen(false)}\n            />\n          )}\n          \n          {/* Sidebar */}\n          <div className={`\n            fixed lg:static inset-y-0 left-0 z-50 lg:z-auto\n            w-64 lg:w-auto lg:flex-none\n            transform lg:transform-none transition-transform duration-300\n            ${sidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}\n          `}>\n            <Card variant=\"elevated\" padding=\"none\" className=\"h-full lg:h-auto\">\n              <div className=\"p-4 border-b border-gray-200\">\n                <div className=\"flex items-center justify-between lg:justify-start gap-3\">\n                  <div className=\"flex items-center gap-3 flex-1\">\n                    <div className=\"w-10 h-10 sm:w-12 sm:h-12 bg-[#004E89] rounded-full flex items-center justify-center text-white text-lg sm:text-xl font-bold\">\n                      {user.name?.charAt(0).toUpperCase()}\n                    </div>\n                    <div>\n                      <p className=\"font-semibold text-gray-900 text-sm sm:text-base\">{user.name}</p>\n                      <p className=\"text-xs sm:text-sm text-gray-600\">Student / طالب</p>\n                    </div>\n                  </div>\n                  <button \n                    className=\"lg:hidden p-2 hover:bg-gray-100 rounded-lg\"\n                    onClick={() => setSidebarOpen(false)}\n                  >\n                    <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                    </svg>\n                  </button>\n                </div>\n              </div>\n              <nav className=\"p-2\">\n                {menuItems.map((item) => {\n                  const Icon = item.icon\n                  const isDisabled = item.disabled\n                  return (\n                    <button\n                      key={item.id}\n                      onClick={() => {\n                        if (!isDisabled) {\n                          setActiveTab(item.id)\n                          setSidebarOpen(false)\n                        }\n                      }}\n                      disabled={isDisabled}\n                      className={`w-full flex items-center gap-3 px-3 sm:px-4 py-2 sm:py-3 rounded-lg transition-colors mb-1 ${\n                        activeTab === item.id\n                          ? 'bg-[#004E89] text-white'\n                          : isDisabled\n                          ? 'text-gray-400 cursor-not-allowed'\n                          : 'text-gray-700 hover:bg-gray-100'\n                      }`}\n                    >\n                      <Icon className=\"h-5 w-5\" />\n                      <span className=\"text-xs sm:text-sm font-medium\">{item.label}</span>\n                    </button>\n                  )\n                })}\n              </nav>\n            </Card>\n          </div>\n\n          {/* Main Content */}\n          <div className=\"flex-1 min-w-0\">\n            {activeTab === 'home' && <HomeTab isActive={isActive} />}\n            {activeTab === 'mylearn' && <MyLearnTab isActive={isActive} />}\n            {activeTab === 'discover' && <DiscoverTab isActive={isActive} />}\n            {activeTab === 'test' && <TestTab isActive={isActive} />}\n            {activeTab === 'sessions' && <SessionsTab isActive={isActive} />}\n            {activeTab === 'homework' && <HomeworkTab isActive={isActive} />}\n            {activeTab === 'packages' && <PackagesTab isActive={isActive} />}\n            {activeTab === 'chat' && isActive && <ChatTab />}\n          </div>\n        </div>\n      </div>\n      <FloatingContactButtons />\n    </div>\n  )\n}\n\nfunction DiscoverTab({ isActive }: { isActive: boolean }) {\n  if (!isActive) {\n    return (\n      <div>\n        <h2 className=\"text-2xl sm:text-3xl font-bold text-[#004E89] mb-4\">\n          Discover Words / اكتشف الكلمات الجديدة\n        </h2>\n        <Alert variant=\"warning\">\n          <p>قم بتفعيل حسابك للوصول لهذه الميزة / Activate your account to access this feature</p>\n        </Alert>\n      </div>\n    )\n  }\n\n  return (\n    <div>\n      <iframe \n        src=\"/dashboard/student/discover-words\" \n        className=\"w-full h-[calc(100vh-200px)] border-0 rounded-lg shadow-lg\"\n        title=\"Discover New Words\"\n      />\n    </div>\n  )\n}\n\nfunction TestTab({ isActive }: { isActive: boolean }) {\n  if (!isActive) {\n    return (\n      <div>\n        <h2 className=\"text-2xl sm:text-3xl font-bold text-[#004E89] mb-4\">\n          Test Yourself / اختبر نفسك\n        </h2>\n        <Alert variant=\"warning\">\n          <p>قم بتفعيل حسابك للوصول لهذه الميزة / Activate your account to access this feature</p>\n        </Alert>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"bg-white rounded-lg shadow-lg p-6\">\n      <div className=\"flex items-center gap-4 mb-6\">\n        <div className=\"bg-blue-600 p-3 rounded-xl\">\n          <Brain className=\"h-8 w-8 text-white\" />\n        </div>\n        <div>\n          <h2 className=\"text-3xl font-bold text-black\">اختبر نفسك</h2>\n          <p className=\"text-black opacity-70\">Test Your Vocabulary</p>\n        </div>\n      </div>\n      \n      <div className=\"grid md:grid-cols-2 gap-6\">\n        <Link href=\"/dashboard/student/test-words\">\n          <div className=\"bg-white border-2 border-blue-600 rounded-2xl p-8 text-left shadow-lg hover:shadow-xl transition-all cursor-pointer hover:scale-105\">\n            <BookOpen className=\"h-12 w-12 text-blue-600 mb-4\" />\n            <h3 className=\"text-2xl font-bold text-black mb-2\">اختيار من متعدد</h3>\n            <p className=\"text-black opacity-70\">Multiple Choice Test</p>\n            <p className=\"text-black text-sm mt-3\">اختر الإجابة الصحيحة من 4 خيارات</p>\n          </div>\n        </Link>\n\n        <Link href=\"/dashboard/student/test-words\">\n          <div className=\"bg-white border-2 border-blue-600 rounded-2xl p-8 text-left shadow-lg hover:shadow-xl transition-all cursor-pointer hover:scale-105\">\n            <Trophy className=\"h-12 w-12 text-blue-600 mb-4\" />\n            <h3 className=\"text-2xl font-bold text-black mb-2\">اختبار الكتابة</h3>\n            <p className=\"text-black opacity-70\">Writing Test</p>\n            <p className=\"text-black text-sm mt-3\">اكتب الإجابة الصحيحة بنفسك</p>\n          </div>\n        </Link>\n      </div>\n    </div>\n  )\n}\n\nfunction ChatTab() {\n  const [selectedUser, setSelectedUser] = useState<any>(null)\n  const [showConversations, setShowConversations] = useState(true)\n\n  return (\n    <div>\n      <h2 className=\"text-2xl sm:text-3xl font-bold text-[#004E89] mb-4 sm:mb-6\">\n        Chat / الدردشة\n      </h2>\n      <div className=\"flex flex-col lg:flex-row gap-4 h-[calc(100vh-250px)] sm:h-[calc(100vh-300px)]\">\n        <div className={`lg:flex-none lg:w-1/3 ${selectedUser && !showConversations ? 'hidden lg:block' : 'block'}`}>\n          <Card variant=\"elevated\" padding=\"none\" className=\"h-full overflow-hidden\">\n            <div className=\"bg-gradient-to-r from-[#004E89] to-[#1A5F7A] p-4 text-white\">\n              <h3 className=\"font-bold text-lg\">المحادثات</h3>\n            </div>\n            <div className=\"overflow-y-auto h-[calc(100%-60px)]\">\n              <ConversationsList \n                onSelectConversation={setSelectedUser}\n                selectedUserId={selectedUser?.id}\n              />\n            </div>\n          </Card>\n        </div>\n        <div className=\"lg:col-span-2 h-full\">\n          {selectedUser ? (\n            <ChatBox \n              otherUser={selectedUser}\n              onClose={() => setSelectedUser(null)}\n            />\n          ) : (\n            <Card variant=\"elevated\" className=\"h-full flex flex-col items-center justify-center text-gray-400\">\n              <MessageCircle className=\"w-24 h-24 mb-4\" />\n              <p className=\"text-xl font-medium\">اختر محادثة للبدء</p>\n              <p className=\"text-sm mt-2\">حدد محادثة من القائمة لبدء الدردشة</p>\n            </Card>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}\n","size_bytes":14308},"components/ui/index.ts":{"content":"export { default as Button } from './Button';\nexport type { ButtonProps } from './Button';\n\nexport { default as Input } from './Input';\nexport type { InputProps } from './Input';\n\nexport { default as Card } from './Card';\nexport type { CardProps } from './Card';\n\nexport { default as Modal } from './Modal';\nexport type { ModalProps } from './Modal';\n\nexport { default as Badge } from './Badge';\nexport type { BadgeProps } from './Badge';\n\nexport { default as LoadingSpinner } from './LoadingSpinner';\nexport type { LoadingSpinnerProps } from './LoadingSpinner';\n\nexport { default as Alert } from './Alert';\nexport type { AlertProps } from './Alert';\n\nexport { default as Tabs } from './Tabs';\nexport type { TabsProps, TabsListProps, TabsTriggerProps, TabsContentProps } from './Tabs';\n\nexport { Table, TableHeader, TableBody, TableFooter, TableHead, TableRow, TableCell, TableCaption } from './Table';\nexport type { TableProps } from './Table';\n","size_bytes":946},"components/layout/DashboardHeader.tsx":{"content":"'use client';\n\nimport React from 'react';\nimport Link from 'next/link';\nimport { Settings, LogOut } from 'lucide-react';\nimport AppHeader from './AppHeader';\nimport Button from '@/components/ui/Button';\nimport Badge from '@/components/ui/Badge';\n\nexport interface DashboardHeaderProps {\n  userName: string;\n  roleBadge?: React.ReactNode;\n  onToggleSidebar?: () => void;\n  onLogout: () => void;\n  showSettings?: boolean;\n  className?: string;\n}\n\nconst DashboardHeader: React.FC<DashboardHeaderProps> = ({\n  userName,\n  roleBadge,\n  onToggleSidebar,\n  onLogout,\n  showSettings = true,\n  className,\n}) => {\n  return (\n    <AppHeader variant=\"dashboard\" className={className} showLogo={true}>\n      {onToggleSidebar && (\n        <button\n          className=\"lg:hidden p-2 hover:bg-white/10 rounded-lg text-white mr-2\"\n          onClick={onToggleSidebar}\n          aria-label=\"Toggle sidebar\"\n        >\n          <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h16\" />\n          </svg>\n        </button>\n      )}\n      \n      {roleBadge && (\n        <div className=\"hidden sm:block\">\n          {typeof roleBadge === 'string' ? (\n            <Badge variant=\"success\">{roleBadge}</Badge>\n          ) : (\n            roleBadge\n          )}\n        </div>\n      )}\n      \n      <span className=\"text-xs sm:text-sm hidden sm:block text-white\">{userName}</span>\n      \n      {showSettings && (\n        <Link href=\"/settings\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"text-white border-white hover:bg-white hover:text-[#004E89] text-xs sm:text-sm px-2 sm:px-4\"\n          >\n            <Settings className=\"h-4 w-4\" />\n            <span className=\"hidden sm:inline ml-2\">إعدادات</span>\n          </Button>\n        </Link>\n      )}\n      \n      <Button\n        variant=\"outline\"\n        size=\"sm\"\n        onClick={onLogout}\n        className=\"text-white border-white hover:bg-white hover:text-[#004E89] text-xs sm:text-sm px-2 sm:px-4\"\n      >\n        <LogOut className=\"h-4 w-4 sm:mr-2\" />\n        <span className=\"hidden sm:inline\">Logout / خروج</span>\n      </Button>\n    </AppHeader>\n  );\n};\n\nexport default DashboardHeader;\n","size_bytes":2312},"next.config.ts":{"content":"import type { NextConfig } from \"next\";\n\nconst nextConfig: NextConfig = {\n  typescript: {\n    ignoreBuildErrors: false,\n  },\n  images: {\n    remotePatterns: [\n      {\n        protocol: 'https',\n        hostname: '**',\n      },\n    ],\n  },\n  allowedDevOrigins: ['*'],\n};\n\nexport default nextConfig;\n","size_bytes":298},"lib/utils.ts":{"content":"import { type ClassValue, clsx } from 'clsx';\nimport { twMerge } from 'tailwind-merge';\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n","size_bytes":169},"app/api/admin/logs/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || (session.user.role !== 'ADMIN' && session.user.role !== 'ASSISTANT')) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const logs = await prisma.auditLog.findMany({\n      orderBy: {\n        createdAt: 'desc'\n      },\n      take: 50\n    })\n\n    return NextResponse.json(logs)\n  } catch (error) {\n    console.error('Error fetching logs:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":787},"components/ChatBox.tsx":{"content":"'use client'\n\nimport { useState, useEffect, useRef } from 'react'\nimport { Send, X, Loader2, MessageCircle } from 'lucide-react'\nimport { useSession } from 'next-auth/react'\nimport io, { Socket } from 'socket.io-client'\n\ninterface Message {\n  id: string\n  content: string\n  fromUserId: string\n  toUserId: string\n  createdAt: string\n  fromUser: {\n    id: string\n    name: string\n    profilePhoto: string | null\n  }\n}\n\ninterface ChatBoxProps {\n  otherUser: {\n    id: string\n    name: string\n    profilePhoto?: string | null\n    role?: string\n  }\n  onClose?: () => void\n}\n\nexport default function ChatBox({ otherUser, onClose }: ChatBoxProps) {\n  const { data: session } = useSession()\n  const [messages, setMessages] = useState<Message[]>([])\n  const [newMessage, setNewMessage] = useState('')\n  const [loading, setLoading] = useState(true)\n  const [sending, setSending] = useState(false)\n  const [socket, setSocket] = useState<Socket | null>(null)\n  const messagesEndRef = useRef<HTMLDivElement>(null)\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })\n  }\n\n  useEffect(() => {\n    scrollToBottom()\n  }, [messages])\n\n  useEffect(() => {\n    if (!session?.user?.id) return\n\n    const fetchMessages = async () => {\n      try {\n        const res = await fetch(`/api/chat/messages?userId=${otherUser.id}`)\n        if (res.ok) {\n          const data = await res.json()\n          setMessages(data.messages || [])\n          \n          await fetch('/api/chat/mark-read', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ fromUserId: otherUser.id })\n          })\n        }\n      } catch (error) {\n        console.error('Error fetching messages:', error)\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    fetchMessages()\n\n    const socketInstance = io({\n      path: '/api/socket/io',\n    })\n\n    socketInstance.on('connect', () => {\n      console.log('Socket connected')\n      socketInstance.emit('join-room', session.user.id)\n    })\n\n    socketInstance.on('new-message', (data) => {\n      if (data.fromUserId === otherUser.id) {\n        setMessages((prev) => [...prev, {\n          id: Date.now().toString(),\n          content: data.message,\n          fromUserId: data.fromUserId,\n          toUserId: session.user.id,\n          createdAt: data.timestamp,\n          fromUser: {\n            id: otherUser.id,\n            name: otherUser.name,\n            profilePhoto: otherUser.profilePhoto || null\n          }\n        }])\n      }\n    })\n\n    setSocket(socketInstance)\n\n    return () => {\n      socketInstance.disconnect()\n    }\n  }, [session?.user?.id, otherUser])\n\n  const handleSend = async () => {\n    if (!newMessage.trim() || !session?.user?.id || sending) return\n\n    setSending(true)\n    try {\n      const res = await fetch('/api/chat/messages', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          toUserId: otherUser.id,\n          content: newMessage.trim()\n        })\n      })\n\n      if (res.ok) {\n        const data = await res.json()\n        setMessages((prev) => [...prev, data.message])\n        setNewMessage('')\n\n        if (socket) {\n          socket.emit('send-message', {\n            toUserId: otherUser.id,\n            fromUserId: session.user.id,\n            message: newMessage.trim()\n          })\n        }\n      }\n    } catch (error) {\n      console.error('Error sending message:', error)\n    } finally {\n      setSending(false)\n    }\n  }\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault()\n      handleSend()\n    }\n  }\n\n  const getRoleColor = (role?: string) => {\n    switch (role) {\n      case 'TEACHER': return 'text-purple-600'\n      case 'STUDENT': return 'text-blue-600'\n      case 'ADMIN': return 'text-red-600'\n      default: return 'text-gray-600'\n    }\n  }\n\n  const getRoleBadge = (role?: string) => {\n    switch (role) {\n      case 'TEACHER': return 'مدرس'\n      case 'STUDENT': return 'طالب'\n      case 'ADMIN': return 'مدير'\n      default: return ''\n    }\n  }\n\n  return (\n    <div className=\"flex flex-col h-full bg-white dark:bg-neutral-800 rounded-lg shadow-xl border border-neutral-200 dark:border-neutral-700 overflow-hidden\">\n      {/* Header */}\n      <div className=\"bg-gradient-to-r from-primary-600 to-primary-700 dark:from-primary-500 dark:to-primary-600 p-4 text-white\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 bg-white dark:bg-neutral-200 rounded-full flex items-center justify-center text-primary-600 dark:text-primary-700 font-bold\">\n              {otherUser.profilePhoto ? (\n                <img src={otherUser.profilePhoto} alt={otherUser.name} className=\"w-full h-full rounded-full object-cover\" />\n              ) : (\n                otherUser.name.charAt(0).toUpperCase()\n              )}\n            </div>\n            <div>\n              <h3 className=\"font-bold text-lg\">{otherUser.name}</h3>\n              {otherUser.role && (\n                <span className=\"text-xs bg-white/20 px-2 py-0.5 rounded-full\">\n                  {getRoleBadge(otherUser.role)}\n                </span>\n              )}\n            </div>\n          </div>\n          {onClose && (\n            <button\n              onClick={onClose}\n              className=\"hover:bg-white/20 rounded-full p-1 transition-colors\"\n            >\n              <X className=\"w-5 h-5\" />\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Messages */}\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4 bg-neutral-50 dark:bg-neutral-900\">\n        {loading ? (\n          <div className=\"flex items-center justify-center h-full\">\n            <Loader2 className=\"w-8 h-8 animate-spin text-primary-600 dark:text-primary-400\" />\n          </div>\n        ) : messages.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center h-full text-neutral-400 dark:text-neutral-500\">\n            <MessageCircle className=\"w-16 h-16 mb-2\" />\n            <p>لا توجد رسائل بعد</p>\n            <p className=\"text-sm\">ابدأ المحادثة الآن!</p>\n          </div>\n        ) : (\n          messages.map((message) => {\n            const isOwn = message.fromUserId === session?.user?.id\n            return (\n              <div\n                key={message.id}\n                className={`flex ${isOwn ? 'justify-end' : 'justify-start'}`}\n              >\n                <div\n                  className={`max-w-[70%] rounded-2xl px-4 py-2 ${\n                    isOwn\n                      ? 'bg-gradient-to-r from-primary-600 to-primary-700 dark:from-primary-500 dark:to-primary-600 text-white rounded-br-sm'\n                      : 'bg-white dark:bg-neutral-700 text-neutral-800 dark:text-neutral-100 border border-neutral-200 dark:border-neutral-600 rounded-bl-sm'\n                  }`}\n                >\n                  <p className=\"whitespace-pre-wrap break-words text-right\" dir=\"rtl\">\n                    {message.content}\n                  </p>\n                  <p className={`text-xs mt-1 ${isOwn ? 'text-white/70' : 'text-neutral-400 dark:text-neutral-500'}`}>\n                    {new Date(message.createdAt).toLocaleTimeString('ar-EG', {\n                      hour: '2-digit',\n                      minute: '2-digit'\n                    })}\n                  </p>\n                </div>\n              </div>\n            )\n          })\n        )}\n        <div ref={messagesEndRef} />\n      </div>\n\n      {/* Input */}\n      <div className=\"p-4 bg-white dark:bg-neutral-800 border-t border-neutral-200 dark:border-neutral-700\">\n        <div className=\"flex gap-2\">\n          <button\n            onClick={handleSend}\n            disabled={!newMessage.trim() || sending}\n            className=\"bg-gradient-to-r from-primary-600 to-primary-700 dark:from-primary-500 dark:to-primary-600 text-white p-3 rounded-full hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0\"\n          >\n            {sending ? (\n              <Loader2 className=\"w-5 h-5 animate-spin\" />\n            ) : (\n              <Send className=\"w-5 h-5\" />\n            )}\n          </button>\n          <input\n            type=\"text\"\n            value={newMessage}\n            onChange={(e) => setNewMessage(e.target.value)}\n            onKeyPress={handleKeyPress}\n            placeholder=\"اكتب رسالتك...\"\n            className=\"flex-1 px-4 py-3 border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-500 dark:placeholder:text-neutral-400 rounded-full focus:ring-2 focus:ring-primary-600 dark:focus:ring-primary-400 focus:border-transparent text-right\"\n            dir=\"rtl\"\n            disabled={sending}\n          />\n        </div>\n      </div>\n    </div>\n  )\n}\n","size_bytes":9045},"app/api/words/[id]/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'STUDENT') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const { id } = await params\n    const body = await request.json()\n    const { known, reviewCount } = body\n\n    const word = await prisma.word.findUnique({\n      where: { id }\n    })\n\n    if (!word || word.studentId !== session.user.id) {\n      return NextResponse.json({ error: 'Word not found' }, { status: 404 })\n    }\n\n    const updated = await prisma.word.update({\n      where: { id },\n      data: {\n        known: known !== undefined ? known : word.known,\n        reviewCount: reviewCount !== undefined ? reviewCount : word.reviewCount\n      }\n    })\n\n    return NextResponse.json(updated)\n  } catch (error) {\n    console.error('Error updating word:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'STUDENT') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const { id } = await params\n\n    const word = await prisma.word.findUnique({\n      where: { id }\n    })\n\n    if (!word || word.studentId !== session.user.id) {\n      return NextResponse.json({ error: 'Word not found' }, { status: 404 })\n    }\n\n    await prisma.word.delete({\n      where: { id }\n    })\n\n    return NextResponse.json({ success: true })\n  } catch (error) {\n    console.error('Error deleting word:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":2069},"app/page.tsx":{"content":"'use client';\n\nimport Link from \"next/link\";\nimport Image from \"next/image\";\nimport FloatingContactButtons from \"@/components/FloatingContactButtons\";\nimport AppHeader from \"@/components/layout/AppHeader\";\nimport { BookOpen, Video, Users, Award, Globe, Sparkles, MessageCircle, Target, ArrowRight, CheckCircle, Star, Zap } from \"lucide-react\";\n\nexport default function Home() {\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-[#F5F1E8] via-[#E8DCC8] to-[#F5F1E8] text-black\">\n      <AppHeader variant=\"marketing\">\n        <Link\n          href=\"/auth/login\"\n          className=\"px-6 py-3 text-base rounded-xl bg-[#004E89] text-white hover:bg-[#003A6B] transition-all duration-300 shadow-lg hover:shadow-xl font-semibold\"\n        >\n          Login\n        </Link>\n      </AppHeader>\n\n      <main>\n        {/* Hero Section - More Professional */}\n        <section className=\"relative py-20 md:py-32 overflow-hidden\">\n          {/* Elegant Background Pattern */}\n          <div className=\"absolute inset-0 opacity-5\">\n            <div className=\"absolute top-20 left-10 w-72 h-72 bg-[#004E89] rounded-full blur-3xl\"></div>\n            <div className=\"absolute bottom-20 right-10 w-96 h-96 bg-[#FF6B35] rounded-full blur-3xl\"></div>\n            <div className=\"absolute top-1/2 left-1/2 w-80 h-80 bg-[#004E89] rounded-full blur-3xl\"></div>\n          </div>\n\n          {/* Geometric Decorations */}\n          <div className=\"absolute top-32 right-20 w-20 h-20 border-4 border-[#004E89]/20 rounded-lg rotate-12 hidden lg:block\"></div>\n          <div className=\"absolute bottom-40 left-16 w-16 h-16 border-4 border-[#FF6B35]/20 rounded-full hidden lg:block\"></div>\n          <div className=\"absolute top-1/3 left-1/4 w-12 h-12 bg-gradient-to-br from-[#004E89]/10 to-transparent rounded-lg rotate-45 hidden lg:block\"></div>\n\n          <div className=\"container mx-auto px-4 sm:px-6 lg:px-8 relative z-10\">\n            <div className=\"text-center max-w-5xl mx-auto\">\n              {/* Badge */}\n              <div className=\"inline-flex items-center gap-2 bg-white/80 backdrop-blur-md border border-[#004E89]/20 px-6 py-3 rounded-full mb-8 shadow-lg\">\n                <Star className=\"w-5 h-5 text-[#FFD700] fill-[#FFD700]\" />\n                <span className=\"text-sm font-bold text-[#004E89] tracking-wide\">\n                  PROFESSIONAL ENGLISH LEARNING PLATFORM\n                </span>\n                <Star className=\"w-5 h-5 text-[#FFD700] fill-[#FFD700]\" />\n              </div>\n\n              {/* Main Heading */}\n              <h1 className=\"text-5xl sm:text-6xl md:text-7xl lg:text-8xl font-extrabold mb-6 leading-tight\">\n                <span className=\"block text-[#1a1a1a] mb-3\">\n                  Master English\n                </span>\n                <span className=\"block bg-gradient-to-r from-[#004E89] via-[#0066CC] to-[#004E89] bg-clip-text text-transparent\">\n                  with Excellence\n                </span>\n              </h1>\n\n              {/* Subtitle */}\n              <div className=\"max-w-3xl mx-auto mb-12 space-y-4\">\n                <p className=\"text-xl md:text-2xl text-gray-700 font-medium leading-relaxed\">\n                  Transform your future with interactive live classes led by expert instructors\n                </p>\n              </div>\n\n              {/* CTA Buttons */}\n              <div className=\"flex flex-col sm:flex-row gap-6 justify-center items-center max-w-2xl mx-auto mb-16\">\n                <Link\n                  href=\"/auth/register\"\n                  className=\"group relative w-full sm:w-auto px-10 py-5 bg-gradient-to-r from-[#004E89] to-[#0066CC] text-white rounded-2xl text-lg font-bold transition-all duration-300 shadow-2xl hover:shadow-3xl hover:scale-105 text-center overflow-hidden\"\n                >\n                  <span className=\"relative z-10 flex items-center justify-center gap-3\">\n                    <Zap className=\"w-6 h-6\" />\n                    Start Your Journey\n                    <ArrowRight className=\"w-5 h-5 group-hover:translate-x-1 transition-transform\" />\n                  </span>\n                  <div className=\"absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-white/0 transform -skew-x-12 translate-x-full group-hover:translate-x-[-200%] transition-transform duration-1000\"></div>\n                </Link>\n                <a\n                  href=\"https://wa.me/201091515594\"\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  className=\"group w-full sm:w-auto px-10 py-5 bg-white border-2 border-[#25D366] text-[#25D366] rounded-2xl text-lg font-bold hover:bg-[#25D366] hover:text-white transition-all duration-300 shadow-xl hover:shadow-2xl hover:scale-105 text-center\"\n                >\n                  <span className=\"flex items-center justify-center gap-3\">\n                    <MessageCircle className=\"w-6 h-6\" />\n                    Contact Us\n                  </span>\n                </a>\n              </div>\n\n              {/* Trust Indicators */}\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-6 max-w-4xl mx-auto\">\n                {[\n                  { number: \"500+\", label: \"Students\" },\n                  { number: \"50+\", label: \"Teachers\" },\n                  { number: \"1000+\", label: \"Classes\" },\n                  { number: \"98%\", label: \"Satisfaction\" }\n                ].map((stat, index) => (\n                  <div key={index} className=\"bg-white/60 backdrop-blur-md rounded-2xl p-6 shadow-lg border border-[#004E89]/10\">\n                    <div className=\"text-4xl font-extrabold text-[#004E89] mb-2\">{stat.number}</div>\n                    <div className=\"text-sm font-semibold text-gray-700\">{stat.label}</div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {/* Features Section - Premium Design */}\n        <section className=\"py-20 bg-gradient-to-b from-white/40 to-transparent\">\n          <div className=\"container mx-auto px-4 sm:px-6 lg:px-8\">\n            <div className=\"text-center mb-16\">\n              <h2 className=\"text-4xl md:text-5xl font-extrabold mb-4\">\n                <span className=\"text-[#1a1a1a]\">Why Choose </span>\n                <span className=\"text-[#004E89]\">Youspeak</span>\n              </h2>\n              <div className=\"w-24 h-1.5 bg-gradient-to-r from-transparent via-[#004E89] to-transparent mx-auto\"></div>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n              {[\n                {\n                  icon: <Video className=\"w-10 h-10\" />,\n                  gradient: \"from-blue-500 to-blue-700\",\n                  title: \"Live Interactive Classes\",\n                  description: \"Engage in real-time 60-minute sessions with professional teachers\"\n                },\n                {\n                  icon: <Target className=\"w-10 h-10\" />,\n                  gradient: \"from-orange-500 to-red-600\",\n                  title: \"Personalized Assessment\",\n                  description: \"Free 20-minute placement test to identify your level\"\n                },\n                {\n                  icon: <BookOpen className=\"w-10 h-10\" />,\n                  gradient: \"from-green-500 to-emerald-700\",\n                  title: \"Smart Learning System\",\n                  description: \"AI-powered vocabulary tracking and progress monitoring\"\n                },\n                {\n                  icon: <Users className=\"w-10 h-10\" />,\n                  gradient: \"from-purple-500 to-purple-700\",\n                  title: \"Expert Instructors\",\n                  description: \"Certified professionals with years of teaching experience\"\n                },\n                {\n                  icon: <MessageCircle className=\"w-10 h-10\" />,\n                  gradient: \"from-pink-500 to-rose-700\",\n                  title: \"24/7 Support\",\n                  description: \"Round-the-clock assistance for your learning journey\"\n                },\n                {\n                  icon: <Award className=\"w-10 h-10\" />,\n                  gradient: \"from-yellow-500 to-orange-600\",\n                  title: \"Recognized Certificates\",\n                  description: \"Industry-recognized completion certificates\"\n                }\n              ].map((feature, index) => (\n                <div\n                  key={index}\n                  className=\"group relative bg-white rounded-3xl p-8 shadow-xl hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-3 border border-gray-100 overflow-hidden\"\n                >\n                  {/* Gradient Background on Hover */}\n                  <div className={`absolute inset-0 bg-gradient-to-br ${feature.gradient} opacity-0 group-hover:opacity-5 transition-opacity duration-500`}></div>\n\n                  <div className=\"relative z-10\">\n                    <div className={`w-16 h-16 bg-gradient-to-br ${feature.gradient} rounded-2xl flex items-center justify-center text-white mb-6 group-hover:scale-110 group-hover:rotate-6 transition-all duration-500 shadow-lg`}>\n                      {feature.icon}\n                    </div>\n                    <h3 className=\"text-2xl font-bold text-[#1a1a1a] mb-4\">\n                      {feature.title}\n                    </h3>\n                    <p className=\"text-gray-600 leading-relaxed\">\n                      {feature.description}\n                    </p>\n                  </div>\n\n                  {/* Corner Accent */}\n                  <div className=\"absolute top-0 right-0 w-20 h-20 bg-gradient-to-br from-[#004E89]/5 to-transparent rounded-bl-3xl\"></div>\n                </div>\n              ))}\n            </div>\n          </div>\n        </section>\n\n        {/* Packages Section - Elegant Design */}\n        <section className=\"py-20\">\n          <div className=\"container mx-auto px-4 sm:px-6 lg:px-8\">\n            <div className=\"bg-gradient-to-br from-white/80 via-white/60 to-white/80 backdrop-blur-xl rounded-3xl shadow-2xl p-8 md:p-16 border border-white/50\">\n              <div className=\"text-center mb-16\">\n                <div className=\"inline-flex items-center gap-3 bg-gradient-to-r from-[#004E89]/10 to-[#0066CC]/10 border border-[#004E89]/30 px-8 py-3 rounded-full mb-6 shadow-lg\">\n                  <Globe className=\"w-6 h-6 text-[#004E89]\" />\n                  <span className=\"text-base font-bold text-[#004E89] tracking-wide\">\n                    INVESTMENT IN YOUR FUTURE\n                  </span>\n                  <Globe className=\"w-6 h-6 text-[#004E89]\" />\n                </div>\n                <h2 className=\"text-4xl md:text-5xl font-extrabold mb-4\">\n                  <span className=\"text-[#1a1a1a]\">Choose Your </span>\n                  <span className=\"text-[#004E89]\">Package</span>\n                </h2>\n                <p className=\"text-xl text-gray-600 max-w-2xl mx-auto\">\n                  Premium learning experiences at competitive prices\n                </p>\n              </div>\n\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 mb-12\">\n                {[\n                  { name: \"Single Level\", price: \"200\", lessons: \"8\", duration: \"2 months\", gradient: \"from-blue-500 to-blue-600\", popular: false },\n                  { name: \"Monthly\", price: \"360\", lessons: \"12\", duration: \"1 month\", gradient: \"from-orange-500 to-red-600\", popular: true },\n                  { name: \"Quarterly\", price: \"1000\", lessons: \"36\", duration: \"3 months\", gradient: \"from-purple-500 to-purple-600\", popular: false },\n                  { name: \"Premium\", price: \"1800\", lessons: \"48\", duration: \"6 months\", gradient: \"from-yellow-500 to-orange-600\", popular: false }\n                ].map((pkg, index) => (\n                  <div\n                    key={index}\n                    className={`relative rounded-3xl p-8 text-center transform transition-all duration-500 ${\n                      pkg.popular\n                        ? 'bg-gradient-to-br from-[#004E89] to-[#0066CC] text-white shadow-2xl scale-105 lg:scale-110'\n                        : 'bg-white border-2 border-gray-200 shadow-xl hover:shadow-2xl hover:scale-105 text-black'\n                    }`}\n                  >\n                    {pkg.popular && (\n                      <div className=\"absolute -top-5 left-1/2 transform -translate-x-1/2\">\n                        <div className=\"bg-gradient-to-r from-yellow-400 to-orange-500 text-black px-6 py-2 rounded-full text-sm font-black shadow-xl flex items-center gap-2\">\n                          <Star className=\"w-4 h-4 fill-black\" />\n                          BEST VALUE\n                          <Star className=\"w-4 h-4 fill-black\" />\n                        </div>\n                      </div>\n                    )}\n\n                    <div className={`w-20 h-20 mx-auto mb-6 bg-gradient-to-br ${pkg.gradient} rounded-2xl flex items-center justify-center text-white text-4xl font-bold shadow-lg ${pkg.popular ? 'bg-white/20' : ''}`}>\n                      {index + 1}\n                    </div>\n\n                    <h3 className={`text-2xl font-extrabold mb-6 ${pkg.popular ? 'text-white' : 'text-[#1a1a1a]'}`}>\n                      {pkg.name}\n                    </h3>\n\n                    <div className=\"mb-6\">\n                      <div className=\"flex items-end justify-center gap-2\">\n                        <span className={`text-5xl font-black ${pkg.popular ? 'text-white' : 'text-[#004E89]'}`}>\n                          {pkg.price}\n                        </span>\n                        <span className={`text-2xl font-bold pb-1 ${pkg.popular ? 'text-white/80' : 'text-gray-600'}`}>\n                          SAR\n                        </span>\n                      </div>\n                    </div>\n\n                    <div className=\"space-y-3 mb-6\">\n                      <div className={`flex items-center justify-center gap-2 ${pkg.popular ? 'text-white' : 'text-gray-700'}`}>\n                        <CheckCircle className=\"w-5 h-5\" />\n                        <span className=\"font-semibold\">{pkg.lessons} lessons</span>\n                      </div>\n                      <div className={`flex items-center justify-center gap-2 ${pkg.popular ? 'text-white' : 'text-gray-700'}`}>\n                        <CheckCircle className=\"w-5 h-5\" />\n                        <span className=\"font-semibold\">{pkg.duration}</span>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n\n              <div className=\"text-center\">\n                <Link\n                  href=\"/packages\"\n                  className=\"inline-flex items-center gap-3 px-12 py-5 bg-gradient-to-r from-[#004E89] to-[#0066CC] text-white rounded-2xl text-lg font-bold hover:shadow-2xl transition-all duration-300 hover:scale-105\"\n                >\n                  <BookOpen className=\"w-6 h-6\" />\n                  <span>View All Packages</span>\n                  <ArrowRight className=\"w-5 h-5\" />\n                </Link>\n              </div>\n            </div>\n          </div>\n        </section>\n      </main>\n\n      {/* Footer - Professional */}\n      <footer className=\"relative bg-gradient-to-b from-white/60 to-white/80 backdrop-blur-md border-t-2 border-[#004E89]/10 text-black py-16 mt-20\">\n        <div className=\"container mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center max-w-4xl mx-auto\">\n            <div className=\"flex items-center justify-center gap-4 mb-8\">\n              <div className=\"w-16 h-16 bg-gradient-to-br from-[#004E89] to-[#0066CC] rounded-2xl flex items-center justify-center shadow-xl\">\n                <Image\n                  src=\"/logo.png\"\n                  alt=\"Youspeak Logo\"\n                  width={48}\n                  height={48}\n                  className=\"w-12 h-12\"\n                />\n              </div>\n              <span className=\"text-4xl font-extrabold bg-gradient-to-r from-[#004E89] to-[#0066CC] bg-clip-text text-transparent\">\n                Youspeak\n              </span>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-8 max-w-2xl mx-auto\">\n              <a href=\"mailto:youspeak.help@gmail.com\" className=\"flex items-center justify-center gap-3 bg-white/60 backdrop-blur-sm rounded-xl p-4 hover:shadow-lg transition-all duration-300 border border-gray-200\">\n                <div className=\"w-10 h-10 bg-[#004E89] rounded-lg flex items-center justify-center text-white\">\n                  📧\n                </div>\n                <span className=\"font-semibold text-gray-700\">youspeak.help@gmail.com</span>\n              </a>\n              <a href=\"tel:+201091515594\" className=\"flex items-center justify-center gap-3 bg-white/60 backdrop-blur-sm rounded-xl p-4 hover:shadow-lg transition-all duration-300 border border-gray-200\">\n                <div className=\"w-10 h-10 bg-[#25D366] rounded-lg flex items-center justify-center text-white\">\n                  📱\n                </div>\n                <span className=\"font-semibold text-gray-700\">+201091515594</span>\n              </a>\n            </div>\n\n            <div className=\"w-full h-px bg-gradient-to-r from-transparent via-[#004E89]/30 to-transparent mb-8\"></div>\n\n            <p className=\"text-base font-semibold text-gray-700\">\n              © 2024 Youspeak - All Rights Reserved\n            </p>\n          </div>\n        </div>\n\n        {/* Bottom Credit */}\n        <div className=\"mt-8 pt-6 border-t border-[#004E89]/10\">\n          <p className=\"text-sm text-gray-600 flex items-center justify-center gap-2\">\n            Crafted with <span className=\"text-red-500\">❤️</span> by MA3K Company\n          </p>\n        </div>\n      </footer>\n\n      <FloatingContactButtons />\n    </div>\n  );\n}","size_bytes":17850},"app/api/admin/packages/[id]/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { prisma } from '@/lib/prisma'\nimport { requireAdmin, parseJsonBody, isNextResponse } from '@/lib/auth-helpers'\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const admin = await requireAdmin()\n    if (isNextResponse(admin)) return admin\n\n    const { id } = await params\n\n    const pkg = await prisma.package.findUnique({\n      where: { id },\n      include: {\n        Subscription: {\n          include: {\n            user: {\n              select: {\n                id: true,\n                name: true,\n                email: true\n              }\n            }\n          }\n        }\n      }\n    })\n\n    if (!pkg) {\n      return NextResponse.json({ error: 'Package not found' }, { status: 404 })\n    }\n\n    return NextResponse.json(pkg)\n  } catch (error) {\n    console.error('Error fetching package:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const admin = await requireAdmin()\n    if (isNextResponse(admin)) return admin\n\n    const { id } = await params\n\n    const body = await parseJsonBody<{\n      title?: string\n      titleAr?: string\n      description?: string\n      descriptionAr?: string\n      price?: number\n      lessonsCount?: number\n      durationDays?: number\n      isActive?: boolean\n    }>(request)\n    if (isNextResponse(body)) return body\n\n    const { title, titleAr, description, descriptionAr, price, lessonsCount, durationDays, isActive } = body\n\n    const existingPackage = await prisma.package.findUnique({\n      where: { id }\n    })\n\n    if (!existingPackage) {\n      return NextResponse.json({ error: 'Package not found' }, { status: 404 })\n    }\n\n    if (price !== undefined && price < 0) {\n      return NextResponse.json({ error: 'Invalid price' }, { status: 400 })\n    }\n\n    if (lessonsCount !== undefined && lessonsCount < 1) {\n      return NextResponse.json({ error: 'Invalid lessons count' }, { status: 400 })\n    }\n\n    if (durationDays !== undefined && durationDays < 1) {\n      return NextResponse.json({ error: 'Invalid duration' }, { status: 400 })\n    }\n\n    const updateData: any = {}\n    if (title !== undefined) updateData.title = title\n    if (titleAr !== undefined) updateData.titleAr = titleAr\n    if (description !== undefined) updateData.description = description\n    if (descriptionAr !== undefined) updateData.descriptionAr = descriptionAr\n    if (price !== undefined) updateData.price = price\n    if (lessonsCount !== undefined) updateData.lessonsCount = lessonsCount\n    if (durationDays !== undefined) updateData.durationDays = durationDays\n    if (isActive !== undefined) updateData.isActive = isActive\n    updateData.updatedAt = new Date()\n\n    const updatedPackage = await prisma.package.update({\n      where: { id },\n      data: updateData\n    })\n\n    return NextResponse.json(updatedPackage)\n  } catch (error) {\n    console.error('Error updating package:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const admin = await requireAdmin()\n    if (isNextResponse(admin)) return admin\n\n    const { id } = await params\n\n    const existingPackage = await prisma.package.findUnique({\n      where: { id },\n      include: {\n        Subscription: true\n      }\n    })\n\n    if (!existingPackage) {\n      return NextResponse.json({ error: 'Package not found' }, { status: 404 })\n    }\n\n    if (existingPackage.Subscription.length > 0) {\n      return NextResponse.json(\n        { error: 'Cannot delete package with active subscriptions' },\n        { status: 400 }\n      )\n    }\n\n    await prisma.package.delete({\n      where: { id }\n    })\n\n    return NextResponse.json({ success: true }, { status: 200 })\n  } catch (error) {\n    console.error('Error deleting package:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":4182},"attached_assets/studentSessionRoutes_1763165368930.ts":{"content":"import type { Express, Request, Response } from \"express\";\nimport { storage } from \"./storage\";\nimport { requireAuth, type AuthenticatedRequest } from \"./authMiddleware\";\n\nexport function setupStudentSessionRoutes(app: Express) {\n  // Get student's sessions\n  app.get('/api/student/sessions', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = (req as AuthenticatedRequest).user!.id;\n      \n      // Get all students and find by userId to avoid password column issue\n      const allStudents = await storage.getAllStudents();\n      const student = allStudents.find(s => s.userId === userId);\n      \n      if (!student) {\n        return res.status(404).json({ message: \"سجل الطالب غير موجود\" });\n      }\n      \n      const sessions = await storage.getAllSessionAccess(student.id);\n      const liveRooms = await storage.getLiveRoomsByStudent(student.id);\n      \n      // Merge roomToken into sessions\n      const sessionsWithRoomToken = sessions.map(session => {\n        const room = liveRooms.find(r => \n          r.sessionDate.toISOString().split('T')[0] === session.sessionDate\n        );\n        return {\n          ...session,\n          roomToken: room?.roomToken,\n          roomId: room?.id,\n        };\n      });\n      \n      res.json(sessionsWithRoomToken);\n    } catch (error) {\n      console.error(\"Error fetching student sessions:\", error);\n      res.status(500).json({ message: \"خطأ في جلب الحصص\" });\n    }\n  });\n\n  // Get today's assignment\n  app.get('/api/student/assignment/today', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = (req as AuthenticatedRequest).user!.id;\n      \n      // Get student record from userId\n      const students = await storage.getAllStudents();\n      const student = students.find(s => s.userId === userId);\n      \n      if (!student) {\n        return res.status(404).json({ message: \"سجل الطالب غير موجود\" });\n      }\n      \n      const today = new Date().toISOString().split('T')[0];\n      const assignment = await storage.getDailyAssignment(student.id, today);\n      \n      if (!assignment) {\n        return res.status(404).json({ message: \"لا يوجد تكليف اليوم\" });\n      }\n      \n      res.json(assignment);\n    } catch (error) {\n      console.error(\"Error fetching today's assignment:\", error);\n      res.status(500).json({ message: \"خطأ في جلب التكليف\" });\n    }\n  });\n\n  // Get all assignments\n  app.get('/api/student/assignments', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = (req as AuthenticatedRequest).user!.id;\n      \n      // Get student record from userId\n      const students = await storage.getAllStudents();\n      const student = students.find(s => s.userId === userId);\n      \n      if (!student) {\n        return res.status(404).json({ message: \"سجل الطالب غير موجود\" });\n      }\n      \n      const assignments = await storage.getDailyAssignments(student.id);\n      res.json(assignments);\n    } catch (error) {\n      console.error(\"Error fetching assignments:\", error);\n      res.status(500).json({ message: \"خطأ في جلب التكاليف\" });\n    }\n  });\n}\n","size_bytes":3227},"prisma/test-connection.js":{"content":"const { Client } = require('pg');\n\nconst client = new Client({\n  connectionString: process.env.EXTERNAL_DATABASE_URL\n});\n\nasync function test() {\n  try {\n    await client.connect();\n    console.log('✅ Connected successfully');\n    \n    // Check current user\n    const userResult = await client.query('SELECT current_user, current_database();');\n    console.log('Current user:', userResult.rows[0]);\n    \n    // Check schemas\n    const schemaResult = await client.query('SELECT schema_name FROM information_schema.schemata;');\n    console.log('Schemas:', schemaResult.rows);\n    \n    // Check permissions\n    const permResult = await client.query(`\n      SELECT * FROM information_schema.role_table_grants \n      WHERE grantee = current_user LIMIT 5;\n    `);\n    console.log('Permissions:', permResult.rows);\n    \n    await client.end();\n  } catch (error) {\n    console.error('❌ Error:', error.message);\n    await client.end();\n  }\n}\n\ntest();\n","size_bytes":946},"attached_assets/use-mobile_1763165145844.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"components/layout/Footer.tsx":{"content":"import React from 'react';\nimport { cn } from '@/lib/utils';\n\nexport interface FooterProps {\n  children?: React.ReactNode;\n  className?: string;\n}\n\nconst Footer: React.FC<FooterProps> = ({ children, className }) => {\n  return (\n    <footer\n      className={cn(\n        'w-full border-t border-neutral-200 bg-white dark:bg-neutral-900 dark:border-neutral-800',\n        className\n      )}\n      role=\"contentinfo\"\n    >\n      <div className=\"container mx-auto px-4 sm:px-6 lg:px-8\">\n        {children || (\n          <div className=\"py-8\">\n            <div className=\"grid grid-cols-1 gap-8 sm:grid-cols-2 md:grid-cols-4\">\n              <div>\n                <h3 className=\"text-sm font-semibold text-neutral-900 dark:text-neutral-100 mb-4 rtl:text-right\">\n                  About Youspeak\n                </h3>\n                <p className=\"text-sm text-neutral-600 dark:text-neutral-400 rtl:text-right\">\n                  Professional online English learning platform with live interactive classes.\n                </p>\n              </div>\n              <div>\n                <h3 className=\"text-sm font-semibold text-neutral-900 dark:text-neutral-100 mb-4 rtl:text-right\">\n                  Quick Links\n                </h3>\n                <ul className=\"space-y-2\">\n                  <li>\n                    <a\n                      href=\"/\"\n                      className=\"text-sm text-neutral-600 hover:text-primary dark:text-neutral-400 dark:hover:text-primary-400 transition-colors rtl:text-right block\"\n                    >\n                      Home\n                    </a>\n                  </li>\n                  <li>\n                    <a\n                      href=\"/courses\"\n                      className=\"text-sm text-neutral-600 hover:text-primary dark:text-neutral-400 dark:hover:text-primary-400 transition-colors rtl:text-right block\"\n                    >\n                      Courses\n                    </a>\n                  </li>\n                  <li>\n                    <a\n                      href=\"/about\"\n                      className=\"text-sm text-neutral-600 hover:text-primary dark:text-neutral-400 dark:hover:text-primary-400 transition-colors rtl:text-right block\"\n                    >\n                      About\n                    </a>\n                  </li>\n                </ul>\n              </div>\n              <div>\n                <h3 className=\"text-sm font-semibold text-neutral-900 dark:text-neutral-100 mb-4 rtl:text-right\">\n                  Contact\n                </h3>\n                <ul className=\"space-y-2\">\n                  <li className=\"text-sm text-neutral-600 dark:text-neutral-400 rtl:text-right\">\n                    Email: info@youspeak.com\n                  </li>\n                  <li className=\"text-sm text-neutral-600 dark:text-neutral-400 rtl:text-right\">\n                    Phone: +123 456 7890\n                  </li>\n                </ul>\n              </div>\n              <div>\n                <h3 className=\"text-sm font-semibold text-neutral-900 dark:text-neutral-100 mb-4 rtl:text-right\">\n                  Follow Us\n                </h3>\n                <div className=\"flex gap-4 rtl:flex-row-reverse rtl:justify-end\">\n                  <a\n                    href=\"#\"\n                    className=\"text-neutral-600 hover:text-primary dark:text-neutral-400 dark:hover:text-primary-400 transition-colors\"\n                    aria-label=\"Facebook\"\n                  >\n                    <svg className=\"h-5 w-5\" fill=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n                      <path d=\"M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z\" />\n                    </svg>\n                  </a>\n                  <a\n                    href=\"#\"\n                    className=\"text-neutral-600 hover:text-primary dark:text-neutral-400 dark:hover:text-primary-400 transition-colors\"\n                    aria-label=\"Twitter\"\n                  >\n                    <svg className=\"h-5 w-5\" fill=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n                      <path d=\"M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84\" />\n                    </svg>\n                  </a>\n                </div>\n              </div>\n            </div>\n            <div className=\"mt-8 border-t border-neutral-200 dark:border-neutral-800 pt-8 text-center\">\n              <p className=\"text-sm text-neutral-600 dark:text-neutral-400\">\n                © {new Date().getFullYear()} Youspeak. All rights reserved.\n              </p>\n            </div>\n          </div>\n        )}\n      </div>\n    </footer>\n  );\n};\n\nexport default Footer;\n","size_bytes":5224},"components/ui/Alert.tsx":{"content":"import React from 'react';\nimport { cva, type VariantProps } from 'class-variance-authority';\nimport { cn } from '@/lib/utils';\nimport { AlertCircle, CheckCircle, Info, XCircle, X } from 'lucide-react';\n\nconst alertVariants = cva(\n  'relative w-full rounded-lg border p-4 [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:rtl:left-auto [&>svg]:rtl:right-4 [&>svg+div]:pl-8 [&>svg+div]:rtl:pr-8 [&>svg+div]:rtl:pl-0',\n  {\n    variants: {\n      variant: {\n        info: 'bg-info-50 border-info-200 text-info-900 [&>svg]:text-info-600 dark:bg-info-900/20 dark:border-info-800 dark:text-info-100',\n        success: 'bg-success-50 border-success-200 text-success-900 [&>svg]:text-success-600 dark:bg-success-900/20 dark:border-success-800 dark:text-success-100',\n        warning: 'bg-warning-50 border-warning-200 text-warning-900 [&>svg]:text-warning-600 dark:bg-warning-900/20 dark:border-warning-800 dark:text-warning-100',\n        error: 'bg-error-50 border-error-200 text-error-900 [&>svg]:text-error-600 dark:bg-error-900/20 dark:border-error-800 dark:text-error-100',\n      },\n    },\n    defaultVariants: {\n      variant: 'info',\n    },\n  }\n);\n\nconst iconMap = {\n  info: Info,\n  success: CheckCircle,\n  warning: AlertCircle,\n  error: XCircle,\n};\n\nexport interface AlertProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof alertVariants> {\n  title?: string;\n  dismissible?: boolean;\n  onDismiss?: () => void;\n}\n\nconst Alert = React.forwardRef<HTMLDivElement, AlertProps>(\n  ({ className, variant = 'info', title, dismissible, onDismiss, children, ...props }, ref) => {\n    const Icon = variant ? iconMap[variant] : iconMap.info;\n\n    return (\n      <div\n        ref={ref}\n        role=\"alert\"\n        className={cn(alertVariants({ variant }), className)}\n        {...props}\n      >\n        {Icon && <Icon className=\"h-5 w-5\" aria-hidden=\"true\" />}\n        <div className={cn(dismissible && 'pr-8 rtl:pl-8 rtl:pr-0')}>\n          {title && (\n            <h5 className=\"mb-1 font-medium leading-none tracking-tight rtl:text-right\">\n              {title}\n            </h5>\n          )}\n          <div className=\"text-sm [&_p]:leading-relaxed rtl:text-right\">{children}</div>\n        </div>\n        {dismissible && (\n          <button\n            onClick={onDismiss}\n            className=\"absolute right-4 top-4 text-current opacity-70 hover:opacity-100 transition-opacity rtl:right-auto rtl:left-4\"\n            aria-label=\"Dismiss alert\"\n          >\n            <X className=\"h-4 w-4\" aria-hidden=\"true\" />\n          </button>\n        )}\n      </div>\n    );\n  }\n);\n\nAlert.displayName = 'Alert';\n\nexport default Alert;\n","size_bytes":2645},"tailwind.config.ts":{"content":"import type { Config } from 'tailwindcss';\n\nconst config: Config = {\n  darkMode: 'class',\n  content: [\n    './pages/**/*.{js,ts,jsx,tsx,mdx}',\n    './components/**/*.{js,ts,jsx,tsx,mdx}',\n    './app/**/*.{js,ts,jsx,tsx,mdx}',\n  ],\n  theme: {\n    extend: {\n      colors: {\n        primary: {\n          50: '#e6f1f7',\n          100: '#cce3ef',\n          200: '#99c7df',\n          300: '#66abcf',\n          400: '#338fbf',\n          500: '#004E89',\n          600: '#003e6e',\n          700: '#002f52',\n          800: '#001f37',\n          900: '#00101b',\n          DEFAULT: '#004E89',\n        },\n        accent: {\n          50: '#fffdf5',\n          100: '#fffbeb',\n          200: '#fff6d6',\n          300: '#fff1c2',\n          400: '#ffedad',\n          500: '#FFD700',\n          600: '#ccac00',\n          700: '#998100',\n          800: '#665600',\n          900: '#332b00',\n          DEFAULT: '#FFD700',\n        },\n        success: {\n          50: '#f0fdf4',\n          100: '#dcfce7',\n          200: '#bbf7d0',\n          300: '#86efac',\n          400: '#4ade80',\n          500: '#22c55e',\n          600: '#16a34a',\n          700: '#15803d',\n          800: '#166534',\n          900: '#14532d',\n          DEFAULT: '#22c55e',\n        },\n        error: {\n          50: '#fef2f2',\n          100: '#fee2e2',\n          200: '#fecaca',\n          300: '#fca5a5',\n          400: '#f87171',\n          500: '#ef4444',\n          600: '#dc2626',\n          700: '#b91c1c',\n          800: '#991b1b',\n          900: '#7f1d1d',\n          DEFAULT: '#ef4444',\n        },\n        warning: {\n          50: '#fffbeb',\n          100: '#fef3c7',\n          200: '#fde68a',\n          300: '#fcd34d',\n          400: '#fbbf24',\n          500: '#f59e0b',\n          600: '#d97706',\n          700: '#b45309',\n          800: '#92400e',\n          900: '#78350f',\n          DEFAULT: '#f59e0b',\n        },\n        info: {\n          50: '#eff6ff',\n          100: '#dbeafe',\n          200: '#bfdbfe',\n          300: '#93c5fd',\n          400: '#60a5fa',\n          500: '#3b82f6',\n          600: '#2563eb',\n          700: '#1d4ed8',\n          800: '#1e40af',\n          900: '#1e3a8a',\n          DEFAULT: '#3b82f6',\n        },\n      },\n      screens: {\n        xs: '320px',\n        sm: '640px',\n        md: '768px',\n        lg: '1024px',\n        xl: '1280px',\n        '2xl': '1536px',\n      },\n      spacing: {\n        xs: '0.25rem',\n        sm: '0.5rem',\n        md: '1rem',\n        lg: '1.5rem',\n        xl: '2rem',\n        '2xl': '3rem',\n        '3xl': '4rem',\n        '4xl': '6rem',\n        '5xl': '8rem',\n        '13': '3.25rem',\n        '15': '3.75rem',\n      },\n      borderRadius: {\n        sm: '0.125rem',\n        DEFAULT: '0.375rem',\n        md: '0.5rem',\n        lg: '0.75rem',\n        xl: '1rem',\n        '2xl': '1.5rem',\n        '3xl': '2rem',\n      },\n      boxShadow: {\n        sm: '0 1px 2px 0 rgb(0 0 0 / 0.05)',\n        DEFAULT: '0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1)',\n        md: '0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)',\n        lg: '0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)',\n        xl: '0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1)',\n        '2xl': '0 25px 50px -12px rgb(0 0 0 / 0.25)',\n        inner: 'inset 0 2px 4px 0 rgb(0 0 0 / 0.05)',\n      },\n      transitionDuration: {\n        fast: '150ms',\n        base: '300ms',\n        slow: '500ms',\n      },\n    },\n  },\n  plugins: [],\n};\n\nexport default config;\n","size_bytes":3487},"app/api/student/sessions/[id]/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'STUDENT') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const { id } = await params\n\n    const sessionData = await prisma.session.findFirst({\n      where: {\n        id,\n        SessionStudent: {\n          some: {\n            studentId: session.user.id\n          }\n        }\n      },\n      include: {\n        TeacherProfile: {\n          include: {\n            User: {\n              select: {\n                name: true,\n                email: true\n              }\n            }\n          }\n        }\n      }\n    })\n\n    if (!sessionData) {\n      return NextResponse.json({ error: 'Session not found or not enrolled' }, { status: 404 })\n    }\n\n    return NextResponse.json({\n      ...sessionData,\n      teacher: {\n        name: sessionData.TeacherProfile.User.name\n      }\n    })\n  } catch (error) {\n    console.error('Error fetching session:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":1374},"app/dashboard/student/discover-words/page.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { motion, AnimatePresence } from 'framer-motion'\nimport { Check, X, Star, Sparkles, Brain, Trophy, ArrowRight } from 'lucide-react'\n\ninterface Word {\n  word: string\n  arabic: string\n  example: string\n  imageUrl?: string\n}\n\nexport default function DiscoverWordsPage() {\n  const [words, setWords] = useState<Word[]>([])\n  const [currentIndex, setCurrentIndex] = useState(0)\n  const [level, setLevel] = useState<'beginner' | 'intermediate' | 'advanced'>('beginner')\n  const [loading, setLoading] = useState(true)\n  const [score, setScore] = useState(0)\n  const [streak, setStreak] = useState(0)\n  const [showExample, setShowExample] = useState(false)\n\n  useEffect(() => {\n    loadWords()\n  }, [level])\n\n  const loadWords = async () => {\n    setLoading(true)\n    try {\n      const res = await fetch(`/api/words/discover?level=${level}`)\n      const data = await res.json()\n      setWords(data.words)\n      setCurrentIndex(0)\n      setShowExample(false)\n    } catch (error) {\n      console.error('Error loading words:', error)\n    }\n    setLoading(false)\n  }\n\n  const handleResponse = async (known: boolean) => {\n    const currentWord = words[currentIndex]\n\n    await fetch('/api/words/discover', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        word: currentWord.word,\n        arabic: currentWord.arabic,\n        example: currentWord.example,\n        known: known\n      })\n    })\n\n    if (known) {\n      setScore(score + 10)\n      setStreak(streak + 1)\n    } else {\n      setStreak(0)\n    }\n\n    if (currentIndex < words.length - 1) {\n      setCurrentIndex(currentIndex + 1)\n      setShowExample(false)\n    } else {\n      loadWords()\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-[#F5F5DC] flex items-center justify-center\">\n        <div className=\"text-gray-800 text-2xl flex items-center gap-3\">\n          <Sparkles className=\"animate-spin h-8 w-8 text-blue-600\" />\n          <span>جاري تحميل الكلمات...</span>\n        </div>\n      </div>\n    )\n  }\n\n  const currentWord = words[currentIndex]\n\n  return (\n    <div className=\"min-h-screen bg-[#F5F5DC] p-4 md:p-8\">\n      {/* Header */}\n      <div className=\"max-w-6xl mx-auto mb-8\">\n        <motion.div\n          initial={{ y: -50, opacity: 0 }}\n          animate={{ y: 0, opacity: 1 }}\n          className=\"flex flex-col md:flex-row justify-between items-center gap-4 bg-[#FAF8F3] border-2 border-amber-200 rounded-2xl p-6 shadow-lg\"\n        >\n          <div className=\"flex items-center gap-4\">\n            <div className=\"bg-blue-600 p-3 rounded-xl\">\n              <Brain className=\"h-8 w-8 text-white\" />\n            </div>\n            <div>\n              <h1 className=\"text-3xl font-bold text-gray-900\">اكتشف الكلمات الجديدة</h1>\n              <p className=\"text-gray-600\">Discover New Words</p>\n            </div>\n          </div>\n\n          <div className=\"flex gap-4\">\n            <div className=\"bg-blue-50 border-2 border-blue-500 px-6 py-3 rounded-xl text-center\">\n              <Star className=\"h-6 w-6 mx-auto mb-1 text-blue-600\" />\n              <div className=\"text-2xl font-bold text-gray-900\">{score}</div>\n              <div className=\"text-xs text-gray-600\">النقاط</div>\n            </div>\n            <div className=\"bg-blue-50 border-2 border-blue-400 px-6 py-3 rounded-xl text-center\">\n              <Trophy className=\"h-6 w-6 mx-auto mb-1 text-blue-600\" />\n              <div className=\"text-2xl font-bold text-gray-900\">{streak}</div>\n              <div className=\"text-xs text-gray-600\">التتابع</div>\n            </div>\n          </div>\n        </motion.div>\n\n        {/* Level Selector */}\n        <motion.div\n          initial={{ scale: 0.9, opacity: 0 }}\n          animate={{ scale: 1, opacity: 1 }}\n          transition={{ delay: 0.1 }}\n          className=\"flex gap-3 mt-4 justify-center\"\n        >\n          {(['beginner', 'intermediate', 'advanced'] as const).map((lvl) => (\n            <button\n              key={lvl}\n              onClick={() => setLevel(lvl)}\n              className={`px-6 py-3 rounded-xl font-semibold transition-all border-2 ${\n                level === lvl\n                  ? 'bg-blue-600 text-white border-blue-600 shadow-lg scale-110'\n                  : 'bg-[#FAF8F3] text-gray-900 border-amber-300 hover:border-blue-600 hover:text-blue-600'\n              }`}\n            >\n              {lvl === 'beginner' && 'مبتدئ'}\n              {lvl === 'intermediate' && 'متوسط'}\n              {lvl === 'advanced' && 'متقدم'}\n            </button>\n          ))}\n        </motion.div>\n      </div>\n\n      {/* Word Card */}\n      <div className=\"max-w-2xl mx-auto\">\n        <AnimatePresence mode=\"wait\">\n          {currentWord && (\n            <motion.div\n              key={currentIndex}\n              initial={{ scale: 0, rotateY: -180 }}\n              animate={{ scale: 1, rotateY: 0 }}\n              exit={{ scale: 0, rotateY: 180 }}\n              transition={{ type: 'spring', stiffness: 200, damping: 20 }}\n              className=\"bg-[#FAF8F3] border-2 border-amber-200 rounded-3xl shadow-xl p-12 text-center relative overflow-hidden\"\n            >\n              {/* Background Decoration */}\n              <div className=\"absolute top-0 right-0 w-40 h-40 bg-blue-500/10 rounded-full filter blur-3xl -z-10\" />\n              <div className=\"absolute bottom-0 left-0 w-40 h-40 bg-blue-500/10 rounded-full filter blur-3xl -z-10\" />\n\n              {/* Word with Image */}\n              <motion.div\n                initial={{ y: 20, opacity: 0 }}\n                animate={{ y: 0, opacity: 1 }}\n                transition={{ delay: 0.2 }}\n              >\n                {/* Image */}\n                {currentWord.imageUrl && (\n                  <div className=\"mb-6 relative w-64 h-64 mx-auto rounded-2xl overflow-hidden shadow-lg\">\n                    <img \n                      src={currentWord.imageUrl} \n                      alt={currentWord.word}\n                      className=\"w-full h-full object-cover\"\n                      onError={(e) => {\n                        (e.target as HTMLImageElement).style.display = 'none'\n                      }}\n                    />\n                  </div>\n                )}\n\n                <div className=\"inline-block bg-blue-600 text-white px-8 py-4 rounded-2xl mb-6\">\n                  <h2 className=\"text-6xl font-bold\">{currentWord.word}</h2>\n                </div>\n\n                {/* Progress */}\n                <div className=\"flex justify-center gap-2 mb-8\">\n                  {words.map((_, idx) => (\n                    <div\n                      key={idx}\n                      className={`h-2 rounded-full transition-all ${\n                        idx === currentIndex\n                          ? 'w-12 bg-blue-600'\n                          : idx < currentIndex\n                          ? 'w-2 bg-blue-400'\n                          : 'w-2 bg-gray-300'\n                      }`}\n                    />\n                  ))}\n                </div>\n\n                {/* Arabic Meaning */}\n                <div className=\"mb-8\">\n                  <p className=\"text-3xl font-bold text-gray-900 mb-2\" dir=\"rtl\">\n                    {currentWord.arabic}\n                  </p>\n                </div>\n\n                {/* Example Toggle */}\n                <button\n                  onClick={() => setShowExample(!showExample)}\n                  className=\"mb-6 flex items-center gap-2 mx-auto text-blue-600 hover:text-blue-700 font-semibold\"\n                >\n                  <Sparkles className=\"h-5 w-5\" />\n                  {showExample ? 'إخفاء المثال' : 'عرض المثال'}\n                </button>\n\n                {showExample && (\n                  <motion.div\n                    initial={{ height: 0, opacity: 0 }}\n                    animate={{ height: 'auto', opacity: 1 }}\n                    className=\"bg-amber-50 rounded-xl p-6 mb-8 border border-amber-200\"\n                  >\n                    <p className=\"text-lg text-gray-900 italic\">\"{currentWord.example}\"</p>\n                  </motion.div>\n                )}\n\n                {/* Action Buttons */}\n                <div className=\"flex gap-4 justify-center\">\n                  <motion.button\n                    whileHover={{ scale: 1.05 }}\n                    whileTap={{ scale: 0.95 }}\n                    onClick={() => handleResponse(false)}\n                    className=\"flex-1 max-w-xs bg-blue-500 hover:bg-blue-600 text-white px-8 py-6 rounded-2xl font-bold text-xl shadow-lg flex items-center justify-center gap-3 transition-colors\"\n                  >\n                    <X className=\"h-8 w-8\" />\n                    <span>لا أعرفها</span>\n                  </motion.button>\n\n                  <motion.button\n                    whileHover={{ scale: 1.05 }}\n                    whileTap={{ scale: 0.95 }}\n                    onClick={() => handleResponse(true)}\n                    className=\"flex-1 max-w-xs bg-blue-600 hover:bg-blue-700 text-white px-8 py-6 rounded-2xl font-bold text-xl shadow-lg flex items-center justify-center gap-3 transition-colors\"\n                  >\n                    <Check className=\"h-8 w-8\" />\n                    <span>أعرفها!</span>\n                  </motion.button>\n                </div>\n\n                {/* Tips */}\n                <div className=\"mt-8 text-sm text-gray-900 bg-blue-50 p-4 rounded-xl border border-blue-200\">\n                  <p>💡 <strong>جميع الكلمات</strong> ستُضاف تلقائياً لقائمة \"كلماتي\" - الكلمات التي تعرفها ستُعلم كـ \"معروفة\" ✅</p>\n                  <p className=\"mt-2\">📚 الكلمات التي لا تعرفها ستُحفظ كـ \"غير معروفة\" ❌ لمراجعتها لاحقاً</p>\n                </div>\n              </motion.div>\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </div>\n    </div>\n  )\n}","size_bytes":10092},"app/api/admin/users/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\nimport bcrypt from 'bcryptjs'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || (session.user.role !== 'ADMIN' && session.user.role !== 'ASSISTANT')) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const users = await prisma.user.findMany({\n      orderBy: { createdAt: 'desc' },\n      select: {\n        id: true,\n        name: true,\n        email: true,\n        role: true,\n        isActive: true,\n        phone: true,\n        createdAt: true\n      }\n    })\n\n    return NextResponse.json(users)\n  } catch (error) {\n    console.error('Error fetching users:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || session.user.role !== 'ADMIN') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const { name, email, password, phone, bio } = await request.json()\n\n    if (!name || !email || !password) {\n      return NextResponse.json({ error: 'Name, email, and password are required' }, { status: 400 })\n    }\n\n    const existingUser = await prisma.user.findUnique({\n      where: { email }\n    })\n\n    if (existingUser) {\n      return NextResponse.json({ error: 'Email already in use' }, { status: 400 })\n    }\n\n    const passwordHash = await bcrypt.hash(password, 10)\n\n    const newUser = await prisma.user.create({\n      data: {\n        id: `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        name,\n        email,\n        passwordHash,\n        phone: phone || null,\n        role: 'TEACHER',\n        isActive: true\n      }\n    })\n\n    const teacherProfile = await prisma.teacherProfile.create({\n      data: {\n        id: `teacher_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        userId: newUser.id,\n        bio: bio || null\n      }\n    })\n\n    await prisma.auditLog.create({\n      data: {\n        id: `audit_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        action: 'Teacher account created',\n        userId: session.user.id,\n        details: `Created teacher account for ${name} (${email})`\n      }\n    })\n\n    return NextResponse.json({\n      id: newUser.id,\n      name: newUser.name,\n      email: newUser.email,\n      role: newUser.role\n    })\n  } catch (error) {\n    console.error('Error creating teacher:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":2784},"components/ThemeToggle.tsx":{"content":"'use client'\n\nimport { Moon, Sun } from 'lucide-react'\nimport { useTheme } from '@/lib/contexts/ThemeContext'\n\nexport default function ThemeToggle() {\n  const { theme, toggleTheme } = useTheme()\n  \n  return (\n    <button\n      onClick={toggleTheme}\n      className=\"p-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors\"\n      aria-label=\"Toggle theme\"\n    >\n      {theme === 'light' ? (\n        <Moon className=\"w-5 h-5 text-gray-700 dark:text-gray-300\" />\n      ) : (\n        <Sun className=\"w-5 h-5 text-gray-700 dark:text-gray-300\" />\n      )}\n    </button>\n  )\n}\n","size_bytes":617},"components/ConversationsList.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { MessageCircle, Loader2 } from 'lucide-react'\nimport { useSession } from 'next-auth/react'\n\ninterface Conversation {\n  user: {\n    id: string\n    name: string\n    email: string\n    role: string\n    profilePhoto: string | null\n  }\n  lastMessage: {\n    content: string\n    createdAt: string\n    fromUserId: string\n  } | null\n  unreadCount: number\n}\n\ninterface ConversationsListProps {\n  onSelectConversation: (user: Conversation['user']) => void\n  selectedUserId?: string\n}\n\nexport default function ConversationsList({ onSelectConversation, selectedUserId }: ConversationsListProps) {\n  const { data: session } = useSession()\n  const [conversations, setConversations] = useState<Conversation[]>([])\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    const fetchConversations = async () => {\n      try {\n        const res = await fetch('/api/chat/conversations')\n        if (res.ok) {\n          const data = await res.json()\n          setConversations(data.conversations || [])\n        }\n      } catch (error) {\n        console.error('Error fetching conversations:', error)\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    if (session?.user?.id) {\n      fetchConversations()\n      const interval = setInterval(fetchConversations, 10000)\n      return () => clearInterval(interval)\n    }\n  }, [session?.user?.id])\n\n  const getRoleBadge = (role: string) => {\n    switch (role) {\n      case 'TEACHER': return { text: 'مدرس', color: 'bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300' }\n      case 'STUDENT': return { text: 'طالب', color: 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300' }\n      case 'ADMIN': return { text: 'مدير', color: 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300' }\n      default: return { text: 'مستخدم', color: 'bg-neutral-100 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-300' }\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-primary-600 dark:text-primary-400\" />\n      </div>\n    )\n  }\n\n  if (conversations.length === 0) {\n    return (\n      <div className=\"flex flex-col items-center justify-center h-full text-neutral-400 dark:text-neutral-500 p-8\">\n        <MessageCircle className=\"w-16 h-16 mb-4\" />\n        <p className=\"text-lg font-medium\">لا توجد محادثات</p>\n        <p className=\"text-sm text-center mt-2\">ابدأ محادثة جديدة مع مدرسك أو طلابك</p>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-2 p-4\">\n      {conversations.map((conv) => {\n        const badge = getRoleBadge(conv.user.role)\n        const isSelected = selectedUserId === conv.user.id\n        \n        return (\n          <button\n            key={conv.user.id}\n            onClick={() => onSelectConversation(conv.user)}\n            className={`w-full p-4 rounded-lg hover:bg-neutral-50 dark:hover:bg-neutral-700 transition-all text-right border ${\n              isSelected ? 'bg-primary-50 dark:bg-primary-900/20 border-primary-600 dark:border-primary-400' : 'bg-white dark:bg-neutral-800 border-neutral-200 dark:border-neutral-700'\n            }`}\n          >\n            <div className=\"flex items-start gap-3\">\n              <div className=\"w-12 h-12 bg-gradient-to-br from-primary-600 to-primary-700 dark:from-primary-500 dark:to-primary-600 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0\">\n                {conv.user.profilePhoto ? (\n                  <img src={conv.user.profilePhoto} alt={conv.user.name} className=\"w-full h-full rounded-full object-cover\" />\n                ) : (\n                  conv.user.name.charAt(0).toUpperCase()\n                )}\n              </div>\n              \n              <div className=\"flex-1 min-w-0\">\n                <div className=\"flex items-center justify-between mb-1\">\n                  <h3 className=\"font-semibold text-neutral-900 dark:text-neutral-100 truncate\">{conv.user.name}</h3>\n                  {conv.unreadCount > 0 && (\n                    <span className=\"bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full\">\n                      {conv.unreadCount}\n                    </span>\n                  )}\n                </div>\n                \n                <div className=\"flex items-center gap-2 mb-1\">\n                  <span className={`text-xs px-2 py-0.5 rounded-full ${badge.color}`}>\n                    {badge.text}\n                  </span>\n                </div>\n                \n                {conv.lastMessage && (\n                  <div className=\"flex items-baseline justify-between\">\n                    <p className=\"text-sm text-neutral-600 dark:text-neutral-400 truncate\" dir=\"rtl\">\n                      {conv.lastMessage.fromUserId === session?.user?.id && 'أنت: '}\n                      {conv.lastMessage.content}\n                    </p>\n                    <span className=\"text-xs text-neutral-400 dark:text-neutral-500 flex-shrink-0 mr-2\">\n                      {new Date(conv.lastMessage.createdAt).toLocaleDateString('ar-EG', {\n                        month: 'short',\n                        day: 'numeric'\n                      })}\n                    </span>\n                  </div>\n                )}\n              </div>\n            </div>\n          </button>\n        )\n      })}\n    </div>\n  )\n}\n","size_bytes":5490},"server.js":{"content":"const { createServer } = require('http')\nconst { parse } = require('url')\nconst next = require('next')\nconst { Server } = require('socket.io')\n\nconst dev = process.env.NODE_ENV !== 'production'\nconst hostname = '0.0.0.0'\nconst port = parseInt(process.env.PORT || '5000', 10)\n\nconst app = next({ dev, hostname, port })\nconst handle = app.getRequestHandler()\n\napp.prepare().then(() => {\n  const httpServer = createServer(async (req, res) => {\n    try {\n      const parsedUrl = parse(req.url, true)\n      await handle(req, res, parsedUrl)\n    } catch (err) {\n      console.error('Error occurred handling', req.url, err)\n      res.statusCode = 500\n      res.end('internal server error')\n    }\n  })\n  \n  const io = new Server(httpServer, {\n    path: '/api/socket/io',\n    cors: {\n      origin: '*',\n      methods: ['GET', 'POST']\n    }\n  })\n\n  io.on('connection', (socket) => {\n    console.log('✅ Socket connected:', socket.id)\n\n    socket.on('join-room', (userId) => {\n      socket.join(`user-${userId}`)\n      console.log(`✅ User ${userId} joined room`)\n    })\n\n    socket.on('send-message', (data) => {\n      const { toUserId, fromUserId, message } = data\n      console.log(`📨 Sending message from ${fromUserId} to ${toUserId}`)\n      io.to(`user-${toUserId}`).emit('new-message', {\n        fromUserId,\n        message,\n        timestamp: new Date()\n      })\n    })\n\n    socket.on('disconnect', () => {\n      console.log('❌ Socket disconnected:', socket.id)\n    })\n  })\n\n  httpServer\n    .once('error', (err) => {\n      console.error(err)\n      process.exit(1)\n    })\n    .listen(port, () => {\n      console.log(`> Ready on http://${hostname}:${port}`)\n      console.log(`> Socket.IO server running on path: /api/socket/io`)\n    })\n})\n","size_bytes":1742},"app/api/chat/mark-read/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\nexport async function POST(req: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions)\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const { fromUserId } = await req.json()\n\n    if (!fromUserId) {\n      return NextResponse.json({ error: 'From user ID required' }, { status: 400 })\n    }\n\n    await prisma.chat.updateMany({\n      where: {\n        fromUserId: fromUserId,\n        toUserId: session.user.id,\n        isSaved: false\n      },\n      data: {\n        isSaved: true\n      }\n    })\n\n    return NextResponse.json({ success: true })\n  } catch (error) {\n    console.error('Error marking messages as read:', error)\n    return NextResponse.json({ error: 'Failed to mark messages as read' }, { status: 500 })\n  }\n}\n","size_bytes":990},"app/settings/page.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { useTheme } from '@/contexts/ThemeContext'\nimport { Settings, Sun, Moon, Globe, Palette, Save, ArrowRight } from 'lucide-react'\nimport Button from '@/components/ui/Button'\nimport Card from '@/components/ui/Card'\nimport Alert from '@/components/ui/Alert'\n\nexport default function SettingsPage() {\n  const { theme, language, setTheme, setLanguage } = useTheme()\n  const [saved, setSaved] = useState(false)\n  const router = useRouter()\n\n  const handleSave = () => {\n    setSaved(true)\n    setTimeout(() => setSaved(false), 3000)\n  }\n\n  useEffect(() => {\n    if (saved) {\n      console.log('Settings saved:', { theme, language })\n    }\n  }, [saved, theme, language])\n\n  const t = {\n    ar: {\n      title: 'الإعدادات',\n      subtitle: 'Settings',\n      themeSection: 'المظهر',\n      themeDesc: 'Theme',\n      lightMode: 'الوضع الفاتح',\n      darkMode: 'الوضع الداكن',\n      languageSection: 'اللغة',\n      languageDesc: 'Language',\n      arabic: 'العربية',\n      english: 'English',\n      saveButton: 'حفظ التغييرات',\n      savedMessage: 'تم حفظ الإعدادات بنجاح!'\n    },\n    en: {\n      title: 'Settings',\n      subtitle: 'الإعدادات',\n      themeSection: 'Appearance',\n      themeDesc: 'المظهر',\n      lightMode: 'Light Mode',\n      darkMode: 'Dark Mode',\n      languageSection: 'Language',\n      languageDesc: 'اللغة',\n      arabic: 'العربية',\n      english: 'English',\n      saveButton: 'Save Changes',\n      savedMessage: 'Settings saved successfully!'\n    }\n  }\n\n  const text = t[language]\n\n  return (\n    <div className=\"min-h-screen bg-[#F5F1E8] p-4 md:p-8\">\n      {/* Header */}\n      <div className=\"mb-8\">\n        <div className=\"flex items-center gap-4 mb-2\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => router.back()}\n            className=\"text-white hover:bg-white/20 p-2\"\n          >\n            <ArrowRight className=\"h-8 w-8 text-black\" />\n          </Button>\n          <div className=\"bg-[#004E89] p-3 rounded-xl\">\n            <Settings className=\"h-8 w-8 text-white\" />\n          </div>\n          <div>\n            <h1 className=\"text-4xl font-bold text-black\">{text.title}</h1>\n            <p className=\"text-black opacity-70\">{text.subtitle}</p>\n          </div>\n        </div>\n      </div>\n\n      {saved && (\n        <Alert variant=\"success\" dismissible onDismiss={() => setSaved(false)} className=\"mb-6\">\n          {text.savedMessage}\n        </Alert>\n      )}\n\n      {/* Theme Settings */}\n      <Card variant=\"elevated\" padding=\"lg\" className=\"mb-6 bg-[var(--card-bg)] border-2 border-[var(--border)]\">\n        <div className=\"flex items-center gap-3 mb-6\">\n          <Palette className=\"h-6 w-6 text-blue-600\" />\n          <div>\n            <h2 className=\"text-2xl font-bold text-[var(--foreground)]\">{text.themeSection}</h2>\n            <p className=\"text-sm text-[var(--foreground)] opacity-70\">{text.themeDesc}</p>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <button\n            onClick={() => {\n              setTheme('light')\n              handleSave()\n            }}\n            className={`p-6 rounded-xl border-2 transition-all ${\n              theme === 'light'\n                ? 'bg-blue-600 border-blue-600 text-white shadow-lg scale-105'\n                : 'bg-[var(--card-bg)] border-[var(--border)] text-[var(--foreground)] hover:border-blue-600'\n            }`}\n          >\n            <Sun className={`h-12 w-12 mx-auto mb-3 ${theme === 'light' ? 'text-white' : 'text-blue-600'}`} />\n            <div className=\"text-xl font-bold\">{text.lightMode}</div>\n          </button>\n\n          <button\n            onClick={() => {\n              setTheme('dark')\n              handleSave()\n            }}\n            className={`p-6 rounded-xl border-2 transition-all ${\n              theme === 'dark'\n                ? 'bg-blue-600 border-blue-600 text-white shadow-lg scale-105'\n                : 'bg-[var(--card-bg)] border-[var(--border)] text-[var(--foreground)] hover:border-blue-600'\n            }`}\n          >\n            <Moon className={`h-12 w-12 mx-auto mb-3 ${theme === 'dark' ? 'text-white' : 'text-blue-600'}`} />\n            <div className=\"text-xl font-bold\">{text.darkMode}</div>\n          </button>\n        </div>\n      </Card>\n\n      {/* Language Settings */}\n      <Card variant=\"elevated\" padding=\"lg\" className=\"mb-6 bg-[var(--card-bg)] border-2 border-[var(--border)]\">\n        <div className=\"flex items-center gap-3 mb-6\">\n          <Globe className=\"h-6 w-6 text-blue-600\" />\n          <div>\n            <h2 className=\"text-2xl font-bold text-[var(--foreground)]\">{text.languageSection}</h2>\n            <p className=\"text-sm text-[var(--foreground)] opacity-70\">{text.languageDesc}</p>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <button\n            onClick={() => {\n              setLanguage('ar')\n              handleSave()\n            }}\n            className={`p-6 rounded-xl border-2 transition-all ${\n              language === 'ar'\n                ? 'bg-blue-600 border-blue-600 text-white shadow-lg scale-105'\n                : 'bg-[var(--card-bg)] border-[var(--border)] text-[var(--foreground)] hover:border-blue-600'\n            }`}\n          >\n            <div className=\"text-6xl mb-3\">🇸🇦</div>\n            <div className=\"text-xl font-bold\">{text.arabic}</div>\n          </button>\n\n          <button\n            onClick={() => {\n              setLanguage('en')\n              handleSave()\n            }}\n            className={`p-6 rounded-xl border-2 transition-all ${\n              language === 'en'\n                ? 'bg-blue-600 border-blue-600 text-white shadow-lg scale-105'\n                : 'bg-[var(--card-bg)] border-[var(--border)] text-[var(--foreground)] hover:border-blue-600'\n            }`}\n          >\n            <div className=\"text-6xl mb-3\">🇬🇧</div>\n            <div className=\"text-xl font-bold\">{text.english}</div>\n          </button>\n        </div>\n      </Card>\n\n      {/* Preview Section */}\n      <Card variant=\"elevated\" padding=\"lg\" className=\"bg-[var(--card-bg)] border-2 border-[var(--border)]\">\n        <h3 className=\"text-xl font-bold text-[var(--foreground)] mb-4\">\n          {language === 'ar' ? 'معاينة' : 'Preview'}\n        </h3>\n        <div className=\"bg-[var(--background)] p-6 rounded-xl border-2 border-[var(--border)]\">\n          <p className=\"text-[var(--foreground)] text-lg mb-2\">\n            {language === 'ar'\n              ? 'هذا مثال على كيفية ظهور النصوص في الموقع'\n              : 'This is an example of how text will appear on the site'}\n          </p>\n          <div className=\"flex gap-3 mt-4\">\n            <Button variant=\"primary\" size=\"sm\">\n              {language === 'ar' ? 'زر أساسي' : 'Primary Button'}\n            </Button>\n            <Button variant=\"secondary\" size=\"sm\">\n              {language === 'ar' ? 'زر ثانوي' : 'Secondary Button'}\n            </Button>\n          </div>\n        </div>\n      </Card>\n\n      <footer className=\"mt-8 text-center text-sm text-black pb-4\">\n        Made with ❤️ by MA3K Company\n      </footer>\n    </div>\n  )\n}","size_bytes":7443},"app/api/admin/users/[id]/toggle/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session || (session.user.role !== 'ADMIN' && session.user.role !== 'ASSISTANT')) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const { id: userId } = await params\n\n    const user = await prisma.user.findUnique({\n      where: { id: userId }\n    })\n\n    if (!user) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 })\n    }\n\n    if (user.role === 'ADMIN') {\n      return NextResponse.json({ error: 'Cannot modify admin users' }, { status: 403 })\n    }\n\n    const updatedUser = await prisma.user.update({\n      where: { id: userId },\n      data: { isActive: !user.isActive }\n    })\n\n    await prisma.auditLog.create({\n      data: {\n        id: `audit_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        action: `User ${updatedUser.isActive ? 'activated' : 'deactivated'}`,\n        userId: session.user.id,\n        details: `${user.name} (${user.email}) was ${updatedUser.isActive ? 'activated' : 'deactivated'}`\n      }\n    })\n\n    return NextResponse.json(updatedUser)\n  } catch (error) {\n    console.error('Error toggling user status:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n","size_bytes":1576},"app/dashboard/page.tsx":{"content":"import { redirect } from 'next/navigation'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\n\nexport default async function DashboardPage() {\n  const session = await getServerSession(authOptions)\n\n  if (!session) {\n    redirect('/auth/login')\n  }\n\n  const role = session.user.role\n\n  if (role === 'STUDENT') {\n    redirect('/dashboard/student')\n  } else if (role === 'TEACHER') {\n    redirect('/dashboard/teacher')\n  } else if (role === 'ADMIN' || role === 'ASSISTANT') {\n    redirect('/dashboard/admin')\n  }\n\n  return null\n}\n","size_bytes":562},"components/layout/index.ts":{"content":"export { default as Navbar, NavLink } from './Navbar';\nexport type { NavbarProps, NavLinkProps } from './Navbar';\n\nexport { default as Sidebar, SidebarItem } from './Sidebar';\nexport type { SidebarProps, SidebarItemProps } from './Sidebar';\n\nexport { default as Footer } from './Footer';\nexport type { FooterProps } from './Footer';\n\nexport { default as Container } from './Container';\nexport type { ContainerProps } from './Container';\n","size_bytes":437},"components/layout/AppHeader.tsx":{"content":"'use client';\n\nimport React from 'react';\nimport Image from 'next/image';\nimport Link from 'next/link';\nimport { cn } from '@/lib/utils';\n\nexport interface AppHeaderProps {\n  variant?: 'marketing' | 'dashboard';\n  children?: React.ReactNode;\n  className?: string;\n  showLogo?: boolean;\n}\n\nconst AppHeader: React.FC<AppHeaderProps> = ({\n  variant = 'marketing',\n  children,\n  className,\n  showLogo = true,\n}) => {\n  const isMarketing = variant === 'marketing';\n  \n  return (\n    <header\n      className={cn(\n        'shadow-lg',\n        isMarketing ? 'bg-[#F5F1E8]' : 'bg-[#004E89] text-white',\n        className\n      )}\n    >\n      <div className=\"container mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n        <div\n          className={cn(\n            'flex items-center justify-between rounded-2xl px-6 py-4 shadow-lg',\n            isMarketing\n              ? 'backdrop-blur-sm bg-white/30 border-2 border-[#d4c9b8]'\n              : 'bg-transparent'\n          )}\n        >\n          <div className=\"flex items-center gap-3\">\n            {showLogo && (\n              <>\n                <div className=\"relative\">\n                  {isMarketing && (\n                    <div className=\"absolute inset-0 bg-[#004E89] blur-xl opacity-20 rounded-full\"></div>\n                  )}\n                  <Image\n                    src=\"/logo.png\"\n                    alt=\"Youspeak Logo\"\n                    width={50}\n                    height={50}\n                    priority\n                    className={cn(\n                      'relative',\n                      isMarketing ? 'w-12 h-12 sm:w-14 sm:h-14' : 'w-10 h-10 rounded-lg'\n                    )}\n                    style={{ width: 'auto', height: 'auto' }}\n                  />\n                </div>\n                <div>\n                  <Link href=\"/\">\n                    <span\n                      className={cn(\n                        'text-2xl sm:text-3xl font-bold',\n                        isMarketing ? 'text-black' : 'text-white'\n                      )}\n                    >\n                      Youspeak\n                    </span>\n                  </Link>\n                  {isMarketing && (\n                    <p className=\"text-xs text-gray-700\">Master English Today</p>\n                  )}\n                </div>\n              </>\n            )}\n          </div>\n          <div className=\"flex gap-3 items-center\">{children}</div>\n        </div>\n      </div>\n    </header>\n  );\n};\n\nexport default AppHeader;\n","size_bytes":2481},"contexts/ThemeContext.tsx":{"content":"'use client'\n\nimport React, { createContext, useContext, useEffect, useState } from 'react'\n\ntype Theme = 'light' | 'dark'\ntype Language = 'en' | 'ar'\n\ninterface ThemeContextType {\n  theme: Theme\n  language: Language\n  toggleTheme: () => void\n  toggleLanguage: () => void\n  setTheme: (theme: Theme) => void\n  setLanguage: (lang: Language) => void\n}\n\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined)\n\nexport function ThemeProvider({ children }: { children: React.ReactNode }) {\n  const [theme, setThemeState] = useState<Theme>('light')\n  const [language, setLanguageState] = useState<Language>('ar')\n  const [mounted, setMounted] = useState(false)\n\n  useEffect(() => {\n    setMounted(true)\n    const savedTheme = localStorage.getItem('theme') as Theme || 'light'\n    const savedLang = localStorage.getItem('language') as Language || 'ar'\n    setThemeState(savedTheme)\n    setLanguageState(savedLang)\n    \n    if (savedTheme === 'dark') {\n      document.documentElement.classList.add('dark')\n    }\n    document.documentElement.dir = savedLang === 'ar' ? 'rtl' : 'ltr'\n    document.documentElement.lang = savedLang\n  }, [])\n\n  const setTheme = (newTheme: Theme) => {\n    setThemeState(newTheme)\n    localStorage.setItem('theme', newTheme)\n    \n    if (newTheme === 'dark') {\n      document.documentElement.classList.add('dark')\n    } else {\n      document.documentElement.classList.remove('dark')\n    }\n  }\n\n  const setLanguage = (newLang: Language) => {\n    setLanguageState(newLang)\n    localStorage.setItem('language', newLang)\n    document.documentElement.dir = newLang === 'ar' ? 'rtl' : 'ltr'\n    document.documentElement.lang = newLang\n  }\n\n  const toggleTheme = () => {\n    setTheme(theme === 'light' ? 'dark' : 'light')\n  }\n\n  const toggleLanguage = () => {\n    setLanguage(language === 'en' ? 'ar' : 'en')\n  }\n\n  if (!mounted) {\n    return <>{children}</>\n  }\n\n  return (\n    <ThemeContext.Provider value={{ theme, language, toggleTheme, toggleLanguage, setTheme, setLanguage }}>\n      {children}\n    </ThemeContext.Provider>\n  )\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext)\n  if (context === undefined) {\n    throw new Error('useTheme must be used within a ThemeProvider')\n  }\n  return context\n}\n","size_bytes":2261},"app/auth/login/page.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport Link from 'next/link'\nimport { useRouter } from 'next/navigation'\nimport { signIn } from 'next-auth/react'\nimport Image from 'next/image'\nimport { Mail, Lock, ArrowLeft } from 'lucide-react'\nimport Button from '@/components/ui/Button'\nimport Input from '@/components/ui/Input'\nimport Card from '@/components/ui/Card'\nimport Alert from '@/components/ui/Alert'\nimport AppHeader from '@/components/layout/AppHeader'\nimport LanguageToggle from '@/components/LanguageToggle'\nimport { useTranslation } from '@/lib/hooks/useTranslation'\n\nexport default function LoginPage() {\n  const router = useRouter()\n  const { t } = useTranslation()\n  const [formData, setFormData] = useState({\n    email: '',\n    password: '',\n  })\n  const [error, setError] = useState('')\n  const [loading, setLoading] = useState(false)\n\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setError('')\n    setLoading(true)\n\n    try {\n      const result = await signIn('credentials', {\n        email: formData.email,\n        password: formData.password,\n        redirect: false,\n      })\n\n      if (result?.error) {\n        setError('Invalid email or password / البريد الإلكتروني أو كلمة المرور غير صحيحة')\n        return\n      }\n\n      router.push('/dashboard')\n      router.refresh()\n    } catch (err: any) {\n      setError('An error occurred during login / حدث خطأ أثناء تسجيل الدخول')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-[#F5F1E8] flex flex-col\">\n      <AppHeader variant=\"marketing\">\n        <Link\n          href=\"/auth/register\"\n          className=\"px-4 py-2 sm:px-6 sm:py-2 rounded-lg border-2 border-[#004E89] text-[#004E89] hover:bg-[#004E89] hover:text-white transition-colors text-sm sm:text-base\"\n        >\n          {t('register')}\n        </Link>\n      </AppHeader>\n\n      <div className=\"flex-1 flex items-center justify-center p-3 sm:p-4 md:p-6\">\n        <Card className=\"w-full max-w-md shadow-2xl bg-[#F5F1E8] border-2 border-[#d4c9b8]\">\n          <div className=\"flex justify-between items-center mb-4\">\n            <Link href=\"/\">\n              <Button variant=\"ghost\" size=\"sm\" className=\"gap-2\">\n                <ArrowLeft className=\"w-4 h-4\" />\n              </Button>\n            </Link>\n            <LanguageToggle />\n          </div>\n\n          <div className=\"flex items-center justify-center mb-6 sm:mb-8\">\n            <div className=\"w-20 h-20 sm:w-24 sm:h-24 bg-white rounded-2xl sm:rounded-3xl shadow-xl flex items-center justify-center\">\n              <Image\n                src=\"/logo.png\"\n                alt=\"Youspeak Logo\"\n                width={70}\n                height={70}\n                className=\"sm:w-[80px] sm:h-[80px]\"\n              />\n            </div>\n          </div>\n\n          <h1 className=\"text-2xl sm:text-3xl md:text-4xl font-bold text-center mb-2 sm:mb-3 bg-gradient-to-r from-[#004E89] to-[#0066CC] bg-clip-text text-transparent\">\n            {t('welcomeBack')}\n          </h1>\n          <p className=\"text-center text-gray-600 mb-6 sm:mb-8 text-sm sm:text-base\">\n            {t('signIn')}\n          </p>\n\n          {error && (\n            <Alert\n              variant=\"error\"\n              dismissible\n              onDismiss={() => setError('')}\n              className=\"mb-6\"\n            >\n              {error}\n            </Alert>\n          )}\n\n          <form onSubmit={handleSubmit} className=\"space-y-4 sm:space-y-6\">\n            <Input\n              label={t('email')}\n              type=\"email\"\n              placeholder=\"your@email.com\"\n              value={formData.email}\n              onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n              required\n              leftIcon={<Mail className=\"h-4 w-4 sm:h-5 sm:w-5\" />}\n              inputSize=\"md\"\n              labelClassName=\"text-black text-sm sm:text-base\"\n              inputClassName=\"bg-white text-black text-base\"\n            />\n\n            <Input\n              label={t('password')}\n              type=\"password\"\n              placeholder=\"••••••••\"\n              value={formData.password}\n              onChange={(e) => setFormData({ ...formData, password: e.target.value })}\n              required\n              leftIcon={<Lock className=\"h-4 w-4 sm:h-5 sm:w-5\" />}\n              inputSize=\"md\"\n              labelClassName=\"text-black text-sm sm:text-base\"\n              inputClassName=\"bg-white text-black text-base\"\n            />\n\n            <Button\n              type=\"submit\"\n              fullWidth\n              size=\"lg\"\n              loading={loading}\n              className=\"font-semibold bg-[#004E89] hover:bg-[#003A6B] text-white text-base sm:text-lg py-3 sm:py-4\"\n            >\n              {loading ? t('loading') : t('login')}\n            </Button>\n\n            <p className=\"text-center text-gray-600 mt-4 sm:mt-6 text-xs sm:text-sm\">\n              Don't have an account?{' '}\n              <Link href=\"/auth/register\" className=\"text-[#004E89] hover:text-[#003A6A] font-semibold\">\n                {t('register')}\n              </Link>\n            </p>\n          </form>\n        </Card>\n      </div>\n\n      <footer className=\"w-full py-4 sm:py-6 text-center text-sm sm:text-base text-black bg-[#F5F1E8] border-t-2 border-[#d4c9b8] mt-auto\">\n        <p className=\"px-4\">Made with ❤️ by MA3K Company</p>\n      </footer>\n    </div>\n  )\n}","size_bytes":5519},"components/ui/Tabs.tsx":{"content":"'use client';\n\nimport React, { useState, createContext, useContext } from 'react';\nimport { cn } from '@/lib/utils';\n\ninterface TabsContextValue {\n  activeTab: string;\n  setActiveTab: (value: string) => void;\n}\n\nconst TabsContext = createContext<TabsContextValue | undefined>(undefined);\n\nconst useTabs = () => {\n  const context = useContext(TabsContext);\n  if (!context) {\n    throw new Error('Tabs components must be used within a Tabs provider');\n  }\n  return context;\n};\n\nexport interface TabsProps {\n  defaultValue: string;\n  value?: string;\n  onValueChange?: (value: string) => void;\n  children: React.ReactNode;\n  className?: string;\n}\n\nconst Tabs: React.FC<TabsProps> & {\n  List: typeof TabsList;\n  Trigger: typeof TabsTrigger;\n  Content: typeof TabsContent;\n} = ({ defaultValue, value: controlledValue, onValueChange, children, className }) => {\n  const [uncontrolledValue, setUncontrolledValue] = useState(defaultValue);\n  const value = controlledValue ?? uncontrolledValue;\n\n  const handleValueChange = (newValue: string) => {\n    if (controlledValue === undefined) {\n      setUncontrolledValue(newValue);\n    }\n    onValueChange?.(newValue);\n  };\n\n  return (\n    <TabsContext.Provider value={{ activeTab: value, setActiveTab: handleValueChange }}>\n      <div className={cn('w-full', className)}>{children}</div>\n    </TabsContext.Provider>\n  );\n};\n\nexport interface TabsListProps {\n  children: React.ReactNode;\n  className?: string;\n  variant?: 'default' | 'pills';\n}\n\nconst TabsList: React.FC<TabsListProps> = ({ children, className, variant = 'default' }) => {\n  return (\n    <div\n      role=\"tablist\"\n      className={cn(\n        'inline-flex items-center justify-start w-full sm:w-auto',\n        variant === 'default' && 'border-b border-neutral-200 dark:border-neutral-800',\n        variant === 'pills' && 'gap-2 p-1 bg-neutral-100 dark:bg-neutral-800 rounded-lg',\n        className\n      )}\n    >\n      {children}\n    </div>\n  );\n};\n\nexport interface TabsTriggerProps {\n  value: string;\n  children: React.ReactNode;\n  className?: string;\n  disabled?: boolean;\n}\n\nconst TabsTrigger: React.FC<TabsTriggerProps> = ({ value, children, className, disabled }) => {\n  const { activeTab, setActiveTab } = useTabs();\n  const isActive = activeTab === value;\n\n  return (\n    <button\n      role=\"tab\"\n      aria-selected={isActive}\n      aria-controls={`tab-panel-${value}`}\n      id={`tab-${value}`}\n      disabled={disabled}\n      onClick={() => setActiveTab(value)}\n      className={cn(\n        'flex-1 sm:flex-initial inline-flex items-center justify-center whitespace-nowrap px-4 py-2.5 text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50',\n        isActive\n          ? 'border-b-2 border-primary text-primary dark:text-primary-400'\n          : 'text-neutral-600 hover:text-neutral-900 dark:text-neutral-400 dark:hover:text-neutral-100',\n        className\n      )}\n    >\n      {children}\n    </button>\n  );\n};\n\nexport interface TabsContentProps {\n  value: string;\n  children: React.ReactNode;\n  className?: string;\n}\n\nconst TabsContent: React.FC<TabsContentProps> = ({ value, children, className }) => {\n  const { activeTab } = useTabs();\n\n  if (activeTab !== value) {\n    return null;\n  }\n\n  return (\n    <div\n      role=\"tabpanel\"\n      id={`tab-panel-${value}`}\n      aria-labelledby={`tab-${value}`}\n      className={cn('mt-4 focus-visible:outline-none', className)}\n      tabIndex={0}\n    >\n      {children}\n    </div>\n  );\n};\n\nTabs.List = TabsList;\nTabs.Trigger = TabsTrigger;\nTabs.Content = TabsContent;\n\nexport default Tabs;\n","size_bytes":3683},"components/GrammarErrorHighlighter.tsx":{"content":"'use client'\n\nimport { useState } from 'react'\nimport { AlertCircle, X, Plus } from 'lucide-react'\nimport Button from './ui/Button'\n\ninterface GrammarError {\n  text: string\n  correction: string\n  explanation: string\n}\n\ninterface GrammarErrorHighlighterProps {\n  studentAnswer: string\n  errors: GrammarError[]\n  onErrorsChange: (errors: GrammarError[]) => void\n  readonly?: boolean\n}\n\nexport default function GrammarErrorHighlighter({\n  studentAnswer,\n  errors,\n  onErrorsChange,\n  readonly = false\n}: GrammarErrorHighlighterProps) {\n  const [selectedText, setSelectedText] = useState('')\n  const [showAddError, setShowAddError] = useState(false)\n  const [newError, setNewError] = useState({ text: '', correction: '', explanation: '' })\n\n  const handleTextSelection = () => {\n    const selection = window.getSelection()\n    const text = selection?.toString().trim()\n    if (text && !readonly) {\n      setSelectedText(text)\n      setNewError({ ...newError, text })\n      setShowAddError(true)\n    }\n  }\n\n  const handleAddError = () => {\n    if (newError.text && newError.correction) {\n      onErrorsChange([...errors, newError])\n      setNewError({ text: '', correction: '', explanation: '' })\n      setShowAddError(false)\n      setSelectedText('')\n    }\n  }\n\n  const handleRemoveError = (index: number) => {\n    onErrorsChange(errors.filter((_, i) => i !== index))\n  }\n\n  const escapeHtml = (text: string) => {\n    const div = document.createElement('div')\n    div.textContent = text\n    return div.innerHTML\n  }\n\n  const renderHighlightedText = () => {\n    const parts: Array<{ text: string; isError: boolean; errorIndex?: number }> = []\n    let lastIndex = 0\n    \n    const sortedErrors = errors.map((err, idx) => ({\n      ...err,\n      index: idx,\n      position: studentAnswer.indexOf(err.text)\n    })).filter(e => e.position !== -1).sort((a, b) => a.position - b.position)\n    \n    sortedErrors.forEach(error => {\n      if (error.position > lastIndex) {\n        parts.push({ text: studentAnswer.slice(lastIndex, error.position), isError: false })\n      }\n      parts.push({ text: error.text, isError: true, errorIndex: error.index })\n      lastIndex = error.position + error.text.length\n    })\n    \n    if (lastIndex < studentAnswer.length) {\n      parts.push({ text: studentAnswer.slice(lastIndex), isError: false })\n    }\n    \n    return parts\n  }\n\n  const highlightedParts = renderHighlightedText()\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"border border-gray-300 dark:border-gray-600 rounded-lg p-4 bg-white dark:bg-gray-800\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <h4 className=\"font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2\">\n            <AlertCircle className=\"w-4 h-4 text-red-500\" />\n            Student Answer / إجابة الطالب\n          </h4>\n          {!readonly && (\n            <span className=\"text-xs text-gray-600 dark:text-gray-400\">\n              حدد النص لإضافة خطأ / Select text to add error\n            </span>\n          )}\n        </div>\n        <div\n          className=\"text-gray-700 dark:text-gray-300 leading-relaxed whitespace-pre-wrap select-text\"\n          onMouseUp={handleTextSelection}\n        >\n          {highlightedParts.map((part, index) => \n            part.isError ? (\n              <mark\n                key={index}\n                className=\"bg-red-200 dark:bg-red-900 cursor-pointer relative group\"\n                title={`Error: ${errors[part.errorIndex!].correction}`}\n              >\n                {part.text}\n                <span className=\"hidden group-hover:block absolute bottom-full left-0 mb-2 p-2 bg-gray-900 text-white text-xs rounded shadow-lg w-64 z-10\">\n                  <strong className=\"text-green-400\">✓ {errors[part.errorIndex!].correction}</strong>\n                  {errors[part.errorIndex!].explanation && (\n                    <span className=\"block text-gray-300 mt-1\">{errors[part.errorIndex!].explanation}</span>\n                  )}\n                </span>\n              </mark>\n            ) : (\n              <span key={index}>{part.text}</span>\n            )\n          )}\n        </div>\n      </div>\n\n      {!readonly && showAddError && (\n        <div className=\"bg-blue-50 dark:bg-blue-900 border border-blue-200 dark:border-blue-700 rounded-lg p-4\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <h5 className=\"font-semibold text-blue-900 dark:text-blue-100\">\n              Add Grammar Error / إضافة خطأ نحوي\n            </h5>\n            <button\n              onClick={() => setShowAddError(false)}\n              className=\"text-blue-600 dark:text-blue-400 hover:text-blue-800\"\n            >\n              <X className=\"w-4 h-4\" />\n            </button>\n          </div>\n          <div className=\"space-y-3\">\n            <div>\n              <label className=\"block text-sm font-medium text-blue-900 dark:text-blue-100 mb-1\">\n                Incorrect Text / النص الخاطئ\n              </label>\n              <input\n                type=\"text\"\n                value={newError.text}\n                onChange={(e) => setNewError({ ...newError, text: e.target.value })}\n                className=\"w-full px-3 py-2 border border-blue-300 dark:border-blue-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100\"\n                placeholder=\"The selected text...\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-blue-900 dark:text-blue-100 mb-1\">\n                Correction / التصحيح *\n              </label>\n              <input\n                type=\"text\"\n                value={newError.correction}\n                onChange={(e) => setNewError({ ...newError, correction: e.target.value })}\n                className=\"w-full px-3 py-2 border border-blue-300 dark:border-blue-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100\"\n                placeholder=\"The correct form...\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-blue-900 dark:text-blue-100 mb-1\">\n                Explanation (Optional) / التوضيح (اختياري)\n              </label>\n              <textarea\n                value={newError.explanation}\n                onChange={(e) => setNewError({ ...newError, explanation: e.target.value })}\n                className=\"w-full px-3 py-2 border border-blue-300 dark:border-blue-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100\"\n                placeholder=\"Why this is incorrect...\"\n                rows={2}\n              />\n            </div>\n            <Button\n              variant=\"primary\"\n              size=\"sm\"\n              onClick={handleAddError}\n              disabled={!newError.text || !newError.correction}\n            >\n              <Plus className=\"w-3 h-3 mr-1\" />\n              Add Error / إضافة\n            </Button>\n          </div>\n        </div>\n      )}\n\n      {errors.length > 0 && (\n        <div className=\"space-y-2\">\n          <h5 className=\"font-semibold text-gray-900 dark:text-gray-100\">\n            Grammar Errors ({errors.length}) / الأخطاء النحوية\n          </h5>\n          {errors.map((error, index) => (\n            <div\n              key={index}\n              className=\"bg-red-50 dark:bg-red-900 border border-red-200 dark:border-red-700 rounded-lg p-3 flex items-start justify-between\"\n            >\n              <div className=\"flex-1\">\n                <p className=\"text-sm text-gray-900 dark:text-gray-100\">\n                  <span className=\"line-through text-red-600 dark:text-red-400\">{error.text}</span>\n                  {' → '}\n                  <span className=\"text-green-600 dark:text-green-400 font-semibold\">{error.correction}</span>\n                </p>\n                {error.explanation && (\n                  <p className=\"text-xs text-gray-700 dark:text-gray-300 mt-1\">{error.explanation}</p>\n                )}\n              </div>\n              {!readonly && (\n                <button\n                  onClick={() => handleRemoveError(index)}\n                  className=\"text-red-600 dark:text-red-400 hover:text-red-800 ml-2\"\n                >\n                  <X className=\"w-4 h-4\" />\n                </button>\n              )}\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  )\n}\n","size_bytes":8471},"DEPLOYMENT.md":{"content":"# Youspeak Deployment Guide\n\n## Environment Variables Required for Production\n\nWhen deploying to Render (or any production environment), make sure to set the following environment variables:\n\n### Database Configuration\n\nYou have two options for database configuration:\n\n#### Option 1: Using DATABASE_URL (Recommended for Render)\n```\nDATABASE_URL=postgresql://username:password@host:port/database?schema=youspeak_exercisein\n```\n\n#### Option 2: Using AWS Database Credentials (Alternative)\n```\nAWS_DB_HOST=your-db-host.region.rds.amazonaws.com\nAWS_DB_PORT=5432\nAWS_DB_NAME=your-database-name\nAWS_DB_USER=your-username\nAWS_DB_PASSWORD=your-password\n```\n\n### NextAuth Configuration\n```\nNEXTAUTH_SECRET=your-super-secret-key-here-minimum-32-characters\nNEXTAUTH_URL=https://your-app-domain.onrender.com\n```\n\n### Node Environment\n```\nNODE_ENV=production\n```\n\n## Deployment Steps for Render\n\n1. **Connect your GitHub repository** to Render\n\n2. **Set Environment Variables** in Render Dashboard:\n   - Go to your service settings\n   - Navigate to \"Environment\" tab\n   - Add all required environment variables listed above\n\n3. **Build Command:**\n   ```\n   npm install && npm run build\n   ```\n\n4. **Start Command:**\n   ```\n   npm start\n   ```\n\n5. **Important Notes:**\n   - The `lib/prisma.ts` file is configured to handle missing DATABASE_URL during build\n   - Make sure your database schema `youspeak_exercisein` exists before deployment\n   - Run `prisma db push` locally first to ensure schema is up to date\n\n## Test Accounts\n\nAfter deployment, you can test with these accounts:\n\n- **Admin:** admin@youspeak.com / 123456\n- **Teacher:** teacher@youspeak.com / 123456\n- **Student:** ahmed@student.com / 123456\n\n## Troubleshooting\n\n### Build fails with \"DATABASE_URL undefined\"\n- Make sure DATABASE_URL is set in environment variables\n- Or ensure all AWS_DB_* variables are set correctly\n\n### Database connection fails\n- Verify your database allows connections from Render's IP addresses\n- Check that your database credentials are correct\n- Ensure the schema `youspeak_exercisein` exists\n\n### NextAuth errors\n- Verify NEXTAUTH_SECRET is set and is at least 32 characters\n- Ensure NEXTAUTH_URL matches your production domain\n","size_bytes":2211},"components/LanguageToggle.tsx":{"content":"'use client'\n\nimport { Languages } from 'lucide-react'\nimport { useTheme } from '@/lib/contexts/ThemeContext'\n\nexport default function LanguageToggle() {\n  const { language, toggleLanguage } = useTheme()\n  \n  return (\n    <button\n      onClick={toggleLanguage}\n      className=\"flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors\"\n      aria-label=\"Toggle language\"\n    >\n      <Languages className=\"w-5 h-5 text-gray-700 dark:text-gray-300\" />\n      <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n        {language === 'ar' ? 'EN' : 'ع'}\n      </span>\n    </button>\n  )\n}\n","size_bytes":680},"app/dashboard/teacher/components/HomeTab.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { Calendar, Users, BookOpen, Clock, CheckCircle } from 'lucide-react'\nimport Card from '@/components/ui/Card'\nimport LoadingSpinner from '@/components/ui/LoadingSpinner'\nimport Badge from '@/components/ui/Badge'\n\ninterface Stats {\n  totalStudents: number\n  totalSessions: number\n  upcomingSessions: number\n  pendingGrading: number\n  nextSession: {\n    id: string\n    title: string\n    startTime: Date\n    endTime: Date\n    studentsCount: number\n  } | null\n}\n\nexport default function HomeTab({ teacherProfileId }: { teacherProfileId: string }) {\n  const [stats, setStats] = useState<Stats | null>(null)\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    fetchStats()\n  }, [])\n\n  async function fetchStats() {\n    try {\n      const response = await fetch('/api/teacher/stats')\n      if (response.ok) {\n        const data = await response.json()\n        setStats(data)\n      }\n    } catch (error) {\n      console.error('Error fetching stats:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <LoadingSpinner size=\"lg\" />\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <h2 className=\"text-3xl font-bold text-[#004E89]\">\n        Dashboard / لوحة التحكم\n      </h2>\n\n      <div className=\"grid md:grid-cols-4 gap-4\">\n        <Card variant=\"elevated\">\n          <div className=\"text-center\">\n            <div className=\"w-12 h-12 bg-blue-100 rounded-full mx-auto mb-3 flex items-center justify-center\">\n              <Users className=\"h-6 w-6 text-[#004E89]\" />\n            </div>\n            <h3 className=\"font-semibold text-gray-900 mb-1\">Total Students</h3>\n            <p className=\"text-2xl font-bold text-[#004E89]\">{stats?.totalStudents || 0}</p>\n            <p className=\"text-sm text-gray-600\">إجمالي الطلاب</p>\n          </div>\n        </Card>\n\n        <Card variant=\"elevated\">\n          <div className=\"text-center\">\n            <div className=\"w-12 h-12 bg-green-100 rounded-full mx-auto mb-3 flex items-center justify-center\">\n              <Calendar className=\"h-6 w-6 text-green-600\" />\n            </div>\n            <h3 className=\"font-semibold text-gray-900 mb-1\">Total Sessions</h3>\n            <p className=\"text-2xl font-bold text-[#004E89]\">{stats?.totalSessions || 0}</p>\n            <p className=\"text-sm text-gray-600\">إجمالي الحصص</p>\n          </div>\n        </Card>\n\n        <Card variant=\"elevated\">\n          <div className=\"text-center\">\n            <div className=\"w-12 h-12 bg-purple-100 rounded-full mx-auto mb-3 flex items-center justify-center\">\n              <Clock className=\"h-6 w-6 text-purple-600\" />\n            </div>\n            <h3 className=\"font-semibold text-gray-900 mb-1\">Upcoming Sessions</h3>\n            <p className=\"text-2xl font-bold text-[#004E89]\">{stats?.upcomingSessions || 0}</p>\n            <p className=\"text-sm text-gray-600\">حصص قادمة</p>\n          </div>\n        </Card>\n\n        <Card variant=\"elevated\">\n          <div className=\"text-center\">\n            <div className=\"w-12 h-12 bg-orange-100 rounded-full mx-auto mb-3 flex items-center justify-center\">\n              <BookOpen className=\"h-6 w-6 text-orange-600\" />\n            </div>\n            <h3 className=\"font-semibold text-gray-900 mb-1\">Pending Grading</h3>\n            <p className=\"text-2xl font-bold text-[#004E89]\">{stats?.pendingGrading || 0}</p>\n            <p className=\"text-sm text-gray-600\">في انتظار التصحيح</p>\n          </div>\n        </Card>\n      </div>\n\n      {stats?.nextSession && (\n        <Card variant=\"elevated\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center\">\n              <Calendar className=\"h-6 w-6 text-[#004E89]\" />\n            </div>\n            <div className=\"flex-1\">\n              <h3 className=\"font-semibold text-gray-900 flex items-center gap-2\">\n                Next Session / الحصة القادمة\n                <Badge variant=\"primary\">Upcoming</Badge>\n              </h3>\n              <p className=\"text-sm text-gray-700 font-medium\">{stats.nextSession.title}</p>\n              <p className=\"text-sm text-gray-600\">\n                {new Date(stats.nextSession.startTime).toLocaleString('ar-EG', {\n                  weekday: 'long',\n                  month: 'long',\n                  day: 'numeric',\n                  hour: '2-digit',\n                  minute: '2-digit'\n                })} • {stats.nextSession.studentsCount} students enrolled\n              </p>\n            </div>\n          </div>\n        </Card>\n      )}\n\n      <Card variant=\"elevated\" className=\"bg-gradient-to-r from-blue-50 to-purple-50\">\n        <h3 className=\"text-xl font-bold text-[#004E89] mb-4\">\n          Quick Actions / إجراءات سريعة\n        </h3>\n        <div className=\"grid md:grid-cols-2 gap-3\">\n          <div className=\"bg-white rounded-lg p-3 flex items-start gap-2 shadow-sm\">\n            <CheckCircle className=\"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5\" />\n            <div>\n              <p className=\"font-medium text-gray-900\">Create Sessions</p>\n              <p className=\"text-sm text-gray-600\">Schedule new classes in Sessions tab / جدولة حصص جديدة</p>\n            </div>\n          </div>\n          <div className=\"bg-white rounded-lg p-3 flex items-start gap-2 shadow-sm\">\n            <CheckCircle className=\"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5\" />\n            <div>\n              <p className=\"font-medium text-gray-900\">Grade Assignments</p>\n              <p className=\"text-sm text-gray-600\">Review homework in Assignments tab / مراجعة الواجبات</p>\n            </div>\n          </div>\n          <div className=\"bg-white rounded-lg p-3 flex items-start gap-2 shadow-sm\">\n            <CheckCircle className=\"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5\" />\n            <div>\n              <p className=\"font-medium text-gray-900\">Manage Students</p>\n              <p className=\"text-sm text-gray-600\">View student progress / عرض تقدم الطلاب</p>\n            </div>\n          </div>\n          <div className=\"bg-white rounded-lg p-3 flex items-start gap-2 shadow-sm\">\n            <CheckCircle className=\"h-5 w-5 text-orange-600 flex-shrink-0 mt-0.5\" />\n            <div>\n              <p className=\"font-medium text-gray-900\">Track Progress</p>\n              <p className=\"text-sm text-gray-600\">Monitor attendance and performance / متابعة الحضور والأداء</p>\n            </div>\n          </div>\n        </div>\n      </Card>\n    </div>\n  )\n}\n","size_bytes":6775},"app/session/[id]/SessionClient.tsx":{"content":"'use client'\n\nimport { useEffect, useRef, useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { Video, VideoOff, Users, ArrowLeft } from 'lucide-react'\nimport Button from '@/components/ui/Button'\nimport LoadingSpinner from '@/components/ui/LoadingSpinner'\n\ndeclare global {\n  interface Window {\n    JitsiMeetExternalAPI: any\n  }\n}\n\ninterface SessionClientProps {\n  sessionId: string\n  user: {\n    id: string\n    name: string\n    email: string\n    role: string\n  }\n}\n\ninterface SessionData {\n  id: string\n  title: string\n  description: string | null\n  startTime: string\n  endTime: string\n  teacherId: string\n  teacher: {\n    name: string\n  }\n}\n\nexport default function SessionClient({ sessionId, user }: SessionClientProps) {\n  const router = useRouter()\n  const jitsiContainer = useRef<HTMLDivElement>(null)\n  const [session, setSession] = useState<SessionData | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [jitsiApi, setJitsiApi] = useState<any>(null)\n\n  useEffect(() => {\n    fetchSession()\n  }, [sessionId])\n\n  useEffect(() => {\n    if (session && jitsiContainer.current && !jitsiApi) {\n      loadJitsiScript()\n    }\n\n    return () => {\n      if (jitsiApi) {\n        jitsiApi.dispose()\n      }\n    }\n  }, [session])\n\n  async function fetchSession() {\n    try {\n      const endpoint = user.role === 'TEACHER' \n        ? `/api/teacher/sessions/${sessionId}`\n        : `/api/student/sessions/${sessionId}`\n      \n      const response = await fetch(endpoint)\n      if (response.ok) {\n        const data = await response.json()\n        setSession(data)\n      } else {\n        alert('Session not found or you do not have access')\n        router.push('/dashboard')\n      }\n    } catch (error) {\n      console.error('Error fetching session:', error)\n      alert('Error loading session')\n      router.push('/dashboard')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  function loadJitsiScript() {\n    const script = document.createElement('script')\n    script.src = 'https://meet.jit.si/external_api.js'\n    script.async = true\n    script.onload = () => initializeJitsi()\n    document.body.appendChild(script)\n  }\n\n  function initializeJitsi() {\n    if (!jitsiContainer.current || !session) return\n\n    const domain = 'meet.jit.si'\n    const options = {\n      roomName: `YouSpeak_${sessionId}`,\n      width: '100%',\n      height: '100%',\n      parentNode: jitsiContainer.current,\n      userInfo: {\n        displayName: user.name,\n        email: user.email\n      },\n      configOverwrite: {\n        startWithAudioMuted: true,\n        startWithVideoMuted: true,\n        prejoinPageEnabled: true,\n        enableWelcomePage: false,\n        enableClosePage: false\n      },\n      interfaceConfigOverwrite: {\n        SHOW_JITSI_WATERMARK: false,\n        SHOW_WATERMARK_FOR_GUESTS: false,\n        TOOLBAR_BUTTONS: [\n          'microphone',\n          'camera',\n          'closedcaptions',\n          'desktop',\n          'fullscreen',\n          'fodeviceselection',\n          'hangup',\n          'profile',\n          'chat',\n          'recording',\n          'livestreaming',\n          'etherpad',\n          'sharedvideo',\n          'settings',\n          'raisehand',\n          'videoquality',\n          'filmstrip',\n          'stats',\n          'shortcuts',\n          'tileview',\n          'download',\n          'help',\n          'mute-everyone'\n        ]\n      }\n    }\n\n    const api = new window.JitsiMeetExternalAPI(domain, options)\n    setJitsiApi(api)\n\n    api.addEventListener('videoConferenceJoined', () => {\n      console.log('User joined the conference')\n    })\n\n    api.addEventListener('videoConferenceLeft', () => {\n      console.log('User left the conference')\n      router.push('/dashboard')\n    })\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-neutral-100 dark:bg-neutral-900 flex items-center justify-center\">\n        <LoadingSpinner />\n      </div>\n    )\n  }\n\n  if (!session) {\n    return null\n  }\n\n  return (\n    <div className=\"min-h-screen bg-neutral-100 dark:bg-neutral-900 flex flex-col\">\n      <div className=\"bg-white dark:bg-neutral-800 shadow-sm border-b border-neutral-200 dark:border-neutral-700 px-6 py-4\">\n        <div className=\"max-w-7xl mx-auto flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Button\n              variant=\"outline\"\n              onClick={() => router.push('/dashboard')}\n            >\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back / رجوع\n            </Button>\n            <div>\n              <h1 className=\"text-xl font-bold text-primary-600 dark:text-primary-300\">\n                {session.title}\n              </h1>\n              <p className=\"text-sm text-neutral-600 dark:text-neutral-400\">\n                Teacher: {session.teacher.name} | {new Date(session.startTime).toLocaleString()}\n              </p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Video className=\"h-5 w-5 text-primary-600 dark:text-primary-300\" />\n            <span className=\"text-sm font-medium text-primary-600 dark:text-primary-300\">Live Session</span>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"flex-1 p-6\">\n        <div className=\"max-w-7xl mx-auto h-full\">\n          <div \n            ref={jitsiContainer} \n            className=\"w-full h-full bg-gray-900 rounded-lg shadow-xl overflow-hidden\"\n            style={{ minHeight: '600px' }}\n          />\n        </div>\n      </div>\n    </div>\n  )\n}\n","size_bytes":5554},"app/dashboard/admin/AdminDashboardClient.tsx":{"content":"'use client'\n\nimport { useState } from 'react'\nimport { signOut } from 'next-auth/react'\nimport { useRouter } from 'next/navigation'\nimport { Home, Users, CreditCard, Activity, LogOut, Shield } from 'lucide-react'\nimport Button from '@/components/ui/Button'\nimport Card from '@/components/ui/Card'\nimport Badge from '@/components/ui/Badge'\nimport FloatingContactButtons from '@/components/FloatingContactButtons'\nimport HomeTab from './components/HomeTab'\nimport UsersTab from './components/UsersTab'\nimport SubscriptionsTab from './components/SubscriptionsTab'\nimport SystemTab from './components/SystemTab'\n\ninterface AdminDashboardClientProps {\n  user: {\n    name: string\n    email: string\n    role: string\n  }\n}\n\nexport default function AdminDashboardClient({ user }: AdminDashboardClientProps) {\n  const router = useRouter()\n  const [activeTab, setActiveTab] = useState('home')\n  const [sidebarOpen, setSidebarOpen] = useState(false)\n\n  const handleSignOut = async () => {\n    await signOut({ redirect: false })\n    router.push('/auth/login')\n  }\n\n  const menuItems = [\n    { id: 'home', label: 'Home / الرئيسية', icon: Home },\n    { id: 'users', label: 'Users / المستخدمين', icon: Users },\n    { id: 'subscriptions', label: 'Subscriptions / الاشتراكات', icon: CreditCard },\n    { id: 'system', label: 'System / النظام', icon: Activity },\n  ]\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-[#F5F5DC] to-white\">\n      <header className=\"bg-[#004E89] text-white shadow-lg\">\n        <div className=\"container mx-auto px-4 py-3 sm:py-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-2 sm:gap-4\">\n              <button\n                className=\"lg:hidden p-2 hover:bg-white/10 rounded-lg\"\n                onClick={() => setSidebarOpen(!sidebarOpen)}\n              >\n                <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h16\" />\n                </svg>\n              </button>\n              <Shield className=\"h-6 w-6 sm:h-8 sm:w-8\" />\n              <h1 className=\"text-xl sm:text-2xl font-bold\">Youspeak</h1>\n              <Badge variant=\"success\" className=\"hidden sm:inline-flex\">{user.role}</Badge>\n            </div>\n            <div className=\"flex items-center gap-2 sm:gap-4\">\n              <span className=\"text-xs sm:text-sm hidden sm:block\">{user.name}</span>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={handleSignOut}\n                className=\"text-white border-white hover:bg-white hover:text-[#004E89] text-xs sm:text-sm px-2 sm:px-4\"\n              >\n                <LogOut className=\"h-4 w-4 sm:mr-2\" />\n                <span className=\"hidden sm:inline\">Logout / خروج</span>\n              </Button>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"container mx-auto px-4 py-4 sm:py-6\">\n        <div className=\"flex flex-col lg:flex-row gap-4 sm:gap-6\">\n          {/* Mobile Sidebar Overlay */}\n          {sidebarOpen && (\n            <div\n              className=\"fixed inset-0 bg-black/50 z-40 lg:hidden\"\n              onClick={() => setSidebarOpen(false)}\n            />\n          )}\n\n          {/* Sidebar */}\n          <div className={`\n            fixed lg:static inset-y-0 left-0 z-50 lg:z-auto\n            w-64 lg:w-auto lg:flex-none\n            transform lg:transform-none transition-transform duration-300\n            ${sidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}\n          `}>\n            <Card variant=\"elevated\" padding=\"none\" className=\"h-full lg:h-auto\">\n              <div className=\"p-4 border-b border-gray-200\">\n                <div className=\"flex items-center justify-between lg:justify-start gap-3\">\n                  <div className=\"flex items-center gap-3 flex-1\">\n                    <div className=\"w-10 h-10 sm:w-12 sm:h-12 bg-[#004E89] rounded-full flex items-center justify-center\">\n                      <Shield className=\"h-5 w-5 sm:h-6 sm:w-6 text-white\" />\n                    </div>\n                    <div>\n                      <p className=\"font-semibold text-gray-900 text-sm sm:text-base\">{user.name}</p>\n                      <p className=\"text-xs sm:text-sm text-gray-600\">{user.role}</p>\n                    </div>\n                  </div>\n                  <button\n                    className=\"lg:hidden p-2 hover:bg-gray-100 rounded-lg\"\n                    onClick={() => setSidebarOpen(false)}\n                  >\n                    <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                    </svg>\n                  </button>\n                </div>\n              </div>\n              <nav className=\"p-2\">\n                {menuItems.map((item) => {\n                  const Icon = item.icon\n                  return (\n                    <button\n                      key={item.id}\n                      onClick={() => {\n                        setActiveTab(item.id)\n                        setSidebarOpen(false)\n                      }}\n                      className={`w-full flex items-center gap-3 px-3 sm:px-4 py-2 sm:py-3 rounded-lg transition-colors mb-1 ${\n                        activeTab === item.id\n                          ? 'bg-[#004E89] text-white'\n                          : 'text-gray-700 hover:bg-gray-100'\n                      }`}\n                    >\n                      <Icon className=\"h-5 w-5\" />\n                      <span className=\"text-xs sm:text-sm font-medium\">{item.label}</span>\n                    </button>\n                  )\n                })}\n              </nav>\n            </Card>\n          </div>\n\n          <div className=\"flex-1 min-w-0\">\n            {activeTab === 'home' && <HomeTab />}\n            {activeTab === 'users' && <UsersTab />}\n            {activeTab === 'subscriptions' && <SubscriptionsTab />}\n            {activeTab === 'system' && <SystemTab />}\n          </div>\n        </div>\n      </div>\n      <FloatingContactButtons />\n    </div>\n  )\n}","size_bytes":6336},"types/next-auth.d.ts":{"content":"import NextAuth from 'next-auth'\n\ndeclare module 'next-auth' {\n  interface User {\n    id: string\n    email: string\n    name: string\n    role: string\n    isActive: boolean\n  }\n\n  interface Session {\n    user: {\n      id: string\n      email: string\n      name: string\n      role: string\n      isActive: boolean\n    }\n  }\n}\n\ndeclare module 'next-auth/jwt' {\n  interface JWT {\n    id: string\n    role: string\n    isActive: boolean\n  }\n}\n","size_bytes":433}},"version":2}